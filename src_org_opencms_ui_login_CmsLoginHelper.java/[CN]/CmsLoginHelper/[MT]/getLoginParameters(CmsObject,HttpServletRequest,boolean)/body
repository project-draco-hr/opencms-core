{
  String authToken=request.getParameter(PARAM_AUTHTOKEN);
  String actionLogout=CmsRequestUtil.getNotEmptyParameter(request,PARAM_ACTION_LOGOUT);
  boolean logout=Boolean.valueOf(actionLogout).booleanValue();
  String oufqn=request.getParameter(PARAM_OUFQN);
  if (oufqn == null) {
    oufqn=getPreDefOuFqn(cms,request,logout);
  }
  String pcType=getPcType(request);
  String username=CmsRequestUtil.getNotEmptyParameter(request,PARAM_USERNAME);
  if (username != null) {
    username=username.trim();
  }
  if ((pcType == null) || PCTYPE_PRIVATE.equals(pcType)) {
    Cookie userNameCookie=getCookie(request,COOKIE_USERNAME);
    if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(userNameCookie.getValue()) && !"null".equals(userNameCookie.getValue())) {
      if (username == null) {
        username=userNameCookie.getValue();
      }
      if (pcType == null) {
        pcType=PCTYPE_PRIVATE;
      }
    }
    if (oufqn != null) {
      Cookie ouFqnCookie=getCookie(request,COOKIE_OUFQN);
      if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(ouFqnCookie.getValue()) && !"null".equals(ouFqnCookie.getValue())) {
        oufqn=ouFqnCookie.getValue();
      }
    }
  }
  String requestedWorkplaceApp=null;
  String requestedResource=CmsRequestUtil.getNotEmptyParameter(request,CmsWorkplaceManager.PARAM_LOGIN_REQUESTED_RESOURCE);
  if (workplaceUiRequest && (requestedResource == null)) {
    requestedWorkplaceApp=request.getRequestURL().toString();
  }
 else   if (requestedResource == null) {
    requestedResource=CmsFrameset.JSP_WORKPLACE_URI;
  }
  Locale locale=getLocaleForRequest(request);
  return new LoginParameters(username,pcType,oufqn,requestedResource,requestedWorkplaceApp,locale,authToken,logout);
}
