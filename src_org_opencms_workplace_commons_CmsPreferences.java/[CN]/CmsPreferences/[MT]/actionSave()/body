{
  HttpServletRequest request=getJsp().getRequest();
  request.setAttribute(SESSION_WORKPLACE_CLASS,this);
  CmsUserSettings userSettings=new CmsUserSettings(getCms(),getSettings().getUser());
  m_userSettings.setEditorSettings(userSettings.getEditorSettings());
  m_userSettings.setSynchronizeSettings(userSettings.getSynchronizeSettings());
  Enumeration en=request.getParameterNames();
  while (en.hasMoreElements()) {
    String paramName=(String)en.nextElement();
    if (paramName.startsWith(PARAM_PREFERREDEDITOR_PREFIX)) {
      String paramValue=request.getParameter(paramName);
      if (paramValue != null && !INPUT_DEFAULT.equals(paramValue.trim())) {
        m_userSettings.setPreferredEditor(paramName.substring(PARAM_PREFERREDEDITOR_PREFIX.length()),CmsEncoder.decode(paramValue));
      }
 else {
        m_userSettings.setPreferredEditor(paramName.substring(PARAM_PREFERREDEDITOR_PREFIX.length()),null);
      }
    }
  }
  m_userSettings.setUser(getSettings().getUser());
  try {
    m_userSettings.save(getCms());
  }
 catch (  CmsException e) {
    if (LOG.isInfoEnabled()) {
      LOG.info(e.getLocalizedMessage());
    }
  }
  updatePreferences(getCms(),getJsp().getRequest());
  try {
    String projectName=m_userSettings.getStartProject();
    CmsProject project=getCms().readProject(projectName);
    getCms().getRequestContext().setCurrentProject(project);
    getSettings().setProject(project.getId());
  }
 catch (  Exception e) {
    LOG.error(e.getLocalizedMessage());
  }
  try {
    if (DIALOG_SET.equals(getParamAction())) {
      Map params=new HashMap();
      params.put(PARAM_TAB,String.valueOf(getActiveTab()));
      params.put(PARAM_SETPRESSED,Boolean.TRUE.toString());
      sendForward(getJsp().getRequestContext().getUri(),params);
    }
 else {
      Map params=new HashMap();
      params.put(PARAM_ACTION,DIALOG_RELOAD);
      sendForward(getJsp().getRequestContext().getUri(),params);
    }
  }
 catch (  IOException e) {
    if (LOG.isInfoEnabled()) {
      LOG.info(e.getLocalizedMessage());
    }
  }
catch (  ServletException e) {
    if (LOG.isInfoEnabled()) {
      LOG.info(e.getLocalizedMessage());
    }
  }
}
