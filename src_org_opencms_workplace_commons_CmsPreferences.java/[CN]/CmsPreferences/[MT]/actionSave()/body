{
  HttpServletRequest request=getJsp().getRequest();
  request.setAttribute(C_SESSION_WORKPLACE_CLASS,this);
  Enumeration en=request.getParameterNames();
  while (en.hasMoreElements()) {
    String paramName=(String)en.nextElement();
    if (paramName.startsWith(PARAM_PREFERREDEDITOR_PREFIX)) {
      String paramValue=request.getParameter(paramName);
      if (paramValue != null && !INPUT_DEFAULT.equals(paramValue.trim())) {
        m_userSettings.setPreferredEditor(paramName.substring(PARAM_PREFERREDEDITOR_PREFIX.length()),paramValue);
      }
 else {
        m_userSettings.setPreferredEditor(paramName.substring(PARAM_PREFERREDEDITOR_PREFIX.length()),null);
      }
    }
  }
  m_userSettings.setUser(getSettings().getUser());
  try {
    m_userSettings.save(getCms());
  }
 catch (  CmsException e) {
    if (LOG.isInfoEnabled()) {
      LOG.info(e.getLocalizedMessage());
    }
  }
  CmsWorkplaceAction.updatePreferences(getCms(),getJsp().getRequest());
  try {
    String projectName=m_userSettings.getStartProject();
    CmsProject project=getCms().readProject(projectName);
    getCms().getRequestContext().setCurrentProject(project);
    getSettings().setProject(project.getId());
  }
 catch (  Exception e) {
    LOG.error(e.getLocalizedMessage());
  }
  try {
    if (DIALOG_SET.equals(getParamAction())) {
      sendCmsRedirect(getJsp().getRequestContext().getUri() + "?" + PARAM_TAB+ "="+ getActiveTab()+ "&"+ PARAM_SETPRESSED+ "=true");
    }
 else {
      sendCmsRedirect(getJsp().getRequestContext().getUri() + "?" + PARAM_ACTION+ "="+ DIALOG_RELOAD);
    }
  }
 catch (  IOException e) {
    if (LOG.isInfoEnabled()) {
      LOG.info(e.getLocalizedMessage());
    }
  }
}
