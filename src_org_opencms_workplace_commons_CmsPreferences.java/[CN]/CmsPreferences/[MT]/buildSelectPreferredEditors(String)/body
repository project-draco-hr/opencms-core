{
  StringBuffer result=new StringBuffer(1024);
  HttpServletRequest request=getJsp().getRequest();
  if (htmlAttributes != null) {
    htmlAttributes+=" name=\"" + PARAM_PREFERREDEDITOR_PREFIX;
  }
  Map resourceEditors=OpenCms.getWorkplaceManager().getWorkplaceEditorManager().getConfigurableEditors();
  if (resourceEditors != null) {
    Iterator i=resourceEditors.keySet().iterator();
    while (i.hasNext()) {
      String currentResourceType=(String)i.next();
      SortedMap availableEditors=(TreeMap)resourceEditors.get(currentResourceType);
      if (availableEditors != null && availableEditors.size() > 0) {
        String preSelection=computeEditorPreselection(request,currentResourceType);
        List options=new ArrayList(availableEditors.size() + 1);
        List values=new ArrayList(availableEditors.size() + 1);
        options.add(key("preferences.editor.best"));
        values.add(INPUT_DEFAULT);
        int selectedIndex=0;
        int counter=1;
        while (availableEditors.size() > 0) {
          Float key=(Float)availableEditors.lastKey();
          CmsWorkplaceEditorConfiguration conf=(CmsWorkplaceEditorConfiguration)availableEditors.get(key);
          options.add(key(conf.getEditorLabel()));
          values.add(conf.getEditorUri());
          if (conf.getEditorUri().equals(preSelection)) {
            selectedIndex=counter;
          }
          counter++;
          availableEditors.remove(key);
        }
        result.append("<tr>\n\t<td style=\"white-space: nowrap;\">");
        String localizedName=key("fileicon." + currentResourceType);
        if (localizedName.startsWith(CmsMessages.C_UNKNOWN_KEY_EXTENSION)) {
          localizedName=currentResourceType;
        }
        result.append(localizedName);
        result.append("</td>\n\t<td>");
        result.append(buildSelect(htmlAttributes + currentResourceType + "\"",options,values,selectedIndex));
        result.append("</td>\n</tr>\n");
      }
    }
  }
  return result.toString();
}
