{
  getJsp().getRequest().setAttribute(C_SESSION_WORKPLACE_CLASS,this);
  String oldPwd=getParamOldPassword();
  String newPwd=getParamNewPassword();
  setAction(ACTION_DEFAULT);
  setParamOldPassword(null);
  setParamNewPassword(null);
  if (oldPwd != null && !"".equals(oldPwd.trim()) && newPwd != null && !"".equals(newPwd.trim())) {
    try {
      getCms().setPassword(getSettings().getUser().getName(),oldPwd,newPwd);
    }
 catch (    CmsSecurityException e) {
      setAction(ACTION_ERROR);
      setParamErrorstack(CmsException.getStackTraceAsString(e));
      setParamMessage(key("error.message.chpwd"));
      setParamReasonSuggestion(key("error.reason.chpwd4") + "<br>\n" + key("error.suggestion.chpwd3")+ "\n");
      getJsp().include(C_FILE_DIALOG_SCREEN_ERROR);
    }
catch (    CmsException e) {
      setAction(ACTION_ERROR);
      setParamErrorstack(CmsException.getStackTraceAsString(e));
      setParamMessage(key("error.message.chpwd"));
      setParamReasonSuggestion(key("error.reason.chpwd2") + "<br>\n" + key("error.suggestion.chpwd2")+ "\n");
      getJsp().include(C_FILE_DIALOG_SCREEN_ERROR);
    }
  }
 else {
    CmsException e=new CmsException("The password values you entered are not valid.");
    setAction(ACTION_ERROR);
    setParamErrorstack(CmsException.getStackTraceAsString(e));
    setParamMessage(key("error.message.chpwd"));
    setParamReasonSuggestion(key("error.reason.chpwd2") + "<br>\n" + key("error.suggestion.chpwd2")+ "\n");
    getJsp().include(C_FILE_DIALOG_SCREEN_ERROR);
  }
}
