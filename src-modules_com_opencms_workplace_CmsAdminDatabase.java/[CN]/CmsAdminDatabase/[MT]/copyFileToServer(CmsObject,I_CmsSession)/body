{
  String filename=null;
  Enumeration files=CmsXmlTemplateLoader.getRequest(cms.getRequestContext()).getFileNames();
  while (files.hasMoreElements()) {
    filename=(String)files.nextElement();
  }
  if (filename != null) {
    session.putValue(C_PARA_RESOURCE,filename);
  }
  filename=(String)session.getValue(C_PARA_RESOURCE);
  byte[] filecontent=new byte[0];
  if (filename != null) {
    filecontent=CmsXmlTemplateLoader.getRequest(cms.getRequestContext()).getFile(filename);
  }
  if (filecontent != null) {
    session.putValue(C_PARA_FILECONTENT,filecontent);
  }
  filecontent=(byte[])session.getValue(C_PARA_FILECONTENT);
  File discFolder=new File(OpenCms.getSystemInfo().getAbsoluteRfsPathRelativeToWebInf(OpenCms.getSystemInfo().getPackagesRfsPath() + File.separator));
  if (!discFolder.exists()) {
    boolean success=discFolder.mkdir();
    if (OpenCms.getLog(this).isWarnEnabled() && (!success)) {
      OpenCms.getLog(this).warn("Couldn't create folder " + discFolder.getAbsolutePath());
    }
  }
  File discFile=new File(OpenCms.getSystemInfo().getAbsoluteRfsPathRelativeToWebInf(OpenCms.getSystemInfo().getPackagesRfsPath() + File.separator + filename));
  try {
    OutputStream s=new FileOutputStream(discFile);
    s.write(filecontent);
    s.close();
  }
 catch (  Exception e) {
    throw new CmsLegacyException("[" + this.getClass().getName() + "] "+ e.getMessage());
  }
  return filename;
}
