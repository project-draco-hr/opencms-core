{
  boolean cacheNavEnabled=!getRequestContext().currentProject().isOnlineProject();
  String cacheKey=null;
  if (cacheNavEnabled) {
    StringBuffer key=new StringBuffer(8);
    key.append(getRequestContext().getSiteRoot());
    key.append("_");
    key.append(getHeadNavFolder().hashCode());
    key.append("_");
    key.append(getStartFolder().hashCode());
    key.append("_");
    key.append(getMenuDepth());
    key.append("_");
    key.append(showMenus());
    key.append("_");
    key.append(showAccessibleVersion());
    key.append("_");
    key.append(getLocale());
    if (isHeadNavManual()) {
      key.append("_");
      key.append(getConfigPath().hashCode());
    }
    cacheKey=key.toString();
    String cachedNav=CmsTemplateParts.getInstance().getPart(cacheKey);
    if (CmsStringUtil.isNotEmpty(cachedNav)) {
      return cachedNav;
    }
  }
  StringBuffer result=new StringBuffer(4096);
  if (showMenus()) {
    boolean manualHeadConfig=isHeadNavManual();
    List navElements=new ArrayList();
    if (manualHeadConfig) {
      navElements=getHeadNavItemsFromConfig(0,"0");
    }
 else {
      navElements=getNavigation().getNavigationForFolder(getHeadNavFolder());
    }
    int count=-1;
    String showItemProperty;
    for (int i=0; i < navElements.size(); i++) {
      CmsJspNavElement foldernav=(CmsJspNavElement)navElements.get(i);
      showItemProperty=getHeadNavItemDefaultStringValue();
      if (getCmsObject().existsResource(foldernav.getResourceName())) {
        showItemProperty=property(PROPERTY_HEADNAV_USE,foldernav.getResourceName(),getHeadNavItemDefaultStringValue());
      }
 else       if (LOG.isWarnEnabled()) {
        LOG.warn(Messages.get().getBundle().key(Messages.LOG_NAVIGATION_CONFIG_ERR_2,foldernav.getResourceName(),getRequestContext().getUri()));
      }
      boolean showItem=Boolean.valueOf(showItemProperty).booleanValue();
      if (manualHeadConfig || (foldernav.isFolderLink() && showItem)) {
        count++;
        String subfolder=foldernav.getResourceName();
        List subNav=new ArrayList();
        String menuIndexes=null;
        if (manualHeadConfig) {
          menuIndexes=String.valueOf(i);
          subNav=getHeadNavItemsFromConfig(1,menuIndexes);
        }
 else {
          subNav=getNavigation().getNavigationForFolder(subfolder);
        }
        result.append(getMenuNavigation(subNav,styleClass,"menu" + count,1,menuIndexes));
      }
    }
    if (cacheNavEnabled) {
      CmsTemplateParts.getInstance().addPart(cacheKey,result.toString());
    }
  }
  return result.toString();
}
