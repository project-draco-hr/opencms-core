{
  boolean firstItem=true;
  StringBuffer result=new StringBuffer(1024);
  result.append("<div class=\"");
  result.append(styleLink);
  result.append("\">\n");
  result.append("\t<!-- Start Topnavigation -->\n");
  boolean showHomeLink=Boolean.valueOf(getConfigurationValue("headnav.homelink/link.show",CmsStringUtil.TRUE)).booleanValue();
  if (showHomeLink && !showHeadNavImages()) {
    boolean onlyIndex=Boolean.valueOf(getConfigurationValue("headnav.homelink/link.onlyindex",CmsStringUtil.FALSE)).booleanValue();
    String url=getStartFolder();
    String target="_self";
    if ((onlyIndex && isDefaultFile(getStartFolder(),getRequestContext().getUri())) || (!onlyIndex)) {
      url=getConfigurationValue("headnav.homelink/link.url",getStartFolder());
      homeLabel=getConfigurationValue("headnav.homelink/link.text",homeLabel);
      target=getConfigurationValue("headnav.homelink/link.target","_self");
    }
    if (url.startsWith("/")) {
      url=link(url);
    }
    homeLabel=homeLabel.toUpperCase();
    result.append("<a class=\"");
    result.append(styleLink);
    result.append("\" href=\"");
    result.append(url);
    result.append("\" title=\"");
    result.append(homeLabel);
    result.append("\" target=\"");
    result.append(target);
    result.append("\">");
    result.append(homeLabel);
    result.append("</a>\n");
    firstItem=false;
  }
 else   if (showHeadNavImages()) {
    result.append("<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tr>");
  }
  int count=-1;
  String showItemProperty;
  boolean manualHeadConfig=isHeadNavManual();
  List navElements;
  if (manualHeadConfig) {
    navElements=getHeadNavItemsFromConfig(0,"0");
  }
 else {
    navElements=getNavigation().getNavigationForFolder(getHeadNavFolder());
  }
  for (int i=0; i < navElements.size(); i++) {
    CmsJspNavElement nav=(CmsJspNavElement)navElements.get(i);
    String link=nav.getResourceName();
    if (link.startsWith("/")) {
      link=link(link);
    }
    showItemProperty=getHeadNavItemDefaultStringValue();
    if (getCmsObject().existsResource(nav.getResourceName())) {
      showItemProperty=property(PROPERTY_HEADNAV_USE,nav.getResourceName(),getHeadNavItemDefaultStringValue());
    }
 else     if (LOG.isWarnEnabled()) {
      LOG.warn(Messages.get().getBundle().key(Messages.LOG_NAVIGATION_CONFIG_ERR_2,nav.getResourceName(),getRequestContext().getUri()));
    }
    boolean showItem=Boolean.valueOf(showItemProperty).booleanValue();
    if (manualHeadConfig || (nav.isFolderLink() && showItem)) {
      count++;
      String navText=CmsEncoder.escapeXml(nav.getNavText().toUpperCase());
      String target=nav.getInfo();
      if (CmsStringUtil.isEmpty(target)) {
        target="_self";
      }
      if (showHeadNavImages()) {
        result.append("<td style= \"vertical-align: middle\">");
        result.append("<a");
        if (showMenus()) {
          result.append(" onmouseover=\"buttonMouseover(event, 'menu");
          result.append(count);
          result.append("');\"");
          if (getHeadNavMenuClick()) {
            result.append(" onclick=\"return buttonClick(event, 'menu");
            result.append(count);
            result.append("');\"");
          }
        }
        result.append(" title=\"");
        result.append(navText);
        result.append("\" href=\"");
        result.append(link);
        result.append("\" target=\"");
        result.append(target);
        result.append("\">");
        result.append("<img src=\"");
        result.append(link(nav.getNavImage()));
        result.append("\" border=\"0\" alt=\"");
        result.append(navText);
        result.append("\">");
        result.append("</a></td>\n");
      }
 else {
        if (!firstItem) {
          result.append("<span class=\"");
          result.append(styleSeparator);
          result.append("\">|</span>\n");
        }
        result.append("<a");
        if (showMenus()) {
          result.append(" onmouseover=\"buttonMouseover(event, 'menu");
          result.append(count);
          result.append("');\"");
          if (getHeadNavMenuClick()) {
            result.append(" onclick=\"return buttonClick(event, 'menu");
            result.append(count);
            result.append("');\"");
          }
        }
        if (getHeadNavMarkCurrent() && getRequestContext().getUri().startsWith(nav.getResourceName())) {
          result.append(" style=\"font-weight: bold;\"");
        }
        result.append(" class=\"");
        result.append(styleLink);
        result.append("\" title=\"");
        result.append(navText);
        result.append("\" href=\"");
        result.append(link);
        result.append("\" target=\"");
        result.append(target);
        result.append("\">");
        result.append(navText);
        result.append("</a>\n");
      }
      firstItem=false;
    }
  }
  if (showHeadNavImages()) {
    result.append("</tr></table>");
  }
  result.append("\t<!-- End Topnavigation -->\n");
  result.append("</div>\n");
  return result.toString();
}
