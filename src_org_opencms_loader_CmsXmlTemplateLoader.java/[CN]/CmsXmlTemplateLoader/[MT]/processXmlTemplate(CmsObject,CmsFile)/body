{
  if ((DEBUG > 0) && I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
    A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_CRITICAL,getClassName() + "Loader started for " + file.getResourceName());
  }
  String errorMessage=null;
  if (file == null) {
    errorMessage="Got \"null\" CmsFile object. :-(";
  }
  if (cms == null) {
    errorMessage="Actual cms object missing";
  }
  if (errorMessage != null) {
    if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
      A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_CRITICAL,getClassName() + errorMessage);
    }
    throw new CmsException(errorMessage,CmsException.C_LOADER_ERROR);
  }
  String clearcache=cms.getRequestContext().getRequest().getParameter("_clearcache");
  clearLoaderCache(cms,((clearcache != null) && ("all".equals(clearcache) || "file".equals(clearcache))),((clearcache != null) && ("all".equals(clearcache) || "template".equals(clearcache))));
  I_CmsRequest req=cms.getRequestContext().getRequest();
  byte[] result=null;
  result=generateOutput(cms,file,req);
  if (result != null) {
    writeBytesToResponse(cms,result);
  }
}
