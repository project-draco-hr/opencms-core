{
  if (OpenCms.getLog(CmsLog.CHANNEL_WORKPLACE_XML).isWarnEnabled() && C_DEBUG) {
    OpenCms.getLog(CmsLog.CHANNEL_WORKPLACE_XML).warn(this.getClassName() + "getting content of element " + ((elementName == null) ? "<root>" : elementName));
    OpenCms.getLog(CmsLog.CHANNEL_WORKPLACE_XML).warn(this.getClassName() + "template file is: " + templateFile);
    OpenCms.getLog(CmsLog.CHANNEL_WORKPLACE_XML).warn(this.getClassName() + "selected template section is: " + ((templateSelector == null) ? "<default>" : templateSelector));
  }
  CmsXmlWpTemplateFile xmlTemplateDocument=(CmsXmlWpTemplateFile)getOwnTemplateFile(cms,templateFile,elementName,parameters,templateSelector);
  CmsProject project=null;
  I_CmsSession session=cms.getRequestContext().getSession(true);
  String action=(String)parameters.get("action");
  String projectId=(String)parameters.get("projectid");
  if (projectId == null || "".equals(projectId)) {
    projectId=(String)session.getValue("delprojectid");
  }
 else {
    session.putValue("delprojectid",projectId);
  }
  if (parameters.get("ok") != null) {
    if (action == null) {
      project=cms.readProject(Integer.parseInt(projectId));
      A_CmsReportThread doDelete=new CmsProjectDeleteThread(cms,Integer.parseInt(projectId));
      doDelete.start();
      session.putValue(C_DELETE_THREAD,doDelete);
      xmlTemplateDocument.setData("time","10");
      templateSelector="wait";
    }
 else     if ("working".equals(action)) {
      A_CmsReportThread doDelete=(A_CmsReportThread)session.getValue(C_DELETE_THREAD);
      if (doDelete.isAlive()) {
        String time=(String)parameters.get("time");
        int wert=Integer.parseInt(time);
        wert+=2;
        xmlTemplateDocument.setData("time","" + wert);
        templateSelector="wait";
      }
 else {
        Throwable error=doDelete.getError();
        if (error == null) {
          CmsXmlWpTemplateFile.clearcache();
          templateSelector="done";
          if (cms.getRequestContext().currentProject().getId() == I_CmsConstants.C_PROJECT_ONLINE_ID) {
            xmlTemplateDocument.setData("onlineId","" + I_CmsConstants.C_PROJECT_ONLINE_ID);
            xmlTemplateDocument.setData("switchjavascript",xmlTemplateDocument.getProcessedDataValue("switchheadproject"));
          }
 else {
            xmlTemplateDocument.setData("switchjavascript",xmlTemplateDocument.getProcessedDataValue("dontswitchheadproject"));
          }
          session.removeValue("delprojectid");
        }
 else {
          xmlTemplateDocument.setData("details",Utils.getStackTrace(error));
          templateSelector="error";
          session.removeValue("delprojectid");
        }
      }
    }
  }
 else {
    project=cms.readProject(Integer.parseInt(projectId));
    CmsXmlLanguageFile lang=xmlTemplateDocument.getLanguageFile();
    CmsProjectlist.setListEntryData(cms,lang,xmlTemplateDocument,project);
  }
  return startProcessing(cms,xmlTemplateDocument,elementName,parameters,templateSelector);
}
