{
  if (resource == null) {
    String uri=cms.getRequestContext().getUri();
    if (uri.startsWith(PERMALINK_HANDLER)) {
      String id=uri.substring(PERMALINK_HANDLER.length());
      String storedSiteRoot=cms.getRequestContext().getSiteRoot();
      try {
        cms.getRequestContext().setSiteRoot("/");
        int pos=id.indexOf('.');
        if (pos > -1) {
          id=id.substring(0,id.indexOf('.'));
        }
        resource=cms.readDefaultFile(id);
      }
 catch (      Throwable e) {
        CmsMessageContainer msg=Messages.get().container(Messages.ERR_PERMALINK_1,id);
        if (LOG.isErrorEnabled()) {
          LOG.error(msg.key(),e);
        }
        throw new CmsResourceInitException(msg,e);
      }
 finally {
        cms.getRequestContext().setSiteRoot(storedSiteRoot);
        if (resource != null) {
          cms.getRequestContext().setUri(cms.getSitePath(resource));
        }
      }
    }
  }
  return resource;
}
