{
  CmsLoginHelper.LoginParameters params=CmsLoginHelper.getLoginParameters(cms,request,false);
  request.getSession().setAttribute(CmsLoginUI.INIT_DATA_SESSION_ATTR,params);
  try {
    byte[] pageBytes=CmsFileUtil.readFully(Thread.currentThread().getContextClassLoader().getResourceAsStream("org/opencms/ui/login/login-page.html"));
    String page=new String(pageBytes,"UTF-8");
    CmsMacroResolver resolver=new CmsMacroResolver();
    String context=OpenCms.getSystemInfo().getContextPath();
    String vaadinDir=CmsStringUtil.joinPaths(context,"VAADIN/");
    String vaadinServlet=CmsStringUtil.joinPaths(context,"opencms-login/");
    String vaadinBootstrap=CmsStringUtil.joinPaths(context,"VAADIN/vaadinBootstrap.js");
    String autocomplete=params.isPrivatePc() ? "on" : "off";
    String cmsLogo=OpenCms.getSystemInfo().getContextPath() + CmsWorkplace.RFS_PATH_RESOURCES + "commons/login_logo.png";
    resolver.addMacro("vaadinDir",vaadinDir);
    resolver.addMacro("vaadinServlet",vaadinServlet);
    resolver.addMacro("vaadinBootstrap",vaadinBootstrap);
    resolver.addMacro("cmsLogo",cmsLogo);
    resolver.addMacro("autocomplete",autocomplete);
    resolver.addMacro("title",CmsLoginHelper.getTitle(params.getLocale()));
    if (params.isPrivatePc()) {
      resolver.addMacro("hiddenPasswordField","      <input type=\"password\" id=\"hidden-password\" name=\"ocPword\" autocomplete=\"%(autocomplete)\" >");
    }
    if (params.getUsername() != null) {
      resolver.addMacro("predefUser","value=\"" + CmsEncoder.escapeXml(params.getUsername()) + "\"");
    }
    page=resolver.resolveMacros(page);
    return page;
  }
 catch (  Exception e) {
    LOG.error("Failed to display login dialog.",e);
    return "<!--Error-->";
  }
}
