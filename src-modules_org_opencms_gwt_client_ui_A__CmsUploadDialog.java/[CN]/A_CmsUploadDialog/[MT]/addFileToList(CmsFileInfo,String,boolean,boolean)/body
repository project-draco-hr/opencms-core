{
  CmsListInfoBean infoBean=createInfoBean(file);
  CmsListItemWidget listItemWidget=new CmsListItemWidget(infoBean);
  listItemWidget.setIcon(icon);
  CmsCheckBox check=new CmsCheckBox();
  check.setChecked(false);
  if (!invalid && !isTooLarge) {
    if (m_filesToUpload.containsKey(file.getFileName())) {
      check.setChecked(true);
    }
    check.setTitle(file.getFileName());
    addClickHandlerToCheckBox(check,file);
  }
 else   if (isTooLarge) {
    String message=Messages.get().key(Messages.GUI_UPLOAD_FILE_TOO_LARGE_2,formatBytes(file.getFileSize()),formatBytes(new Long(CmsCoreProvider.get().getUploadFileSizeLimit()).intValue()));
    check.disable(message);
    listItemWidget.setBackground(Background.RED);
    listItemWidget.setSubtitleLabel(message);
  }
 else {
    String message=Messages.get().key(Messages.GUI_UPLOAD_FILE_INVALID_NAME_2,file.getFileName(),formatBytes(file.getFileSize()));
    check.disable(message);
    listItemWidget.setBackground(Background.RED);
    listItemWidget.setSubtitleLabel(message);
  }
  CmsListItem listItem=new CmsListItem();
  listItem.initContent(check,listItemWidget);
  m_fileList.addItem(listItem);
  m_listItems.put(file.getFileName(),listItem);
}
