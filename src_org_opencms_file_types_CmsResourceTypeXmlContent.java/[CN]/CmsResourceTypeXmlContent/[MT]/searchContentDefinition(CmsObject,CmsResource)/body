{
  try {
    CmsXmlContentDefinition contentDef=null;
    String xsd=m_schema;
    if (CmsStringUtil.isEmptyOrWhitespaceOnly(xsd)) {
      List<CmsRelation> relations=cms.getRelationsForResource(resource,CmsRelationFilter.TARGETS.filterType(CmsRelationType.XSD));
      if ((relations != null) && !relations.isEmpty()) {
        xsd=cms.getSitePath(relations.get(0).getTarget(cms,CmsResourceFilter.ALL));
      }
    }
    contentDef=new CmsXmlEntityResolver(cms).getCachedContentDefinition(xsd);
    if (contentDef == null) {
      CmsXmlContent content=CmsXmlContentFactory.unmarshal(cms,cms.readFile(resource));
      contentDef=content.getContentDefinition();
    }
    return contentDef;
  }
 catch (  CmsException e) {
    if (LOG.isErrorEnabled()) {
      LOG.error(Messages.get().getBundle().key(Messages.ERR_READING_FORMATTER_CONFIGURATION_1,cms.getSitePath(resource)),e);
    }
    return null;
  }
}
