{
  Hashtable parameters=(Hashtable)userObj;
  CmsXmlWpTemplateFile xmlTemplateDocument=(CmsXmlWpTemplateFile)doc;
  StringBuffer result=new StringBuffer();
  String folder=(String)parameters.get(C_PARA_FOLDER);
  String pageText=(String)parameters.get(C_PARA_PAGE);
  String filter=(String)parameters.get(C_PARA_FILTER);
  Vector allPics=cms.getFilesInFolder(folder);
  int numPics=allPics.size();
  int page=new Integer(pageText).intValue();
  int from=(page - 1) * C_PICBROWSER_MAXIMAGES;
  int to=((from + C_PICBROWSER_MAXIMAGES) > numPics) ? numPics : (from + C_PICBROWSER_MAXIMAGES);
  String picsUrl=getConfigFile(cms).getPictureUrl();
  for (int i=from; i < to; i++) {
    CmsFile file=(CmsFile)allPics.elementAt(i);
    String filename=file.getName();
    if (inFilter(filename,filter) && isImage(filename)) {
      result.append(xmlTemplateDocument.getProcessedXmlDataValue("picstartseq",this,userObj));
      result.append(picsUrl + file.getName());
      result.append(xmlTemplateDocument.getProcessedXmlDataValue("picendseq",this,userObj));
      result.append(xmlTemplateDocument.getProcessedXmlDataValue("textstartseq",this,userObj));
      result.append(file.getLength() + " Bytes\n");
      result.append(xmlTemplateDocument.getProcessedXmlDataValue("textendseq",this,userObj));
    }
  }
  return result.toString();
}
