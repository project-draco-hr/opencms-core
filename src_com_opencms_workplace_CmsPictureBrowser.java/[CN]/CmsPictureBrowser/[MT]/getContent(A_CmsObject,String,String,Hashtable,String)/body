{
  if (C_DEBUG && A_OpenCms.isLogging()) {
    A_OpenCms.log(C_OPENCMS_DEBUG,getClassName() + "getting content of element " + ((elementName == null) ? "<root>" : elementName));
    A_OpenCms.log(C_OPENCMS_DEBUG,getClassName() + "template file is: " + templateFile);
    A_OpenCms.log(C_OPENCMS_DEBUG,getClassName() + "selected template section is: " + ((templateSelector == null) ? "<default>" : templateSelector));
  }
  String folder=(String)parameters.get(C_PARA_FOLDER);
  String pageText=(String)parameters.get(C_PARA_PAGE);
  String filter=(String)parameters.get(C_PARA_FILTER);
  if (folder == null || "".equals(folder)) {
    folder=getConfigFile(cms).getCommonPicturePath();
    parameters.put(C_PARA_FOLDER,folder);
  }
  if (pageText == null || "".equals(pageText)) {
    pageText="1";
    parameters.put(C_PARA_PAGE,pageText);
  }
  if (filter == null || "".equals(filter)) {
    filter="*";
    parameters.put(C_PARA_FILTER,filter);
  }
  Vector filteredPics=getFilteredPicList(cms,folder,filter);
  int maxpage=((filteredPics.size() - 1) / C_PICBROWSER_MAXIMAGES) + 1;
  CmsXmlWpTemplateFile xmlTemplateDocument=(CmsXmlWpTemplateFile)getOwnTemplateFile(cms,templateFile,elementName,parameters,templateSelector);
  xmlTemplateDocument.setData(C_PARA_FOLDER,Encoder.escape(folder));
  xmlTemplateDocument.setData(C_PARA_PAGE,pageText);
  xmlTemplateDocument.setData(C_PARA_FILTER,filter);
  xmlTemplateDocument.setData(C_PARA_MAXPAGE,"" + maxpage);
  parameters.put("_PICLIST_",filteredPics);
  return startProcessing(cms,xmlTemplateDocument,elementName,parameters,templateSelector);
}
