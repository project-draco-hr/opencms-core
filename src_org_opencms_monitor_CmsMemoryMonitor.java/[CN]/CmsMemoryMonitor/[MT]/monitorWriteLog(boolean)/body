{
  if (!OpenCms.getLog(this).isWarnEnabled()) {
    return;
  }
 else   if ((!warning) && (!OpenCms.getLog(this).isDebugEnabled())) {
    return;
  }
 else   if (warning && (m_warningLoggedSinceLastStatus && !(((m_intervalLog <= 0) && (System.currentTimeMillis() < (m_lastLogWarning + m_intervalWarning)))))) {
    return;
  }
 else   if ((!warning) && (m_intervalLog <= 0)) {
    return;
  }
  long maxMemory=Runtime.getRuntime().maxMemory() / 1048576;
  long totalMemory=Runtime.getRuntime().totalMemory() / 1048576;
  long usedMemory=(Runtime.getRuntime().totalMemory() - Runtime.getRuntime().freeMemory()) / 1048576;
  long freeMemory=maxMemory - usedMemory;
  long usage=usedMemory * 100 / maxMemory;
  if (warning) {
    m_lastLogWarning=System.currentTimeMillis();
    m_warningLoggedSinceLastStatus=true;
    OpenCms.getLog(this).warn(", W A R N I N G Memory consumption of " + usage + "% has reached a critical level"+ " ("+ m_maxUsagePercent+ "% configured)");
  }
 else {
    m_warningLoggedSinceLastStatus=false;
    m_lastLogStatus=System.currentTimeMillis();
  }
  String memStatus=", Memory max: " + maxMemory + " mb  "+ "total: "+ totalMemory+ " mb  "+ "free: "+ freeMemory+ " mb  "+ "used: "+ usedMemory+ " mb  "+ "percent: "+ usage+ "%  "+ "limit: "+ m_maxUsagePercent+ "%  ";
  if (warning) {
    OpenCms.getLog(this).warn(memStatus);
  }
 else {
    OpenCms.getLog(this).debug(", Memory monitor log for server " + OpenCms.getServerName().toUpperCase());
    List keyList=Arrays.asList(m_monitoredObjects.keySet().toArray());
    Collections.sort(keyList);
    long totalSize=0;
    for (Iterator keys=keyList.iterator(); keys.hasNext(); ) {
      String key=(String)keys.next();
      Object obj=m_monitoredObjects.get(key);
      long size=getKeySize(obj) + getValueSize(obj) + getCosts(obj);
      totalSize+=size;
      PrintfFormat name1=new PrintfFormat("%-80s");
      PrintfFormat name2=new PrintfFormat("%-50s");
      PrintfFormat form=new PrintfFormat("%9s");
      OpenCms.getLog(this).debug(",, " + "Monitored:, " + name1.sprintf(key) + ", "+ "Type:, "+ name2.sprintf(obj.getClass().getName())+ ", "+ "Entries:, "+ form.sprintf(getItems(obj))+ ", "+ "Limit:, "+ form.sprintf(getLimit(obj))+ ", "+ "Size:, "+ form.sprintf(Long.toString(size)));
    }
    memStatus+="size monitored: " + totalSize + " ("+ totalSize / 1048576 + ")";
    OpenCms.getLog(this).debug(memStatus);
    OpenCmsSessionManager sm=OpenCmsCore.getInstance().getSessionManager();
    CmsCoreSession cs=OpenCmsCore.getInstance().getSessionStorage();
    if ((sm != null) && (cs != null)) {
      OpenCms.getLog(this).debug(", Sessions users: " + cs.getLoggedInUsers().size() + " current: "+ sm.getCurrentSessions()+ " total: "+ sm.getTotalSessions());
    }
    sm=null;
    cs=null;
  }
}
