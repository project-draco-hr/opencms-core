{
  Log log=OpenCms.getLog(this);
  if (!log.isWarnEnabled()) {
    return;
  }
 else   if ((!warning) && (!log.isInfoEnabled())) {
    return;
  }
 else   if (warning && (m_warningLoggedSinceLastStatus && !(((m_intervalLog <= 0) && (System.currentTimeMillis() < (m_lastLogWarning + m_intervalWarning)))))) {
    return;
  }
 else   if ((!warning) && (m_intervalLog <= 0)) {
    return;
  }
  long maxMemory=Runtime.getRuntime().maxMemory() / 1048576;
  long totalMemory=Runtime.getRuntime().totalMemory() / 1048576;
  long usedMemory=(Runtime.getRuntime().totalMemory() - Runtime.getRuntime().freeMemory()) / 1048576;
  long freeMemory=maxMemory - usedMemory;
  long usage=usedMemory * 100 / maxMemory;
  if (warning) {
    m_lastLogWarning=System.currentTimeMillis();
    m_warningLoggedSinceLastStatus=true;
    log.warn(" W A R N I N G Memory consumption of " + usage + "% has reached a critical level"+ " ("+ m_maxUsagePercent+ "% configured)");
  }
 else {
    m_warningLoggedSinceLastStatus=false;
    m_lastLogStatus=System.currentTimeMillis();
  }
  String memStatus="Memory max: " + maxMemory + " mb  "+ "total: "+ totalMemory+ " mb  "+ "free: "+ freeMemory+ " mb  "+ "used: "+ usedMemory+ " mb  "+ "percent: "+ usage+ "%  "+ "limit: "+ m_maxUsagePercent+ "%  ";
  if (warning) {
    log.warn(memStatus);
  }
 else {
    m_logCount++;
    log.info("Memory monitor log for server " + OpenCms.getSystemInfo().getServerName().toUpperCase() + " ("+ m_logCount+ ")");
    List keyList=Arrays.asList(m_monitoredObjects.keySet().toArray());
    Collections.sort(keyList);
    long totalSize=0;
    for (Iterator keys=keyList.iterator(); keys.hasNext(); ) {
      String key=(String)keys.next();
      Object obj=m_monitoredObjects.get(key);
      long size=getKeySize(obj) + getValueSize(obj) + getCosts(obj);
      totalSize+=size;
      PrintfFormat name1=new PrintfFormat("%-80s");
      PrintfFormat name2=new PrintfFormat("%-50s");
      PrintfFormat form=new PrintfFormat("%9s");
      log.info("    " + "Monitored: " + name1.sprintf(key) + " "+ "Type: "+ name2.sprintf(obj.getClass().getName())+ " "+ "Entries: "+ form.sprintf(getItems(obj))+ " "+ "Limit: "+ form.sprintf(getLimit(obj))+ " "+ "Size: "+ form.sprintf(Long.toString(size)));
    }
    memStatus+="size monitored: " + totalSize + " ("+ totalSize / 1048576 + " mb)";
    log.info(memStatus);
    CmsSessionManager sm=OpenCms.getSessionManager();
    if (sm != null) {
      log.info("Sessions users: " + sm.getSessionCountAuthenticated() + " current: "+ sm.getSessionCountCurrent()+ " total: "+ sm.getSessionCountTotal());
    }
    sm=null;
    log.info("OpenCms startup time was: " + CmsDateUtil.getDateTimeShort(OpenCms.getSystemInfo().getStartupTime()) + " - current runtime is: "+ CmsStringUtil.formatRuntime(OpenCms.getSystemInfo().getRuntime()));
  }
}
