{
  int newId=C_UNKNOWN_ID;
  CmsTask task=null;
  Connection con=null;
  PreparedStatement statement=null;
  try {
    newId=nextId(C_TABLE_TASK);
    con=DriverManager.getConnection(m_poolName);
    statement=con.prepareStatement(m_SqlQueries.get("C_TASK_TYPE_COPY"));
    statement.setInt(1,newId);
    statement.setInt(2,tasktype);
    statement.executeUpdate();
    task=this.readTask(newId);
    task.setRoot(rootId);
    task.setParent(parentId);
    task.setName(taskname);
    task.setTaskType(tasktype);
    task.setRole(roleId);
    if (agentId == C_UNKNOWN_ID) {
      agentId=findAgent(roleId);
    }
    if (agentId == C_UNKNOWN_ID) {
      throw new CmsException(CmsException.C_NO_USER);
    }
    task.setAgentUser(agentId);
    task.setOriginalUser(agentId);
    task.setWakeupTime(wakeuptime);
    task.setTimeOut(timeout);
    task.setPriority(priority);
    task.setPercentage(0);
    task.setState(C_TASK_STATE_STARTED);
    task.setInitiatorUser(ownerId);
    task.setStartTime(new java.sql.Timestamp(System.currentTimeMillis()));
    task.setMilestone(0);
    task=this.writeTask(task);
  }
 catch (  SQLException exc) {
    throw new CmsException(exc.getMessage(),CmsException.C_SQL_ERROR,exc);
  }
 finally {
    if (statement != null) {
      try {
        statement.close();
      }
 catch (      SQLException exc) {
      }
    }
    if (con != null) {
      try {
        con.close();
      }
 catch (      SQLException exc) {
      }
    }
  }
  return task;
}
