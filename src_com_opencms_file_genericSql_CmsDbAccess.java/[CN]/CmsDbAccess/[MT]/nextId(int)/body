{
  com.opencms.file.genericSql.CmsDbPool pool=(com.opencms.file.genericSql.CmsDbPool)m_pool;
  int newId=C_UNKNOWN_INT;
  PreparedStatement firstStatement=null;
  PreparedStatement statement=null;
  ResultSet res=null;
  try {
    firstStatement=pool.getPreparedStatement(m_cq.C_SYSTEMID_LOCK_KEY);
    firstStatement.executeUpdate();
    statement=pool.getNextPreparedStatement(firstStatement,m_cq.C_SYSTEMID_READ_KEY);
    statement.setInt(1,key);
    res=statement.executeQuery();
    if (res.next()) {
      newId=res.getInt(m_cq.C_SYSTEMID_ID);
    }
 else {
      throw new CmsException("[" + this.getClass().getName() + "] "+ " cant read Id! ",CmsException.C_NO_GROUP);
    }
    res.close();
    res=null;
    statement=pool.getNextPreparedStatement(firstStatement,m_cq.C_SYSTEMID_WRITE_KEY);
    statement.setInt(1,newId + 1);
    statement.setInt(2,key);
    statement.executeUpdate();
    statement=pool.getNextPreparedStatement(firstStatement,m_cq.C_SYSTEMID_UNLOCK_KEY);
    statement.executeUpdate();
  }
 catch (  SQLException e) {
    throw new CmsException("[" + this.getClass().getName() + "] "+ e.getMessage(),CmsException.C_SQL_ERROR,e);
  }
 finally {
    if (res != null) {
      try {
        res.close();
      }
 catch (      SQLException se) {
      }
    }
    if (firstStatement != null)     m_pool.putPreparedStatement(m_cq.C_SYSTEMID_LOCK_KEY,firstStatement);
  }
  return (newId);
}
