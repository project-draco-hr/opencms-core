{
  try {
    CmsResource resource=cmsObject.readResource(filename,CmsResourceFilter.ALL);
    int currentProject=cmsObject.getRequestContext().currentProject().getId();
    CmsUUID userId=cmsObject.getRequestContext().currentUser().getId();
    CmsLock lock=cmsObject.getLock(filename);
    boolean locked=!(lock.isNullLock() || (lock.getUserId().equals(userId) && lock.getProjectId() == currentProject));
    if (currentProject == CmsProject.ONLINE_PROJECT_ID) {
      return null;
    }
 else     if (!OpenCms.getResourceManager().getResourceType(resource.getTypeId()).isDirectEditable()) {
      return null;
    }
 else     if (CmsResource.getName(filename).startsWith(org.opencms.workplace.CmsWorkplace.TEMP_FILE_PREFIX)) {
      return DIRECT_EDIT_MODE_INACTIVE;
    }
 else     if (!cmsObject.isInsideCurrentProject(filename)) {
      return DIRECT_EDIT_MODE_INACTIVE;
    }
 else     if (!cmsObject.hasPermissions(resource,CmsPermissionSet.ACCESS_WRITE,false,CmsResourceFilter.IGNORE_EXPIRATION)) {
      if (locked) {
        return DIRECT_EDIT_MODE_DISABLED;
      }
 else {
        return DIRECT_EDIT_MODE_INACTIVE;
      }
    }
 else     if (locked) {
      return DIRECT_EDIT_MODE_DISABLED;
    }
    if ((element != null) && (resource.getTypeId() == CmsResourceTypeXmlPage.getStaticTypeId())) {
      I_CmsXmlDocument document=CmsXmlPageFactory.unmarshal(cmsObject,filename,req);
      List locales=document.getLocales();
      Locale locale;
      if ((locales == null) || (locales.size() == 0)) {
        locale=(Locale)OpenCms.getLocaleManager().getDefaultLocales(cmsObject,filename).get(0);
      }
 else {
        locale=OpenCms.getLocaleManager().getBestMatchingLocale(null,OpenCms.getLocaleManager().getDefaultLocales(cmsObject,filename),locales);
      }
      if (!document.hasValue(element,locale) || !document.isEnabled(element,locale)) {
        return DIRECT_EDIT_MODE_INACTIVE;
      }
    }
    return DIRECT_EDIT_MODE_ENABLED;
  }
 catch (  CmsException e) {
    if (LOG.isWarnEnabled()) {
      LOG.warn(Messages.get().getBundle().key(Messages.LOG_CALC_EDIT_MODE_FAILED_1,filename),e);
    }
    return DIRECT_EDIT_MODE_INACTIVE;
  }
}
