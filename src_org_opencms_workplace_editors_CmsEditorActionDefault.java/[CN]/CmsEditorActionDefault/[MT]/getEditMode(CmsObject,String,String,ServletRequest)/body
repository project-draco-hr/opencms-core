{
  try {
    CmsResource resource=cmsObject.readResource(filename,CmsResourceFilter.ALL);
    int currentProject=cmsObject.getRequestContext().currentProject().getId();
    CmsUUID userId=cmsObject.getRequestContext().currentUser().getId();
    CmsLock lock=cmsObject.getLock(filename);
    boolean locked=!(lock.isNullLock() || (lock.getUserId().equals(userId) && lock.getProjectId() == currentProject));
    if (currentProject == I_CmsConstants.C_PROJECT_ONLINE_ID) {
      return null;
    }
 else     if (!OpenCms.getResourceManager().getResourceType(resource.getTypeId()).isDirectEditable()) {
      return null;
    }
 else     if (CmsResource.getName(filename).startsWith(org.opencms.main.I_CmsConstants.C_TEMP_PREFIX)) {
      return C_DIRECT_EDIT_MODE_INACTIVE;
    }
 else     if (!cmsObject.isInsideCurrentProject(filename)) {
      return C_DIRECT_EDIT_MODE_INACTIVE;
    }
 else     if (!cmsObject.hasPermissions(resource,CmsPermissionSet.ACCESS_WRITE,false,CmsResourceFilter.IGNORE_EXPIRATION)) {
      if (locked) {
        return C_DIRECT_EDIT_MODE_DISABLED;
      }
 else {
        return C_DIRECT_EDIT_MODE_INACTIVE;
      }
    }
 else     if (locked) {
      return C_DIRECT_EDIT_MODE_DISABLED;
    }
    if ((element != null) && (resource.getTypeId() == CmsResourceTypeXmlPage.C_RESOURCE_TYPE_ID)) {
      I_CmsXmlDocument document=CmsXmlPageFactory.unmarshal(cmsObject,filename,req);
      List locales=document.getLocales();
      Locale locale;
      if ((locales == null) || (locales.size() == 0)) {
        locale=(Locale)OpenCms.getLocaleManager().getDefaultLocales(cmsObject,filename).get(0);
      }
 else {
        locale=OpenCms.getLocaleManager().getBestMatchingLocale(null,OpenCms.getLocaleManager().getDefaultLocales(cmsObject,filename),locales);
      }
      if (!document.hasValue(element,locale) || !document.isEnabled(element,locale)) {
        return C_DIRECT_EDIT_MODE_INACTIVE;
      }
    }
    return C_DIRECT_EDIT_MODE_ENABLED;
  }
 catch (  CmsException e) {
    if (OpenCms.getLog(this).isWarnEnabled()) {
      OpenCms.getLog(this).warn("Error while calculation edit mode for " + filename,e);
    }
    return C_DIRECT_EDIT_MODE_INACTIVE;
  }
}
