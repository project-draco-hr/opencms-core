{
  CmsGalleryService galleryService=CmsGalleryService.newInstance(getRequest());
  CmsGalleryDataBean data=galleryService.getInitialSettings(galleryMode,getRequest().getParameter(ReqParam.resource.name()),getRequest().getParameter(ReqParam.gallerypath.name()),getRequest().getParameter(ReqParam.currentelement.name()),getRequest().getParameter(ReqParam.types.name()),getRequest().getParameter(ReqParam.gallerytypes.name()));
  CmsGallerySearchBean search=null;
  if (GalleryTabId.cms_tab_results.equals(data.getStartTab())) {
    search=galleryService.getSearch(data);
  }
  if ((search != null) && (search.getScope() != null) && (search.getScope() != data.getScope())) {
    data.setScope(search.getScope());
  }
 else   if ((search != null) && (search.getScope() == null)) {
    data.setScope(CmsGallerySearchScope.everything);
  }
  StringBuffer sb=new StringBuffer();
  sb.append(ClientMessages.get().export(getRequest()));
  sb.append(exportDictionary(CmsGalleryDataBean.DICT_NAME,I_CmsGalleryService.class.getMethod("getInitialSettings",GalleryMode.class,String.class,String.class,String.class,String.class,String.class),data));
  sb.append(exportDictionary(CmsGallerySearchBean.DICT_NAME,I_CmsGalleryService.class.getMethod("getSearch",CmsGalleryDataBean.class),search));
  return sb.toString();
}
