{
  CmsXmlPage xmlPage=null;
  try {
    xmlPage=new CmsXmlPage();
    SAXReader reader=new SAXReader();
    Document page=reader.read(new StringReader(content));
    Element xmltemplate=page.getRootElement();
    if (xmltemplate == null || !"XMLTEMPLATE".equals(xmltemplate.getName())) {
      throw new Exception("Element XMLTEMPLATE not found");
    }
    Element edittemplate=xmltemplate.element("edittemplate");
    String bodyContent=null;
    if (edittemplate != null) {
      bodyContent=edittemplate.getText();
    }
 else {
      Element template=xmltemplate.element("TEMPLATE");
      if (template != null) {
        StringBuffer contentBuffer=new StringBuffer();
        for (Iterator i=template.nodeIterator(); i.hasNext(); ) {
          Node n=(Node)i.next();
          if (n.getNodeType() == Node.CDATA_SECTION_NODE) {
            contentBuffer.append(n.getText());
          }
 else           if (n.getNodeType() == Node.ELEMENT_NODE) {
            if ("LINK".equals(n.getName())) {
              contentBuffer.append(OpenCms.getOpenCmsContext());
              contentBuffer.append(n.getText());
            }
 else {
              throw new Exception("Cannot handle element <" + n.getName() + ">");
            }
          }
 else {
            throw new Exception("Cannot handle nodes of type " + n.getNodeTypeName());
          }
        }
        bodyContent=contentBuffer.toString();
      }
    }
    if (bodyContent == null) {
      throw new Exception("Body content not found");
    }
    bodyContent=CmsStringSubstitution.substitute(bodyContent,I_CmsWpConstants.C_MACRO_OPENCMS_CONTEXT,OpenCms.getOpenCmsContext());
    xmlPage.addElement(body,language);
    xmlPage.setContent(cms,body,language,bodyContent);
    return xmlPage;
  }
 catch (  Exception exc) {
    throw new CmsException(exc.toString());
  }
}
