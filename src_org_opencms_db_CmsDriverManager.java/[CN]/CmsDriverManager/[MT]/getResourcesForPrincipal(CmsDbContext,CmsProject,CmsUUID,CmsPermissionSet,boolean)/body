{
  List resources=m_vfsDriver.readResourcesForPrincipalACE(dbc,project,principalId);
  if (permissions != null) {
    Iterator itRes=resources.iterator();
    while (itRes.hasNext()) {
      CmsAccessControlEntry ace=readAccessControlEntry(dbc,(CmsResource)itRes.next(),principalId);
      if ((ace.getPermissions().getPermissions() & permissions.getPermissions()) != permissions.getPermissions()) {
        itRes.remove();
      }
    }
  }
  if (includeAttr) {
    resources.addAll(m_vfsDriver.readResourcesForPrincipalAttr(dbc,project,principalId));
  }
  Set resNames=new HashSet();
  Iterator itRes=resources.iterator();
  while (itRes.hasNext()) {
    String resName=((CmsResource)itRes.next()).getRootPath();
    if (resNames.contains(resName)) {
      itRes.remove();
    }
 else {
      resNames.add(resName);
    }
  }
  return resources;
}
