{
  List result=new ArrayList();
  List newFolderList=folderList == null ? new ArrayList() : new ArrayList(folderList);
  for (int i=0; i < resourceList.size(); i++) {
    CmsResource res=(CmsResource)resourceList.get(i);
    try {
      if (res.getStructureId().equals(currentResource.getStructureId())) {
        continue;
      }
      CmsLock lock=getLock(dbc,res);
      if (!lock.isNullLock()) {
        if (lock.getType() == CmsLock.TYPE_SHARED_INHERITED || lock.getType() == CmsLock.TYPE_SHARED_EXCLUSIVE) {
          if (res.getState() != CmsResource.STATE_DELETED) {
            continue;
          }
        }
 else {
          continue;
        }
      }
      if (!"/".equals(res.getRootPath()) && !checkParentResource(dbc,newFolderList,res)) {
        continue;
      }
      if (res.isFolder()) {
        newFolderList.add(res);
      }
      result.add(res);
    }
 catch (    Exception e) {
    }
  }
  return result;
}
