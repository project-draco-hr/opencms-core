{
  if (!userInGroup(dbc,username,groupname)) {
    CmsUser user;
    CmsGroup group;
    try {
      user=readUser(dbc,username);
    }
 catch (    CmsDbEntryNotFoundException e) {
      user=readWebUser(dbc,username);
    }
    if (user != null) {
      if (user.getType() == CmsUser.USER_TYPE_WEBUSER) {
        if (groupname.equals(CmsDefaultUsers.DEFAULT_GROUP_ADMINISTRATORS) || groupname.equals(CmsDefaultUsers.DEFAULT_GROUP_PROJECTMANAGERS) || groupname.equals(CmsDefaultUsers.DEFAULT_GROUP_USERS)) {
          throw new CmsSecurityException(Messages.get().container(Messages.ERR_WEBUSER_GROUP_0));
        }
      }
      group=readGroup(dbc,groupname);
      if (group != null) {
        m_userDriver.createUserInGroup(dbc,user.getId(),group.getId(),null);
        m_userGroupsCache.clear();
      }
 else {
        throw new CmsDbEntryNotFoundException(Messages.get().container(Messages.ERR_UNKNOWN_GROUP_1,groupname));
      }
    }
 else {
      throw new CmsDbEntryNotFoundException(Messages.get().container(Messages.ERR_UNKNOWN_USER_1,user.getName()));
    }
  }
}
