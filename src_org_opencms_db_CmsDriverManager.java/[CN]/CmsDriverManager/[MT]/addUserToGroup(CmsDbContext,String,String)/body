{
  if (!userInGroup(dbc,username,groupname)) {
    CmsUser user;
    CmsGroup group;
    try {
      user=readUser(dbc,username);
    }
 catch (    CmsDbEntryNotFoundException e) {
      user=readWebUser(dbc,username);
    }
    if (user != null) {
      if (user.getType() == CmsUser.USER_TYPE_WEBUSER) {
        List forbidden=new ArrayList();
        forbidden.add(OpenCms.getDefaultUsers().getGroupAdministrators());
        forbidden.add(OpenCms.getDefaultUsers().getGroupProjectmanagers());
        forbidden.add(OpenCms.getDefaultUsers().getGroupUsers());
        if (forbidden.contains(groupname)) {
          throw new CmsSecurityException(Messages.get().container(Messages.ERR_WEBUSER_GROUP_1,forbidden));
        }
      }
      group=readGroup(dbc,groupname);
      if (group != null) {
        m_userDriver.createUserInGroup(dbc,user.getId(),group.getId(),null);
        m_userGroupsCache.clear();
      }
 else {
        throw new CmsDbEntryNotFoundException(Messages.get().container(Messages.ERR_UNKNOWN_GROUP_1,groupname));
      }
    }
 else {
      throw new CmsDbEntryNotFoundException(Messages.get().container(Messages.ERR_UNKNOWN_USER_1,username));
    }
  }
}
