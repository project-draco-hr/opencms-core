{
  String siteRoot=context.getSiteRoot();
  Stack storage=new Stack();
  context.setSiteRoot("/");
  String destination=I_CmsConstants.C_VFS_LOST_AND_FOUND + resourcename;
  String des=destination;
  try {
    while (des.indexOf("/") == 0) {
      des=des.substring(0,des.lastIndexOf("/"));
      storage.push(des.concat("/"));
    }
    while (storage.size() != 0) {
      des=(String)storage.pop();
      try {
        readFolder(context,des);
      }
 catch (      Exception e1) {
        createFolder(context,des,new HashMap());
      }
    }
    des=destination;
    int postfix=1;
    boolean found=true;
    while (found) {
      try {
        found=true;
        readFileHeader(context,des);
        String path=destination.substring(0,destination.lastIndexOf("/") + 1);
        String filename=destination.substring(destination.lastIndexOf("/") + 1,destination.length());
        des=path;
        if (filename.lastIndexOf(".") > 0) {
          des+=filename.substring(0,filename.lastIndexOf("."));
        }
 else {
          des+=filename;
        }
        des+="_" + postfix;
        if (filename.lastIndexOf(".") > 0) {
          des+=filename.substring(filename.lastIndexOf("."),filename.length());
        }
        postfix++;
      }
 catch (      CmsException e3) {
        found=false;
      }
    }
    destination=des;
    if (copyResource) {
      moveResource(context,resourcename,destination);
    }
  }
 catch (  CmsException e2) {
    throw e2;
  }
 finally {
    context.setSiteRoot(siteRoot);
  }
  return destination;
}
