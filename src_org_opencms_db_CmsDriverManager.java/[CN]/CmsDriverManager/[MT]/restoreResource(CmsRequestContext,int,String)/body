{
  CmsBackupResource backupFile=null;
  CmsFile offlineFile=null;
  int state=I_CmsConstants.C_STATE_CHANGED;
  backupFile=readBackupFile(context,versionId,filename);
  offlineFile=readFile(context,filename);
  if (offlineFile.getState() == I_CmsConstants.C_STATE_NEW) {
    state=I_CmsConstants.C_STATE_NEW;
  }
  if (backupFile != null && offlineFile != null) {
    CmsFile newFile=new CmsFile(offlineFile.getId(),offlineFile.getResourceId(),offlineFile.getParentId(),offlineFile.getFileId(),offlineFile.getResourceName(),backupFile.getType(),backupFile.getFlags(),context.currentProject().getId(),backupFile.getAccessFlags(),state,offlineFile.isLockedBy(),backupFile.getLauncherType(),backupFile.getLauncherClassname(),offlineFile.getDateCreated(),backupFile.getResourceCreatedBy(),offlineFile.getDateLastModified(),context.currentUser().getId(),backupFile.getContents(),backupFile.getLength(),context.currentProject().getId(),backupFile.getVfsLinkType());
    writeFile(context,newFile);
    clearResourceCache();
  }
}
