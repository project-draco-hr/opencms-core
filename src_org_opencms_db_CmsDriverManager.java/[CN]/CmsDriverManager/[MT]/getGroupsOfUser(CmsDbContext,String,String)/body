{
  CmsUser user=readUser(dbc,username);
  String cacheKey=m_keyGenerator.getCacheKeyForUserGroups(remoteAddress,dbc,user);
  List allGroups=(List)m_userGroupsCache.get(cacheKey);
  if (allGroups == null) {
    List groups=m_userDriver.readGroupsOfUser(dbc,user.getId(),remoteAddress);
    allGroups=new ArrayList(groups);
    for (int i=0; i < groups.size(); i++) {
      CmsGroup parent=getParent(dbc,((CmsGroup)groups.get(i)).getName());
      while ((parent != null) && (!allGroups.contains(parent))) {
        allGroups.add(parent);
        parent=getParent(dbc,parent.getName());
      }
    }
    allGroups=Collections.unmodifiableList(allGroups);
    m_userGroupsCache.put(cacheKey,allGroups);
  }
  return allGroups;
}
