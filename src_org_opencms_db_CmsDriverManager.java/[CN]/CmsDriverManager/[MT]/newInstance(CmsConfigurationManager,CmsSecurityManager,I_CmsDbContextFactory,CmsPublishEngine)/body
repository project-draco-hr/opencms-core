{
  ExtendedProperties config=(ExtendedProperties)configurationManager.getConfiguration();
  List<String> drivers=null;
  String driverName=null;
  I_CmsVfsDriver vfsDriver=null;
  I_CmsUserDriver userDriver=null;
  I_CmsProjectDriver projectDriver=null;
  I_CmsHistoryDriver historyDriver=null;
  CmsDriverManager driverManager=null;
  try {
    driverManager=new CmsDriverManager();
    if (CmsLog.INIT.isInfoEnabled()) {
      CmsLog.INIT.info(Messages.get().getBundle().key(Messages.INIT_DRIVER_MANAGER_START_PHASE1_0));
    }
    if ((runtimeInfoFactory == null) && CmsLog.INIT.isDebugEnabled()) {
      CmsLog.INIT.debug(Messages.get().getBundle().key(Messages.INIT_DRIVER_MANAGER_START_RT_0));
    }
  }
 catch (  Exception exc) {
    CmsMessageContainer message=Messages.get().container(Messages.LOG_ERR_DRIVER_MANAGER_START_0);
    if (LOG.isFatalEnabled()) {
      LOG.fatal(message.key(),exc);
    }
    throw new CmsInitException(message,exc);
  }
  driverManager.m_securityManager=securityManager;
  driverManager.m_connectionPools=new ArrayList<PoolingDriver>();
  driverManager.m_lockManager=new CmsLockManager(driverManager);
  driverManager.m_sqlManager=new CmsSqlManager(driverManager);
  driverManager.m_publishEngine=publishEngine;
  if (CmsLog.INIT.isInfoEnabled()) {
    CmsLog.INIT.info(Messages.get().getBundle().key(Messages.INIT_DRIVER_MANAGER_START_PHASE2_0));
  }
  String[] driverPoolNames=config.getStringArray(CmsDriverManager.CONFIGURATION_DB + ".pools");
  if (CmsLog.INIT.isInfoEnabled()) {
    String names="";
    for (int p=0; p < driverPoolNames.length; p++) {
      names+=driverPoolNames[p] + " ";
    }
    CmsLog.INIT.info(Messages.get().getBundle().key(Messages.INIT_DRIVER_MANAGER_START_POOLS_1,names));
  }
  for (int p=0; p < driverPoolNames.length; p++) {
    driverManager.newPoolInstance(config,driverPoolNames[p]);
  }
  if (runtimeInfoFactory != null) {
    runtimeInfoFactory.initialize(driverManager);
  }
  if (CmsLog.INIT.isInfoEnabled()) {
    CmsLog.INIT.info(Messages.get().getBundle().key(Messages.INIT_DRIVER_MANAGER_START_PHASE3_0));
  }
  drivers=Arrays.asList(config.getStringArray(CmsDriverManager.CONFIGURATION_VFS));
  String driverKey=drivers.get(0) + ".vfs.driver";
  driverName=config.getString(driverKey);
  drivers=(drivers.size() > 1) ? drivers.subList(1,drivers.size()) : null;
  if (driverName == null) {
    CmsLog.INIT.error(Messages.get().getBundle().key(Messages.INIT_DRIVER_FAILED_1,driverKey));
  }
  vfsDriver=(I_CmsVfsDriver)driverManager.newDriverInstance(configurationManager,driverName,drivers);
  drivers=Arrays.asList(config.getStringArray(CmsDriverManager.CONFIGURATION_USER));
  driverKey=drivers.get(0) + ".user.driver";
  driverName=config.getString(driverKey);
  drivers=(drivers.size() > 1) ? drivers.subList(1,drivers.size()) : null;
  if (driverName == null) {
    CmsLog.INIT.error(Messages.get().getBundle().key(Messages.INIT_DRIVER_FAILED_1,driverKey));
  }
  userDriver=(I_CmsUserDriver)driverManager.newDriverInstance(configurationManager,driverName,drivers);
  drivers=Arrays.asList(config.getStringArray(CmsDriverManager.CONFIGURATION_PROJECT));
  driverKey=drivers.get(0) + ".project.driver";
  driverName=config.getString(driverKey);
  drivers=(drivers.size() > 1) ? drivers.subList(1,drivers.size()) : null;
  if (driverName == null) {
    CmsLog.INIT.error(Messages.get().getBundle().key(Messages.INIT_DRIVER_FAILED_1,driverKey));
  }
  projectDriver=(I_CmsProjectDriver)driverManager.newDriverInstance(configurationManager,driverName,drivers);
  drivers=Arrays.asList(config.getStringArray(CmsDriverManager.CONFIGURATION_HISTORY));
  driverKey=drivers.get(0) + ".history.driver";
  driverName=config.getString(driverKey);
  drivers=(drivers.size() > 1) ? drivers.subList(1,drivers.size()) : null;
  if (driverName == null) {
    CmsLog.INIT.error(Messages.get().getBundle().key(Messages.INIT_DRIVER_FAILED_1,driverKey));
  }
  historyDriver=(I_CmsHistoryDriver)driverManager.newDriverInstance(configurationManager,driverName,drivers);
  driverManager.m_vfsDriver=vfsDriver;
  driverManager.m_userDriver=userDriver;
  driverManager.m_projectDriver=projectDriver;
  driverManager.m_historyDriver=historyDriver;
  driverManager.m_propertyConfiguration=config;
  org.opencms.main.OpenCms.addCmsEventListener(driverManager,new int[]{I_CmsEventListener.EVENT_UPDATE_EXPORTS,I_CmsEventListener.EVENT_CLEAR_CACHES,I_CmsEventListener.EVENT_CLEAR_PRINCIPAL_CACHES,I_CmsEventListener.EVENT_PUBLISH_PROJECT});
  return driverManager;
}
