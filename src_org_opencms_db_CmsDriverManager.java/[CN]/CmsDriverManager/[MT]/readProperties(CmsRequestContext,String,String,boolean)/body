{
  CmsResource res=readFileHeader(context,resource);
  readPath(context,res,true);
  checkPermissions(context,res,I_CmsConstants.C_READ_OR_VIEW_ACCESS);
  search=search && (siteRoot != null);
  HashMap value=null;
  String cacheKey=getCacheKey(C_CACHE_ALL_PROPERTIES + search,null,new CmsProject(context.currentProject().getId(),-1),res.getFullResourceName());
  value=(HashMap)m_propertyCache.get(cacheKey);
  if (value == null) {
    if (search) {
      boolean cont;
      siteRoot+="/";
      value=new HashMap();
      HashMap parentValue;
      do {
        try {
          parentValue=(HashMap)readProperties(context,resource,siteRoot,false);
          parentValue.putAll(value);
          value.clear();
          value.putAll(parentValue);
          resource=CmsResource.getParent(resource);
          cont=(!"/".equals(resource));
        }
 catch (        CmsSecurityException se) {
          cont=false;
        }
      }
 while (cont);
    }
 else {
      value=m_vfsDriver.readProperties(context.currentProject().getId(),res,res.getType());
    }
    m_propertyCache.put(cacheKey,value);
  }
  return (Map)value.clone();
}
