{
  List resources;
  if ((state == I_CmsConstants.C_STATE_NEW) || (state == I_CmsConstants.C_STATE_CHANGED) || (state == I_CmsConstants.C_STATE_DELETED)) {
    resources=m_vfsDriver.readResources(dbc,projectId,state,I_CmsConstants.C_READMODE_MATCHSTATE);
  }
 else {
    resources=m_vfsDriver.readResources(dbc,projectId,I_CmsConstants.C_STATE_UNCHANGED,I_CmsConstants.C_READMODE_UNMATCHSTATE);
  }
  List result=new ArrayList(resources.size());
  for (int i=0; i < resources.size(); i++) {
    CmsResource currentResource=(CmsResource)resources.get(i);
    if (CmsSecurityManager.PERM_ALLOWED == m_securityManager.hasPermissions(dbc,currentResource,CmsPermissionSet.ACCESS_READ,true,CmsResourceFilter.ALL)) {
      result.add(currentResource);
    }
  }
  resources.clear();
  resources=null;
  updateContextDates(dbc,result);
  Collections.sort(result);
  return result;
}
