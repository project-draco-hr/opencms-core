{
  List subResources=null;
  CmsFolder parentFolder=null;
  CmsResource currentResource=null;
  String cacheKey=null;
  if (getSubFolders) {
    cacheKey=getCacheKey(context.currentUser().getName() + "_folders",context.currentProject(),parentFolderName);
  }
 else {
    cacheKey=getCacheKey(context.currentUser().getName() + "_files_" + filter,context.currentProject(),parentFolderName);
  }
  subResources=(List)m_resourceListCache.get(cacheKey);
  try {
    if (!CmsResource.isFolder(parentFolderName)) {
      parentFolderName+="/";
    }
    parentFolder=readFolder(context,parentFolderName,filter);
    checkPermissions(context,parentFolder,I_CmsConstants.C_READ_ACCESS,filter);
  }
 catch (  CmsException e) {
    return new ArrayList(0);
  }
  if ((!filter.isValid(context,parentFolder))) {
    return new ArrayList(0);
  }
  if (subResources != null && subResources.size() > 0) {
    return new ArrayList(subResources);
  }
  subResources=m_vfsDriver.readChildResources(context.currentProject(),parentFolder,getSubFolders);
  for (int i=0; i < subResources.size(); i++) {
    currentResource=(CmsResource)subResources.get(i);
    if (PERM_ALLOWED != hasPermissions(context,currentResource,I_CmsConstants.C_READ_OR_VIEW_ACCESS,filter,false)) {
      subResources.remove(i--);
    }
 else {
      if (currentResource.isFolder() && !CmsResource.isFolder(currentResource.getName())) {
        currentResource.setFullResourceName(parentFolderName + currentResource.getName().concat("/"));
      }
 else {
        currentResource.setFullResourceName(parentFolderName + currentResource.getName());
      }
      updateContextDates(context,currentResource);
    }
  }
  m_resourceListCache.put(cacheKey,subResources);
  return new ArrayList(subResources);
}
