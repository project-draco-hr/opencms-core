{
  boolean printReportHeaders=false;
  try {
    List publishedResources=m_projectDriver.readPublishedResources(dbc,projectId,publishHistoryId);
    if (publishedResources.size() == 0) {
      if (LOG.isWarnEnabled()) {
        LOG.warn(Messages.get().key(Messages.LOG_EMPTY_PUBLISH_HISTORY_1,publishHistoryId));
      }
      return;
    }
    Set exportPoints=new HashSet();
    exportPoints.addAll(OpenCms.getExportPoints());
    exportPoints.addAll(OpenCms.getModuleManager().getExportPoints());
    if (exportPoints.size() == 0) {
      if (LOG.isWarnEnabled()) {
        LOG.warn(Messages.get().key(Messages.LOG_NO_EXPORT_POINTS_CONFIGURED_0));
      }
      return;
    }
    CmsExportPointDriver exportPointDriver=new CmsExportPointDriver(exportPoints);
    if (report == null) {
      report=new CmsLogReport();
    }
    Iterator i=publishedResources.iterator();
    while (i.hasNext()) {
      CmsPublishedResource currentPublishedResource=(CmsPublishedResource)i.next();
      String currentExportPoint=exportPointDriver.getExportPoint(currentPublishedResource.getRootPath());
      if (currentExportPoint != null) {
        if (!printReportHeaders) {
          report.println(Messages.get().container(Messages.RPT_EXPORT_POINTS_WRITE_BEGIN_0),I_CmsReport.FORMAT_HEADLINE);
          printReportHeaders=true;
        }
        if (currentPublishedResource.isFolder()) {
          if (currentPublishedResource.getState() == CmsResource.STATE_DELETED) {
            exportPointDriver.removeResource(currentPublishedResource.getRootPath(),currentExportPoint);
          }
 else {
            exportPointDriver.createFolder(currentPublishedResource.getRootPath(),currentExportPoint);
          }
        }
 else {
          if (currentPublishedResource.getState() == CmsResource.STATE_DELETED) {
            exportPointDriver.removeResource(currentPublishedResource.getRootPath(),currentExportPoint);
          }
 else {
            CmsFile file=getVfsDriver().readFile(dbc,CmsProject.ONLINE_PROJECT_ID,false,currentPublishedResource.getStructureId());
            exportPointDriver.writeFile(file.getRootPath(),currentExportPoint,file.getContents());
          }
        }
        if (currentPublishedResource.getState() == CmsResource.STATE_DELETED) {
          report.print(Messages.get().container(Messages.RPT_EXPORT_POINTS_DELETE_0),I_CmsReport.FORMAT_NOTE);
          report.print(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_ARGUMENT_1,currentPublishedResource.getRootPath()));
          report.print(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_DOTS_0));
          report.println(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_OK_0),I_CmsReport.FORMAT_OK);
        }
 else {
          report.print(Messages.get().container(Messages.RPT_EXPORT_POINTS_WRITE_0),I_CmsReport.FORMAT_NOTE);
          report.print(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_ARGUMENT_1,currentPublishedResource.getRootPath()));
          report.print(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_DOTS_0));
          report.println(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_OK_0),I_CmsReport.FORMAT_OK);
        }
      }
    }
  }
 catch (  CmsException e) {
    if (LOG.isErrorEnabled()) {
      LOG.error(Messages.get().key(Messages.LOG_WRITE_EXPORT_POINTS_ERROR_0),e);
    }
  }
 finally {
    if (printReportHeaders) {
      report.println(Messages.get().container(Messages.RPT_EXPORT_POINTS_WRITE_END_0),I_CmsReport.FORMAT_HEADLINE);
    }
  }
}
