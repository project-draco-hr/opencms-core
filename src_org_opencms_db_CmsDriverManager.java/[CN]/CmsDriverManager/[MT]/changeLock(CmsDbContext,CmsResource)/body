{
  if (getLock(dbc,resource).isNullLock()) {
    throw new CmsLockException("Unable to change lock on unlocked resource " + resource.getRootPath(),CmsLockException.C_RESOURCE_UNLOCKED);
  }
  CmsLock exclusiveLock=m_lockManager.getExclusiveLockedSibling(this,dbc,resource.getRootPath());
  m_lockManager.removeResource(this,dbc,resource.getRootPath(),true);
  m_securityManager.clearPermissionCache();
  try {
    lockResource(dbc,resource,CmsLock.C_MODE_COMMON);
  }
 catch (  CmsSecurityException e) {
    m_lockManager.addResource(this,dbc,exclusiveLock.getResourceName(),exclusiveLock.getUserId(),exclusiveLock.getProjectId(),CmsLock.C_MODE_COMMON);
    throw e;
  }
}
