{
  String folderName=newFileName.substring(0,newFileName.lastIndexOf(I_CmsConstants.C_FOLDER_SEPARATOR,newFileName.length()) + 1);
  String resourceName=newFileName.substring(folderName.length(),newFileName.length());
  validFilename(resourceName);
  I_CmsResourceType resType=getResourceType(context,type);
  if (("XMLTemplate".equals(resType.getResourceTypeName()) || "jsp".equals(resType.getResourceTypeName())) && !isAdmin(context)) {
    throw new CmsException("[" + this.getClass().getName() + "] "+ resourceName,CmsException.C_NO_ACCESS);
  }
  CmsFolder cmsFolder=readFolder(context,folderName);
  checkPermissions(context,cmsFolder,I_CmsConstants.C_WRITE_ACCESS);
  CmsFile file=m_vfsDriver.createFile(context.currentUser(),context.currentProject(),resourceName,0,cmsFolder.getId(),contents,getResourceType(context,type));
  clearResourceCache();
  m_vfsDriver.writeProperties(propertyinfos,context.currentProject().getId(),file,file.getType());
  fileSystemChanged(false);
  return file;
}
