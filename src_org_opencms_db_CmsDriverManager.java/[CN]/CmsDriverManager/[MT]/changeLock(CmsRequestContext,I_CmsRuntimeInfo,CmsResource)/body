{
  if (getLock(context,runtimeInfo,resource).isNullLock()) {
    throw new CmsLockException("Unable to change lock on unlocked resource " + resource.getRootPath(),CmsLockException.C_RESOURCE_UNLOCKED);
  }
  CmsLock exclusiveLock=m_lockManager.getExclusiveLockedSibling(this,context,runtimeInfo,resource.getRootPath());
  m_lockManager.removeResource(this,context,runtimeInfo,resource.getRootPath(),true);
  m_securityManager.clearPermissionCache();
  try {
    lockResource(context,runtimeInfo,resource,CmsLock.C_MODE_COMMON);
  }
 catch (  CmsSecurityException e) {
    m_lockManager.addResource(this,context,runtimeInfo,exclusiveLock.getResourceName(),exclusiveLock.getUserId(),exclusiveLock.getProjectId(),CmsLock.C_MODE_COMMON);
    throw e;
  }
}
