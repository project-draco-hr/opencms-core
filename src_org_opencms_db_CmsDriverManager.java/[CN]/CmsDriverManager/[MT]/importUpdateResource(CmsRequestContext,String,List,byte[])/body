{
  CmsResource resource=null;
  try {
    resource=readFileHeader(context,resourcename,CmsResourceFilter.ALL);
    checkPermissions(context,resource,I_CmsConstants.C_WRITE_ACCESS,CmsResourceFilter.ALL,-1);
    m_vfsDriver.writePropertyObjects(context.currentProject(),resource,properties);
    m_vfsDriver.writeResource(context.currentProject(),resource,filecontent,C_UPDATE_STRUCTURE_STATE,context.currentUser().getId());
    m_vfsDriver.writeLastModifiedProjectId(context.currentProject(),context.currentProject().getId(),resource);
  }
  finally {
    clearResourceCache();
    m_propertyCache.clear();
    OpenCms.fireCmsEvent(new CmsEvent(new CmsObject(),I_CmsEventListener.EVENT_RESOURCE_AND_PROPERTIES_MODIFIED,Collections.singletonMap("resource",resource)));
  }
}
