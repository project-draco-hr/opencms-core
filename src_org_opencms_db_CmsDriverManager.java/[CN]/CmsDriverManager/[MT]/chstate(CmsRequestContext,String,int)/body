{
  CmsResource resource=null;
  if (CmsResource.isFolder(filename)) {
    resource=readFolder(context,filename);
  }
 else {
    resource=(CmsFile)readFileHeader(context,filename);
  }
  checkPermissions(context,resource,I_CmsConstants.C_WRITE_ACCESS,true,CmsResourceFilter.ALL);
  resource.setState(state);
  resource.setUserLastModified(context.currentUser().getId());
  m_vfsDriver.writeResource(context.currentProject(),resource,C_UPDATE_ALL);
  clearResourceCache();
}
