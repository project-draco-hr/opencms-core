{
  Set exportPoints=new HashSet();
  String currentExportPoint=null;
  List resources=new ArrayList();
  Iterator i=null;
  CmsResource currentResource=null;
  CmsExportPointDriver exportPointDriver=null;
  try {
    CmsRequestContext context=OpenCms.initCmsObject(OpenCms.getDefaultUsers().getUserExport()).getRequestContext();
    context.setCurrentProject(readProject(I_CmsConstants.C_PROJECT_ONLINE_ID));
    exportPoints.addAll(OpenCms.getExportPoints());
    exportPoints.addAll(OpenCms.getModuleManager().getExportPoints());
    if (exportPoints.size() == 0) {
      if (OpenCms.getLog(this).isWarnEnabled()) {
        OpenCms.getLog(this).warn("No export points configured at all.");
      }
      return;
    }
    exportPointDriver=new CmsExportPointDriver(exportPoints);
    if (report == null) {
      report=new CmsLogReport();
    }
    i=exportPointDriver.getExportPointPaths().iterator();
    while (i.hasNext()) {
      currentExportPoint=(String)i.next();
      if (OpenCms.getLog(this).isInfoEnabled()) {
        OpenCms.getLog(this).info("Writing export point " + currentExportPoint);
      }
      try {
        resources=readAllSubResourcesInDfs(context,currentExportPoint,-1);
        setFullResourceNames(context,resources);
        Iterator j=resources.iterator();
        while (j.hasNext()) {
          currentResource=(CmsResource)j.next();
          if (currentResource.getTypeId() == CmsResourceTypeFolder.C_RESOURCE_TYPE_ID) {
            exportPointDriver.createFolder(currentResource.getRootPath(),currentExportPoint);
          }
 else {
            exportPointDriver.createFolder(currentExportPoint,currentExportPoint);
            CmsFile file=getVfsDriver().readFile(I_CmsConstants.C_PROJECT_ONLINE_ID,false,currentResource.getStructureId());
            file.setRootPath(currentResource.getRootPath());
            writeExportPoint(context,exportPointDriver,currentExportPoint,file);
          }
        }
      }
 catch (      CmsException e) {
        if (e.getType() != CmsException.C_NOT_FOUND) {
          if (OpenCms.getLog(this).isErrorEnabled()) {
            OpenCms.getLog(this).error("Error updating export points",e);
          }
        }
      }
    }
  }
 catch (  CmsException e) {
    if (OpenCms.getLog(this).isErrorEnabled()) {
      OpenCms.getLog(this).error("Error updating export points",e);
    }
  }
}
