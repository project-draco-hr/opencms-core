{
  String cacheKey=getCacheKey(dbc.currentUser().getName() + filter.getCacheId() + readTree,dbc.currentProject(),parent.getRootPath());
  List subResources=(List)m_resourceListCache.get(cacheKey);
  if (subResources != null && subResources.size() > 0) {
    return updateContextDates(dbc,subResources,filter);
  }
  subResources=m_vfsDriver.readResourceTree(dbc,dbc.currentProject().getId(),(readTree ? parent.getRootPath() : parent.getStructureId().toString()),filter.getType(),filter.getState(),filter.getModifiedAfter(),filter.getModifiedBefore(),(readTree ? I_CmsConstants.C_READMODE_INCLUDE_TREE : I_CmsConstants.C_READMODE_EXCLUDE_TREE) | (filter.excludeType() ? I_CmsConstants.C_READMODE_EXCLUDE_TYPE : 0) | (filter.excludeState() ? I_CmsConstants.C_READMODE_EXCLUDE_STATE : 0)| ((filter.getOnlyFolders() != null) ? (filter.getOnlyFolders().booleanValue() ? I_CmsConstants.C_READMODE_ONLY_FOLDERS : I_CmsConstants.C_READMODE_ONLY_FILES) : 0));
  for (int i=0; i < subResources.size(); i++) {
    CmsResource currentResource=(CmsResource)subResources.get(i);
    int perms=m_securityManager.hasPermissions(dbc,currentResource,CmsPermissionSet.ACCESS_READ,true,filter);
    if (perms != CmsSecurityManager.PERM_ALLOWED) {
      subResources.remove(i--);
    }
  }
  m_resourceListCache.put(cacheKey,subResources);
  return updateContextDates(dbc,subResources,filter);
}
