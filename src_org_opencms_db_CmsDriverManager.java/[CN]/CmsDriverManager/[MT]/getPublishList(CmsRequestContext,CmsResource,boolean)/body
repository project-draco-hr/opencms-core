{
  CmsPublishList publishList=new CmsPublishList(directPublishResource);
  if (directPublishResource == null) {
    publishList.addFolders(filterResources(context,null,m_vfsDriver.readResourceTree(context.currentProject().getId(),I_CmsConstants.C_READ_IGNORE_PARENT,CmsResourceTypeFolder.C_RESOURCE_TYPE_ID,I_CmsConstants.C_STATE_UNCHANGED,I_CmsConstants.C_READ_IGNORE_TIME,I_CmsConstants.C_READ_IGNORE_TIME,I_CmsConstants.C_READMODE_INCLUDE_TREE | I_CmsConstants.C_READMODE_INCLUDE_PROJECT | I_CmsConstants.C_READMODE_EXCLUDE_STATE)));
    publishList.addFiles(filterResources(context,publishList.getFolderList(),m_vfsDriver.readResourceTree(context.currentProject().getId(),I_CmsConstants.C_READ_IGNORE_PARENT,CmsResourceTypeFolder.C_RESOURCE_TYPE_ID,I_CmsConstants.C_STATE_UNCHANGED,I_CmsConstants.C_READ_IGNORE_TIME,I_CmsConstants.C_READ_IGNORE_TIME,I_CmsConstants.C_READMODE_INCLUDE_TREE | I_CmsConstants.C_READMODE_INCLUDE_PROJECT | I_CmsConstants.C_READMODE_EXCLUDE_TYPE| I_CmsConstants.C_READMODE_EXCLUDE_STATE)));
  }
 else   if (directPublishResource.isFolder()) {
    if (I_CmsConstants.C_STATE_UNCHANGED != directPublishResource.getState() && getLock(context,null,directPublishResource.getRootPath()).isNullLock()) {
      publishList.addFolder(directPublishResource);
    }
    publishList.addFolders(filterResources(context,null,m_vfsDriver.readResourceTree(context.currentProject().getId(),directPublishResource.getRootPath(),CmsResourceTypeFolder.C_RESOURCE_TYPE_ID,I_CmsConstants.C_STATE_UNCHANGED,I_CmsConstants.C_READ_IGNORE_TIME,I_CmsConstants.C_READ_IGNORE_TIME,I_CmsConstants.C_READMODE_INCLUDE_TREE | I_CmsConstants.C_READMODE_INCLUDE_PROJECT | I_CmsConstants.C_READMODE_EXCLUDE_STATE)));
    publishList.addFiles(filterResources(context,publishList.getFolderList(),m_vfsDriver.readResourceTree(context.currentProject().getId(),directPublishResource.getRootPath(),CmsResourceTypeFolder.C_RESOURCE_TYPE_ID,I_CmsConstants.C_STATE_UNCHANGED,I_CmsConstants.C_READ_IGNORE_TIME,I_CmsConstants.C_READ_IGNORE_TIME,I_CmsConstants.C_READMODE_INCLUDE_TREE | I_CmsConstants.C_READMODE_INCLUDE_PROJECT | I_CmsConstants.C_READMODE_EXCLUDE_TYPE| I_CmsConstants.C_READMODE_EXCLUDE_STATE)));
  }
 else   if (directPublishResource.isFile() && I_CmsConstants.C_STATE_UNCHANGED != directPublishResource.getState()) {
    if (getLock(context,null,directPublishResource.getRootPath()).isNullLock()) {
      publishList.addFile(directPublishResource);
    }
  }
  if (publishSiblings) {
    List publishFiles=publishList.getFileList();
    int size=publishFiles.size();
    for (int i=0; i < size; i++) {
      CmsResource currentFile=(CmsResource)publishFiles.get(i);
      if (currentFile.getSiblingCount() > 1) {
        publishList.addFiles(filterSiblings(context,currentFile,publishList.getFolderList(),readSiblings(context,null,currentFile.getRootPath(),CmsResourceFilter.ALL_MODIFIED)));
      }
    }
  }
  return publishList;
}
