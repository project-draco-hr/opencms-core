{
  CmsPublishList publishList=new CmsPublishList(directPublishResource);
  if (directPublishResource == null) {
    List folderList=m_vfsDriver.readResourceTree(context.currentProject().getId(),I_CmsConstants.C_READ_IGNORE_PARENT,I_CmsConstants.C_READ_IGNORE_TYPE,I_CmsConstants.C_STATE_UNCHANGED,I_CmsConstants.C_READ_IGNORE_TIME,I_CmsConstants.C_READ_IGNORE_TIME,I_CmsConstants.C_READMODE_INCLUDE_TREE | I_CmsConstants.C_READMODE_INCLUDE_PROJECT | I_CmsConstants.C_READMODE_EXCLUDE_STATE| I_CmsConstants.C_READMODE_ONLY_FOLDERS);
    publishList.addFolders(filterResources(context,folderList,folderList));
    List fileList=m_vfsDriver.readResourceTree(context.currentProject().getId(),I_CmsConstants.C_READ_IGNORE_PARENT,I_CmsConstants.C_READ_IGNORE_TYPE,I_CmsConstants.C_STATE_UNCHANGED,I_CmsConstants.C_READ_IGNORE_TIME,I_CmsConstants.C_READ_IGNORE_TIME,I_CmsConstants.C_READMODE_INCLUDE_TREE | I_CmsConstants.C_READMODE_INCLUDE_PROJECT | I_CmsConstants.C_READMODE_EXCLUDE_STATE| I_CmsConstants.C_READMODE_ONLY_FILES);
    publishList.addFiles(filterResources(context,publishList.getFolderList(),fileList));
  }
 else   if (directPublishResource.isFolder()) {
    if (I_CmsConstants.C_STATE_UNCHANGED != directPublishResource.getState() && getLock(context,null,directPublishResource.getRootPath()).isNullLock()) {
      publishList.addFolder(directPublishResource);
    }
    List folderList=m_vfsDriver.readResourceTree(context.currentProject().getId(),directPublishResource.getRootPath(),I_CmsConstants.C_READ_IGNORE_TYPE,I_CmsConstants.C_STATE_UNCHANGED,I_CmsConstants.C_READ_IGNORE_TIME,I_CmsConstants.C_READ_IGNORE_TIME,I_CmsConstants.C_READMODE_INCLUDE_TREE | I_CmsConstants.C_READMODE_INCLUDE_PROJECT | I_CmsConstants.C_READMODE_EXCLUDE_STATE| I_CmsConstants.C_READMODE_ONLY_FOLDERS);
    publishList.addFolders(filterResources(context,publishList.getFolderList(),folderList));
    List fileList=m_vfsDriver.readResourceTree(context.currentProject().getId(),directPublishResource.getRootPath(),I_CmsConstants.C_READ_IGNORE_TYPE,I_CmsConstants.C_STATE_UNCHANGED,I_CmsConstants.C_READ_IGNORE_TIME,I_CmsConstants.C_READ_IGNORE_TIME,I_CmsConstants.C_READMODE_INCLUDE_TREE | I_CmsConstants.C_READMODE_INCLUDE_PROJECT | I_CmsConstants.C_READMODE_EXCLUDE_STATE| I_CmsConstants.C_READMODE_ONLY_FILES);
    publishList.addFiles(filterResources(context,publishList.getFolderList(),fileList));
  }
 else   if (directPublishResource.isFile() && I_CmsConstants.C_STATE_UNCHANGED != directPublishResource.getState()) {
    if (getLock(context,null,directPublishResource.getRootPath()).isNullLock()) {
      publishList.addFile(directPublishResource);
    }
  }
  if (publishSiblings) {
    List publishFiles=publishList.getFileList();
    int size=publishFiles.size();
    for (int i=0; i < size; i++) {
      CmsResource currentFile=(CmsResource)publishFiles.get(i);
      if (currentFile.getSiblingCount() > 1) {
        publishList.addFiles(filterSiblings(context,currentFile,publishList.getFolderList(),readSiblings(context,null,currentFile,CmsResourceFilter.ALL_MODIFIED)));
      }
    }
  }
  return publishList;
}
