{
  CmsFolder folder=null;
  Vector folders=new Vector();
  if (!foldername.endsWith(I_CmsConstants.C_FOLDER_SEPARATOR))   foldername+=I_CmsConstants.C_FOLDER_SEPARATOR;
  String cacheKey=getCacheKey(currentUser.getName() + "_folders",currentUser,currentProject,foldername);
  folders=(Vector)m_resourceListCache.get(cacheKey);
  try {
    folder=readFolder(currentUser,currentProject,foldername,includeDeleted);
    checkPermissions(currentUser,currentProject,folder,I_CmsConstants.C_READ_ACCESS);
  }
 catch (  CmsException e) {
    return new Vector();
  }
  if ((folders == null) || (folders.size() == 0)) {
    folders=new Vector();
    try {
      folders=helperGetSubFolders(currentUser,currentProject,folder);
    }
 catch (    CmsException exc) {
    }
    if (!currentProject.isOnlineProject()) {
      try {
        Vector onlineFolders=helperGetSubFolders(currentUser,onlineProject(currentUser,currentProject),folder);
        folders=mergeResources(folders,onlineFolders);
      }
 catch (      CmsException exc) {
      }
    }
    m_resourceListCache.put(cacheKey,folders);
  }
  return (folders == null) ? null : (Vector)folders.clone();
}
