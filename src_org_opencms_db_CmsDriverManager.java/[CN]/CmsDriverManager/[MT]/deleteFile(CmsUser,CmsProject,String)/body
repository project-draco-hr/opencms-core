{
  CmsResource onlineFile;
  CmsResource file=readFileHeader(currentUser,currentProject,filename);
  try {
    onlineFile=readFileHeader(currentUser,onlineProject(currentUser,currentProject),filename);
  }
 catch (  CmsException exc) {
    onlineFile=null;
  }
  getVfsAccessGuard(currentUser,currentProject).check(file,C_WRITE_ACCESS);
  if (onlineFile == null) {
    deleteAllProperties(currentUser,currentProject,file.getResourceName());
    m_vfsDriver.removeFile(currentProject.getId(),filename);
    removeAllAccessControlEntries(currentUser,currentProject,file);
  }
 else {
    m_vfsDriver.deleteFile(currentProject,filename);
    deleteAllAccessControlEntries(currentUser,currentProject,file);
  }
  this.clearResourceCache(filename,currentProject,currentUser);
  m_accessCache.clear();
  fileSystemChanged(false);
}
