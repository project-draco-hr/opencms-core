{
  CmsResource onlineFile=null;
  CmsResource offlineFile=null;
  try {
    List onlinePath=readPath(currentUser,readProject(I_CmsConstants.C_PROJECT_ONLINE_ID),filename,false);
    onlineFile=(CmsResource)onlinePath.get(onlinePath.size() - 1);
  }
 catch (  CmsException exc) {
    onlineFile=null;
  }
  List offlinePath=readPath(currentUser,currentProject,filename,false);
  offlineFile=(CmsResource)offlinePath.get(offlinePath.size() - 1);
  checkPermissions(currentUser,currentProject,offlineFile,I_CmsConstants.C_WRITE_ACCESS);
  if (onlineFile == null) {
    deleteAllProperties(currentUser,currentProject,filename);
    m_vfsDriver.removeFile(currentProject,offlineFile);
    m_userDriver.removeAllAccessControlEntries(currentProject,offlineFile.getResourceAceId());
  }
 else {
    m_vfsDriver.deleteFile(currentProject,offlineFile.getId());
    deleteAllAccessControlEntries(currentUser,currentProject,offlineFile);
  }
  clearAccessControlListCache();
  clearResourceCache();
  m_accessCache.clear();
  fileSystemChanged(false);
}
