{
  CmsFile file=null;
  byte[] contents=null;
  String encoding=null;
  try {
    if (file == null) {
      file=getVfsDriver().readFile(context.currentProject().getId(),false,publishedResource.getStructureId());
      file.setFullResourceName(publishedResource.getRootPath());
    }
    contents=file.getContents();
    encoding=getVfsDriver().readProperty(I_CmsConstants.C_PROPERTY_CONTENT_ENCODING,context.currentProject().getId(),file,file.getType());
    if (encoding != null) {
      try {
        contents=(new String(contents,encoding)).getBytes();
      }
 catch (      UnsupportedEncodingException e) {
        if (OpenCms.getLog(this).isErrorEnabled()) {
          OpenCms.getLog(this).error("Unsupported encoding of " + publishedResource.toString(),e);
        }
        throw new CmsException("Unsupported encoding of " + publishedResource.toString(),e);
      }
    }
    discAccess.writeFile(publishedResource.getRootPath(),exportKey,contents);
  }
 catch (  Exception e) {
    if (OpenCms.getLog(this).isErrorEnabled()) {
      OpenCms.getLog(this).error("Error writing export point of " + publishedResource.toString(),e);
    }
    throw new CmsException("Error writing export point of " + publishedResource.toString(),e);
  }
}
