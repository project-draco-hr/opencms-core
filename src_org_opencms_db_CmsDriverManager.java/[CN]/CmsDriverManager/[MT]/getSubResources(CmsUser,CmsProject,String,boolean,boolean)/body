{
  List subResources=null;
  CmsFolder parentFolder=null;
  CmsResource currentResource=null;
  String cacheKey=null;
  if (getSubFolders) {
    cacheKey=getCacheKey(currentUser.getName() + "_folders",currentUser,currentProject,parentFolderName);
  }
 else {
    cacheKey=getCacheKey(currentUser.getName() + "_files_" + includeDeleted,currentUser,currentProject,parentFolderName);
  }
  subResources=(List)m_resourceListCache.get(cacheKey);
  try {
    if (!parentFolderName.endsWith(I_CmsConstants.C_FOLDER_SEPARATOR)) {
      parentFolderName+=I_CmsConstants.C_FOLDER_SEPARATOR;
    }
    parentFolder=readFolder(currentUser,currentProject,parentFolderName,includeDeleted);
    checkPermissions(currentUser,currentProject,parentFolder,I_CmsConstants.C_READ_ACCESS);
  }
 catch (  CmsException e) {
    return (List)new ArrayList(0);
  }
  if ((parentFolder.getState() == I_CmsConstants.C_STATE_DELETED) && (!includeDeleted)) {
    return (List)new ArrayList(0);
  }
  if (subResources != null && subResources.size() > 0) {
    return subResources;
  }
  subResources=m_vfsDriver.getSubResources(currentProject,parentFolder,getSubFolders);
  for (int i=0; i < subResources.size(); i++) {
    currentResource=(CmsResource)subResources.get(i);
    if (!hasPermissions(currentUser,currentProject,currentResource,I_CmsConstants.C_READ_ACCESS,false)) {
      subResources.remove(i--);
    }
  }
  m_resourceListCache.put(cacheKey,subResources);
  return subResources;
}
