{
  CmsResource resource=readFileHeader(context,resourceName,CmsResourceFilter.ALL);
  checkPermissions(context,resource,I_CmsConstants.C_READ_OR_VIEW_ACCESS,true,CmsResourceFilter.ALL);
  search=search && (siteRoot != null);
  String cacheKey=getCacheKey(key + search,context.currentProject().getId(),resource.getRootPath());
  CmsProperty value=(CmsProperty)m_propertyCache.get(cacheKey);
  if (value == null) {
    String cacheKey2=getCacheKey(C_CACHE_ALL_PROPERTIES + search,context.currentProject().getId(),resource.getRootPath());
    List allProperties=(List)m_propertyCache.get(cacheKey2);
    if (allProperties != null) {
      for (int i=0; i < allProperties.size(); i++) {
        CmsProperty property=(CmsProperty)allProperties.get(i);
        if (property.getKey().equals(key)) {
          value=property;
          break;
        }
      }
    }
 else     if (search) {
      String cacheKey3=getCacheKey(key + false,context.currentProject().getId(),resource.getRootPath());
      value=(CmsProperty)m_propertyCache.get(cacheKey3);
      if ((value == null) || value.isNullProperty()) {
        boolean cont;
        siteRoot+="/";
        do {
          try {
            value=readPropertyObject(context,resourceName,siteRoot,key,false);
            cont=(value.isNullProperty() && (!"/".equals(resourceName)));
          }
 catch (          CmsSecurityException se) {
            cont=false;
          }
          if (cont) {
            resourceName=CmsResource.getParentFolder(resourceName);
          }
        }
 while (cont);
      }
    }
 else {
      value=m_vfsDriver.readPropertyObject(key,context.currentProject(),resource);
    }
    if (value == null) {
      value=CmsProperty.getNullProperty();
    }
    m_propertyCache.put(cacheKey,value);
  }
  return value;
}
