{
  CmsResourceFilter filter=CmsResourceFilter.IGNORE_EXPIRATION;
  List resources=new ArrayList();
  if (recursive) {
    resources=readResourcesWithProperty(dbc,resource,propertyDefinition,null,filter);
  }
 else {
    resources.add(resource);
  }
  Pattern oldPattern;
  try {
    oldPattern=Pattern.compile(oldValue);
  }
 catch (  PatternSyntaxException e) {
    throw new CmsVfsException(Messages.get().container(Messages.ERR_CHANGE_RESOURCES_IN_FOLDER_WITH_PROP_4,new Object[]{propertyDefinition,oldValue,newValue,resource.getRootPath()}),e);
  }
  List changedResources=new ArrayList(resources.size());
  CmsPermissionSet perm=CmsPermissionSet.ACCESS_WRITE;
  for (int i=0; i < resources.size(); i++) {
    CmsResource res=(CmsResource)resources.get(i);
    try {
      m_securityManager.checkPermissions(dbc,res,perm,true,filter);
    }
 catch (    Exception e) {
      continue;
    }
    CmsProperty property=readPropertyObject(dbc,res,propertyDefinition,false);
    String structureValue=property.getStructureValue();
    String resourceValue=property.getResourceValue();
    boolean changed=false;
    if ((structureValue != null) && oldPattern.matcher(structureValue).matches()) {
      property.setStructureValue(newValue);
      changed=true;
    }
    if ((resourceValue != null) && oldPattern.matcher(resourceValue).matches()) {
      property.setResourceValue(newValue);
      changed=true;
    }
    if (changed) {
      writePropertyObject(dbc,res,property);
      changedResources.add(res);
    }
  }
  return changedResources;
}
