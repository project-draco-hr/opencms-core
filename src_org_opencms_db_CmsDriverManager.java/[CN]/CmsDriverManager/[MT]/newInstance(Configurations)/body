{
  String driverPoolNames[]=null;
  String driverName=null;
  String driverPoolName=null;
  Class driverClass=null;
  I_CmsVfsDriver vfsDriver=null;
  I_CmsUserDriver userDriver=null;
  I_CmsProjectDriver projectDriver=null;
  I_CmsWorkflowDriver workflowDriver=null;
  I_CmsBackupDriver backupDriver=null;
  CmsDriverManager driverManager=null;
  try {
    driverManager=new CmsDriverManager();
    if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
      A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_INIT,". Driver manager init  : phase 1 ok - initializing database");
    }
  }
 catch (  Exception exc) {
    String message="Critical error while loading driver manager";
    if (I_CmsLogChannels.C_LOGGING && A_OpenCms.isLogging(I_CmsLogChannels.C_OPENCMS_CRITICAL)) {
      A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_CRITICAL,"[CmsDriverManager] " + message);
    }
    exc.printStackTrace(System.err);
    throw new CmsException(message,CmsException.C_RB_INIT_ERROR,exc);
  }
  driverPoolNames=configurations.getStringArray(C_CONFIGURATION_DB + ".pools");
  if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
    A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_INIT,". Resource pools       : ");
  }
  driverManager.m_driverPools=new HashMap();
  for (int p=0; p < driverPoolNames.length; p++) {
    try {
      String poolUrl=CmsDbPool.createDriverConnectionPool(configurations,driverPoolNames[p]);
      if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
        A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_INIT,". Initializing pool    : " + poolUrl);
      }
      driverManager.m_driverPools.put(driverPoolNames[p],poolUrl);
    }
 catch (    Exception exc) {
      String message="Critical error while initializing resource pool " + driverPoolNames[p];
      if (I_CmsLogChannels.C_LOGGING && A_OpenCms.isLogging(I_CmsLogChannels.C_OPENCMS_CRITICAL)) {
        A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_CRITICAL,"[CmsDriverManager] " + message);
      }
      exc.printStackTrace(System.err);
      throw new CmsException(message,CmsException.C_RB_INIT_ERROR,exc);
    }
  }
  driverName=configurations.getString(C_CONFIGURATION_DB + ".vfs.driver");
  driverPoolName=configurations.getString(C_CONFIGURATION_DB + ".vfs.pool");
  vfsDriver=(I_CmsVfsDriver)newDriverInstance(configurations,driverName,driverPoolName,driverManager);
  driverName=configurations.getString(C_CONFIGURATION_DB + ".user.driver");
  driverPoolName=configurations.getString(C_CONFIGURATION_DB + ".user.pool");
  userDriver=(I_CmsUserDriver)newDriverInstance(configurations,driverName,driverPoolName,driverManager);
  driverName=configurations.getString(C_CONFIGURATION_DB + ".project.driver");
  driverPoolName=configurations.getString(C_CONFIGURATION_DB + ".project.pool");
  projectDriver=(I_CmsProjectDriver)newDriverInstance(configurations,driverName,driverPoolName,driverManager);
  driverName=configurations.getString(C_CONFIGURATION_DB + ".workflow.driver");
  driverPoolName=configurations.getString(C_CONFIGURATION_DB + ".workflow.pool");
  workflowDriver=(I_CmsWorkflowDriver)newDriverInstance(configurations,driverName,driverPoolName,driverManager);
  driverName=configurations.getString(C_CONFIGURATION_DB + ".backup.driver");
  driverPoolName=configurations.getString(C_CONFIGURATION_DB + ".backup.pool");
  backupDriver=(I_CmsBackupDriver)newDriverInstance(configurations,driverName,driverPoolName,driverManager);
  try {
    driverManager.init(configurations,vfsDriver,userDriver,projectDriver,workflowDriver,backupDriver);
    if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
      A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_INIT,". Driver manager init  : phase 3 ok - finished");
    }
  }
 catch (  Exception exc) {
    String message="Critical error while loading driver manager";
    if (I_CmsLogChannels.C_LOGGING && A_OpenCms.isLogging(I_CmsLogChannels.C_OPENCMS_CRITICAL)) {
      A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_CRITICAL,"[CmsDriverManager] " + message);
    }
    exc.printStackTrace(System.err);
    throw new CmsException(message,CmsException.C_RB_INIT_ERROR,exc);
  }
  driverPoolName=configurations.getString(C_CONFIGURATION_DB + ".cos.pool");
  driverPoolName=(String)driverManager.m_driverPools.get(driverPoolName);
  A_OpenCms.setRuntimeProperty("cosPoolUrl",driverPoolName);
  CmsIdGenerator.setDefaultPool(driverPoolName);
  return driverManager;
}
