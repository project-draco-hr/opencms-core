{
  Set projects=new HashSet();
  List ous=getOrgUnitsForRole(dbc,CmsRole.PROJECT_MANAGER.forOrgUnit(""),true);
  Set userGroupIds=new HashSet();
  Iterator itGroups=getGroupsOfUser(dbc,dbc.currentUser().getName(),false).iterator();
  while (itGroups.hasNext()) {
    CmsGroup group=(CmsGroup)itGroups.next();
    userGroupIds.add(group.getId());
  }
  projects.addAll(m_projectDriver.readProjects(dbc,""));
  Iterator itProjects=projects.iterator();
  while (itProjects.hasNext()) {
    CmsProject project=(CmsProject)itProjects.next();
    if (project.isHidden()) {
      itProjects.remove();
      continue;
    }
    boolean accessible=false;
    accessible=accessible || project.isOnlineProject();
    accessible=accessible || project.getOwnerId().equals(dbc.currentUser().getId());
    Iterator itOus=ous.iterator();
    while (!accessible && itOus.hasNext()) {
      CmsOrganizationalUnit ou=(CmsOrganizationalUnit)itOus.next();
      accessible=accessible || project.getOuFqn().startsWith(ou.getName());
    }
    if (!accessible) {
      CmsUUID groupId=null;
      if (userGroupIds.contains(project.getGroupId())) {
        groupId=project.getGroupId();
      }
 else       if (userGroupIds.contains(project.getManagerGroupId())) {
        groupId=project.getManagerGroupId();
      }
      if (groupId != null) {
        String oufqn=readGroup(dbc,groupId).getOuFqn();
        accessible=accessible || (oufqn.startsWith(dbc.getRequestContext().getOuFqn()));
      }
    }
    if (!accessible) {
      itProjects.remove();
    }
  }
  ArrayList accessibleProjects=new ArrayList(projects);
  Collections.sort(accessibleProjects);
  CmsProject onlineProject=readProject(dbc,CmsProject.ONLINE_PROJECT_ID);
  if (accessibleProjects.contains(onlineProject)) {
    accessibleProjects.remove(onlineProject);
    accessibleProjects.add(0,onlineProject);
  }
  return accessibleProjects;
}
