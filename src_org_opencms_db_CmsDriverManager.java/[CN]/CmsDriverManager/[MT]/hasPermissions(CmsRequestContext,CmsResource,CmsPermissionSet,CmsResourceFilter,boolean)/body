{
  if (filter != CmsResourceFilter.ALL) {
    if (!filter.isValid(context,resource)) {
      return PERM_FILTERED;
    }
    if ((requiredPermissions.getPermissions() & I_CmsConstants.C_ACCESS_VISIBLE) > 0) {
      if (!filter.includeVisiblePermission()) {
        requiredPermissions.setPermissions(requiredPermissions.getAllowedPermissions() | I_CmsConstants.C_ACCESS_VISIBLE,requiredPermissions.getDeniedPermissions());
      }
    }
  }
  String cacheKey=m_keyGenerator.getCacheKeyForUserPermissions(String.valueOf(strongCheck),context,resource,requiredPermissions);
  Integer cacheResult=(Integer)m_permissionCache.get(cacheKey);
  if (cacheResult != null) {
    return cacheResult;
  }
  int denied=0;
  if (context.currentProject().isOnlineProject()) {
    denied|=I_CmsConstants.C_PERMISSION_WRITE;
  }
  boolean isAdmin=isAdmin(context);
  if (!isAdmin && ((resource.getType() == CmsResourceTypeXMLTemplate.C_RESOURCE_TYPE_ID) || (resource.getType() == CmsResourceTypeJsp.C_RESOURCE_TYPE_ID))) {
    denied|=I_CmsConstants.C_PERMISSION_WRITE;
  }
  CmsLock lock=getLock(context,resource);
  if (!lock.isNullLock()) {
    if (!context.currentUser().getId().equals(lock.getUserId())) {
      denied|=I_CmsConstants.C_PERMISSION_WRITE;
    }
  }
  CmsPermissionSet permissions;
  if (isAdmin) {
    permissions=new CmsPermissionSet(~0);
  }
 else {
    CmsAccessControlList acl=getAccessControlList(context,resource);
    permissions=acl.getPermissions(context.currentUser(),getGroupsOfUser(context,context.currentUser().getName()));
  }
  permissions.denyPermissions(denied);
  Integer result;
  if (strongCheck) {
    if ((requiredPermissions.getPermissions() & (permissions.getPermissions())) == requiredPermissions.getPermissions()) {
      result=PERM_ALLOWED;
    }
 else {
      result=PERM_DENIED;
    }
  }
 else {
    if ((requiredPermissions.getPermissions() & (permissions.getPermissions())) > 0) {
      result=PERM_ALLOWED;
    }
 else {
      result=PERM_DENIED;
    }
  }
  m_permissionCache.put(cacheKey,result);
  if ((result != PERM_ALLOWED) && OpenCms.getLog(this).isDebugEnabled()) {
    OpenCms.getLog(this).debug("Access to resource " + resource.getRootPath() + " "+ "not permitted for user "+ context.currentUser().getName()+ ", "+ "required permissions "+ requiredPermissions.getPermissionString()+ " "+ "not satisfied by "+ permissions.getPermissionString()+ " "+ ((strongCheck) ? "(required all)" : "(required one)"));
  }
  return result;
}
