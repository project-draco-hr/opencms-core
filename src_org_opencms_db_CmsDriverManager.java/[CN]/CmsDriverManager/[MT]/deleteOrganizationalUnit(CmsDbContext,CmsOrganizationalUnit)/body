{
  if (dbc.getRequestContext().getOuFqn().equals(organizationalUnit.getName())) {
    throw new CmsDbConsistencyException(Messages.get().container(Messages.ERR_ORGUNIT_DELETE_IN_CONTEXT_1,organizationalUnit.getName()));
  }
  if (dbc.currentUser().getOuFqn().equals(organizationalUnit.getName())) {
    throw new CmsDbConsistencyException(Messages.get().container(Messages.ERR_ORGUNIT_DELETE_CURRENT_USER_1,organizationalUnit.getName()));
  }
  if (!getOrganizationalUnits(dbc,organizationalUnit,true).isEmpty()) {
    throw new CmsDbConsistencyException(Messages.get().container(Messages.ERR_ORGUNIT_DELETE_SUB_ORGUNITS_1,organizationalUnit.getName()));
  }
  List groups=getGroups(dbc,organizationalUnit,true,false);
  Iterator itGroups=groups.iterator();
  while (itGroups.hasNext()) {
    CmsGroup group=(CmsGroup)itGroups.next();
    if (!OpenCms.getDefaultUsers().isDefaultGroup(group.getName())) {
      throw new CmsDbConsistencyException(Messages.get().container(Messages.ERR_ORGUNIT_DELETE_GROUPS_1,organizationalUnit.getName()));
    }
  }
  if (!getUsers(dbc,organizationalUnit,true).isEmpty()) {
    throw new CmsDbConsistencyException(Messages.get().container(Messages.ERR_ORGUNIT_DELETE_USERS_1,organizationalUnit.getName()));
  }
  itGroups=groups.iterator();
  while (itGroups.hasNext()) {
    CmsGroup group=(CmsGroup)itGroups.next();
    deleteGroup(dbc,group,null);
  }
  Iterator itProjects=m_projectDriver.readProjects(dbc,organizationalUnit.getName()).iterator();
  while (itProjects.hasNext()) {
    CmsProject project=(CmsProject)itProjects.next();
    deleteProject(dbc,project);
  }
  Iterator itRoles=getGroups(dbc,organizationalUnit,true,true).iterator();
  while (itRoles.hasNext()) {
    CmsGroup role=(CmsGroup)itRoles.next();
    deleteGroup(dbc,role,null);
  }
  CmsResource resource=readResource(dbc,organizationalUnit.getId(),CmsResourceFilter.DEFAULT);
  CmsPublishList pl=new CmsPublishList(resource,false);
  pl.add(resource,false);
  m_userDriver.deleteOrganizationalUnit(dbc,organizationalUnit);
  m_projectDriver.writePublishHistory(dbc,pl.getPublishHistoryId(),new CmsPublishedResource(resource));
  OpenCms.getMemoryMonitor().clearPrincipalsCache();
  OpenCms.getMemoryMonitor().flushProperties();
  OpenCms.getMemoryMonitor().flushPropertyLists();
  Map eventData=new HashMap();
  eventData.put(I_CmsEventListener.KEY_PUBLISHID,pl.getPublishHistoryId().toString());
  eventData.put(I_CmsEventListener.KEY_PROJECTID,dbc.currentProject().getUuid());
  eventData.put(I_CmsEventListener.KEY_DBCONTEXT,dbc);
  CmsEvent afterPublishEvent=new CmsEvent(I_CmsEventListener.EVENT_PUBLISH_PROJECT,eventData);
  OpenCms.fireCmsEvent(afterPublishEvent);
  m_lockManager.removeDeletedResource(dbc,resource.getRootPath());
}
