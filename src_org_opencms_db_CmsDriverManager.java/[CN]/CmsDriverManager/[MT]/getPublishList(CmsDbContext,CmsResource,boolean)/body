{
  CmsPublishList publishList=new CmsPublishList(directPublishResource);
  if (directPublishResource == null) {
    List folderList=m_vfsDriver.readResourceTree(dbc,dbc.currentProject().getId(),CmsDriverManager.READ_IGNORE_PARENT,CmsDriverManager.READ_IGNORE_TYPE,CmsResource.STATE_UNCHANGED,CmsDriverManager.READ_IGNORE_TIME,CmsDriverManager.READ_IGNORE_TIME,CmsDriverManager.READMODE_INCLUDE_TREE | CmsDriverManager.READMODE_INCLUDE_PROJECT | CmsDriverManager.READMODE_EXCLUDE_STATE| CmsDriverManager.READMODE_ONLY_FOLDERS);
    publishList.addFolders(filterResources(dbc,folderList,folderList));
    List fileList=m_vfsDriver.readResourceTree(dbc,dbc.currentProject().getId(),CmsDriverManager.READ_IGNORE_PARENT,CmsDriverManager.READ_IGNORE_TYPE,CmsResource.STATE_UNCHANGED,CmsDriverManager.READ_IGNORE_TIME,CmsDriverManager.READ_IGNORE_TIME,CmsDriverManager.READMODE_INCLUDE_TREE | CmsDriverManager.READMODE_INCLUDE_PROJECT | CmsDriverManager.READMODE_EXCLUDE_STATE| CmsDriverManager.READMODE_ONLY_FILES);
    publishList.addFiles(filterResources(dbc,publishList.getFolderList(),fileList));
  }
 else   if (directPublishResource.isFolder()) {
    if (CmsResource.STATE_UNCHANGED != directPublishResource.getState() && getLock(dbc,directPublishResource).isNullLock()) {
      publishList.addFolder(directPublishResource);
    }
    List folderList=m_vfsDriver.readResourceTree(dbc,dbc.currentProject().getId(),directPublishResource.getRootPath(),CmsDriverManager.READ_IGNORE_TYPE,CmsResource.STATE_UNCHANGED,CmsDriverManager.READ_IGNORE_TIME,CmsDriverManager.READ_IGNORE_TIME,CmsDriverManager.READMODE_INCLUDE_TREE | CmsDriverManager.READMODE_INCLUDE_PROJECT | CmsDriverManager.READMODE_EXCLUDE_STATE| CmsDriverManager.READMODE_ONLY_FOLDERS);
    publishList.addFolders(filterResources(dbc,publishList.getFolderList(),folderList));
    List fileList=m_vfsDriver.readResourceTree(dbc,dbc.currentProject().getId(),directPublishResource.getRootPath(),CmsDriverManager.READ_IGNORE_TYPE,CmsResource.STATE_UNCHANGED,CmsDriverManager.READ_IGNORE_TIME,CmsDriverManager.READ_IGNORE_TIME,CmsDriverManager.READMODE_INCLUDE_TREE | CmsDriverManager.READMODE_INCLUDE_PROJECT | CmsDriverManager.READMODE_EXCLUDE_STATE| CmsDriverManager.READMODE_ONLY_FILES);
    publishList.addFiles(filterResources(dbc,publishList.getFolderList(),fileList));
  }
 else   if (directPublishResource.isFile() && CmsResource.STATE_UNCHANGED != directPublishResource.getState()) {
    if (getLock(dbc,directPublishResource).isNullLock()) {
      publishList.addFile(directPublishResource);
    }
  }
  if (publishSiblings) {
    List publishFiles=publishList.getFileList();
    int size=publishFiles.size();
    for (int i=0; i < size; i++) {
      CmsResource currentFile=(CmsResource)publishFiles.get(i);
      if (currentFile.getSiblingCount() > 1) {
        publishList.addFiles(filterSiblings(dbc,currentFile,publishList.getFolderList(),readSiblings(dbc,currentFile,CmsResourceFilter.ALL_MODIFIED)));
      }
    }
  }
  publishList.initialize();
  return publishList;
}
