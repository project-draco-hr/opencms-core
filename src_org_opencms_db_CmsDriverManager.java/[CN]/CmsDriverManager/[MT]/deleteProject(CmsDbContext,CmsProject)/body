{
  int projectId=deleteProject.getId();
  List modifiedFiles=readChangedResourcesInsideProject(dbc,projectId,1);
  List modifiedFolders=readChangedResourcesInsideProject(dbc,projectId,CmsResourceTypeFolder.C_RESOURCE_TYPE_ID);
  for (int i=0; i < modifiedFiles.size(); i++) {
    CmsResource currentFile=(CmsResource)modifiedFiles.get(i);
    if (currentFile.getState() == I_CmsConstants.C_STATE_NEW) {
      CmsLock lock=getLock(dbc,currentFile);
      if (lock.isNullLock()) {
        lockResource(dbc,currentFile,CmsLock.C_MODE_COMMON);
      }
 else       if (!lock.getUserId().equals(dbc.currentUser().getId()) || lock.getProjectId() != dbc.currentProject().getId()) {
        changeLock(dbc,currentFile);
      }
      m_vfsDriver.deletePropertyObjects(dbc,projectId,currentFile,CmsProperty.C_DELETE_OPTION_DELETE_STRUCTURE_AND_RESOURCE_VALUES);
      m_vfsDriver.removeFile(dbc,dbc.currentProject(),currentFile,true);
      m_userDriver.removeAccessControlEntries(dbc,dbc.currentProject(),currentFile.getResourceId());
      OpenCms.fireCmsEvent(new CmsEvent(I_CmsEventListener.EVENT_RESOURCE_AND_PROPERTIES_MODIFIED,Collections.singletonMap("resource",currentFile)));
    }
  }
  for (int i=0; i < modifiedFolders.size(); i++) {
    CmsResource currentFolder=(CmsResource)modifiedFolders.get(i);
    if (currentFolder.getState() == I_CmsConstants.C_STATE_NEW) {
      m_vfsDriver.deletePropertyObjects(dbc,projectId,currentFolder,CmsProperty.C_DELETE_OPTION_DELETE_STRUCTURE_AND_RESOURCE_VALUES);
      m_vfsDriver.removeFolder(dbc,dbc.currentProject(),currentFolder);
      m_userDriver.removeAccessControlEntries(dbc,dbc.currentProject(),currentFolder.getResourceId());
      OpenCms.fireCmsEvent(new CmsEvent(I_CmsEventListener.EVENT_RESOURCE_AND_PROPERTIES_MODIFIED,Collections.singletonMap("resource",currentFolder)));
    }
  }
  for (int i=0; i < modifiedFolders.size(); i++) {
    CmsResource currentFolder=(CmsResource)modifiedFolders.get(i);
    if ((currentFolder.getState() == I_CmsConstants.C_STATE_CHANGED) || (currentFolder.getState() == I_CmsConstants.C_STATE_DELETED)) {
      CmsLock lock=getLock(dbc,currentFolder);
      if (lock.isNullLock()) {
        lockResource(dbc,currentFolder,CmsLock.C_MODE_COMMON);
      }
 else       if (!lock.getUserId().equals(dbc.currentUser().getId()) || lock.getProjectId() != dbc.currentProject().getId()) {
        changeLock(dbc,currentFolder);
      }
      undoChanges(dbc,currentFolder);
      OpenCms.fireCmsEvent(new CmsEvent(I_CmsEventListener.EVENT_RESOURCE_AND_PROPERTIES_MODIFIED,Collections.singletonMap("resource",currentFolder)));
    }
  }
  for (int i=0; i < modifiedFiles.size(); i++) {
    CmsResource currentFile=(CmsResource)modifiedFiles.get(i);
    if ((currentFile.getState() == I_CmsConstants.C_STATE_CHANGED) || (currentFile.getState() == I_CmsConstants.C_STATE_DELETED)) {
      CmsLock lock=getLock(dbc,currentFile);
      if (lock.isNullLock()) {
        lockResource(dbc,currentFile,CmsLock.C_MODE_COMMON);
      }
 else       if (!lock.getUserId().equals(dbc.currentUser().getId()) || lock.getProjectId() != dbc.currentProject().getId()) {
        changeLock(dbc,currentFile);
      }
      undoChanges(dbc,currentFile);
      OpenCms.fireCmsEvent(new CmsEvent(I_CmsEventListener.EVENT_RESOURCE_AND_PROPERTIES_MODIFIED,Collections.singletonMap("resource",currentFile)));
    }
  }
  m_lockManager.removeResourcesInProject(deleteProject.getId());
  clearAccessControlListCache();
  clearResourceCache();
  if (projectId == dbc.currentProject().getId()) {
    dbc.getRequestContext().setCurrentProject(readProject(dbc,I_CmsConstants.C_PROJECT_ONLINE_ID));
  }
  m_projectDriver.deleteProject(dbc,deleteProject);
  m_projectCache.remove(new Integer(projectId));
  OpenCms.fireCmsEvent(new CmsEvent(I_CmsEventListener.EVENT_PROJECT_MODIFIED,Collections.singletonMap("project",deleteProject)));
}
