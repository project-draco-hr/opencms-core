{
  CmsUUID projectId=deleteProject.getUuid();
  List modifiedFiles=readChangedResourcesInsideProject(dbc,projectId,RCPRM_FILES_ONLY_MODE);
  List modifiedFolders=readChangedResourcesInsideProject(dbc,projectId,RCPRM_FOLDERS_ONLY_MODE);
  for (int i=0; i < modifiedFiles.size(); i++) {
    CmsResource currentFile=(CmsResource)modifiedFiles.get(i);
    if (currentFile.getState().isNew()) {
      CmsLock lock=getLock(dbc,currentFile);
      if (lock.isNullLock()) {
        lockResource(dbc,currentFile,CmsLockType.EXCLUSIVE);
      }
 else       if (!lock.isOwnedBy(dbc.currentUser()) || !lock.isInProject(dbc.currentProject())) {
        changeLock(dbc,currentFile,CmsLockType.EXCLUSIVE);
      }
      m_vfsDriver.deletePropertyObjects(dbc,projectId,currentFile,CmsProperty.DELETE_OPTION_DELETE_STRUCTURE_AND_RESOURCE_VALUES);
      m_vfsDriver.removeFile(dbc,dbc.currentProject().getUuid(),currentFile);
      m_userDriver.removeAccessControlEntries(dbc,dbc.currentProject(),currentFile.getResourceId());
      OpenCms.fireCmsEvent(new CmsEvent(I_CmsEventListener.EVENT_RESOURCE_AND_PROPERTIES_MODIFIED,Collections.singletonMap("resource",currentFile)));
    }
  }
  for (int i=0; i < modifiedFolders.size(); i++) {
    CmsResource currentFolder=(CmsResource)modifiedFolders.get(i);
    if (currentFolder.getState().isNew()) {
      m_vfsDriver.deletePropertyObjects(dbc,projectId,currentFolder,CmsProperty.DELETE_OPTION_DELETE_STRUCTURE_AND_RESOURCE_VALUES);
      m_vfsDriver.removeFolder(dbc,dbc.currentProject(),currentFolder);
      m_userDriver.removeAccessControlEntries(dbc,dbc.currentProject(),currentFolder.getResourceId());
      OpenCms.fireCmsEvent(new CmsEvent(I_CmsEventListener.EVENT_RESOURCE_AND_PROPERTIES_MODIFIED,Collections.singletonMap("resource",currentFolder)));
    }
  }
  for (int i=0; i < modifiedFolders.size(); i++) {
    CmsResource currentFolder=(CmsResource)modifiedFolders.get(i);
    if ((currentFolder.getState().isChanged()) || (currentFolder.getState().isDeleted())) {
      CmsLock lock=getLock(dbc,currentFolder);
      if (lock.isNullLock()) {
        lockResource(dbc,currentFolder,CmsLockType.EXCLUSIVE);
      }
 else       if (!lock.isOwnedBy(dbc.currentUser()) || !lock.isInProject(dbc.currentProject())) {
        changeLock(dbc,currentFolder,CmsLockType.EXCLUSIVE);
      }
      undoChanges(dbc,currentFolder,CmsResource.UNDO_CONTENT);
      OpenCms.fireCmsEvent(new CmsEvent(I_CmsEventListener.EVENT_RESOURCE_AND_PROPERTIES_MODIFIED,Collections.singletonMap("resource",currentFolder)));
    }
  }
  for (int i=0; i < modifiedFiles.size(); i++) {
    CmsResource currentFile=(CmsResource)modifiedFiles.get(i);
    if (currentFile.getState().isChanged() || currentFile.getState().isDeleted()) {
      CmsLock lock=getLock(dbc,currentFile);
      if (lock.isNullLock()) {
        lockResource(dbc,currentFile,CmsLockType.EXCLUSIVE);
      }
 else       if (!lock.isOwnedInProjectBy(dbc.currentUser(),dbc.currentProject())) {
        if (lock.isLockableBy(dbc.currentUser())) {
          changeLock(dbc,currentFile,CmsLockType.EXCLUSIVE);
        }
      }
      undoChanges(dbc,currentFile,CmsResource.UNDO_CONTENT);
      OpenCms.fireCmsEvent(new CmsEvent(I_CmsEventListener.EVENT_RESOURCE_AND_PROPERTIES_MODIFIED,Collections.singletonMap("resource",currentFile)));
    }
  }
  m_lockManager.removeResourcesInProject(deleteProject.getUuid(),true);
  OpenCms.getMemoryMonitor().clearAccessControlListCache();
  OpenCms.getMemoryMonitor().clearResourceCache();
  if (projectId.equals(dbc.currentProject().getUuid())) {
    dbc.getRequestContext().setCurrentProject(readProject(dbc,CmsProject.ONLINE_PROJECT_ID));
  }
  m_projectDriver.deleteProject(dbc,deleteProject);
  OpenCms.getMemoryMonitor().uncacheProject(deleteProject);
  OpenCms.fireCmsEvent(new CmsEvent(I_CmsEventListener.EVENT_PROJECT_MODIFIED,Collections.singletonMap("project",deleteProject)));
}
