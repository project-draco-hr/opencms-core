{
  CmsProject onlineProject=readProject(context,I_CmsConstants.C_PROJECT_ONLINE_ID);
  if (resourceName.endsWith("/")) {
    CmsFolder onlineFolder=readFolder(context,resourceName);
    CmsFolder offlineFolder=readFolder(context,resourceName);
    CmsFolder restoredFolder=new CmsFolder(offlineFolder.getId(),offlineFolder.getResourceId(),offlineFolder.getParentId(),offlineFolder.getFileId(),offlineFolder.getResourceName(),onlineFolder.getType(),onlineFolder.getFlags(),onlineFolder.getOwnerId(),onlineFolder.getGroupId(),context.currentProject().getId(),onlineFolder.getAccessFlags(),I_CmsConstants.C_STATE_UNCHANGED,offlineFolder.isLockedBy(),offlineFolder.getDateCreated(),offlineFolder.getDateLastModified(),context.currentUser().getId(),context.currentProject().getId());
    checkPermissions(context,(CmsResource)restoredFolder,I_CmsConstants.C_WRITE_ACCESS);
    restoredFolder.setDateLastModified(onlineFolder.getDateLastModified());
    m_vfsDriver.writeFolder(context.currentProject(),restoredFolder,false,context.currentUser().getId());
    m_vfsDriver.deleteAllProperties(context.currentProject().getId(),restoredFolder);
    Map propertyInfos=m_vfsDriver.readProperties(onlineProject.getId(),onlineFolder,onlineFolder.getType());
    m_vfsDriver.writeProperties(propertyInfos,context.currentProject().getId(),restoredFolder,restoredFolder.getType());
  }
 else {
    CmsFile onlineFile=readFile(context,resourceName);
    CmsFile offlineFile=readFile(context,resourceName);
    CmsFile restoredFile=new CmsFile(offlineFile.getId(),offlineFile.getResourceId(),offlineFile.getParentId(),offlineFile.getFileId(),offlineFile.getResourceName(),onlineFile.getType(),onlineFile.getFlags(),onlineFile.getOwnerId(),onlineFile.getGroupId(),context.currentProject().getId(),onlineFile.getAccessFlags(),I_CmsConstants.C_STATE_UNCHANGED,offlineFile.isLockedBy(),onlineFile.getLauncherType(),onlineFile.getLauncherClassname(),offlineFile.getDateCreated(),offlineFile.getDateLastModified(),context.currentUser().getId(),onlineFile.getContents(),onlineFile.getLength(),context.currentProject().getId(),onlineFile.getVfsLinkType());
    checkPermissions(context,(CmsResource)restoredFile,I_CmsConstants.C_WRITE_ACCESS);
    restoredFile.setDateLastModified(onlineFile.getDateLastModified());
    m_vfsDriver.writeFile(context.currentProject(),restoredFile,false);
    m_vfsDriver.deleteAllProperties(context.currentProject().getId(),restoredFile);
    Map propertyInfos=m_vfsDriver.readProperties(onlineProject.getId(),onlineFile,onlineFile.getType());
    m_vfsDriver.writeProperties(propertyInfos,context.currentProject().getId(),restoredFile,restoredFile.getType());
  }
  clearResourceCache();
  m_propertyCache.clear();
  m_accessCache.clear();
  fileSystemChanged(false);
}
