{
  CmsBackupResource backupFile=null;
  CmsFile offlineFile=null;
  int state=I_CmsConstants.C_STATE_CHANGED;
  backupFile=readBackupFile(currentUser,currentProject,versionId,filename);
  CmsUUID ownerId=currentUser.getId();
  CmsUUID groupId=currentUser.getDefaultGroupId();
  try {
    ownerId=readUser(currentUser,currentProject,backupFile.getOwnerName()).getId();
  }
 catch (  CmsException exc) {
  }
  try {
    groupId=readGroup(currentUser,backupFile.getGroupName()).getId();
  }
 catch (  CmsException exc) {
  }
  offlineFile=readFile(currentUser,currentProject,filename);
  if (offlineFile.getState() == I_CmsConstants.C_STATE_NEW) {
    state=I_CmsConstants.C_STATE_NEW;
  }
  if (backupFile != null && offlineFile != null) {
    CmsFile newFile=new CmsFile(offlineFile.getId(),offlineFile.getResourceId(),offlineFile.getParentId(),offlineFile.getFileId(),offlineFile.getResourceName(),backupFile.getType(),backupFile.getFlags(),ownerId,groupId,currentProject.getId(),backupFile.getAccessFlags(),state,offlineFile.isLockedBy(),backupFile.getLauncherType(),backupFile.getLauncherClassname(),offlineFile.getDateCreated(),offlineFile.getDateLastModified(),currentUser.getId(),backupFile.getContents(),backupFile.getLength(),currentProject.getId(),backupFile.getVfsLinkType());
    writeFile(currentUser,currentProject,newFile);
    clearResourceCache();
  }
}
