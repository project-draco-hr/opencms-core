{
  Vector deletedFolders=new Vector();
  CmsProject deleteProject=readProject(currentUser,currentProject,id);
  if ((isAdmin(currentUser,currentProject) || isManagerOfProject(currentUser,deleteProject)) && (id != I_CmsConstants.C_PROJECT_ONLINE_ID)) {
    List allFiles=m_vfsDriver.readFiles(deleteProject.getId(),false,true);
    List allFolders=m_vfsDriver.readFolders(deleteProject,false,true);
    for (int i=0; i < allFiles.size(); i++) {
      CmsFile currentFile=(CmsFile)allFiles.get(i);
      if (currentFile.getState() == I_CmsConstants.C_STATE_NEW) {
        m_vfsDriver.deleteAllProperties(id,currentFile.getId());
        m_vfsDriver.removeFile(currentProject,currentFile.getId());
        m_userDriver.removeAllAccessControlEntries(currentProject,currentFile.getResourceAceId());
      }
 else       if (currentFile.getState() == I_CmsConstants.C_STATE_CHANGED) {
        if (!currentFile.isLocked()) {
          lockResource(currentUser,deleteProject,currentFile.getResourceName(),true);
        }
        undoChanges(currentUser,deleteProject,currentFile.getResourceName());
      }
 else       if (currentFile.getState() == I_CmsConstants.C_STATE_DELETED) {
        undeleteResource(currentUser,deleteProject,currentFile.getResourceName());
        if (!currentFile.isLocked()) {
          lockResource(currentUser,deleteProject,currentFile.getResourceName(),true);
        }
        undoChanges(currentUser,deleteProject,currentFile.getResourceName());
      }
    }
    for (int i=0; i < allFolders.size(); i++) {
      CmsFolder currentFolder=(CmsFolder)allFolders.get(i);
      if (currentFolder.getState() == I_CmsConstants.C_STATE_NEW) {
        m_vfsDriver.deleteAllProperties(id,currentFolder.getId());
        deletedFolders.addElement(currentFolder);
      }
 else       if (currentFolder.getState() == I_CmsConstants.C_STATE_CHANGED) {
        if (!currentFolder.isLocked()) {
          lockResource(currentUser,deleteProject,currentFolder.getResourceName(),true);
        }
        undoChanges(currentUser,deleteProject,currentFolder.getResourceName());
      }
 else       if (currentFolder.getState() == I_CmsConstants.C_STATE_DELETED) {
        undeleteResource(currentUser,deleteProject,currentFolder.getResourceName());
        if (!currentFolder.isLocked()) {
          lockResource(currentUser,deleteProject,currentFolder.getResourceName(),true);
        }
        undoChanges(currentUser,deleteProject,currentFolder.getResourceName());
      }
    }
    for (int i=deletedFolders.size() - 1; i > -1; i--) {
      CmsFolder delFolder=((CmsFolder)deletedFolders.elementAt(i));
      m_vfsDriver.removeFolder(currentProject,delFolder);
      m_userDriver.removeAllAccessControlEntries(currentProject,delFolder.getResourceAceId());
    }
    m_projectDriver.unlockProject(deleteProject);
    clearAccessControlListCache();
    clearResourceCache();
    m_projectDriver.deleteProject(deleteProject);
    m_projectCache.remove(new Integer(id));
  }
 else {
    throw new CmsException("[" + this.getClass().getName() + "] "+ id,CmsException.C_NO_ACCESS);
  }
}
