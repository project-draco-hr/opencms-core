{
  String folderName=CmsResource.getParentFolder(resourcename);
  String targetName=CmsResource.getName(resourcename);
  if (resource.isFile()) {
    if (labelResource(context,resource,resourcename,2)) {
      int flags=resource.getFlags();
      flags|=I_CmsConstants.C_RESOURCEFLAG_LABELLINK;
      resource.setFlags(flags);
    }
  }
 else {
    targetName=targetName.substring(0,targetName.length() - 1);
  }
  validFilename(targetName);
  CmsFolder parentFolder=readFolder(context,folderName,CmsResourceFilter.IGNORE_EXPIRATION);
  checkPermissions(context,parentFolder,I_CmsConstants.C_WRITE_ACCESS,CmsResourceFilter.ALL,-1);
  if (content == null) {
    content=new byte[0];
  }
  resource.setParentId(parentFolder.getStructureId());
  CmsResource newResource=m_vfsDriver.importResource(context.currentProject(),parentFolder.getStructureId(),resource,content,context.currentUser().getId(),resource.isFolder());
  newResource.setFullResourceName(resourcename);
  content=null;
  clearResourceCache();
  m_vfsDriver.writePropertyObjects(context.currentProject(),newResource,properties);
  OpenCms.fireCmsEvent(new CmsEvent(new CmsObject(),I_CmsEventListener.EVENT_RESOURCE_LIST_MODIFIED,Collections.singletonMap("resource",parentFolder)));
  return newResource;
}
