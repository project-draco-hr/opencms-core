{
  CmsResource resource=readFileHeader(context,resourcename);
  if (forceLock || resourcename.endsWith(I_CmsConstants.C_FOLDER_SEPARATOR)) {
    unlockResource(context,resourcename,true);
  }
  if (!forceLock) {
    checkPermissions(context,resource,I_CmsConstants.C_WRITE_ACCESS);
  }
  resource.setLocked(context.currentUser().getId());
  resource.setLockedInProject(context.currentProject().getId());
  m_vfsDriver.updateLockstate(resource,context.currentProject().getId());
  m_lockDispatcher.addResource(resource.getFullResourceName(),context.currentUser().getId(),context.currentProject().getId(),CmsLock.C_HIERARCHY_DIRECT_LOCKED);
  clearResourceCache();
}
