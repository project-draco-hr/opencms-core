{
  if (oldPassword != null && newPassword != null) {
    CmsUser user=null;
    validatePassword(newPassword);
    try {
      user=m_userDriver.readUser(dbc,username,oldPassword,I_CmsConstants.C_USER_TYPE_SYSTEMUSER);
    }
 catch (    CmsDbEntryNotFoundException e) {
      throw new CmsDataAccessException(Messages.get().container(Messages.ERR_RESET_PASSWORD_1,username),e);
    }
    try {
      user=(user != null) ? user : m_userDriver.readUser(dbc,username,oldPassword,I_CmsConstants.C_USER_TYPE_WEBUSER);
    }
 catch (    CmsDbEntryNotFoundException e) {
      throw new CmsDataAccessException(Messages.get().container(Messages.ERR_RESET_PASSWORD_1,username),e);
    }
    if (user == null) {
      throw new CmsDataAccessException(Messages.get().container(Messages.ERR_RESET_PASSWORD_1,username));
    }
    m_userDriver.writePassword(dbc,username,user.getType(),oldPassword,newPassword);
  }
 else   if (CmsStringUtil.isEmpty(oldPassword)) {
    throw new CmsDataAccessException(Messages.get().container(Messages.ERR_PWD_OLD_MISSING_0));
  }
 else   if (CmsStringUtil.isEmpty(newPassword)) {
    throw new CmsDataAccessException(Messages.get().container(Messages.ERR_PWD_NEW_MISSING_0));
  }
}
