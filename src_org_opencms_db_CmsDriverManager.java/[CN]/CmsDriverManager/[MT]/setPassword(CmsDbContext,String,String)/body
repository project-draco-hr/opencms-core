{
  if (isAdmin(dbc)) {
    CmsUser user=null;
    validatePassword(newPassword);
    try {
      user=m_userDriver.readUser(dbc,username,I_CmsConstants.C_USER_TYPE_SYSTEMUSER);
    }
 catch (    CmsException e) {
      if (e.getType() != CmsException.C_NO_USER) {
        throw new CmsDataAccessException("[" + getClass().getName() + "] Error resetting password for user '"+ username+ "'",e);
      }
    }
    try {
      user=(user != null) ? user : m_userDriver.readUser(dbc,username,I_CmsConstants.C_USER_TYPE_WEBUSER);
    }
 catch (    CmsException e) {
      if (e.getType() != CmsException.C_NO_USER) {
        throw new CmsDataAccessException("[" + getClass().getName() + "] Error resetting password for user '"+ username+ "'",e);
      }
    }
    if (user == null) {
      throw new CmsSecurityException(CmsSecurityException.C_SECURITY_LOGIN_FAILED);
    }
    m_userDriver.writePassword(dbc,username,user.getType(),null,newPassword);
  }
 else {
    throw new CmsSecurityException("[" + this.getClass().getName() + "] setPassword() "+ username,CmsSecurityException.C_SECURITY_ADMIN_PRIVILEGES_REQUIRED);
  }
}
