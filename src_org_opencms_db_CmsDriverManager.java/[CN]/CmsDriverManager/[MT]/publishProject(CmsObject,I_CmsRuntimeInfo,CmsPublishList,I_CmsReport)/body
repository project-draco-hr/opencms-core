{
  CmsRequestContext context=cms.getRequestContext();
  int publishProjectId=context.currentProject().getId();
  boolean temporaryProject=(context.currentProject().getType() == I_CmsConstants.C_PROJECT_TYPE_TEMPORARY);
  boolean backupEnabled=OpenCms.getSystemInfo().isVersionHistoryEnabled();
  int tagId=0;
  try {
    if (backupEnabled) {
      tagId=getBackupTagId();
    }
 else {
      tagId=0;
    }
    int maxVersions=OpenCms.getSystemInfo().getVersionHistoryMaxCount();
    if (publishList.isDirectPublish()) {
      try {
        getVfsDriver().readFolder(runtimeInfo,I_CmsConstants.C_PROJECT_ONLINE_ID,CmsResource.getParentFolder(publishList.getDirectPublishResource().getRootPath()));
      }
 catch (      CmsException e) {
        report.println("Parent folder not published for resource " + publishList.getDirectPublishResource().getRootPath(),I_CmsReport.C_FORMAT_ERROR);
        return;
      }
    }
    clearcache();
    m_projectDriver.publishProject(context,runtimeInfo,report,readProject(I_CmsConstants.C_PROJECT_ONLINE_ID),publishList,OpenCms.getSystemInfo().isVersionHistoryEnabled(),tagId,maxVersions);
    Iterator i=OpenCms.getModuleManager().getActionInstances();
    while (i.hasNext()) {
      I_CmsModuleAction moduleActionInstance=(I_CmsModuleAction)i.next();
      moduleActionInstance.publishProject(cms,publishList,tagId,report);
    }
    if (temporaryProject) {
      try {
        m_projectDriver.deleteProject(runtimeInfo,context.currentProject());
      }
 catch (      CmsException e) {
        OpenCms.getLog(this).error("Could not delete temporary project " + publishProjectId);
      }
      cms.getRequestContext().setCurrentProject(readProject(I_CmsConstants.C_PROJECT_ONLINE_ID));
    }
  }
  finally {
    clearcache();
    Map eventData=new HashMap();
    eventData.put(I_CmsEventListener.KEY_REPORT,report);
    eventData.put(I_CmsEventListener.KEY_PUBLISHID,publishList.getPublishHistoryId().toString());
    eventData.put(I_CmsEventListener.KEY_PROJECTID,new Integer(publishProjectId));
    CmsEvent exportPointEvent=new CmsEvent(I_CmsEventListener.EVENT_PUBLISH_PROJECT,eventData);
    OpenCms.fireCmsEvent(exportPointEvent);
  }
}
