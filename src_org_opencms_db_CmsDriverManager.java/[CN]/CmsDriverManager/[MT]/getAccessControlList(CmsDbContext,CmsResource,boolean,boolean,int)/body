{
  String cacheKey=getCacheKey(inheritedOnly + "_" + forFolder+ "_"+ depth+ "_",dbc.currentProject(),resource.getStructureId().toString());
  CmsAccessControlList acl=(CmsAccessControlList)m_accessControlListCache.get(cacheKey);
  if (acl != null) {
    return acl;
  }
  String parentPath=CmsResource.getParentFolder(resource.getRootPath());
  if (parentPath != null) {
    CmsResource parentResource=m_vfsDriver.readFolder(dbc,dbc.currentProject().getId(),parentPath);
    acl=(CmsAccessControlList)getAccessControlList(dbc,parentResource,inheritedOnly,forFolder,depth + 1).clone();
  }
 else {
    acl=new CmsAccessControlList();
  }
  if (!(depth == 0 && inheritedOnly)) {
    ListIterator ace=m_userDriver.readAccessControlEntries(dbc,dbc.currentProject(),resource.getResourceId(),depth > 1 || (depth > 0 && forFolder)).listIterator();
    while (ace.hasNext()) {
      CmsAccessControlEntry acEntry=(CmsAccessControlEntry)ace.next();
      if (depth > 0) {
        acEntry.setFlags(I_CmsConstants.C_ACCESSFLAGS_INHERITED);
      }
      acl.add(acEntry);
      if ((acEntry.getFlags() & I_CmsConstants.C_ACCESSFLAGS_OVERWRITE) > 0) {
        acl.setAllowedPermissions(acEntry);
      }
    }
  }
  m_accessControlListCache.put(cacheKey,acl);
  return acl;
}
