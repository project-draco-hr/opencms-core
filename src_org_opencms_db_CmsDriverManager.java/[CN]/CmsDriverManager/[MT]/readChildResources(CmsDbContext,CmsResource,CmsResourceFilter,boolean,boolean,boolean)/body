{
  String cacheKey=null;
  List resourceList=null;
  if (OpenCms.getMemoryMonitor().isCacheResourceList()) {
    String time="";
    if (checkPermissions) {
      if ((dbc.getRequestContext() != null) && (OpenCms.getSiteManager().getSiteForSiteRoot(dbc.getRequestContext().getSiteRoot()) != null)) {
        time+=OpenCms.getSiteManager().getSiteForSiteRoot(dbc.getRequestContext().getSiteRoot()).getSiteMatcher().getTimeOffset();
      }
    }
    cacheKey=getCacheKey(new String[]{dbc.currentUser().getName(),getFolders ? (getFiles ? CmsCacheKey.CACHE_KEY_SUBALL : CmsCacheKey.CACHE_KEY_SUBFOLDERS) : CmsCacheKey.CACHE_KEY_SUBFILES,checkPermissions ? "+" + time : "-",filter.getCacheId(),resource.getRootPath()},dbc);
    resourceList=OpenCms.getMemoryMonitor().getCachedResourceList(cacheKey);
  }
  if (resourceList == null) {
    resourceList=m_vfsDriver.readChildResources(dbc,dbc.currentProject(),resource,getFolders,getFiles);
    if (checkPermissions) {
      resourceList=filterPermissions(dbc,resourceList,filter);
    }
    OpenCms.getMemoryMonitor().cacheResourceList(cacheKey,resourceList);
  }
  return updateContextDates(dbc,resourceList,filter);
}
