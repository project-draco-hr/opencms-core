{
  I_CmsSession session=CmsXmlTemplateLoader.getSession(cms.getRequestContext(),true);
  Vector files=new Vector();
  Vector filteredFiles=(Vector)session.getValue("_DOWNLIST_");
  int numFiles=filteredFiles.size();
  String pageText=(String)session.getValue(CmsWorkplaceDefault.C_PARA_PAGE);
  if (pageText == null || "".equals(pageText)) {
    pageText="1";
  }
  int page=new Integer(pageText).intValue();
  int from=(page - 1) * CmsWorkplaceDefault.C_DOWNBROWSER_MAXENTRIES;
  int to=((from + CmsWorkplaceDefault.C_DOWNBROWSER_MAXENTRIES) > numFiles) ? numFiles : (from + CmsWorkplaceDefault.C_DOWNBROWSER_MAXENTRIES);
  String folder=(String)session.getValue(CmsWorkplaceDefault.C_PARA_FOLDER);
  if (folder == null || "".equals(folder)) {
    folder=getConfigFile(cms).getDownGalleryPath();
    List galleries=cms.getSubFolders(folder);
    if (galleries.size() > 0) {
      folder=cms.getSitePath((CmsResource)galleries.get(0));
    }
    session.putValue(CmsWorkplaceDefault.C_PARA_FOLDER,folder);
  }
  for (int i=from; i < to; i++) {
    CmsResource currFile=(CmsResource)filteredFiles.elementAt(i);
    files.addElement(currFile);
  }
  return files;
}
