{
  if (m_exportingModuleData) {
    String channelId=m_cms.readProperty(path,I_CmsConstants.C_PROPERTY_CHANNELID);
    if (channelId != null) {
      if (!m_exportedChannelIds.contains(channelId)) {
        m_exportedChannelIds.add(channelId);
      }
    }
  }
  List subFolders=m_cms.getSubFolders(path);
  List subFiles=m_cms.getFilesInFolder(path);
  for (int i=0; i < subFiles.size(); i++) {
    CmsResource file=(CmsResource)subFiles.get(i);
    int state=file.getState();
    long age=file.getDateLastModified();
    if (m_isOnlineProject || (!m_excludeUnchanged) || state == C_STATE_NEW || state == C_STATE_CHANGED) {
      if ((state != C_STATE_DELETED) && (!file.getResourceName().startsWith("~")) && (age >= m_contentAge)) {
        exportResource(m_cms.readFile(m_cms.readAbsolutePath(file)));
      }
    }
    subFiles.set(i,null);
  }
  subFiles=null;
  for (int i=0; i < subFolders.size(); i++) {
    CmsResource folder=(CmsResource)subFolders.get(i);
    if (folder.getState() != C_STATE_DELETED) {
      String export=m_cms.readAbsolutePath(folder);
      if ((I_CmsWpConstants.C_VFS_NEW_STRUCTURE && export.equalsIgnoreCase(I_CmsWpConstants.C_VFS_PATH_SYSTEM)) || (I_CmsWpConstants.C_VFS_NEW_STRUCTURE && export.startsWith(I_CmsWpConstants.C_VFS_PATH_BODIES)) || (I_CmsWpConstants.C_VFS_NEW_STRUCTURE && export.startsWith(I_CmsWpConstants.C_VFS_PATH_GALLERIES))|| !(m_excludeSystem && (export.startsWith(I_CmsWpConstants.C_VFS_PATH_SYSTEM) || ((!I_CmsWpConstants.C_VFS_NEW_STRUCTURE) && export.startsWith("/pics/system/")) || ((!I_CmsWpConstants.C_VFS_NEW_STRUCTURE) && export.startsWith("/moduledemos/"))))) {
        if (folder.getDateLastModified() >= m_contentAge) {
          writeXmlEntrys(folder);
        }
        exportResources(m_cms.readAbsolutePath(folder));
      }
    }
    subFolders.set(i,null);
  }
}
