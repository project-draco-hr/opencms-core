{
  Vector subFolders=m_cms.getSubFolders(path);
  Vector subFiles=m_cms.getFilesInFolder(path);
  for (int i=0; i < subFiles.size(); i++) {
    CmsResource file=(CmsResource)subFiles.elementAt(i);
    int state=file.getState();
    long age=file.getDateLastModified();
    if (m_isOnlineProject || (!m_excludeUnchanged) || state == C_STATE_NEW || state == C_STATE_CHANGED) {
      if ((state != C_STATE_DELETED) && (!file.getName().startsWith("~")) && (age >= m_contentAge)) {
        exportFile(m_cms.readFile(file.getAbsolutePath()));
      }
    }
    subFiles.set(i,null);
  }
  subFiles=null;
  for (int i=0; i < subFolders.size(); i++) {
    CmsResource folder=(CmsResource)subFolders.elementAt(i);
    if (folder.getState() != C_STATE_DELETED) {
      String export=folder.getAbsolutePath();
      if ((I_CmsWpConstants.C_VFS_NEW_STRUCTURE && export.startsWith(I_CmsWpConstants.C_VFS_PATH_BODIES)) || (I_CmsWpConstants.C_VFS_NEW_STRUCTURE && export.startsWith(I_CmsWpConstants.C_VFS_PATH_GALLERIES)) || !(m_excludeSystem && (export.startsWith(I_CmsWpConstants.C_VFS_PATH_SYSTEM) || ((!I_CmsWpConstants.C_VFS_NEW_STRUCTURE) && export.startsWith("/pics/system/")) || ((!I_CmsWpConstants.C_VFS_NEW_STRUCTURE) && export.startsWith("/moduledemos/"))))) {
        if (folder.getDateLastModified() >= m_contentAge) {
          writeXmlEntrys(folder);
        }
        exportResources(folder.getAbsolutePath());
      }
    }
    subFolders.set(i,null);
  }
}
