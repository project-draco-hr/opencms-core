{
  String name, password, recoveryPassword, description, firstname;
  String lastname, email, flags, defaultGroup, address, section, type;
  String datfileName=new String();
  String infostr=new String();
  Hashtable info=new Hashtable();
  Vector userGroups=new Vector();
  sun.misc.BASE64Encoder enc;
  ObjectOutputStream oout;
  name=user.getName();
  password=user.getPassword();
  recoveryPassword=user.getRecoveryPassword();
  description=user.getDescription();
  firstname=user.getFirstname();
  lastname=user.getLastname();
  email=user.getEmail();
  flags=Integer.toString(user.getFlags());
  info=user.getAdditionalInfo();
  defaultGroup=user.getDefaultGroup().getName();
  address=user.getAddress();
  section=user.getSection();
  type=Integer.toString(user.getType());
  userGroups=m_cms.getDirectGroupsOfUser(user.getName());
  Element userdata=m_docXml.createElement(C_EXPORT_TAG_USERDATA);
  m_userdataElement.appendChild(userdata);
  addElement(userdata,C_EXPORT_TAG_NAME,name);
  enc=new sun.misc.BASE64Encoder();
  String passwd=new String(enc.encodeBuffer(password.getBytes()));
  addCdataElement(userdata,C_EXPORT_TAG_PASSWORD,passwd);
  enc=new sun.misc.BASE64Encoder();
  String recPasswd=new String(enc.encodeBuffer(recoveryPassword.getBytes()));
  addCdataElement(userdata,C_EXPORT_TAG_RECOVERYPASSWORD,recPasswd);
  addCdataElement(userdata,C_EXPORT_TAG_DESCRIPTION,description);
  addElement(userdata,C_EXPORT_TAG_FIRSTNAME,firstname);
  addElement(userdata,C_EXPORT_TAG_LASTNAME,lastname);
  addElement(userdata,C_EXPORT_TAG_EMAIL,email);
  addElement(userdata,C_EXPORT_TAG_FLAGS,flags);
  addElement(userdata,C_EXPORT_TAG_DEFAULTGROUP,defaultGroup);
  addCdataElement(userdata,C_EXPORT_TAG_ADDRESS,address);
  addElement(userdata,C_EXPORT_TAG_SECTION,section);
  addElement(userdata,C_EXPORT_TAG_TYPE,type);
  try {
    datfileName="/~" + C_EXPORT_TAG_USERINFO + "/"+ name+ ".dat";
    ByteArrayOutputStream bout=new ByteArrayOutputStream();
    oout=new ObjectOutputStream(bout);
    oout.writeObject(info);
    oout.close();
    byte[] serializedInfo=bout.toByteArray();
    ZipEntry entry=new ZipEntry(datfileName);
    m_exportZipStream.putNextEntry(entry);
    m_exportZipStream.write(serializedInfo);
    m_exportZipStream.closeEntry();
  }
 catch (  IOException ioex) {
    m_report.addString("IOException: " + ioex.getMessage());
    m_report.addSeperator(0);
  }
  addCdataElement(userdata,C_EXPORT_TAG_USERINFO,datfileName);
  Element usergroup=m_docXml.createElement(C_EXPORT_TAG_USERGROUPS);
  userdata.appendChild(usergroup);
  for (int i=0; i < userGroups.size(); i++) {
    String groupName=((CmsGroup)userGroups.elementAt(i)).getName();
    Element group=m_docXml.createElement(C_EXPORT_TAG_GROUPNAME);
    usergroup.appendChild(group);
    addElement(group,C_EXPORT_TAG_NAME,groupName);
  }
}
