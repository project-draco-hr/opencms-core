{
  CmsObject cms=getCmsObject();
  echo("Testing the import of a resource with relations.");
  String filename="/index.html";
  String zipExportFilename=OpenCms.getSystemInfo().getAbsoluteRfsPathRelativeToWebInf("packages/testImportRelations.zip");
  try {
    assertTrue(cms.getRelationsForResource(filename,CmsRelationFilter.TARGETS.filterNotDefinedInContent()).isEmpty());
    cms.lockResource(filename);
    CmsCategoryService catService=CmsCategoryService.getInstance();
    CmsCategory cat=catService.createCategory(cms,null,"abc","title","description");
    catService.addResourceToCategory(cms,filename,cat.getPath());
    List relations=cms.getRelationsForResource(filename,CmsRelationFilter.TARGETS.filterNotDefinedInContent());
    assertEquals(1,relations.size());
    assertRelation(new CmsRelation(cms.readResource(filename),cms.readResource(cat.getId()),CmsRelationType.CATEGORY),(CmsRelation)relations.get(0));
    CmsVfsImportExportHandler vfsExportHandler=new CmsVfsImportExportHandler();
    vfsExportHandler.setFileName(zipExportFilename);
    List exportPaths=new ArrayList(1);
    exportPaths.add(filename);
    vfsExportHandler.setExportPaths(exportPaths);
    vfsExportHandler.setIncludeSystem(false);
    vfsExportHandler.setIncludeUnchanged(true);
    vfsExportHandler.setExportUserdata(false);
    OpenCms.getImportExportManager().exportData(cms,vfsExportHandler,new CmsShellReport(cms.getRequestContext().getLocale()));
    cms.deleteResource(filename,CmsResource.DELETE_PRESERVE_SIBLINGS);
    OpenCms.getPublishManager().publishResource(cms,filename);
    OpenCms.getPublishManager().waitWhileRunning();
    cms.createResource(filename,CmsResourceTypePlain.getStaticTypeId());
    assertTrue(cms.getRelationsForResource(filename,CmsRelationFilter.TARGETS.filterNotDefinedInContent()).isEmpty());
    OpenCms.getImportExportManager().importData(cms,zipExportFilename,"/",new CmsShellReport(cms.getRequestContext().getLocale()));
    relations=cms.getRelationsForResource(filename,CmsRelationFilter.TARGETS.filterNotDefinedInContent());
    assertEquals(1,relations.size());
    assertRelation(new CmsRelation(cms.readResource(filename),cms.readResource(cat.getId()),CmsRelationType.CATEGORY),(CmsRelation)relations.get(0));
  }
  finally {
    try {
      if (zipExportFilename != null) {
        File file=new File(zipExportFilename);
        if (file.exists()) {
          file.delete();
        }
      }
    }
 catch (    Throwable t) {
    }
  }
}
