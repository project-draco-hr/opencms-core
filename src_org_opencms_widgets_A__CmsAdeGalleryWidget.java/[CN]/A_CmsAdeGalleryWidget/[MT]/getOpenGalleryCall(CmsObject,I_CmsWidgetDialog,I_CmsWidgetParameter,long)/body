{
  String paramResource="&resource=";
  if (widgetDialog instanceof CmsDialog) {
    paramResource+=((CmsDialog)widgetDialog).getParamResource();
  }
  String paramGalleryPath="&gallerypath=";
  CmsGalleryWidgetConfiguration configuration=new CmsGalleryWidgetConfiguration(cms,widgetDialog,param,getConfiguration());
  if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(configuration.getStartup())) {
    paramGalleryPath+=configuration.getStartup();
  }
  StringBuffer sb=new StringBuffer(128);
  sb.append("javascript:cmsOpenDialog('");
  sb.append(widgetDialog.getMessages().key(Messages.getButtonName(getGalleryName()))).append("', '");
  sb.append(OpenCms.getSystemInfo().getOpenCmsContext()).append(PATH_GALLERY_JSP);
  sb.append("?dialogmode=").append(A_CmsAjaxGallery.MODE_WIDGET).append("&types=").append(getGalleryTypes());
  sb.append("&currentelement='+document.getElementById('").append(param.getId());
  sb.append("').getAttribute('value')+'");
  sb.append(paramResource).append(paramGalleryPath);
  sb.append("&fieldid=").append(param.getId()).append("&hashid=").append(hashId);
  sb.append("', '").append(param.getId()).append("', 488, 650); return false;");
  return sb.toString();
}
