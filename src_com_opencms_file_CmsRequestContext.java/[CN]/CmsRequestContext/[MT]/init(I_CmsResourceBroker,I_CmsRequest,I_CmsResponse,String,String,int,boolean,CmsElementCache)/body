{
  m_rb=rb;
  m_req=req;
  m_resp=resp;
  m_links=new Vector();
  m_dependencies=new Vector();
  try {
    m_user=m_rb.readUser(null,null,user);
  }
 catch (  CmsException ex) {
  }
  if (m_user == null) {
    m_user=m_rb.readWebUser(null,null,user);
  }
  if (m_user.getDisabled() == true) {
    m_user=null;
  }
  try {
    setCurrentProject(currentProjectId);
  }
 catch (  CmsException exc) {
    setCurrentProject(I_CmsConstants.C_PROJECT_ONLINE_ID);
  }
  m_currentGroup=m_rb.readGroup(m_user,m_currentProject,currentGroup);
  m_streaming=streaming;
  m_elementCache=elementCache;
  if (req != null) {
    try {
      HttpServletRequest httpReq=(HttpServletRequest)req.getOriginalRequest();
      String accLangs=null;
      if (httpReq != null) {
        accLangs=httpReq.getHeader("Accept-Language");
      }
      if (accLangs != null) {
        StringTokenizer toks=new StringTokenizer(accLangs,",");
        while (toks.hasMoreTokens()) {
          String current=toks.nextToken().trim();
          if (current.indexOf("-") > -1) {
            current=current.substring(0,current.indexOf("-"));
          }
          if (current.indexOf(";") > -1) {
            current=current.substring(0,current.indexOf(";"));
          }
          m_language.addElement(current);
        }
      }
    }
 catch (    UnsupportedOperationException e) {
    }
    detectEncoding();
  }
}
