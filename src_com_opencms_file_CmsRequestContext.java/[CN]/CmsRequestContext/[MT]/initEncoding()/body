{
  try {
    m_encoding=m_driverManager.readProperty(this,addSiteRoot(m_req.getRequestedResource()),getAdjustedSiteRoot(m_req.getRequestedResource()),I_CmsConstants.C_PROPERTY_CONTENT_ENCODING,true);
  }
 catch (  CmsException e) {
    m_encoding=null;
  }
  if ((m_encoding != null) && !"".equals(m_encoding)) {
    return;
  }
 else   if (getUri().startsWith(I_CmsWpConstants.C_VFS_PATH_SYSTEM)) {
    if (OpenCms.getLog(this).isDebugEnabled()) {
      OpenCms.getLog(this).debug("Can't get encoding property for resource " + m_req.getRequestedResource() + ", trying to get it from session.");
    }
    I_CmsSession session=getSession(false);
    if (session != null) {
      m_encoding=(String)session.getValue(I_CmsConstants.C_SESSION_CONTENT_ENCODING);
    }
  }
  if (m_encoding == null || "".equals(m_encoding)) {
    if (OpenCms.getLog(this).isDebugEnabled()) {
      OpenCms.getLog(this).debug("No encoding found - using default: " + OpenCms.getDefaultEncoding());
    }
    m_encoding=OpenCms.getDefaultEncoding();
  }
}
