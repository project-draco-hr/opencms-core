{
  m_driverManager=driverManager;
  m_req=req;
  m_resp=resp;
  m_links=new Vector();
  m_dependencies=new Vector();
  setSiteRoot(site);
  try {
    m_user=m_driverManager.readUser(user);
  }
 catch (  CmsException ex) {
  }
  if (m_user == null) {
    m_user=m_driverManager.readWebUser(this,user);
  }
  if (m_user.getDisabled()) {
    m_user=null;
  }
  try {
    setCurrentProject(projectId);
  }
 catch (  CmsException exc) {
    setCurrentProject(I_CmsConstants.C_PROJECT_ONLINE_ID);
  }
  m_directoryTranslator=directoryTranslator;
  m_fileTranslator=fileTranslator;
  if (req != null) {
    try {
      HttpServletRequest httpReq=(HttpServletRequest)req.getOriginalRequest();
      String accLangs=null;
      if (httpReq != null) {
        accLangs=httpReq.getHeader("Accept-Language");
      }
      if (accLangs != null) {
        StringTokenizer toks=new StringTokenizer(accLangs,",");
        while (toks.hasMoreTokens()) {
          String current=toks.nextToken().trim();
          if (current.indexOf("-") > -1) {
            current=current.substring(0,current.indexOf("-"));
          }
          if (current.indexOf(";") > -1) {
            current=current.substring(0,current.indexOf(";"));
          }
          m_language.addElement(current);
        }
      }
    }
 catch (    UnsupportedOperationException e) {
    }
    initEncoding();
  }
}
