{
  List excluded=new ArrayList();
  List users=new ArrayList();
  Iterator itIds=idsList().iterator();
  while (itIds.hasNext()) {
    String id=itIds.next().toString();
    CmsSessionInfo session=OpenCms.getSessionManager().getSessionInfo(id);
    if (session != null) {
      String userName=session.getUser().getFullName();
      String emailAddress=session.getUser().getEmail();
      if (!users.contains(userName)) {
        if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(emailAddress)) {
          users.add(userName);
        }
 else {
          excluded.add(userName);
        }
      }
    }
  }
  if (!excluded.isEmpty()) {
    StringBuffer html=new StringBuffer(500);
    html.append("<it><strong>");
    html.append(Messages.get().container(Messages.GUI_EXCLUDED_USERS_WARNING_0).key(getLocale()));
    html.append("<ul>");
    Iterator it=excluded.iterator();
    while (it.hasNext()) {
      html.append("<li>");
      html.append(it.next());
      html.append("</li>");
    }
    html.append("</ul></strong></it>");
    setExcludedUsers(html.toString());
  }
  if (users.isEmpty()) {
    setCommitErrors(Collections.singletonList(new CmsIllegalStateException(Messages.get().container(Messages.ERR_NO_SELECTED_USER_WITH_EMAIL_0))));
    return "";
  }
  StringBuffer result=new StringBuffer(256);
  Iterator itUsers=users.iterator();
  while (itUsers.hasNext()) {
    result.append(itUsers.next().toString());
    if (itUsers.hasNext()) {
      result.append("; ");
    }
  }
  return result.toString();
}
