{
  CmsMacroResolver resolver=new CmsMacroResolver();
  resolver.setCmsObject(cms);
  CmsUserSettings settings=new CmsUserSettings(cms.getRequestContext().getCurrentUser());
  CmsMultiMessages multimessages=new CmsMultiMessages(settings.getLocale());
  CmsMessages messages=contentHandler.getMessages(settings.getLocale());
  multimessages.addMessages(messages);
  multimessages.addMessages(OpenCms.getWorkplaceManager().getMessages(settings.getLocale()));
  resolver.setMessages(multimessages);
  resolver.setKeepEmptyMacros(true);
  return resolver;
}
