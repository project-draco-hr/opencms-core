{
  CmsMacroResolver resolver=new CmsMacroResolver();
  resolver.setCmsObject(cms);
  CmsUserSettings settings=new CmsUserSettings(cms.getRequestContext().currentUser());
  CmsMessages messages=contentHandler.getMessages(settings.getLocale());
  resolver.setMessages(messages);
  resolver.setKeepEmptyMacros(true);
  return resolver;
}
