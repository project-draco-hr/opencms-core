{
  Map<String,String> result=new HashMap<String,String>();
  if (CmsResourceTypeXmlContent.isXmlContent(resource)) {
    I_CmsFormatterBean formatter=null;
    for (    Entry<String,String> property : properties.entrySet()) {
      if (property.getKey().startsWith(CmsFormatterConfig.FORMATTER_SETTINGS_KEY) && CmsUUID.isValidUUID(property.getValue())) {
        formatter=OpenCms.getADEManager().getCachedFormatters(cms.getRequestContext().getCurrentProject().isOnlineProject()).getFormatters().get(new CmsUUID(property.getValue()));
        break;
      }
    }
    try {
      Map<String,CmsXmlContentProperty> propertyConfig;
      if (formatter != null) {
        propertyConfig=formatter.getSettings();
      }
 else {
        propertyConfig=CmsXmlContentDefinition.getContentHandlerForResource(cms,resource).getSettings(cms,resource);
      }
      for (      Map.Entry<String,CmsXmlContentProperty> entry : propertyConfig.entrySet()) {
        CmsXmlContentProperty prop=entry.getValue();
        result.put(entry.getKey(),getPropValueIds(cms,prop.getType(),prop.getDefault()));
      }
    }
 catch (    CmsException e) {
      LOG.error(e.getLocalizedMessage(),e);
    }
  }
  result.putAll(properties);
  return result;
}
