{
  boolean changedContainerpage=false;
  boolean isFromClipboard=draggable instanceof CmsMenuListItem;
  CmsContainerPageElementPanel clipboardContainerElement=null;
  if (target != m_initialDropTarget) {
    if (target instanceof I_CmsDropContainer) {
      I_CmsDropContainer container=(I_CmsDropContainer)target;
      try {
        CmsContainerPageElementPanel containerElement=null;
        if (m_isNew) {
          containerElement=m_controller.getContainerpageUtil().createElement(m_controller.getCachedElement(m_draggableId),container);
          containerElement.setNewType(CmsContainerpageController.getServerId(m_draggableId));
        }
 else {
          CmsContainerElementData elementData=m_controller.getCachedElement(m_draggableId);
          containerElement=m_controller.getContainerpageUtil().createElement(elementData,container);
          if (isFromClipboard) {
            clipboardContainerElement=containerElement;
          }
          m_controller.addToRecentList(m_draggableId,null);
        }
        handler.getPlaceholder().getStyle().setDisplay(Display.NONE);
        if (container.getPlaceholderIndex() >= container.getWidgetCount()) {
          container.add(containerElement);
        }
 else {
          container.insert(containerElement,container.getPlaceholderIndex());
        }
        changedContainerpage=!m_controller.isGroupcontainerEditing();
        if (draggable instanceof CmsContainerPageElementPanel) {
          ((CmsContainerPageElementPanel)draggable).removeFromParent();
        }
        m_controller.initializeSubContainers(containerElement);
      }
 catch (      Exception e) {
        CmsDebugLog.getInstance().printLine(e.getMessage());
      }
      if (m_controller.isGroupcontainerEditing()) {
        container.getElement().removeClassName(I_CmsLayoutBundle.INSTANCE.containerpageCss().emptyGroupContainer());
      }
    }
 else     if (target instanceof CmsList<?>) {
      m_controller.addToFavoriteList(m_draggableId);
    }
  }
 else   if ((target instanceof I_CmsDropContainer) && (draggable instanceof CmsContainerPageElementPanel) && isChangedPosition(target)) {
    I_CmsDropContainer container=(I_CmsDropContainer)target;
    int count=container.getWidgetCount();
    handler.getPlaceholder().getStyle().setDisplay(Display.NONE);
    if (container.getPlaceholderIndex() >= count) {
      container.add((CmsContainerPageElementPanel)draggable);
    }
 else {
      container.insert((CmsContainerPageElementPanel)draggable,container.getPlaceholderIndex());
    }
    m_controller.addToRecentList(m_draggableId,null);
    changedContainerpage=!m_controller.isGroupcontainerEditing();
  }
 else   if (draggable instanceof CmsContainerPageElementPanel) {
    CmsContainerPageElementPanel containerElement=(CmsContainerPageElementPanel)draggable;
    CmsElementOptionBar optionBar=containerElement.getElementOptionBar();
    optionBar.removeFromParent();
    containerElement.setElementOptionBar(optionBar);
  }
  if (clipboardContainerElement != null) {
    final CmsContainerPageElementPanel finalClipboardContainerElement=clipboardContainerElement;
    final String serverIdStr=CmsContainerpageController.getServerId(m_draggableId);
    CmsUUID structureId=new CmsUUID(serverIdStr);
    AsyncCallback<String> modeCallback=new AsyncCallback<String>(){
      public void onFailure(      Throwable caught){
        finalClipboardContainerElement.removeFromParent();
      }
      public void onSuccess(      String result){
        if (Objects.equal(result,CmsEditorConstants.MODE_COPY)) {
          final CmsContainerpageController controller=CmsContainerpageController.get();
          CmsContainerElementData data=controller.getCachedElement(finalClipboardContainerElement.getId());
          final Map<String,String> settings=data.getSettings();
          controller.copyElement(serverIdStr,new AsyncCallback<CmsUUID>(){
            public void onFailure(            Throwable caught){
            }
            public void onSuccess(            CmsUUID resultId){
              controller.getElementWithSettings("" + resultId,settings,new I_CmsSimpleCallback<CmsContainerElementData>(){
                public void execute(                CmsContainerElementData newData){
                  try {
                    controller.replaceContainerElement(finalClipboardContainerElement,newData);
                    controller.setPageChanged();
                  }
 catch (                  Exception e) {
                    CmsDebugLog.consoleLog("??? " + e);
                  }
                }
              }
);
            }
          }
);
        }
 else         if (Objects.equal(result,CmsEditorConstants.MODE_REUSE)) {
          m_controller.setPageChanged();
        }
      }
    }
;
    CmsClipboardDropModeSelectionDialog.showDialog(structureId,modeCallback);
  }
 else {
    if (changedContainerpage) {
      m_controller.setPageChanged();
    }
  }
  stopDrag(handler);
}
