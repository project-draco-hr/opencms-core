{
  boolean changedContainerpage=false;
  if (target != m_initialDropTarget) {
    if (target instanceof I_CmsDropContainer) {
      I_CmsDropContainer container=(I_CmsDropContainer)target;
      try {
        CmsContainerPageElementPanel containerElement=null;
        if (m_isNew) {
          containerElement=m_controller.getContainerpageUtil().createElement(m_controller.getCachedElement(draggable.getId()),container);
          containerElement.setNewType(draggable.getId());
        }
 else {
          CmsContainerElementData elementData=m_controller.getCachedElement(draggable.getId());
          containerElement=m_controller.getContainerpageUtil().createElement(elementData,container);
          m_controller.addToRecentList(draggable.getId());
        }
        handler.getPlaceholder().getStyle().setDisplay(Display.NONE);
        if (container.getPlaceholderIndex() >= container.getWidgetCount()) {
          container.add(containerElement);
        }
 else {
          container.insert(containerElement,container.getPlaceholderIndex());
        }
        changedContainerpage=!m_controller.isGroupcontainerEditing();
        if (draggable instanceof CmsContainerPageElementPanel) {
          ((CmsContainerPageElementPanel)draggable).removeFromParent();
        }
      }
 catch (      Exception e) {
        CmsDebugLog.getInstance().printLine(e.getMessage());
      }
      if (m_controller.isGroupcontainerEditing()) {
        container.getElement().removeClassName(I_CmsLayoutBundle.INSTANCE.containerpageCss().emptyGroupContainer());
      }
    }
 else     if (target instanceof CmsList<?>) {
      m_controller.addToFavoriteList(draggable.getId());
    }
  }
 else   if ((target instanceof I_CmsDropContainer) && (draggable instanceof CmsContainerPageElementPanel) && isChangedPosition(target)) {
    I_CmsDropContainer container=(I_CmsDropContainer)target;
    int count=container.getWidgetCount();
    handler.getPlaceholder().getStyle().setDisplay(Display.NONE);
    if (container.getPlaceholderIndex() >= count) {
      container.add((CmsContainerPageElementPanel)draggable);
    }
 else {
      container.insert((CmsContainerPageElementPanel)draggable,container.getPlaceholderIndex());
    }
    m_controller.addToRecentList(draggable.getId());
    changedContainerpage=!m_controller.isGroupcontainerEditing();
  }
 else   if (draggable instanceof CmsContainerPageElementPanel) {
    CmsContainerPageElementPanel containerElement=(CmsContainerPageElementPanel)draggable;
    CmsElementOptionBar optionBar=containerElement.getElementOptionBar();
    optionBar.removeFromParent();
    containerElement.setElementOptionBar(optionBar);
  }
  if (changedContainerpage) {
    m_controller.setPageChanged();
  }
  stopDrag(handler);
}
