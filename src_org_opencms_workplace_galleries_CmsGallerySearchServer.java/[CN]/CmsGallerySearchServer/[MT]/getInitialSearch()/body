{
  JSONObject result=new JSONObject();
  try {
    JSONObject data=getReqDataObj();
    if (data != null) {
      String resourcePath=data.optString(ItemKey.resourcepath.name());
      if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(resourcePath)) {
        CmsSitemapEntry entry=OpenCms.getSitemapManager().getEntryForUri(getCmsObject(),resourcePath);
        if (entry.isSitemap()) {
          result.put(ResponseKey.sitemap.name(),buildJSONForSitemap(resourcePath,null,null,true));
        }
 else {
          result=findResourceInGallery(resourcePath);
        }
      }
 else {
        JSONObject queryData=data.getJSONObject(QueryKey.querydata.name());
        result.put(QueryKey.querydata.name(),queryData);
        result.put(ResponseKey.searchresult.name(),search(queryData));
      }
    }
  }
 catch (  Exception e) {
    LOG.error(e.getLocalizedMessage(),e);
  }
  return result.toString();
}
