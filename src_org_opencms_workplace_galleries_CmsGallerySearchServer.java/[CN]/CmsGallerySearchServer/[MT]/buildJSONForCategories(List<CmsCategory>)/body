{
  JSONArray result=new JSONArray();
  if ((categories == null) || (categories.size() == 0)) {
    return result;
  }
  Map<String,CmsCategory> sorted=new TreeMap<String,CmsCategory>();
  Iterator<CmsCategory> i=categories.iterator();
  while (i.hasNext()) {
    CmsCategory category=i.next();
    String categoryPath=category.getPath();
    if (sorted.get(categoryPath) != null) {
      continue;
    }
    sorted.put(categoryPath,category);
  }
  List<CmsCategory> sortedCategories=new ArrayList<CmsCategory>(sorted.values());
  i=sortedCategories.iterator();
  while (i.hasNext()) {
    CmsCategory cat=i.next();
    JSONObject jsonObj=new JSONObject();
    try {
      CmsFormatterInfoBean formatterInfo=new CmsFormatterInfoBean(OpenCms.getResourceManager().getResourceType("folder"),false);
      jsonObj.put(JsonKeys.TITLE.getName(),cat.getTitle());
      formatterInfo.setTitleInfo(JsonKeys.TITLE.getName(),JsonKeys.TITLE.getName(),cat.getTitle());
      jsonObj.put(JsonKeys.PATH.getName(),cat.getPath());
      formatterInfo.setSubTitleInfo(JsonKeys.PATH.getName(),JsonKeys.PATH.getName(),cat.getPath());
      jsonObj.put(JsonKeys.ROOTPATH.getName(),cat.getRootPath());
      jsonObj.put(JsonKeys.LEVEL.getName(),CmsResource.getPathLevel(cat.getPath()));
      String iconPath=CmsWorkplace.getResourceUri(CmsWorkplace.RES_PATH_FILETYPES + OpenCms.getWorkplaceManager().getExplorerTypeSetting("folder").getIcon());
      formatterInfo.setIcon(iconPath);
      jsonObj.put(JsonKeys.ITEMHTML.getName(),getFormattedListContent(formatterInfo));
      result.put(jsonObj);
    }
 catch (    Exception e) {
      if (LOG.isErrorEnabled()) {
        LOG.error(e.getLocalizedMessage(),e);
      }
    }
  }
  return result;
}
