{
  JSONArray result=new JSONArray();
  if ((categories == null) || (categories.size() == 0)) {
    return result;
  }
  Map<String,CmsCategory> sorted=new TreeMap<String,CmsCategory>();
  Iterator<CmsCategory> i=categories.iterator();
  while (i.hasNext()) {
    CmsCategory category=i.next();
    String categoryPath=category.getPath();
    if (sorted.get(categoryPath) != null) {
      continue;
    }
    sorted.put(categoryPath,category);
  }
  List<CmsCategory> sortedCategories=new ArrayList<CmsCategory>(sorted.values());
  i=sortedCategories.iterator();
  while (i.hasNext()) {
    CmsCategory cat=i.next();
    JSONObject jsonObj=new JSONObject();
    try {
      CmsFormatterInfoBean formatterInfo=new CmsFormatterInfoBean(OpenCms.getResourceManager().getResourceType(CmsResourceTypeFolder.RESOURCE_TYPE_NAME),false);
      jsonObj.put(ItemKey.title.toString(),cat.getTitle());
      formatterInfo.setTitleInfo(ItemKey.title.toString(),ItemKey.title.toString(),cat.getTitle());
      jsonObj.put(ItemKey.path.toString(),cat.getPath());
      formatterInfo.setSubTitleInfo(ItemKey.path.toString(),ItemKey.path.toString(),cat.getPath());
      jsonObj.put(ItemKey.rootpath.toString(),cat.getRootPath());
      jsonObj.put(ItemKey.level.toString(),CmsResource.getPathLevel(cat.getPath()));
      String iconPath=CmsWorkplace.getResourceUri(CmsWorkplace.RES_PATH_FILETYPES + OpenCms.getWorkplaceManager().getExplorerTypeSetting(CmsResourceTypeFolder.RESOURCE_TYPE_NAME).getIcon());
      formatterInfo.setIcon(iconPath);
      jsonObj.put(ItemKey.itemhtml.toString(),getFormattedListContent(formatterInfo));
      result.put(jsonObj);
    }
 catch (    Exception e) {
      if (LOG.isErrorEnabled()) {
        LOG.error(e.getLocalizedMessage(),e);
      }
    }
  }
  return result;
}
