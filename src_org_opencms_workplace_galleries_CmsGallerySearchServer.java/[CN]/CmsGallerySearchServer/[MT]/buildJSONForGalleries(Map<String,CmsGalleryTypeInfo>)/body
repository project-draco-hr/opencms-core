{
  JSONArray result=new JSONArray();
  if (galleryTypes == null) {
    return result;
  }
  Iterator<Entry<String,CmsGalleryTypeInfo>> iGalleryTypes=galleryTypes.entrySet().iterator();
  while (iGalleryTypes.hasNext()) {
    Entry<String,CmsGalleryTypeInfo> ent=iGalleryTypes.next();
    CmsGalleryTypeInfo tInfo=ent.getValue();
    String iconPath=CmsWorkplace.getResourceUri(CmsWorkplace.RES_PATH_FILETYPES + OpenCms.getWorkplaceManager().getExplorerTypeSetting(tInfo.getResourceType().getTypeName()).getIcon());
    JSONArray contentTypes=new JSONArray();
    Iterator<I_CmsResourceType> it=tInfo.getContentTypes().iterator();
    while (it.hasNext()) {
      contentTypes.put(it.next().getTypeId());
    }
    Iterator<CmsResource> ir=tInfo.getGalleries().iterator();
    while (ir.hasNext()) {
      CmsResource res=ir.next();
      JSONObject jsonObj=new JSONObject();
      String sitePath=getCmsObject().getSitePath(res);
      String title="";
      try {
        title=getCmsObject().readPropertyObject(sitePath,CmsPropertyDefinition.PROPERTY_TITLE,false).getValue("");
      }
 catch (      CmsException e) {
        if (LOG.isErrorEnabled()) {
          LOG.error(e.getLocalizedMessage(),e);
        }
      }
      try {
        CmsFormatterInfoBean formatterInfo=new CmsFormatterInfoBean(tInfo.getResourceType(),false);
        formatterInfo.setResource(res);
        jsonObj.put(ItemKey.contenttypes.toString(),contentTypes);
        jsonObj.put(ItemKey.title.toString(),title);
        formatterInfo.setTitleInfo(ItemKey.title.toString(),ItemKey.title.toString(),title);
        jsonObj.put(ItemKey.path.toString(),sitePath);
        formatterInfo.setSubTitleInfo(ItemKey.path.toString(),ItemKey.path.toString(),sitePath);
        formatterInfo.setIcon(iconPath);
        jsonObj.put(ItemKey.gallerytypeid.toString(),tInfo.getResourceType().getTypeId());
        jsonObj.put(ItemKey.icon.toString(),iconPath);
        jsonObj.put(ItemKey.itemhtml.toString(),getFormattedListContent(formatterInfo));
      }
 catch (      Exception e) {
        if (LOG.isErrorEnabled()) {
          LOG.error(e.getLocalizedMessage(),e);
        }
      }
      result.put(jsonObj);
    }
  }
  return result;
}
