{
  CmsObject cms=getCmsObject();
  CmsRequestContext context=cms.getRequestContext();
  boolean switchSites=false;
  String currentSiteRoot=context.getSiteRoot();
  if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(siteRoot) && !currentSiteRoot.equals(siteRoot)) {
    switchSites=true;
    context.setSiteRoot(siteRoot);
  }
  boolean switchLocales=false;
  Locale currentLocale=context.getLocale();
  if ((locale != null) && !currentLocale.equals(locale)) {
    switchLocales=true;
    context.setLocale(locale);
  }
  if (CmsStringUtil.isEmptyOrWhitespaceOnly(targetUri)) {
    targetUri="/";
  }
  String startUri=startFromRoot ? "/demo_t3/" : targetUri;
  JSONObject result=new JSONObject();
  try {
    CmsSiteEntryBean rootEntry=OpenCms.getSitemapManager().getEntryForUri(cms,startUri);
    result.put(SitemapKey.siteRoot.name(),context.getSiteRoot());
    result.put(SitemapKey.locale.name(),context.getLocale().toString());
    result.put(SitemapKey.rootEntry.name(),buildJSONForSitemapEntry(rootEntry,targetUri));
  }
  finally {
    if (switchSites) {
      context.setSiteRoot(currentSiteRoot);
    }
    if (switchLocales) {
      context.setLocale(currentLocale);
    }
  }
  return result;
}
