{
  JSONObject result=new JSONObject();
  CmsObject cms=getCmsObject();
  Map<String,Object> reqAttributes=new HashMap<String,Object>();
  CmsResource resource=cms.readResource(resourcePath);
  I_CmsResourceType type=getResourceManager().getResourceType(resource.getTypeId());
  CmsGalleryItemBean reqItem=new CmsGalleryItemBean(resource);
  reqItem.setTypeId(resource.getTypeId());
  reqItem.setTypeName(type.getTypeName());
  reqAttributes.put(ReqParam.galleryitem.toString(),reqItem);
  CmsContainerElementBean cntElem=new CmsContainerElementBean(resource.getStructureId(),null,null);
  cntElem.setSitePath(cms.getSitePath(resource));
  reqAttributes.put(CmsADEManager.ATTR_CURRENT_ELEMENT,cntElem);
  result.put(ItemKey.itemhtml.toString(),type.getFormattedContent(cms,getRequest(),getResponse(),I_CmsResourceType.Formatter.GALLERY_PREVIEW,reqAttributes));
  result.put(ItemKey.state.toString(),resource.getState().getState());
  JSONArray propertiesJSON=new JSONArray();
  CmsExplorerTypeSettings setting=OpenCms.getWorkplaceManager().getExplorerTypeSetting(type.getTypeName());
  List<String> properties=setting.getProperties();
  String reference=setting.getReference();
  while ((properties.size() == 0) && !CmsStringUtil.isEmptyOrWhitespaceOnly(reference)) {
    setting=OpenCms.getWorkplaceManager().getExplorerTypeSetting(reference);
    properties=setting.getProperties();
    reference=setting.getReference();
  }
  Iterator<String> propIt=properties.iterator();
  while (propIt.hasNext()) {
    String propertyName=propIt.next();
    CmsProperty property=cms.readPropertyObject(resource,propertyName,false);
    JSONObject propertyJSON=new JSONObject();
    propertyJSON.put(ItemKey.name.toString(),propertyName);
    propertyJSON.put(ItemKey.value.toString(),property.getValue());
    propertiesJSON.put(propertyJSON);
  }
  result.put(ItemKey.properties.toString(),propertiesJSON);
  String linkpath=link(resourcePath);
  result.put(ItemKey.linkpath.toString(),linkpath);
  return result;
}
