{
  JSONArray types=queryData.getJSONArray(JsonKeys.TYPES.getName());
  JSONArray galleries=queryData.getJSONArray(JsonKeys.GALLERIES.getName());
  List<String> galleriesList=transformToStringList(galleries);
  JSONArray categories=queryData.getJSONArray(JsonKeys.CATEGORIES.getName());
  List<String> categoriesList=transformToStringList(categories);
  String queryStr=queryData.getString(JsonKeys.QUERY.getName());
  int matches=queryData.getInt(JsonKeys.MATCHESPERPAGE.getName());
  int page=queryData.getInt(JsonKeys.PAGE.getName());
  List<String> typeNames=new ArrayList<String>();
  try {
    typeNames=getTypeNames(types);
  }
 catch (  CmsLoaderException e) {
    if (LOG.isErrorEnabled()) {
      LOG.error(e.getLocalizedMessage(),e);
    }
  }
  CmsUser user=m_cms.getRequestContext().currentUser();
  String indexName=new CmsUserSettings(user).getWorkplaceSearchIndexName();
  CmsSearchParameters params=new CmsSearchParameters();
  if (CmsStringUtil.isEmptyOrWhitespaceOnly(queryStr)) {
    params.setIgnoreQuery(true);
  }
 else {
    params.setQuery(queryStr);
  }
  params.setSort(CmsSearchParameters.SORT_TITLE);
  params.setIndex(indexName);
  params.setMatchesPerPage(matches);
  params.setSearchPage(page);
  if (typeNames != null) {
    params.setResourceTypes(typeNames);
  }
  if (categoriesList != null) {
    params.setCategories(categoriesList);
  }
  if (galleriesList != null) {
    params.setRoots(galleriesList);
  }
  return params;
}
