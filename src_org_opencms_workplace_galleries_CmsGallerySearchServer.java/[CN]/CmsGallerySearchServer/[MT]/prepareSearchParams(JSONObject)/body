{
  JSONArray types=queryData.getJSONArray(JsonKeys.TYPES.getName());
  JSONArray galleries=queryData.getJSONArray(JsonKeys.GALLERIES.getName());
  List<String> galleriesList=transformToStringList(galleries);
  JSONArray categories=queryData.getJSONArray(JsonKeys.CATEGORIES.getName());
  List<String> categoriesList=transformToStringList(categories);
  String queryStr=queryData.getString(JsonKeys.QUERY.getName());
  int matches=queryData.getInt(JsonKeys.MATCHESPERPAGE.getName());
  CmsGallerySearchParameters.CmsGallerySortParam sortOrder;
  if (queryData.has(JsonKeys.SORTORDER.getName())) {
    String temp=queryData.getString(JsonKeys.SORTORDER.getName());
    try {
      sortOrder=CmsGallerySearchParameters.CmsGallerySortParam.valueOf(temp);
    }
 catch (    Exception e) {
      sortOrder=CmsGallerySearchParameters.CmsGallerySortParam.DEFAULT;
    }
  }
 else {
    sortOrder=CmsGallerySearchParameters.CmsGallerySortParam.DEFAULT;
  }
  int page=queryData.getInt(JsonKeys.PAGE.getName());
  String locale;
  if (queryData.has(JsonKeys.LOCALE.getName()) && !CmsStringUtil.isEmptyOrWhitespaceOnly(queryData.getString(JsonKeys.LOCALE.getName()))) {
    locale=queryData.getString(JsonKeys.LOCALE.getName());
  }
 else {
    locale=getRequest().getParameter(ReqParam.LOCALE.getName());
  }
  List<String> typeNames=new ArrayList<String>();
  try {
    typeNames=getTypeNames(types);
  }
 catch (  CmsLoaderException e) {
    if (LOG.isErrorEnabled()) {
      LOG.error(e.getLocalizedMessage(),e);
    }
  }
  CmsGallerySearchParameters params=new CmsGallerySearchParameters();
  if (!CmsStringUtil.isEmptyOrWhitespaceOnly(queryStr)) {
    params.setSearchWords(queryStr);
  }
  params.setSearchLocale(locale);
  params.setSortOrder(sortOrder);
  params.setMatchesPerPage(matches);
  params.setResultPage(page);
  if (typeNames != null) {
    params.setResourceTypes(typeNames);
  }
  if (categoriesList != null) {
    params.setCategories(categoriesList);
  }
  if (galleriesList != null) {
    params.setGalleries(galleriesList);
  }
  return params;
}
