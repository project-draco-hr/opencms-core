{
  JSONArray types=queryData.getJSONArray(QueryKey.types.toString());
  JSONArray galleries=queryData.getJSONArray(QueryKey.galleries.toString());
  List<String> galleriesList=transformToStringList(galleries);
  JSONArray categories=queryData.getJSONArray(QueryKey.categories.toString());
  List<String> categoriesList=transformToStringList(categories);
  String queryStr=queryData.getString(QueryKey.query.toString());
  int matches=queryData.getInt(QueryKey.matchesperpage.toString());
  CmsGallerySearchParameters.CmsGallerySortParam sortOrder;
  if (queryData.has(QueryKey.sortorder.toString())) {
    String temp=queryData.getString(QueryKey.sortorder.toString());
    try {
      sortOrder=CmsGallerySearchParameters.CmsGallerySortParam.valueOf(temp);
    }
 catch (    Exception e) {
      sortOrder=CmsGallerySearchParameters.CmsGallerySortParam.DEFAULT;
    }
  }
 else {
    sortOrder=CmsGallerySearchParameters.CmsGallerySortParam.DEFAULT;
  }
  int page=queryData.getInt(QueryKey.page.toString());
  String locale;
  if (queryData.has(QueryKey.locale.toString()) && !CmsStringUtil.isEmptyOrWhitespaceOnly(queryData.getString(QueryKey.locale.toString()))) {
    locale=queryData.getString(QueryKey.locale.toString());
  }
 else {
    locale=getRequest().getParameter(ReqParam.locale.toString());
  }
  List<String> typeNames=new ArrayList<String>();
  try {
    typeNames=getTypeNames(types);
  }
 catch (  CmsLoaderException e) {
    if (LOG.isErrorEnabled()) {
      LOG.error(e.getLocalizedMessage(),e);
    }
  }
  CmsGallerySearchParameters params=new CmsGallerySearchParameters();
  if (!CmsStringUtil.isEmptyOrWhitespaceOnly(queryStr)) {
    params.setSearchWords(queryStr);
  }
  params.setSearchLocale(locale);
  params.setSortOrder(sortOrder);
  params.setMatchesPerPage(matches);
  params.setResultPage(page);
  if (typeNames != null) {
    params.setResourceTypes(typeNames);
  }
  if (categoriesList != null) {
    params.setCategories(categoriesList);
  }
  if (galleriesList != null) {
    params.setGalleries(galleriesList);
  }
  return params;
}
