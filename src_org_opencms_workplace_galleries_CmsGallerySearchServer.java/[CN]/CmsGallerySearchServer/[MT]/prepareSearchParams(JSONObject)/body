{
  JSONArray types=queryData.getJSONArray(QueryKey.types.toString());
  JSONArray galleries=queryData.getJSONArray(QueryKey.galleries.toString());
  List<String> galleriesList=transformToStringList(galleries);
  JSONArray categories=queryData.getJSONArray(QueryKey.categories.toString());
  List<String> categoriesList=transformToStringList(categories);
  String queryStr=queryData.getString(QueryKey.query.toString());
  int matches=queryData.getInt(QueryKey.matchesperpage.toString());
  CmsGallerySearchParameters.CmsGallerySortParam sortOrder;
  String temp=queryData.optString(QueryKey.sortorder.toString());
  try {
    sortOrder=CmsGallerySearchParameters.CmsGallerySortParam.valueOf(temp);
  }
 catch (  Exception e) {
    sortOrder=CmsGallerySearchParameters.CmsGallerySortParam.DEFAULT;
  }
  int page=queryData.getInt(QueryKey.page.toString());
  String locale=queryData.optString(QueryKey.locale.toString());
  if (CmsStringUtil.isEmptyOrWhitespaceOnly(locale)) {
    locale=getCmsObject().getRequestContext().getLocale().toString();
  }
  List<String> typeNames=new ArrayList<String>();
  try {
    typeNames=getTypeNames(types);
  }
 catch (  CmsLoaderException e) {
    if (LOG.isErrorEnabled()) {
      LOG.error(e.getLocalizedMessage(),e);
    }
  }
  CmsGallerySearchParameters params=new CmsGallerySearchParameters();
  if (!CmsStringUtil.isEmptyOrWhitespaceOnly(queryStr)) {
    params.setSearchWords(queryStr);
  }
  params.setSearchLocale(locale);
  params.setSortOrder(sortOrder);
  params.setMatchesPerPage(matches);
  params.setResultPage(page);
  if (typeNames != null) {
    params.setResourceTypes(typeNames);
  }
  if (categoriesList != null) {
    params.setCategories(categoriesList);
  }
  if (galleriesList != null) {
    params.setGalleries(galleriesList);
  }
  return params;
}
