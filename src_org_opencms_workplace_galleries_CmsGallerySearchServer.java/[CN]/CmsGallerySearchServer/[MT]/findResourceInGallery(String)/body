{
  CmsResource resource=null;
  try {
    resource=m_cms.readResource(resourceName);
  }
 catch (  CmsException e) {
    LOG.warn(e.getLocalizedMessage(),e);
  }
  if (resource == null) {
    return new JSONObject();
  }
  String rootPath=resource.getRootPath();
  JSONObject queryData=new JSONObject();
  JSONArray types=new JSONArray();
  types.put(resource.getTypeId());
  queryData.put(JsonKeys.TYPES.getName(),types);
  JSONArray galleries=new JSONArray();
  galleries.put(CmsResource.getFolderPath(resourceName));
  queryData.put(JsonKeys.GALLERIES.getName(),galleries);
  queryData.put(JsonKeys.CATEGORIES.getName(),new JSONArray());
  queryData.put(JsonKeys.MATCHESPERPAGE.getName(),MATCHES_PER_PAGE);
  queryData.put(JsonKeys.QUERY.getName(),"");
  queryData.put(JsonKeys.SORTORDER.getName(),CmsGallerySearchParameters.CmsGallerySortParam.DEFAULT.toString());
  int currentPage=1;
  boolean found=false;
  queryData.put(JsonKeys.PAGE.getName(),currentPage);
  CmsGallerySearchParameters params=prepareSearchParams(queryData);
  CmsGallerySearch searchBean=new CmsGallerySearch();
  searchBean.init(m_cms);
  searchBean.setIndex(ADVANCED_GALLERY_INDEX);
  CmsGallerySearchResultList searchResults=null;
  while (!found) {
    params.setResultPage(currentPage);
    searchResults=searchBean.getResult(params);
    Iterator<CmsGallerySearchResult> resultsIt=searchResults.listIterator();
    while (resultsIt.hasNext()) {
      CmsGallerySearchResult searchResult=resultsIt.next();
      if (searchResult.getPath().equals(rootPath)) {
        found=true;
        break;
      }
    }
    if (!found && (searchResults.getHitCount() / (currentPage * params.getMatchesPerPage()) >= 1)) {
      currentPage++;
    }
 else {
      break;
    }
  }
  JSONObject result=new JSONObject();
  if (found && (searchResults != null)) {
    JSONObject sResult=new JSONObject();
    sResult.put(JsonKeys.SORTORDER.getName(),params.getSortOrder());
    sResult.put(JsonKeys.RESULTCOUNT.getName(),searchResults.getHitCount());
    sResult.put(JsonKeys.PAGE.getName(),params.getResultPage());
    sResult.put(JsonKeys.RESULTLIST.getName(),buildJSONForSearchResult(searchResults));
    queryData.put(JsonKeys.PAGE.getName(),currentPage);
    queryData.put(JsonKeys.TABID.getName(),RESULT_TAB_ID);
    result.put(JsonKeys.QUERYDATA.getName(),queryData);
    result.put(JsonKeys.SEARCHRESULT.getName(),sResult);
  }
  return result;
}
