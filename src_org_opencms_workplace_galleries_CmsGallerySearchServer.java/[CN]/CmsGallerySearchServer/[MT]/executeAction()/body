{
  JSONObject result=new JSONObject();
  HttpServletRequest request=getRequest();
  if (checkParameters(request,result,ReqParam.action.toString(),ReqParam.data.toString())) {
    String actionParam=request.getParameter(ReqParam.action.toString());
    String localeParam=request.getParameter(ReqParam.locale.toString());
    String dataParam=request.getParameter(ReqParam.data.toString());
    Action action=Action.valueOf(actionParam.toUpperCase());
    m_locale=CmsLocaleManager.getLocale(localeParam);
    m_cms.getRequestContext().setLocale(m_locale);
    JSONObject data=new JSONObject(dataParam);
    if (action.equals(Action.ALL)) {
      result.merge(getAllLists(null),true,true);
    }
 else     if (action.equals(Action.CATEGORIES)) {
      result.put(ResponseKeys.categories.toString(),readSystemCategories());
    }
 else     if (action.equals(Action.CONTAINERS)) {
    }
 else     if (action.equals(Action.GALLERIES)) {
      JSONArray resourceTypesParam=data.getJSONArray(ResponseKeys.types.toString());
      List<I_CmsResourceType> resourceTypes=readContentTypes(resourceTypesParam);
      Map<String,CmsGalleryTypeInfo> galleryTypes=readGalleryTypes(resourceTypes);
      result.put(ResponseKeys.galleries.toString(),buildJSONForGalleries(galleryTypes));
    }
 else     if (action.equals(Action.SEARCH)) {
      JSONObject query=data.getJSONObject(QueryKeys.querydata.toString());
      result.put(ResponseKeys.searchresult.toString(),search(query));
    }
 else     if (action.equals(Action.PREVIEW)) {
      String resourcePath=data.getString(ItemKeys.path.toString());
      result.put(ResponseKeys.previewdata.toString(),getPreviewData(resourcePath));
    }
 else     if (action.equals(Action.SETPROPERTIES)) {
      String resourcePath=data.getString(ItemKeys.path.toString());
      JSONArray properties=data.getJSONArray(ItemKeys.properties.toString());
      result.put(ResponseKeys.previewdata.toString(),setProperties(resourcePath,properties));
    }
 else     if (action.equals(Action.VFSPATH)) {
      String path=data.getString(ItemKeys.linkpath.toString());
      if (path.startsWith(OpenCms.getSystemInfo().getOpenCmsContext())) {
        path=path.substring(OpenCms.getSystemInfo().getOpenCmsContext().length());
      }
      result.put(ResponseKeys.path.toString(),path);
    }
  }
  return result;
}
