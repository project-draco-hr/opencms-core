{
  CmsResource resource=getCmsObject().readResource(resourcePath);
  if (properties != null) {
    for (int i=0; i < properties.length(); i++) {
      String propertyName=properties.getJSONObject(i).getString(ItemKey.name.toString());
      String propertyValue=properties.getJSONObject(i).getString(ItemKey.value.toString());
      if (CmsStringUtil.isEmptyOrWhitespaceOnly(propertyValue)) {
        propertyValue="";
      }
      try {
        CmsProperty currentProperty=getCmsObject().readPropertyObject(resource,propertyName,false);
        if (currentProperty.isNullProperty()) {
          currentProperty=new CmsProperty();
          currentProperty.setName(propertyName);
          if (OpenCms.getWorkplaceManager().isDefaultPropertiesOnStructure()) {
            currentProperty.setStructureValue(propertyValue);
            currentProperty.setResourceValue(null);
          }
 else {
            currentProperty.setStructureValue(null);
            currentProperty.setResourceValue(propertyValue);
          }
        }
 else         if (currentProperty.getStructureValue() != null) {
          currentProperty.setStructureValue(propertyValue);
          currentProperty.setResourceValue(null);
        }
 else {
          currentProperty.setStructureValue(null);
          currentProperty.setResourceValue(propertyValue);
        }
        CmsLock lock=getCmsObject().getLock(resource);
        if (lock.isUnlocked()) {
          getCmsObject().lockResource(resourcePath);
        }
        getCmsObject().writePropertyObject(resourcePath,currentProperty);
        getCmsObject().unlockResource(resourcePath);
      }
 catch (      CmsException e) {
        LOG.error(e.getLocalizedMessage(),e);
      }
    }
  }
  return getPreviewData(resourcePath);
}
