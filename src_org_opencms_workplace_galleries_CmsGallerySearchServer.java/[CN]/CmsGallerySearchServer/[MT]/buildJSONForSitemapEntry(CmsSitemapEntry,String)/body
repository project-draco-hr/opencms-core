{
  CmsObject cms=getCmsObject();
  JSONObject result=new JSONObject();
  result.put(SitemapKey.title.name(),entry.getTitle());
  result.put(SitemapKey.sitemapUri.name(),entry.getSitePath(cms));
  I_CmsResourceType resType=getResourceManager().getResourceType(cms.readResource(entry.getStructureId()));
  String iconPath=CmsWorkplace.getResourceUri(CmsWorkplace.RES_PATH_FILETYPES + OpenCms.getWorkplaceManager().getExplorerTypeSetting(resType.getTypeName()).getIcon());
  result.put(SitemapKey.icon.name(),iconPath);
  try {
    CmsFormatterInfoBean formatterInfo=new CmsFormatterInfoBean(resType,false);
    formatterInfo.setTitleInfo(ItemKey.title.toString(),ItemKey.title.toString(),entry.getTitle());
    formatterInfo.setIcon(iconPath);
    result.put(ItemKey.itemhtml.toString(),getFormattedListContent(formatterInfo));
  }
 catch (  Exception e) {
    if (LOG.isErrorEnabled()) {
      LOG.error(e.getLocalizedMessage(),e);
    }
  }
  List<CmsSitemapEntry> subEntries=OpenCms.getSitemapManager().getSubEntries(cms,entry.getSitePath(cms));
  if (!subEntries.isEmpty()) {
    result.put(SitemapKey.hasSubEntries.name(),true);
    if (targetUri.startsWith(entry.getSitePath(cms))) {
      JSONArray jSubEntries=new JSONArray();
      Iterator<CmsSitemapEntry> it=subEntries.iterator();
      while (it.hasNext()) {
        jSubEntries.put(buildJSONForSitemapEntry(it.next(),targetUri));
      }
      result.put(SitemapKey.subEntries.name(),jSubEntries);
    }
  }
  return result;
}
