{
  JSONObject result=new JSONObject();
  if (query == null) {
    return result;
  }
  CmsGallerySearchParameters params=prepareSearchParams(query);
  CmsGallerySearch searchBean=new CmsGallerySearch();
  searchBean.init(getCmsObject());
  searchBean.setIndex(ADVANCED_GALLERY_INDEX);
  CmsGallerySearchResultList searchResults=searchBean.getResult(params);
  result.put(QueryKey.sortorder.toString(),params.getSortOrder());
  result.put(QueryKey.resultcount.toString(),searchResults.getHitCount());
  result.put(QueryKey.resultpage.toString(),params.getResultPage());
  result.put(QueryKey.resultlist.toString(),buildJSONForSearchResult(searchResults));
  return result;
}
