{
  StringBuffer result=new StringBuffer();
  int startmacro=value.indexOf("${xpath.");
  int stopmacro=0;
  String xpath;
  if (startmacro != -1) {
    CmsXmlContent xmlcontent=CmsXmlContentFactory.unmarshal(cms,CmsFile.upgrade(resource,cms));
    Locale locale=CmsLocaleManager.getLocale(cms.readPropertyObject(xmlcontent.getFile(),CmsPropertyDefinition.PROPERTY_LOCALE,true).getValue());
    while (startmacro != -1) {
      stopmacro=value.indexOf('}');
      if (stopmacro == 0) {
      }
      result.append(value.substring(0,startmacro));
      xpath=value.substring(startmacro + 8,stopmacro);
      try {
        result.append(xmlcontent.getValue(xpath,locale).getPlainText(cms));
      }
 catch (      Exception ex) {
        if (LOG.isErrorEnabled()) {
          LOG.error(Messages.get().getBundle().key(Messages.LOG_ERR_SELECTWIDGET_XPATH_INVALID_4,new Object[]{xpath,locale.toString(),xmlcontent.getFile().getRootPath(),ex.getLocalizedMessage()}));
        }
      }
      value=value.substring(stopmacro + 1);
      startmacro=value.indexOf("${xpath.");
    }
  }
  result.append(value);
  return result.toString();
}
