{
  CmsGallerySearchBean result=new CmsGallerySearchBean();
  List<String> types=new ArrayList<String>();
  for (  CmsTypesListInfoBean info : data.getTypes()) {
    types.add(info.getId());
  }
  result.setTypes(types);
switch (data.getMode()) {
case editor:
case view:
case widget:
    String gallery=getRequest().getParameter(ReqParam.gallerypath.name());
  if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(gallery)) {
    List<String> galleries=new ArrayList<String>();
    galleries.add(gallery);
    result.setGalleries(galleries);
  }
String currentelement=getRequest().getParameter(ReqParam.currentelement.name());
if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(currentelement)) {
CmsSitemapEntry entry=null;
try {
  entry=OpenCms.getSitemapManager().getEntryForUri(getCmsObject(),currentelement);
}
 catch (CmsException e) {
  logError(e);
}
if ((entry != null) && entry.isSitemap()) {
}
 else {
  result=findResourceInGallery(currentelement,result);
}
}
 else {
result=search(result);
}
result.setTypes(null);
break;
case ade:
result=search(result);
result.setTypes(null);
break;
case sitemap:
result=search(result);
result.setTypes(null);
break;
default :
break;
}
return result;
}
