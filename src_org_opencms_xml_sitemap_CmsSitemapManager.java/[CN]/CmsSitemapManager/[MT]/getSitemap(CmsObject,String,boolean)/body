{
  String cacheKey=cms.getRequestContext().addSiteRoot(path);
  CmsFile sitemapFile=m_cache.getFile(cacheKey,online);
  if (sitemapFile != null) {
    return CmsXmlSitemapFactory.unmarshal(cms,sitemapFile);
  }
  String sitemapPath=path;
  CmsResource sitemapRes=null;
  try {
    sitemapRes=cms.readResource(sitemapPath);
  }
 catch (  CmsVfsResourceNotFoundException e) {
    LOG.debug(e.getLocalizedMessage(),e);
    return null;
  }
catch (  CmsException e) {
    LOG.error(e.getLocalizedMessage(),e);
    return null;
  }
  if ((sitemapRes == null) || !CmsResourceTypeXmlSitemap.isSitemap(sitemapRes)) {
    sitemapPath=cms.readPropertyObject(sitemapPath,CmsPropertyDefinition.PROPERTY_SITEMAP,false).getValue();
    if (CmsStringUtil.isEmptyOrWhitespaceOnly(sitemapPath)) {
      return null;
    }
    String cacheKey2=cms.getRequestContext().addSiteRoot(sitemapPath);
    if (cacheKey.equals(cacheKey2)) {
      return null;
    }
    CmsXmlSitemap sitemap=getSitemap(cms,sitemapPath,online);
    if (sitemap != null) {
      sitemapFile=m_cache.getFile(cacheKey2,online);
      m_cache.setFile(cacheKey,sitemapFile,online);
    }
    return sitemap;
  }
  sitemapFile=cms.readFile(sitemapRes);
  m_cache.setFile(cacheKey,sitemapFile,online);
  return CmsXmlSitemapFactory.unmarshal(cms,sitemapFile);
}
