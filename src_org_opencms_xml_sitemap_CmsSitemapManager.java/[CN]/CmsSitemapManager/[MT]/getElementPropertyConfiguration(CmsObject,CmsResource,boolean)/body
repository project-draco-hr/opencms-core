{
  Map<String,CmsXmlContentProperty> result=new LinkedHashMap<String,CmsXmlContentProperty>();
  Map<String,CmsXmlContentProperty> propertiesFromSchema=CmsXmlContentDefinition.getContentHandlerForResource(cms,resource).getProperties();
  result.putAll(propertiesFromSchema);
  if (includeNonSchemaProperties) {
    CmsADEDefaultConfiguration conf=new CmsADEDefaultConfiguration(CmsPropertyDefinition.PROPERTY_ADE_SITEMAP_CONFIG);
    List<CmsXmlContentProperty> propertiesFromConfigFile=conf.getProperties(cms,cms.getSitePath(resource));
    for (    CmsXmlContentProperty prop : propertiesFromConfigFile) {
      result.put(prop.getPropertyName(),prop);
    }
  }
  return CmsXmlContentPropertyHelper.copyPropertyConfiguration(result);
}
