{
  String url=getJsp().link(getParamResource());
  if (CmsStringUtil.isNotEmpty(getParamVersionid())) {
    byte[] result=getBackupResourceContent(getCms(),getParamResource(),getParamVersionid());
    if (result != null) {
      m_controller.getTopResponse().setContentType(OpenCms.getResourceManager().getMimeType(getParamResource(),getCms().getRequestContext().getEncoding()));
      m_controller.getTopResponse().setContentLength(result.length);
      try {
        getJsp().getResponse().getOutputStream().write(result);
        getJsp().getResponse().getOutputStream().flush();
      }
 catch (      IOException e) {
        if (LOG.isInfoEnabled()) {
          LOG.info(e.getLocalizedMessage());
        }
        return;
      }
    }
  }
 else {
    if (getCms().existsResource(getParamResource(),CmsResourceFilter.DEFAULT)) {
      getJsp().getResponse().sendRedirect(url);
    }
 else {
      throw new CmsVfsResourceNotFoundException(Messages.get().container(Messages.ERR_RESOURCE_OUTSIDE_TIMEWINDOW_1,getParamResource()));
    }
  }
}
