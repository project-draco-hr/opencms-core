{
  checkReadAccess(cms);
  A_CmsElement elem=elementCache.getElementLocator().get(cms,m_startingElement,parameters);
  if (elem == null) {
    throw new CmsException("Couldn't create start element for this uri, have a look at the log file for details.");
  }
  try {
    Enumeration els=m_elementDefinitions.getAllElementNames();
    while (els.hasMoreElements()) {
      String currentElement=(String)els.nextElement();
      CmsElementDefinition eldef=m_elementDefinitions.get(currentElement);
      parameters.put(currentElement + "._TEMPLATE_",eldef.getTemplateName());
      parameters.put(currentElement + "._CLASS_",eldef.getClassName());
      if (eldef.getTemplateSelector() != null) {
        parameters.put(currentElement + "._TEMPLATESELECTOR_",eldef.getTemplateSelector());
      }
 else {
        parameters.put(currentElement + "._TEMPLATESELECTOR_","default");
      }
    }
  }
 catch (  NullPointerException exc) {
  }
  CmsCacheDirectives proxySettings=new CmsCacheDirectives(true);
  elem.checkProxySettings(cms,proxySettings,parameters);
  if (m_elementDefinitions != null) {
    Enumeration elementNames=m_elementDefinitions.getAllElementNames();
    while (elementNames.hasMoreElements()) {
      String name=(String)elementNames.nextElement();
      CmsElementDefinition currentDef=m_elementDefinitions.get(name);
      A_CmsElement currentEle=elementCache.getElementLocator().get(cms,new CmsElementDescriptor(currentDef.getClassName(),currentDef.getTemplateName()),parameters);
      if (currentEle == null) {
        throw new CmsException("Couldn't create element '" + name + "', have a look at the log file for details.");
      }
      currentEle.checkProxySettings(cms,proxySettings,parameters);
    }
  }
  I_CmsResponse resp=cms.getRequestContext().getResponse();
  cms.getRequestContext().setStreaming(cms.getRequestContext().isStreaming() && proxySettings.isStreamable());
  if (!resp.containsHeader("Cache-Control")) {
    if (proxySettings.isProxyPrivateCacheable() && cms.getRequestContext().currentProject().getId() == C_PROJECT_ONLINE_ID) {
      resp.setHeader("Cache-Control","max-age=300");
      if (!proxySettings.isProxyPublicCacheable()) {
        resp.addHeader("Cache-Control","private");
      }
    }
 else {
      resp.setHeader("Cache-Control","no-cache");
      resp.setHeader("Pragma","no-cache");
    }
  }
  return elem.getContent(elementCache,cms,m_elementDefinitions,C_ROOT_TEMPLATE_NAME,parameters,null);
}
