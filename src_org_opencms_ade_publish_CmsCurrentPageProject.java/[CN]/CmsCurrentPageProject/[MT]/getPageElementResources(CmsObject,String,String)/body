{
  CmsUUID pageId=new CmsUUID(containerpageId);
  CmsResourceManager resMan=OpenCms.getResourceManager();
  boolean foundElement=false;
  Set<CmsResource> result=new HashSet<CmsResource>();
  CmsResource page=cms.readResource(pageId,CmsResourceFilter.IGNORE_EXPIRATION);
  result.add(page);
  List<CmsRelation> rels=cms.readRelations(CmsRelationFilter.relationsFromStructureId(pageId));
  for (  CmsRelation rel : rels) {
    CmsResource target=rel.getTarget(cms,CmsResourceFilter.IGNORE_EXPIRATION);
    if (resMan.matchResourceType(CmsResourceTypeXmlContainerPage.GROUP_CONTAINER_TYPE_NAME,target.getTypeId()) || resMan.matchResourceType(CmsResourceTypeXmlContainerPage.INHERIT_CONTAINER_TYPE_NAME,target.getTypeId())) {
      continue;
    }
    foundElement|=(("" + target.getStructureId()).equals(elementId));
    result.add(target);
    List<CmsRelation> rels2=cms.readRelations(CmsRelationFilter.relationsFromStructureId(target.getStructureId()));
    for (    CmsRelation rel2 : rels2) {
      CmsResource target2=rel2.getTarget(cms,CmsResourceFilter.IGNORE_EXPIRATION);
      if (CmsResourceTypeXmlContainerPage.isContainerPage(target)) {
        continue;
      }
      result.add(target2);
    }
  }
  if ((elementId != null) && !foundElement) {
    result.addAll(getElementResources(cms,elementId));
  }
  return result;
}
