{
  List errors=new ArrayList();
  try {
    if (m_orgunit == null) {
      List resourceNames=CmsFileUtil.removeRedundancies(m_orgUnitBean.getResources());
      CmsOrganizationalUnit newOrgUnit=OpenCms.getOrgUnitManager().createOrganizationalUnit(getCms(),m_orgUnitBean.getFqn(),m_orgUnitBean.getDescription(),0,(String)resourceNames.get(0));
      m_orgunit=newOrgUnit;
      resourceNames.remove(0);
      Iterator itResourceNames=CmsFileUtil.removeRedundancies(resourceNames).iterator();
      while (itResourceNames.hasNext()) {
        OpenCms.getOrgUnitManager().addResourceToOrgUnit(getCms(),m_orgunit.getName(),(String)itResourceNames.next());
      }
    }
 else {
      m_orgunit.setDescription(m_orgUnitBean.getDescription());
      List resourceNamesNew=CmsFileUtil.removeRedundancies(m_orgUnitBean.getResources());
      List resourcesOld=OpenCms.getOrgUnitManager().getResourcesForOrganizationalUnit(getCms(),m_orgunit.getName());
      List resourceNamesOld=new ArrayList();
      Iterator itResourcesOld=resourcesOld.iterator();
      while (itResourcesOld.hasNext()) {
        CmsResource resourceOld=(CmsResource)itResourcesOld.next();
        resourceNamesOld.add(getCms().getSitePath(resourceOld));
      }
      Iterator itResourceNamesNew=resourceNamesNew.iterator();
      while (itResourceNamesNew.hasNext()) {
        String resourceNameNew=(String)itResourceNamesNew.next();
        if (!resourceNamesOld.contains(resourceNameNew)) {
          OpenCms.getOrgUnitManager().addResourceToOrgUnit(getCms(),m_orgunit.getName(),resourceNameNew);
        }
      }
      Iterator itResourceNamesOld=resourceNamesOld.iterator();
      while (itResourceNamesOld.hasNext()) {
        String resourceNameOld=(String)itResourceNamesOld.next();
        if (!resourceNamesNew.contains(resourceNameOld)) {
          OpenCms.getOrgUnitManager().removeResourceFromOrgUnit(getCms(),m_orgunit.getName(),resourceNameOld);
        }
      }
    }
    OpenCms.getOrgUnitManager().writeOrganizationalUnit(getCms(),m_orgunit);
  }
 catch (  Throwable t) {
    errors.add(t);
  }
  setCommitErrors(errors);
}
