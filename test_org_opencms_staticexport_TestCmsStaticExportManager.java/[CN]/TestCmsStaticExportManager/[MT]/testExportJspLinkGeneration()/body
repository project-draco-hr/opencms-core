{
  CmsObject cms=getCmsObject();
  echo("Testing the link generation for exported JSP pages");
  String folder="/types/";
  String vfsName=folder + "jsp.jsp";
  CmsProperty exportProp=new CmsProperty(CmsPropertyDefinition.PROPERTY_EXPORT,"true",null);
  cms.lockResource(folder);
  cms.writePropertyObject(folder,exportProp);
  cms.unlockResource(folder);
  cms.lockResource(vfsName);
  cms.writePropertyObject(vfsName,exportProp);
  cms.unlockResource(vfsName);
  cms.publishProject();
  String rfsPrefix=OpenCms.getStaticExportManager().getRfsPrefix();
  String expected;
  echo("Testing basic export name generating functions for a JSP");
  expected=rfsPrefix + cms.getRequestContext().getSiteRoot() + vfsName+ ".html";
  checkLinkWithoutParameters(cms,vfsName,expected);
  checkLinkWithParameters(cms,vfsName,expected);
  echo("Testing export name generating functions for a JSP with 'exportname' property set");
  cms.lockResource(folder);
  cms.writePropertyObject(folder,new CmsProperty(CmsPropertyDefinition.PROPERTY_EXPORTNAME,"myfolder",null));
  cms.unlockResource(folder);
  cms.publishProject();
  expected=rfsPrefix + "/myfolder/jsp.jsp.html";
  checkLinkWithoutParameters(cms,vfsName,expected);
  checkLinkWithParameters(cms,vfsName,expected);
  echo("Testing export name generating functions for a JSP with 'exportname' property AND 'exportsuffix' property set");
  cms.lockResource(vfsName);
  cms.writePropertyObject(vfsName,new CmsProperty(CmsPropertyDefinition.PROPERTY_EXPORTSUFFIX,".txt",null));
  cms.unlockResource(vfsName);
  cms.publishProject();
  expected=rfsPrefix + "/myfolder/jsp.jsp.txt";
  checkLinkWithoutParameters(cms,vfsName,expected);
  checkLinkWithParameters(cms,vfsName,expected);
  echo("Testing export name generating functions for a JSP with only 'exportsuffix' property set");
  cms.lockResource(folder);
  cms.writePropertyObject(folder,new CmsProperty(CmsPropertyDefinition.PROPERTY_EXPORTNAME,CmsProperty.DELETE_VALUE,CmsProperty.DELETE_VALUE));
  cms.unlockResource(folder);
  cms.lockResource(vfsName);
  cms.writePropertyObject(vfsName,new CmsProperty(CmsPropertyDefinition.PROPERTY_EXPORTSUFFIX,".pdf",null));
  cms.unlockResource(vfsName);
  cms.publishProject();
  expected=rfsPrefix + cms.getRequestContext().getSiteRoot() + vfsName+ ".pdf";
  checkLinkWithoutParameters(cms,vfsName,expected);
  checkLinkWithParameters(cms,vfsName,expected);
}
