{
  CmsObject cms=getCmsObject();
  echo("Testing the link generation for exported files without parameters");
  String typesUri="/types";
  String jspUri="/types/jsp.jsp";
  CmsProperty exportProp=new CmsProperty(I_CmsConstants.C_PROPERTY_EXPORT,"true",null);
  cms.lockResource(typesUri);
  cms.writePropertyObject(typesUri,exportProp);
  cms.unlockResource(typesUri);
  cms.lockResource(jspUri);
  cms.writePropertyObject(jspUri,exportProp);
  cms.unlockResource(jspUri);
  cms.publishProject();
  CmsStaticExportManager exportManager=OpenCms.getStaticExportManager();
  echo("Testing basic export name generating functions for a JSP");
  String jspRfsName=exportManager.getRfsName(cms,jspUri);
  System.out.println("JSP RFS name/1: " + jspRfsName);
  String expected=exportManager.getRfsPrefix() + cms.getRequestContext().getSiteRoot() + jspUri+ ".html";
  assertEquals(expected,jspRfsName);
  assertEquals(jspUri,exportManager.getVfsName(cms,jspRfsName));
  jspRfsName=exportManager.getRfsName(cms,jspUri,"?a=b&c=d");
  System.out.println("JSP RFS name/2: " + jspRfsName);
  Pattern pattern=Pattern.compile("^" + CmsStringUtil.escapePattern(exportManager.getRfsPrefix() + cms.getRequestContext().getSiteRoot() + jspUri+ ".html"+ "_") + "\\d*"+ "\\.html$");
  assertTrue(pattern.matcher(jspRfsName).matches());
  assertEquals(jspUri,exportManager.getVfsName(cms,jspRfsName));
  assertEquals(jspUri,exportManager.getVfsName(cms,jspRfsName));
  echo("Testing export name generating functions for a JSP with 'exportname' property set");
  cms.lockResource(typesUri);
  cms.writePropertyObject(typesUri,new CmsProperty(I_CmsConstants.C_PROPERTY_EXPORTNAME,"myfolder",null));
  cms.unlockResource(typesUri);
  cms.publishProject();
  String exportNameJspUri="/myfolder/jsp.jsp";
  jspRfsName=exportManager.getRfsName(cms,jspUri);
  System.out.println("JSP RFS name/3: " + jspRfsName);
  expected=exportManager.getRfsPrefix() + exportNameJspUri + ".html";
  assertEquals(expected,jspRfsName);
  assertEquals(jspUri,exportManager.getVfsName(cms,jspRfsName));
  jspRfsName=exportManager.getRfsName(cms,jspUri,"?a=b&c=d");
  System.out.println("JSP RFS name/4: " + jspRfsName);
  pattern=Pattern.compile("^" + CmsStringUtil.escapePattern(exportManager.getRfsPrefix() + exportNameJspUri + ".html"+ "_") + "\\d*"+ "\\.html$");
  assertTrue(pattern.matcher(jspRfsName).matches());
  assertEquals(jspUri,exportManager.getVfsName(cms,jspRfsName));
  echo("Testing export name generating functions for a JSP with 'exportname' property AND 'exportsuffix' property set");
  cms.lockResource(jspUri);
  cms.writePropertyObject(jspUri,new CmsProperty(I_CmsConstants.C_PROPERTY_EXPORTSUFFIX,".txt",null));
  cms.unlockResource(jspUri);
  cms.publishProject();
  jspRfsName=exportManager.getRfsName(cms,jspUri);
  System.out.println("JSP RFS name/5: " + jspRfsName);
  expected=exportManager.getRfsPrefix() + exportNameJspUri + ".txt";
  assertEquals(expected,jspRfsName);
  assertEquals(jspUri,exportManager.getVfsName(cms,jspRfsName));
  jspRfsName=exportManager.getRfsName(cms,jspUri,"?a=b&c=d");
  System.out.println("JSP RFS name/6: " + jspRfsName);
  pattern=Pattern.compile("^" + CmsStringUtil.escapePattern(exportManager.getRfsPrefix() + exportNameJspUri + ".txt"+ "_") + "\\d*"+ "\\.txt$");
  assertTrue(pattern.matcher(jspRfsName).matches());
  assertEquals(jspUri,exportManager.getVfsName(cms,jspRfsName));
  echo("Testing export name generating functions for a JSP with only 'exportsuffix' property set");
  cms.lockResource(typesUri);
  cms.writePropertyObject(typesUri,new CmsProperty(I_CmsConstants.C_PROPERTY_EXPORTNAME,CmsProperty.C_DELETE_VALUE,CmsProperty.C_DELETE_VALUE));
  cms.unlockResource(typesUri);
  cms.lockResource(jspUri);
  cms.writePropertyObject(jspUri,new CmsProperty(I_CmsConstants.C_PROPERTY_EXPORTSUFFIX,".pdf",null));
  cms.unlockResource(jspUri);
  cms.publishProject();
  jspRfsName=exportManager.getRfsName(cms,jspUri);
  System.out.println("JSP RFS name/7: " + jspRfsName);
  expected=exportManager.getRfsPrefix() + cms.getRequestContext().getSiteRoot() + jspUri+ ".pdf";
  assertEquals(expected,jspRfsName);
  assertEquals(jspUri,exportManager.getVfsName(cms,jspRfsName));
  jspRfsName=exportManager.getRfsName(cms,jspUri,"?a=b&c=d");
  System.out.println("JSP RFS name/8: " + jspRfsName);
  pattern=Pattern.compile("^" + CmsStringUtil.escapePattern(exportManager.getRfsPrefix() + cms.getRequestContext().getSiteRoot() + jspUri+ ".pdf"+ "_") + "\\d*"+ "\\.pdf");
  assertTrue(pattern.matcher(jspRfsName).matches());
  assertEquals(jspUri,exportManager.getVfsName(cms,jspRfsName));
  assertEquals(jspUri,exportManager.getVfsName(cms,jspRfsName));
}
