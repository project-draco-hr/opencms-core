{
  CmsFlexController controller=(CmsFlexController)req.getAttribute(CmsFlexController.ATTRIBUTE_NAME);
  CmsFlexController oldController=null;
  if (controller != null) {
    oldController=controller;
  }
  byte[] result=null;
  try {
    controller=getController(cms,file,req,res,false,false);
    if (element != null) {
      String[] value=new String[]{element};
      Map parameters=Collections.singletonMap(I_CmsConstants.C_PARAMETER_ELEMENT,value);
      controller.getCurrentRequest().addParameterMap(parameters);
    }
    result=dispatchJsp(controller);
    req.removeAttribute(CmsFlexController.ATTRIBUTE_NAME);
  }
  finally {
    if (oldController != null) {
      oldController.updateDates(controller.getDateLastModified(),controller.getDateExpires());
      req.setAttribute(CmsFlexController.ATTRIBUTE_NAME,oldController);
    }
  }
  return result;
}
