{
  CmsXmlLanguageFile lang=new CmsXmlLanguageFile(cms);
  CmsRequestContext context=cms.getRequestContext();
  CmsTaskService taskService=cms.getTaskService();
  CmsTask task=taskService.readTask(taskid);
  CmsUser newEditor=context.currentUser();
  CmsGroup oldRole=taskService.readGroup(task);
  if (cms.userInGroup(newEditor.getName(),oldRole.getName())) {
    taskService.forwardTask(taskid,oldRole.getName(),newEditor.getName());
    taskService.acceptTask(taskid);
    String comment=lang.getLanguageValue("task.dialog.take.logmessage");
    comment+=" " + CmsUser.getFullName(newEditor);
    taskService.writeTaskLog(taskid,comment,C_TASKLOGTYPE_TAKE);
  }
  StringBuffer contentBuf=new StringBuffer(lang.getLanguageValue("task.email.take.content"));
  contentBuf.append("\n");
  contentBuf.append(lang.getLanguageValue("task.label.project"));
  contentBuf.append(": ");
  String projectname="?";
  try {
    projectname=taskService.readTask(task.getRoot()).getName();
  }
 catch (  Exception exc) {
  }
  contentBuf.append(projectname);
  contentBuf.append("\n");
  contentBuf.append(lang.getLanguageValue("task.label.task"));
  contentBuf.append(": ");
  contentBuf.append(task.getName());
  contentBuf.append("\n");
  contentBuf.append(lang.getLanguageValue("task.label.taskfor"));
  contentBuf.append(": ");
  contentBuf.append(CmsUser.getFullName(taskService.readAgent(task)));
  int projectid=taskService.readProject(task).getId();
  contentBuf.append("\n\n\n" + getTaskUrl(cms,task.getId(),projectid));
  String subject=lang.getLanguageValue("task.email.take.subject") + " " + CmsUser.getFullName(newEditor);
  CmsUser[] users={taskService.readAgent(task)};
  try {
    CmsSimpleMail mail=createMail(taskService.readOwner(task),users,subject,contentBuf.toString());
    new CmsMailTransport(mail).send();
  }
 catch (  Exception exc) {
    if (OpenCms.getLog(CmsTaskAction.class).isWarnEnabled()) {
      OpenCms.getLog(CmsTaskAction.class).warn("Error while sending task mail",exc);
    }
  }
}
