{
  Hashtable parameters=(Hashtable)userObj;
  String elementName=(String)parameters.get("_ELEMENT_");
  String result="";
  CmsXmlTemplateFile newsTemplateFile=(CmsXmlTemplateFile)doc;
  String newsFolder=getNewsFolder(elementName,parameters);
  Vector v=CmsNewsContentFile.getAllArticles(cms,newsFolder);
  String maxArticles=getMaxArticles(elementName,parameters);
  int max=new Integer(maxArticles).intValue();
  String navDeck=getNavDeck(parameters);
  int nav=new Integer(navDeck).intValue();
  String selectedArticle=getSelectedArticle(parameters);
  if (selectedArticle == null || "".equals(selectedArticle)) {
    for (int i=(nav) * max; i < ((nav + 1) * max); i++) {
      if (i < v.size()) {
        Object o=v.elementAt(i);
        CmsNewsContentFile doc2=(CmsNewsContentFile)o;
        newsTemplateFile.setData("selection","?article=" + i);
        newsTemplateFile.setData("headline",doc2.getNewsHeadline());
        result=result + newsTemplateFile.getProcessedDataValue(C_TAG_WMLNAV);
      }
    }
    nav+=1;
    if (nav * max < v.size()) {
      newsTemplateFile.setData("selection","?nav=" + nav);
      newsTemplateFile.setData("headline",newsTemplateFile.getDataValue(C_TAG_WMLLINKLABEL));
      result=result + newsTemplateFile.getProcessedDataValue(C_TAG_WMLNAV);
    }
  }
 else {
    int selected=new Integer(selectedArticle).intValue();
    if (selected < v.size()) {
      Object o=v.elementAt(selected);
      CmsNewsContentFile doc2=(CmsNewsContentFile)o;
      newsTemplateFile.setData("date",Utils.getNiceShortDate(doc2.getNewsDate()));
      newsTemplateFile.setData("headline",doc2.getNewsHeadline());
      newsTemplateFile.setData("shorttext",doc2.getNewsShortText());
      newsTemplateFile.setData("author",doc2.getNewsAuthor());
      result=result + newsTemplateFile.getProcessedDataValue(C_TAG_WMLARTICLE);
    }
  }
  return result;
}
