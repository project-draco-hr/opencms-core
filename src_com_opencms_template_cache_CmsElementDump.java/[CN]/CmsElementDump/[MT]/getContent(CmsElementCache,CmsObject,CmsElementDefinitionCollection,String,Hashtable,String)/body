{
  byte[] result=null;
  I_CmsTemplate templateClass=getTemplateClass(cms,m_className);
  A_CmsCacheDirectives cd=getCacheDirectives();
  boolean streamable=cms.getRequestContext().isStreaming();
  CmsElementVariant variant=null;
  Object cacheKey=cd.getCacheKey(cms,parameters);
  if (cd.isInternalCacheable()) {
    checkReadAccess(cms);
    variant=getVariant(cacheKey);
  }
  if (variant != null) {
    result=resolveVariant(cms,variant,elementCache,elDefs,elementName,parameters);
  }
 else {
    try {
      result=templateClass.getContent(cms,m_templateName,elementName,parameters);
      if (cd.isInternalCacheable()) {
        variant=new CmsElementVariant();
        variant.add(result);
        addVariant(cacheKey,variant);
      }
    }
 catch (    CmsException e) {
      throw e;
    }
  }
  if (streamable) {
    try {
      cms.getRequestContext().getResponse().getOutputStream().write(result);
    }
 catch (    Exception e) {
      if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
        A_OpenCms.log(C_OPENCMS_CRITICAL,this.toString() + " Error while streaming!");
      }
    }
    result=null;
  }
  return result;
}
