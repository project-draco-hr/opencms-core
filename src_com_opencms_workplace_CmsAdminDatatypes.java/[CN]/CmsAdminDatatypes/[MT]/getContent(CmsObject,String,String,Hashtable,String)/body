{
  if (OpenCms.getLog(this).isDebugEnabled() && C_DEBUG) {
    OpenCms.getLog(this).debug("Getting content of element " + ((elementName == null) ? "<root>" : elementName));
    OpenCms.getLog(this).debug("Template file is: " + templateFile);
    OpenCms.getLog(this).debug("Selected template section is: " + ((templateSelector == null) ? "<default>" : templateSelector));
  }
  CmsXmlWpTemplateFile xmlTemplateDocument=new CmsXmlWpTemplateFile(cms,templateFile);
  CmsXmlLanguageFile lang=xmlTemplateDocument.getLanguageFile();
  String action=(String)parameters.get("action");
  String resTypeName=(String)parameters.get("restype");
  String extensionName=(String)parameters.get("extension");
  xmlTemplateDocument.setData("RESTYPE",resTypeName);
  if ("new".equals(action)) {
    templateSelector="newextension";
    String name=(String)parameters.get("NAME");
    if (name == null || name.equals("")) {
    }
 else {
      try {
        String formattedName;
        formattedName=format(name);
        Map h=OpenCms.getResourceManager().getExtensionMapping();
        if (h == null) {
          h=new HashMap();
        }
        if (h.containsKey(formattedName)) {
          throw new CmsException(CmsException.C_NOT_EMPTY);
        }
        h.put(formattedName,resTypeName);
        templateSelector="";
      }
 catch (      CmsException e) {
        if (e.getType() == CmsException.C_NOT_EMPTY) {
          templateSelector="errorinuse";
        }
 else {
          if (e.getType() == CmsException.C_BAD_NAME) {
            templateSelector="errorformat";
          }
 else {
            StringBuffer errmesg=new StringBuffer();
            errmesg.append(lang.getLanguageValue("error.reason.newextension1") + " '" + name+ "' "+ lang.getLanguageValue("error.reason.newextension2")+ " '"+ resTypeName+ "' "+ lang.getLanguageValue("error.reason.newextension3")+ "\n\n");
            errmesg.append(CmsException.getStackTraceAsString(e));
            xmlTemplateDocument.setData("NEWDETAILS",errmesg.toString());
            templateSelector="newerror";
          }
        }
      }
    }
  }
 else {
    if ("delete".equals(action)) {
      if ("true".equals(parameters.get("sure"))) {
        Map h=OpenCms.getResourceManager().getExtensionMapping();
        if (h != null) {
          h.remove(extensionName);
        }
        templateSelector="";
      }
 else {
        templateSelector="RUsuredelete";
      }
      xmlTemplateDocument.setData("EXTENSION_NAME",extensionName);
    }
  }
  return startProcessing(cms,xmlTemplateDocument,elementName,parameters,templateSelector);
}
