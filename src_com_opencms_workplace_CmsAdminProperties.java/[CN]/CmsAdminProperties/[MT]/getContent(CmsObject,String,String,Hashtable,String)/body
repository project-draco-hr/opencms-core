{
  if (OpenCms.isLogging(C_OPENCMS_DEBUG) && C_DEBUG) {
    OpenCms.log(C_OPENCMS_DEBUG,this.getClassName() + "getting content of element " + ((elementName == null) ? "<root>" : elementName));
    OpenCms.log(C_OPENCMS_DEBUG,this.getClassName() + "template file is: " + templateFile);
    OpenCms.log(C_OPENCMS_DEBUG,this.getClassName() + "selected template section is: " + ((templateSelector == null) ? "<default>" : templateSelector));
  }
  CmsXmlWpTemplateFile xmlTemplateDocument=new CmsXmlWpTemplateFile(cms,templateFile);
  CmsXmlLanguageFile lang=xmlTemplateDocument.getLanguageFile();
  String action=(String)parameters.get("action");
  String resTypeName=(String)parameters.get("restype");
  String propDefName=(String)parameters.get("propdef");
  xmlTemplateDocument.setData("RESTYPE",resTypeName);
  if ("new".equals(action)) {
    templateSelector="newtype";
    String name=(String)parameters.get("NAME");
    if (name == null || name.equals("")) {
    }
 else {
      try {
        cms.createPropertydefinition(name,cms.getResourceTypeId(resTypeName));
        templateSelector="";
      }
 catch (      CmsException e) {
        StringBuffer errmesg=new StringBuffer();
        errmesg.append(lang.getLanguageValue("error.reason.newprop1") + " '" + name+ "' "+ lang.getLanguageValue("error.reason.newprop2")+ " '"+ resTypeName+ "' "+ lang.getLanguageValue("error.reason.newprop3")+ "\n\n");
        errmesg.append(Utils.getStackTrace(e));
        xmlTemplateDocument.setData("NEWDETAILS",errmesg.toString());
        templateSelector="newerror";
      }
    }
  }
 else {
    if ("delete".equals(action)) {
      if ("true".equals(parameters.get("sure"))) {
        cms.deletePropertydefinition(propDefName,cms.getResourceTypeId(resTypeName));
        templateSelector="";
      }
 else {
        templateSelector="RUsuredelete";
      }
      xmlTemplateDocument.setData("PROPERTY_NAME",propDefName);
    }
  }
  return startProcessing(cms,xmlTemplateDocument,elementName,parameters,templateSelector);
}
