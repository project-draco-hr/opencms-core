{
  I_CmsDocumentFactory documentFactory=OpenCms.getSearchManager().getDocumentFactory(m_res);
  if (documentFactory != null && !m_index.getDocumenttypes(m_res.getRootPath()).contains(documentFactory.getName())) {
    documentFactory=null;
  }
  if (LOG.isDebugEnabled()) {
    if (documentFactory != null) {
      LOG.debug(Messages.get().key(Messages.LOG_INDEXING_DOC_ROOT_1,documentFactory.getName()));
    }
 else {
      LOG.debug(Messages.get().key(Messages.LOG_INDEXING_0));
    }
  }
  if (documentFactory != null) {
    try {
      if (DEBUG && LOG.isDebugEnabled()) {
        LOG.debug(Messages.get().key(Messages.LOG_CREATING_INDEX_DOC_0));
      }
      Document doc=documentFactory.newInstance(m_cms,m_res,m_index.getLocale());
      if (doc == null) {
        throw new CmsIndexException(Messages.get().container(Messages.ERR_CREATING_INDEX_DOC_0));
      }
      if (DEBUG && LOG.isDebugEnabled()) {
        LOG.debug(Messages.get().key(Messages.LOG_WRITING_INDEX_TO_WRITER_1,((m_writer != null) ? m_writer.toString() : "null")));
      }
      if (!isInterrupted()) {
        m_writer.addDocument(doc);
      }
      if (m_report != null && !isInterrupted()) {
        m_report.println(m_report.key("search.indexing_file_end"),I_CmsReport.C_FORMAT_OK);
        if (DEBUG && LOG.isDebugEnabled()) {
          LOG.debug(Messages.get().key(Messages.LOG_WRITE_SUCCESS_0));
        }
      }
      if (isInterrupted() && LOG.isDebugEnabled()) {
        LOG.debug(Messages.get().key(Messages.LOG_ABANDONED_THREAD_FINISHED_1,m_res.getRootPath()));
      }
    }
 catch (    Exception exc) {
      if (m_report != null) {
        m_report.println();
        m_report.println(m_report.key("search.indexing_file_failed") + " : " + exc.getMessage(),I_CmsReport.C_FORMAT_WARNING);
      }
      if (LOG.isWarnEnabled()) {
        LOG.warn(Messages.get().key(Messages.LOG_INDEX_FAILED_1,m_res.getRootPath()),exc);
      }
    }
  }
 else {
    if (m_report != null) {
      m_report.println(m_report.key("search.indexing_file_skipped"),I_CmsReport.C_FORMAT_NOTE);
    }
    if (LOG.isDebugEnabled()) {
      LOG.debug(Messages.get().key(Messages.LOG_SKIPPED_1,m_res.getRootPath()));
    }
  }
  m_threadManager.finished();
}
