{
  try {
    OpenCms.getRoleManager().checkRole(cms,CmsRole.WORKPLACE_MANAGER);
    try {
      CmsResource wpFolderRes=cms.readResource(CmsWorkplace.VFS_PATH_WORKPLACE);
      m_encoding=CmsLocaleManager.getResourceEncoding(cms,wpFolderRes);
    }
 catch (    CmsVfsResourceNotFoundException e) {
      m_encoding=OpenCms.getSystemInfo().getDefaultEncoding();
    }
    if (m_directEditProvider == null) {
      m_directEditProvider=new CmsDirectEditDefaultProvider();
    }
    m_explorerTypeSettingsFromModules.clear();
    CmsModuleManager moduleManager=OpenCms.getModuleManager();
    Iterator j=moduleManager.getModuleNames().iterator();
    while (j.hasNext()) {
      CmsModule module=moduleManager.getModule((String)j.next());
      if (module != null) {
        addExplorerTypeSettings(module);
      }
    }
    initMenuRules();
    initExplorerTypeSettings();
    initWorkplaceViews(cms);
    m_editorManager=new CmsWorkplaceEditorManager(cms);
    initHandler(cms);
    if (CmsLog.INIT.isInfoEnabled()) {
      CmsLog.INIT.info(Messages.get().getBundle().key(Messages.INIT_VFS_ACCESS_INITIALIZED_0));
    }
    try {
      m_tempFileProject=cms.readProject(I_CmsProjectDriver.TEMP_FILE_PROJECT_NAME);
    }
 catch (    CmsException e) {
      LOG.error(Messages.get().getBundle().key(Messages.LOG_NO_TEMP_FILE_PROJECT_0));
    }
    m_editorDisplayOptions=new CmsEditorDisplayOptions();
    m_galleries.clear();
    j=OpenCms.getResourceManager().getResourceTypes().iterator();
    while (j.hasNext()) {
      I_CmsResourceType resourceType=(I_CmsResourceType)j.next();
      if (resourceType instanceof CmsResourceTypeFolderExtended) {
        CmsResourceTypeFolderExtended galleryType=(CmsResourceTypeFolderExtended)resourceType;
        String folderClassName=galleryType.getFolderClassName();
        if (CmsStringUtil.isNotEmpty(folderClassName)) {
          try {
            if (A_CmsGallery.class.isAssignableFrom(Class.forName(folderClassName))) {
              A_CmsGallery galleryInstance=(A_CmsGallery)Class.forName(folderClassName).newInstance();
              galleryInstance.setResourceType(galleryType);
              m_galleries.put(galleryType.getTypeName(),galleryInstance);
            }
          }
 catch (          ClassNotFoundException e) {
            LOG.error(e.getLocalizedMessage());
          }
catch (          InstantiationException e) {
            LOG.error(e.getLocalizedMessage());
          }
catch (          IllegalAccessException e) {
            LOG.error(e.getLocalizedMessage());
          }
        }
      }
    }
    getToolManager().configure(cms);
    m_messages=new HashMap();
    OpenCms.addCmsEventListener(this,new int[]{I_CmsEventListener.EVENT_CLEAR_CACHES});
  }
 catch (  CmsException e) {
    throw new CmsException(Messages.get().container(Messages.ERR_INITIALIZE_WORKPLACE_0));
  }
}
