{
  if (link == null || "".equals(link)) {
    return "";
  }
  String absoluteLink;
  if (!link.startsWith("/")) {
    absoluteLink=Utils.mergeAbsolutePath(cms.getRequestContext().getUri(),link);
  }
 else {
    absoluteLink=link;
  }
  String uri;
  int pos=absoluteLink.indexOf('?');
  if (pos >= 0) {
    uri=absoluteLink.substring(0,pos - 1);
  }
 else {
    uri=absoluteLink;
  }
  String exportProperty;
  if (A_OpenCms.getStaticExportProperties().isStaticExportEnabled() && cms.getRequestContext().currentProject().isOnlineProject()) {
    try {
      exportProperty=cms.readProperty(uri,I_CmsConstants.C_PROPERTY_EXPORT,true,"false");
    }
 catch (    Throwable t) {
      exportProperty="false";
    }
  }
 else {
    exportProperty="false";
  }
  String result;
  if ("true".equalsIgnoreCase(exportProperty)) {
    try {
      String exportname=cms.readProperty(uri,I_CmsConstants.C_PROPERTY_EXPORTNAME,true);
      if (exportname != null) {
        if (!exportname.endsWith("/")) {
          exportname=exportname + "/";
        }
        if (!exportname.startsWith("/")) {
          exportname="/" + exportname;
        }
        String value;
        boolean cont;
        String resource=uri;
        do {
          try {
            value=cms.readProperty(resource,I_CmsConstants.C_PROPERTY_EXPORTNAME,false);
            cont=((value == null) && (!"/".equals(resource)));
          }
 catch (          CmsSecurityException se) {
            cont=false;
          }
          if (cont)           resource=CmsResource.getParent(resource);
        }
 while (cont);
        uri=exportname + uri.substring(resource.length());
        if (pos >= 0) {
          absoluteLink=uri + absoluteLink.substring(pos);
        }
 else {
          absoluteLink=uri;
        }
      }
    }
 catch (    CmsException e) {
    }
    result=A_OpenCms.getStaticExportProperties().getRfsPrefix() + absoluteLink;
  }
 else {
    result=A_OpenCms.getStaticExportProperties().getVfsPrefix() + absoluteLink;
  }
  return result;
}
