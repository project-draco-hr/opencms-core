{
  if (link == null || "".equals(link)) {
    return "";
  }
  String absoluteLink;
  if (!link.startsWith("/")) {
    absoluteLink=Utils.mergeAbsolutePath(cms.getRequestContext().getUri(),link);
  }
 else {
    absoluteLink=link;
  }
  String vfsName;
  String parameters;
  int pos=absoluteLink.indexOf('?');
  if (pos >= 0) {
    vfsName=absoluteLink.substring(0,pos);
    parameters=absoluteLink.substring(pos);
  }
 else {
    vfsName=absoluteLink;
    parameters=null;
  }
  String resultLink=null;
  boolean exportRequired=false;
  if (OpenCms.getStaticExportManager().isStaticExportEnabled() && cms.getRequestContext().currentProject().isOnlineProject()) {
    try {
      resultLink=OpenCms.getStaticExportManager().getCachedOnlineLink(vfsName);
      if (resultLink == null) {
        String exportValue=cms.readProperty(vfsName,I_CmsConstants.C_PROPERTY_EXPORT,true);
        if (exportValue == null) {
          if (OpenCms.getStaticExportManager().getExportPropertyDefault()) {
            exportRequired=true;
          }
 else {
            exportRequired=OpenCms.getStaticExportManager().isSuffixExportable(vfsName);
          }
        }
 else {
          exportRequired="true".equalsIgnoreCase(exportValue.trim());
        }
      }
    }
 catch (    Throwable t) {
    }
  }
  if (resultLink == null) {
    if (!exportRequired) {
      resultLink=OpenCms.getStaticExportManager().getVfsPrefix() + vfsName;
    }
 else {
      resultLink=OpenCms.getStaticExportManager().getRfsName(cms,vfsName);
    }
    if (cms.getRequestContext().currentProject().isOnlineProject()) {
      OpenCms.getStaticExportManager().cacheOnlineLink(vfsName,resultLink);
    }
  }
  if (parameters != null) {
    return resultLink + parameters;
  }
 else {
    return resultLink;
  }
}
