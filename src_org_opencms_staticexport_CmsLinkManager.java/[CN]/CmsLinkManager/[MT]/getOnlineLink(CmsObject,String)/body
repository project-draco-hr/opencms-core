{
  String result="";
  try {
    CmsProject currentProject=cms.getRequestContext().currentProject();
    try {
      cms.getRequestContext().setCurrentProject(cms.readProject(CmsProject.ONLINE_PROJECT_ID));
      result=substituteLinkForUnknownTarget(cms,resourceName);
    }
  finally {
      cms.getRequestContext().setCurrentProject(currentProject);
    }
    if (isAbsoluteUri(result) && !hasScheme(resourceName)) {
      CmsSite currentSite=OpenCms.getSiteManager().getSite(resourceName,cms.getRequestContext().getSiteRoot());
      String serverPrefix=currentSite.getServerPrefix(cms,resourceName);
      result=serverPrefix + result;
    }
  }
 catch (  CmsException e) {
    result=e.getLocalizedMessage();
    if (LOG.isErrorEnabled()) {
      LOG.error(e.getLocalizedMessage(),e);
    }
  }
  return result;
}
