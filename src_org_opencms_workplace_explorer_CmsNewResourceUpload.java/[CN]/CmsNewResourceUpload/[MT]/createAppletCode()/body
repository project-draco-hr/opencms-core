{
  StringBuffer applet=new StringBuffer(2048);
  String scheme=getJsp().getRequest().getScheme();
  String host=getJsp().getRequest().getServerName();
  String path=OpenCms.getSystemInfo().getContextPath() + OpenCms.getSystemInfo().getServletPath();
  int port=getJsp().getRequest().getServerPort();
  String webapp=scheme + "://" + host+ ":"+ port+ OpenCms.getSystemInfo().getContextPath();
  String fileExtensions="";
  Map extensions=OpenCms.getResourceManager().getExtensionMapping();
  Iterator keys=extensions.entrySet().iterator();
  while (keys.hasNext()) {
    Map.Entry entry=(Map.Entry)keys.next();
    String key=(String)entry.getKey();
    String value=(String)entry.getValue();
    fileExtensions+=key + "=" + value+ ",";
  }
  fileExtensions=fileExtensions.substring(0,fileExtensions.length() - 1);
  long maxFileSize=OpenCms.getWorkplaceManager().getFileBytesMaxUploadSize(getCms());
  String currentFolder=getParamCurrentFolder();
  HttpSession session=getJsp().getRequest().getSession(false);
  String sessionId=session.getId();
  String colors="bgColor=#C0C0C0,outerBorderRightBottom=#333333,outerBorderLeftTop=#C0C0C0";
  colors+=",innerBorderRightBottom=#777777,innerBorderLeftTop=#F0F0F0";
  colors+=",bgHeadline=#000066,colorHeadline=#FFFFFF";
  colors+=",colorText=#000000,progessBar=#E10050";
  applet.append("<applet code=\"org.opencms.applet.upload.FileUploadApplet.class\" archive=\"");
  applet.append(webapp);
  applet.append("/resources/components/upload_applet/upload.jar\" width=\"500\" height=\"100\">\n");
  applet.append("<param name=\"opencms\" value=\"");
  applet.append(scheme);
  applet.append("://");
  applet.append(host);
  applet.append(":");
  applet.append(port);
  applet.append(getSkinUri());
  applet.append("filetypes/\">\n");
  applet.append("<param name=\"target\" value=\"");
  applet.append(scheme);
  applet.append("://");
  applet.append(host);
  applet.append(":");
  applet.append(port);
  applet.append(path);
  applet.append("/system/workplace/commons/newresource_upload.jsp\">\n");
  applet.append("<param name=\"redirect\" value=\"");
  applet.append(scheme);
  applet.append("://");
  applet.append(host);
  applet.append(":");
  applet.append(port);
  applet.append(path);
  if (CmsStringUtil.isEmpty(getParamRedirectUrl())) {
    applet.append(CmsWorkplace.FILE_EXPLORER_FILELIST);
  }
 else {
    applet.append(getParamRedirectUrl());
  }
  applet.append("?time=" + System.currentTimeMillis());
  applet.append("\">\n");
  applet.append("<param name=\"targetframe\" value=\"");
  applet.append(getParamTargetFrame());
  applet.append("\">\n");
  applet.append("<param name=error value=\"");
  applet.append(scheme);
  applet.append("://");
  applet.append(host);
  applet.append(":");
  applet.append(port);
  applet.append(path);
  applet.append("/system/workplace/action/explorer_files_new_upload.html\">\n");
  applet.append("<param name=\"sessionId\" value=\"");
  applet.append(sessionId);
  applet.append("\">\n");
  applet.append("<param name=\"filelist\" value=\"");
  applet.append(currentFolder);
  applet.append("\">\n");
  applet.append("<param name=\"colors\" value=\"");
  applet.append(colors);
  applet.append("\">\n");
  applet.append("<param name=\"fileExtensions\" value=\"");
  applet.append(fileExtensions);
  applet.append("\">\n\n");
  applet.append("<param name=\"maxsize\" value=\"");
  applet.append(maxFileSize);
  applet.append("\">\n");
  applet.append("<param name=\"actionOutputSelect\" value=\"");
  applet.append(Messages.get().getBundle(getLocale()).key(Messages.GUI_UPLOADAPPLET_ACTION_SELECT_0));
  applet.append("\">\n");
  applet.append("<param name=\"actionOutputCount\"value=\"");
  applet.append(Messages.get().getBundle(getLocale()).key(Messages.GUI_UPLOADAPPLET_ACTION_COUNT_0));
  applet.append("\">\n");
  applet.append("<param name=\"actionOutputCreate\" value=\"");
  applet.append(Messages.get().getBundle(getLocale()).key(Messages.GUI_UPLOADAPPLET_ACTION_CREATE_0));
  applet.append("\">\n");
  applet.append("<param name=\"actionOutputUpload\" value=\"");
  applet.append(Messages.get().getBundle(getLocale()).key(Messages.GUI_UPLOADAPPLET_ACTION_UPLOAD_0));
  applet.append("\">\n");
  applet.append("<param name=\"messageOutputUpload\" value=\"");
  applet.append(Messages.get().getBundle(getLocale()).key(Messages.GUI_UPLOADAPPLET_MESSAGE_UPLOAD_0));
  applet.append("\">\n");
  applet.append("<param name=\"messageOutputErrorZip\" value=\"");
  applet.append(Messages.get().getBundle(getLocale()).key(Messages.GUI_UPLOADAPPLET_MESSAGE_ERROR_ZIP_0));
  applet.append("\">\n");
  applet.append("<param name=\"messageOutputErrorSize\" value=\"");
  applet.append(Messages.get().getBundle(getLocale()).key(Messages.GUI_UPLOADAPPLET_MESSAGE_ERROR_SIZE_0));
  applet.append("\">\n");
  applet.append("<param name=\"messageNoPreview\" value=\"");
  applet.append(Messages.get().getBundle(getLocale()).key(Messages.GUI_UPLOADAPPLET_MESSAGE_NOPREVIEW_0));
  applet.append("\">\n");
  applet.append("<param name=\"messageOutputAdding\" value=\"");
  applet.append(Messages.get().getBundle(getLocale()).key(Messages.GUI_UPLOADAPPLET_MESSAGE_ADDING_0));
  applet.append(" \">\n");
  applet.append("<param name=\"errorTitle\" value=\"");
  applet.append(Messages.get().getBundle(getLocale()).key(Messages.GUI_UPLOADAPPLET_ERROR_TITLE_0));
  applet.append(" \">\n");
  applet.append("<param name=\"errorLine1\" value=\"");
  applet.append(Messages.get().getBundle(getLocale()).key(Messages.GUI_UPLOADAPPLET_ERROR_LINE1_0));
  applet.append(" \">\n");
  applet.append("</applet>\n");
  return applet.toString();
}
