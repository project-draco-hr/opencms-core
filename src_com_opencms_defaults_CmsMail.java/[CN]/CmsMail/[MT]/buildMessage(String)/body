{
  if (smtpHost == null || "".equals(smtpHost)) {
    throw new CmsException("No SMTP server given.");
  }
  Properties props=System.getProperties();
  props.put("mail.smtp.host",smtpHost);
  Session session=Session.getDefaultInstance(props,null);
  MimeMessage msg=new MimeMessage(session);
  InternetAddress[] to=new InternetAddress[c_TO.length];
  for (int i=0; i < c_TO.length; i++) {
    to[i]=new InternetAddress(c_TO[i]);
  }
  msg.setFrom(new InternetAddress(c_FROM));
  msg.setRecipients(Message.RecipientType.TO,to);
  InternetAddress[] cc=null;
  if (c_CC != null) {
    cc=new InternetAddress[c_CC.length];
    for (int i=0; i < c_CC.length; i++) {
      cc[i]=new InternetAddress(c_CC[i]);
    }
    msg.setRecipients(Message.RecipientType.CC,cc);
  }
  InternetAddress[] bcc=null;
  if (c_BCC != null) {
    bcc=new InternetAddress[c_BCC.length];
    for (int i=0; i < c_BCC.length; i++) {
      bcc[i]=new InternetAddress(c_BCC[i]);
    }
    msg.setRecipients(Message.RecipientType.BCC,bcc);
  }
  msg.setSubject(c_SUBJECT,"ISO-8859-1");
  Vector v=new Vector();
  if (c_CMS != null) {
    Enumeration enum=c_CMS.getRequestContext().getRequest().getFileNames();
    while (enum.hasMoreElements()) {
      v.addElement(enum.nextElement());
    }
  }
  int size=v.size();
  int numAttach=attachContent.size();
  if (size != 0 || numAttach != 0) {
    MimeBodyPart mbp1=new MimeBodyPart();
    Multipart mp=new MimeMultipart();
    if (c_TYPE.equals("text/html")) {
      mbp1.setDataHandler(new DataHandler(new CmsByteArrayDataSource(c_CONTENT,c_TYPE)));
    }
 else {
      mbp1.setText(c_CONTENT,"ISO-8859-1");
    }
    mp.addBodyPart(mbp1);
    for (int i=0; i < numAttach; i++) {
      MimeBodyPart mbpAttach=new MimeBodyPart();
      if ("text/html".equals((String)attachType.elementAt(i))) {
        mbpAttach.setDataHandler(new DataHandler(new CmsByteArrayDataSource((String)attachContent.elementAt(i),"text/html")));
      }
 else {
        mbpAttach.setText((String)attachContent.elementAt(i),"ISO-8859-1");
      }
      mp.addBodyPart(mbpAttach);
    }
    for (int i=0; i < size; i++) {
      String filename=(String)v.elementAt(i);
      MimetypesFileTypeMap mimeTypeMap=new MimetypesFileTypeMap();
      String mimeType=mimeTypeMap.getContentType(filename);
      MimeBodyPart mbp=new MimeBodyPart();
      mbp.setDataHandler(new DataHandler(new CmsByteArrayDataSource(c_CMS.getRequestContext().getRequest().getFile(filename),mimeType)));
      mbp.setFileName(filename);
      mp.addBodyPart(mbp);
    }
    msg.setContent(mp);
  }
 else {
    if (c_TYPE.equals("text/html")) {
      msg.setDataHandler(new DataHandler(new CmsByteArrayDataSource(c_CONTENT,c_TYPE)));
    }
 else {
      msg.setContent(c_CONTENT,c_TYPE);
    }
  }
  msg.setSentDate(new Date());
  return msg;
}
