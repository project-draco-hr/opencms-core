{
  Message msg=null;
  try {
    msg=buildMessage(m_mailserver);
  }
 catch (  Exception e) {
    if (OpenCms.isLogging(CmsLog.C_OPENCMS_CRITICAL,CmsLog.LEVEL_WARN)) {
      OpenCms.log(CmsLog.C_OPENCMS_CRITICAL,CmsLog.LEVEL_WARN,getClassName() + "Error while building Email object: " + Utils.getStackTrace(e));
    }
    return;
  }
  try {
    Transport.send(msg);
  }
 catch (  Exception e) {
    for (; e instanceof MessagingException; e=((MessagingException)e).getNextException()) {
    }
    if (OpenCms.isLogging(CmsLog.C_OPENCMS_CRITICAL,CmsLog.LEVEL_WARN)) {
      OpenCms.log(CmsLog.C_OPENCMS_CRITICAL,CmsLog.LEVEL_WARN,getClassName() + "Error while transmitting mail to SMTP server: " + e);
    }
    if (m_alternativeMailserver != null && !"".equals(m_alternativeMailserver)) {
      if (OpenCms.isLogging(CmsLog.C_OPENCMS_CRITICAL,CmsLog.LEVEL_WARN)) {
        OpenCms.log(CmsLog.C_OPENCMS_CRITICAL,CmsLog.LEVEL_WARN,getClassName() + "Trying alternative server...");
      }
      try {
        msg=buildMessage(m_alternativeMailserver);
        Transport.send(msg);
        if (OpenCms.isLogging(CmsLog.C_OPENCMS_CRITICAL,CmsLog.LEVEL_WARN)) {
          OpenCms.log(CmsLog.C_OPENCMS_CRITICAL,CmsLog.LEVEL_WARN,getClassName() + "...OK. Mail sent.");
        }
      }
 catch (      Exception e2) {
        for (; e2 instanceof MessagingException; e2=((MessagingException)e2).getNextException()) {
        }
        if (OpenCms.isLogging(CmsLog.C_OPENCMS_CRITICAL,CmsLog.LEVEL_WARN)) {
          OpenCms.log(CmsLog.C_OPENCMS_CRITICAL,CmsLog.LEVEL_WARN,getClassName() + "PANIC! Could not send Email. Even alternative server failed! " + e2);
        }
      }
    }
 else {
      if (OpenCms.isLogging(CmsLog.C_OPENCMS_CRITICAL,CmsLog.LEVEL_WARN)) {
        OpenCms.log(CmsLog.C_OPENCMS_CRITICAL,CmsLog.LEVEL_WARN,getClassName() + "PANIC! No alternative SMTP server given! Could not send Email!");
      }
    }
  }
}
