{
  A_CmsElement result;
  result=(A_CmsElement)m_elements.get(desc);
  if (result == null) {
    I_CmsTemplate cmsTemplate=null;
    if ("METHOD".equals(desc.getTemplateName())) {
      String orgClassName=desc.getClassName();
      String className=orgClassName.substring(0,orgClassName.lastIndexOf("."));
      String methodName=orgClassName.substring(orgClassName.lastIndexOf(".") + 1);
      try {
        cmsTemplate=(I_CmsTemplate)com.opencms.template.CmsTemplateClassManager.getClassInstance(cms,className);
        CmsMethodCacheDirectives mcd=(CmsMethodCacheDirectives)cmsTemplate.getClass().getMethod("getMethodCacheDirectives",new Class[]{CmsObject.class,String.class}).invoke(cmsTemplate,new Object[]{cms,methodName});
        ;
        result=new CmsMethodElement(className,methodName,mcd,cms.getRequestContext().getElementCache().getVariantCachesize());
        put(desc,result);
      }
 catch (      Throwable e) {
        if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
          A_OpenCms.log(C_OPENCMS_CRITICAL,toString() + " Could not initialize method element for class \"" + className+ "\". ");
          A_OpenCms.log(C_OPENCMS_CRITICAL,e.toString());
          return null;
        }
      }
    }
 else {
      try {
        cmsTemplate=(I_CmsTemplate)com.opencms.template.CmsTemplateClassManager.getClassInstance(cms,desc.getClassName());
        result=cmsTemplate.createElement(cms,desc.getTemplateName(),parameters);
        put(desc,result);
      }
 catch (      Throwable e) {
        if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
          A_OpenCms.log(C_OPENCMS_CRITICAL,toString() + " Could not initialize (sub-)element for class \"" + desc.getClassName()+ "\". ");
          A_OpenCms.log(C_OPENCMS_CRITICAL,e.toString());
          throw new CmsException("Could not initialize (sub-)element for class \"" + desc.getClassName() + "\". "+ e.toString(),CmsException.C_XML_WRONG_TEMPLATE_CLASS);
        }
      }
    }
  }
  return result;
}
