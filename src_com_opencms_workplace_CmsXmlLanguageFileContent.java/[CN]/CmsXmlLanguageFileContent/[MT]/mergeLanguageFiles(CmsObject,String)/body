{
  List langFiles=(List)new ArrayList();
  if ("uk".equals(language))   language="en";
  langFiles=cms.getFilesInFolder(I_CmsWpConstants.C_VFS_PATH_LOCALES + language + "/");
  List modules=(List)new ArrayList();
  modules=cms.getSubFolders(I_CmsWpConstants.C_VFS_PATH_MODULES);
  String lang=I_CmsWpConstants.C_VFS_DIR_LOCALES + language + "/";
  String oldLang="language/" + language + "/";
  for (int i=0; i < modules.size(); i++) {
    List moduleLangFiles=(List)new ArrayList();
    try {
      moduleLangFiles=cms.getFilesInFolder(cms.readAbsolutePath((CmsFolder)modules.get(i)) + lang);
    }
 catch (    CmsException e) {
      try {
        moduleLangFiles=cms.getFilesInFolder(cms.readAbsolutePath((CmsFolder)modules.get(i)) + oldLang);
        if (C_LOGGING && A_OpenCms.isLogging(C_OPENCMS_INFO)) {
          A_OpenCms.log(C_OPENCMS_INFO,"[" + this.getClass().getName() + ".mergeLanguageFiles/1] Old module 'locales' path used: "+ cms.readAbsolutePath((CmsFolder)modules.get(i))+ oldLang);
        }
      }
 catch (      CmsException ex) {
      }
    }
    for (int j=0; j < moduleLangFiles.size(); j++) {
      langFiles.add(moduleLangFiles.get(j));
    }
  }
  CmsFile file=null;
  for (int i=0; i < langFiles.size(); i++) {
    file=(CmsFile)langFiles.get(i);
    if (!file.getResourceName().toLowerCase().endsWith(".txt") && file.getState() != I_CmsConstants.C_STATE_DELETED) {
      try {
        init(cms,cms.readAbsolutePath(file));
      }
 catch (      Exception exc) {
        if (C_LOGGING && A_OpenCms.isLogging(C_OPENCMS_CRITICAL)) {
          A_OpenCms.log(C_OPENCMS_CRITICAL,"[" + this.getClass().getName() + ".mergeLanguageFiles/3] Error merging language file: "+ cms.readAbsolutePath(file));
        }
      }
    }
  }
}
