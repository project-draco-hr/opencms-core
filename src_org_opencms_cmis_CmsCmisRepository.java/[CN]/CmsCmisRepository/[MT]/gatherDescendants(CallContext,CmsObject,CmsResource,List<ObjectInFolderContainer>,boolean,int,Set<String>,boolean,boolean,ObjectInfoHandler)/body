{
  try {
    List<CmsResource> children=getChildren(cms,folder);
    Collections.sort(children,new Comparator<CmsResource>(){
      public int compare(      CmsResource a,      CmsResource b){
        return a.getName().compareTo(b.getName());
      }
    }
);
    for (    CmsResource child : children) {
      if (foldersOnly && !child.isFolder()) {
        continue;
      }
      ObjectInFolderDataImpl objectInFolder=new ObjectInFolderDataImpl();
      objectInFolder.setObject(collectObjectData(context,cms,child,filter,includeAllowableActions,false,objectInfos));
      if (includePathSegments) {
        objectInFolder.setPathSegment(child.getName());
      }
      ObjectInFolderContainerImpl container=new ObjectInFolderContainerImpl();
      container.setObject(objectInFolder);
      list.add(container);
      if ((depth != 1) && child.isFolder()) {
        container.setChildren(new ArrayList<ObjectInFolderContainer>());
        gatherDescendants(context,cms,child,container.getChildren(),foldersOnly,depth - 1,filter,includeAllowableActions,includePathSegments,objectInfos);
      }
    }
  }
 catch (  CmsException e) {
    handleCmsException(e);
  }
}
