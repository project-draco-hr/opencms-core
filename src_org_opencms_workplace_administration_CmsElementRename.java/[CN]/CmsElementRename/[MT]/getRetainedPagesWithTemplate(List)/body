{
  List resourcesWithTemplate=new ArrayList();
  TreeMap templates=null;
  try {
    templates=CmsNewResourceXmlPage.getTemplates(getCms());
  }
 catch (  CmsException e) {
    if (OpenCms.getLog(this).isErrorEnabled()) {
      OpenCms.getLog(this).error(e);
    }
  }
  if (templates != null && templates.containsValue(getParamTemplate())) {
    Iterator i=xmlPages.iterator();
    while (i.hasNext()) {
      CmsResource currentPage=(CmsResource)i.next();
      CmsProperty templateProperty;
      try {
        templateProperty=getCms().readPropertyObject(getCms().getSitePath(currentPage),I_CmsConstants.C_PROPERTY_TEMPLATE,false);
      }
 catch (      CmsException e2) {
        if (OpenCms.getLog(this).isErrorEnabled()) {
          OpenCms.getLog(this).error(e2);
        }
        continue;
      }
      if (getParamTemplate().equals(templateProperty.getValue())) {
        resourcesWithTemplate.add(currentPage);
      }
    }
    xmlPages.retainAll(resourcesWithTemplate);
  }
  return xmlPages;
}
