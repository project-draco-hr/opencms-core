{
  boolean removeEmptyElements=Boolean.valueOf(getParamRemoveEmptyElements()).booleanValue();
  boolean validateNewElement=Boolean.valueOf(getParamValidateNewElement()).booleanValue();
  if (xmlPages != null && xmlPages.size() > 0) {
    m_report.println("processing rename element for language (" + locale.getLanguage() + ")",I_CmsReport.C_FORMAT_HEADLINE);
    if (!C_ALL.equals(getParamTemplate())) {
      xmlPages=getRetainedPagesWithTemplate(xmlPages);
    }
    int m=0;
    int n=xmlPages.size();
    Iterator i=xmlPages.iterator();
    while (i.hasNext()) {
      m++;
      CmsXmlPage page=null;
      try {
        CmsResource res=(CmsResource)i.next();
        CmsFile file;
        m_report.print("( " + m + " / "+ n+ " ) "+ "processing page "+ getCms().getSitePath(res),I_CmsReport.C_FORMAT_NOTE);
        m_report.println(m_report.key("report.dots"));
        try {
          file=getCms().readFile(getCms().getSitePath(res),CmsResourceFilter.IGNORE_EXPIRATION);
        }
 catch (        CmsException e2) {
          if (OpenCms.getLog(this).isErrorEnabled()) {
            OpenCms.getLog(this).error(e2);
          }
          m_report.println(e2);
          continue;
        }
        try {
          page=CmsXmlPageFactory.unmarshal(getCms(),file);
        }
 catch (        CmsXmlException e) {
          m_report.println(e);
          continue;
        }
        if (!page.hasValue(getParamOldElement(),locale)) {
          m_report.println(m_report.key("report.dots") + "element " + getParamOldElement()+ " does not exist.",I_CmsReport.C_FORMAT_NOTE);
          continue;
        }
        if (page.hasValue(getParamNewElement(),locale)) {
          m_report.println(m_report.key("report.dots") + "the page contains already the new element that includes content",I_CmsReport.C_FORMAT_NOTE);
          continue;
        }
        if (validateNewElement) {
          if (!isValidElement(page,getParamNewElement())) {
            m_report.println(m_report.key("report.dots") + "the new element " + getParamNewElement()+ " is not valid",I_CmsReport.C_FORMAT_NOTE);
            continue;
          }
        }
        try {
          page.renameValue(getParamOldElement(),getParamNewElement(),locale);
          writePageAndReport(page,true);
        }
 catch (        Throwable t) {
          OpenCms.getLog(this).error(t);
          m_report.println(t);
          continue;
        }
      }
 catch (      Throwable t) {
        OpenCms.getLog(this).error(t);
        m_report.println(t);
      }
 finally {
        if (removeEmptyElements) {
          removeInValidElements(page,locale);
        }
      }
    }
  }
}
