{
  if (req != null) {
    String versionId=req.getParameter(PARAM_VERSIONID);
    if (resource == null && versionId != null) {
      String uri=cms.getRequestContext().getUri();
      if (uri.startsWith(BACKUP_HANDLER)) {
        if (cms.existsResource(BACKUP_HANDLER)) {
          try {
            uri=uri.substring(BACKUP_HANDLER.length(),uri.length());
            int id=new Integer(versionId).intValue();
            cms.getRequestContext().saveSiteRoot();
            cms.getRequestContext().setSiteRoot("/");
            resource=cms.readBackupFile(uri,id);
            req.setAttribute(ATTRIBUTE_NAME,Boolean.TRUE);
          }
 catch (          CmsException e) {
            if (OpenCms.getLog(this).isErrorEnabled()) {
              OpenCms.getLog(this).error(Messages.get().container(Messages.ERR_BACKUPRESOURCE_2,uri,versionId));
            }
            throw new CmsResourceInitException(Messages.get().container(Messages.ERR_SHOWVERSION_2,uri,versionId),e);
          }
 finally {
            cms.getRequestContext().restoreSiteRoot();
            if (resource != null) {
              cms.getRequestContext().setUri(cms.getSitePath(resource));
            }
          }
        }
      }
    }
  }
  return resource;
}
