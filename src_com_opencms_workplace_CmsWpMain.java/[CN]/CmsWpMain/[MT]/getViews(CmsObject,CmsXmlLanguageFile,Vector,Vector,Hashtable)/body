{
  CmsRequestContext reqCont=cms.getRequestContext();
  I_CmsSession session=cms.getRequestContext().getSession(true);
  String currentView=null;
  Hashtable startSettings=null;
  startSettings=(Hashtable)reqCont.currentUser().getAdditionalInfo(C_ADDITIONAL_INFO_STARTSETTINGS);
  if (startSettings != null) {
    currentView=(String)startSettings.get(C_START_VIEW);
  }
  if (session != null) {
    if (session.getValue(C_PARA_VIEW) != null) {
      currentView=(String)session.getValue(C_PARA_VIEW);
    }
  }
  if (currentView == null) {
    currentView="";
  }
  if (m_viewNames == null || m_viewLinks == null) {
    m_viewNames=new Vector();
    m_viewLinks=new Vector();
    CmsXmlWpConfigFile configFile=new CmsXmlWpConfigFile(cms);
    configFile.getWorkplaceIniData(m_viewNames,m_viewLinks,"WORKPLACEVIEWS","VIEW");
  }
  boolean adminView=true;
  boolean omittedAdmin=false;
  if (!(reqCont.isAdmin() || reqCont.isProjectManager())) {
    adminView=false;
  }
  int currentViewIndex=0;
  int numViews=m_viewNames.size();
  for (int i=0; i < numViews; i++) {
    String loopValue=(String)m_viewLinks.elementAt(i);
    String loopName=(String)m_viewNames.elementAt(i);
    if (!adminView && loopName.equals("admin")) {
      omittedAdmin=true;
    }
 else {
      values.addElement(loopValue);
      names.addElement(lang.getLanguageValue("select." + loopName));
      if (loopValue.equals(currentView)) {
        currentViewIndex=omittedAdmin ? i - 1 : i;
      }
    }
  }
  return new Integer(currentViewIndex);
}
