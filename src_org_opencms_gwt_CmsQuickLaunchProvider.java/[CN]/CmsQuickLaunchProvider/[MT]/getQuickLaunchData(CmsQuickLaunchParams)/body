{
  List<CmsQuickLaunchData> result=Lists.newArrayList();
  Locale locale=OpenCms.getWorkplaceManager().getWorkplaceLocale(m_cms);
  CmsUserSettings userSettings=new CmsUserSettings(m_cms);
  boolean usesNewWorkplace=userSettings.usesNewWorkplace();
  List<I_CmsWorkplaceAppConfiguration> appConfigs=new ArrayList<I_CmsWorkplaceAppConfiguration>(OpenCms.getWorkplaceAppManager().getQuickLaunchConfigurations(m_cms));
  if (!usesNewWorkplace) {
    I_CmsWorkplaceAppConfiguration config=OpenCms.getWorkplaceAppManager().getAppConfiguration(CmsTraditionalWorkplaceConfiguration.APP_ID);
    if ((config != null) && config.getVisibility(m_cms).isActive()) {
      appConfigs.add(config);
    }
  }
  for (  I_CmsWorkplaceAppConfiguration config : appConfigs) {
    try {
      boolean reload=false;
      String link=null;
      String errorTitle=null;
      String errorMessage=null;
      boolean useLegacyButtonStyle=config instanceof CmsLegacyAppConfiguration;
      if (CmsFileExplorerConfiguration.APP_ID.equals(config.getId())) {
        if (!usesNewWorkplace) {
          continue;
        }
        link=CmsCoreService.getVaadinWorkplaceLink(m_cms,params.getPageId());
      }
 else       if (CmsPageEditorConfiguration.APP_ID.equals(config.getId())) {
        if (params.isPageContext()) {
          reload=true;
        }
 else         if (params.isSitemapContext()) {
          if (params.getReturnCode() != null) {
            CmsReturnLinkInfo linkInfo=CmsCoreService.internalGetLinkForReturnCode(m_cms,params.getReturnCode());
            link=linkInfo.getLink();
            if (link == null) {
              errorTitle=Messages.get().getBundle(locale).key(Messages.GUI_QUICKLAUNCH_PAGE_NOT_FOUND_TITLE_0);
              errorMessage=Messages.get().getBundle(locale).key(Messages.GUI_QUICKLAUNCH_PAGE_NOT_FOUND_0);
            }
          }
 else {
            CmsResource resource=m_cms.readDefaultFile("/");
            CmsReturnLinkInfo linkInfo=CmsCoreService.internalGetLinkForReturnCode(m_cms,"" + resource.getStructureId());
            link=linkInfo.getLink();
          }
        }
      }
 else       if (CmsSitemapEditorConfiguration.APP_ID.equals(config.getId())) {
        if (params.isSitemapContext()) {
          reload=true;
        }
 else         if (params.isPageContext()) {
          String sitemapLink=OpenCms.getLinkManager().substituteLinkForUnknownTarget(m_cms,CmsADEManager.PATH_SITEMAP_EDITOR_JSP);
          String returnCode=params.getDetailId() != null ? "" + params.getPageId() + ":"+ params.getDetailId() : "" + params.getPageId();
          link=sitemapLink + "?path=" + params.getPath()+ "&returncode="+ returnCode;
        }
      }
 else       if (CmsTraditionalWorkplaceConfiguration.APP_ID.equals(config.getId())) {
        String resourceRootFolder=params.getPageId() != null ? CmsResource.getFolderPath(m_cms.readResource(params.getPageId()).getRootPath()) : m_cms.getRequestContext().getSiteRoot();
        link=CmsWorkplace.getWorkplaceExplorerLink(m_cms,resourceRootFolder);
        useLegacyButtonStyle=true;
      }
 else {
        if (!usesNewWorkplace) {
          continue;
        }
        link=OpenCms.getSystemInfo().getWorkplaceContext() + "#!" + config.getId();
      }
      Resource icon=config.getIcon();
      String imageLink="";
      if (icon instanceof ExternalResource) {
        imageLink=((ExternalResource)icon).getURL();
      }
      String name=config.getName(OpenCms.getWorkplaceManager().getWorkplaceLocale(m_cms));
      CmsQuickLaunchData data=new CmsQuickLaunchData(link,name,imageLink,errorTitle,errorMessage,useLegacyButtonStyle,reload);
      result.add(data);
    }
 catch (    Exception e) {
      LOG.error(e.getLocalizedMessage(),e);
    }
  }
  return result;
}
