{
  if (C_DEBUG && A_OpenCms.isLogging()) {
    A_OpenCms.log(C_OPENCMS_DEBUG,this.getClassName() + "getting content of element " + ((elementName == null) ? "<root>" : elementName));
    A_OpenCms.log(C_OPENCMS_DEBUG,this.getClassName() + "template file is: " + templateFile);
    A_OpenCms.log(C_OPENCMS_DEBUG,this.getClassName() + "selected template section is: " + ((templateSelector == null) ? "<default>" : templateSelector));
  }
  A_CmsRequestContext reqCont=cms.getRequestContext();
  CmsXmlWpTemplateFile xmlTemplateDocument=(CmsXmlWpTemplateFile)getOwnTemplateFile(cms,templateFile,elementName,parameters,templateSelector);
  A_CmsTask task;
  int taskid=-1;
  try {
    taskid=Integer.parseInt((String)parameters.get("taskid"));
    if ("accept".equals((String)parameters.get("action"))) {
      cms.acceptTask(taskid);
      String comment="";
      cms.writeTaskLog(taskid,comment,C_TASKLOGTYPE_ACCEPTED);
    }
 else     if ("ok".equals((String)parameters.get("action"))) {
      cms.endTask(taskid);
      String comment="";
      cms.writeTaskLog(taskid,comment,C_TASKLOGTYPE_OK);
    }
    task=cms.readTask(taskid);
  }
 catch (  Exception exc) {
    throw new CmsException(CmsException.C_UNKNOWN_EXCEPTION,exc);
  }
  StringBuffer result=new StringBuffer();
  String priority;
  String projectname="?";
  String style;
  String button2;
  String button6;
  long startTime;
  long timeout;
  long now=new Date().getTime();
  try {
    projectname=cms.readTask(task.getRoot()).getName();
  }
 catch (  Exception exc) {
  }
  priority=xmlTemplateDocument.getProcessedXmlDataValue("priority" + task.getPriority(),this);
  startTime=task.getStartTime().getTime();
  timeout=task.getTimeOut().getTime();
  xmlTemplateDocument.setXmlData("taskid",task.getId() + "");
  if (task.getState() == C_TASK_STATE_ENDED) {
    if (timeout < now) {
      button2=xmlTemplateDocument.getProcessedXmlDataValue("button_forward",this);
      button6=xmlTemplateDocument.getProcessedXmlDataValue("button_reakt",this);
      style=xmlTemplateDocument.getProcessedXmlDataValue("style_alertok",this);
    }
 else {
      button2=xmlTemplateDocument.getProcessedXmlDataValue("button_forward",this);
      button6=xmlTemplateDocument.getProcessedXmlDataValue("button_reakt",this);
      style=xmlTemplateDocument.getProcessedXmlDataValue("style_ok",this);
    }
  }
 else   if (task.getPercentage() == 0) {
    if (timeout < now) {
      button2=xmlTemplateDocument.getProcessedXmlDataValue("button_take",this);
      button6=xmlTemplateDocument.getProcessedXmlDataValue("button_ok",this);
      style=xmlTemplateDocument.getProcessedXmlDataValue("style_alert",this);
    }
 else {
      button2=xmlTemplateDocument.getProcessedXmlDataValue("button_take",this);
      button6=xmlTemplateDocument.getProcessedXmlDataValue("button_ok",this);
      style=xmlTemplateDocument.getProcessedXmlDataValue("style_new",this);
    }
  }
 else {
    if (timeout < now) {
      button2=xmlTemplateDocument.getProcessedXmlDataValue("button_accept",this);
      button6=xmlTemplateDocument.getProcessedXmlDataValue("button_ok",this);
      style=xmlTemplateDocument.getProcessedXmlDataValue("style_alert",this);
    }
 else {
      button2=xmlTemplateDocument.getProcessedXmlDataValue("button_accept",this);
      button6=xmlTemplateDocument.getProcessedXmlDataValue("button_ok",this);
      style=xmlTemplateDocument.getProcessedXmlDataValue("style_activ",this);
    }
  }
  xmlTemplateDocument.setXmlData("style",style);
  xmlTemplateDocument.setXmlData("priority",priority);
  xmlTemplateDocument.setXmlData("task",task.getName());
  xmlTemplateDocument.setXmlData("foruser",cms.readAgent(task).getName());
  xmlTemplateDocument.setXmlData("forrole",cms.readGroup(task).getName());
  xmlTemplateDocument.setXmlData("actuator",cms.readOwner(task).getName());
  xmlTemplateDocument.setXmlData("due",Utils.getNiceShortDate(timeout));
  xmlTemplateDocument.setXmlData("from",Utils.getNiceShortDate(startTime));
  xmlTemplateDocument.setXmlData("project",projectname);
  xmlTemplateDocument.setXmlData("button2",button2);
  xmlTemplateDocument.setXmlData("button6",button6);
  return startProcessing(cms,xmlTemplateDocument,elementName,parameters,templateSelector);
}
