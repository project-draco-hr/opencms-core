{
  Map parameters=request.getParameterMap();
  Map processedParamters=new HashMap();
  Iterator p=parameters.keySet().iterator();
  while (p.hasNext()) {
    String key=(String)p.next();
    String[] values=(String[])parameters.get(key);
    if (key.startsWith(HIDDEN_PARAM_PREFIX)) {
      key=key.substring(HIDDEN_PARAM_PREFIX.length());
      String[] newValues=new String[values.length];
      for (int l=0; l < values.length; l++) {
        newValues[l]=CmsEncoder.decode(values[l],getCms().getRequestContext().getEncoding());
      }
      values=newValues;
    }
    processedParamters.put(key,values);
  }
  m_widgetParamValues=new HashMap();
  Iterator i=getWidgets().iterator();
  while (i.hasNext()) {
    CmsWidgetDialogParameter base=(CmsWidgetDialogParameter)i.next();
    List params=new ArrayList();
    int maxOccurs=base.getMaxOccurs();
    boolean onPage=false;
    if (base.isCollectionBase()) {
      if (CmsStringUtil.isNotEmpty(getParamAction())) {
        String page=getParamPage();
        onPage=CmsStringUtil.isEmpty(page) || CmsStringUtil.isEmpty(base.getDialogPage()) || base.getDialogPage().equals(page);
      }
    }
    for (int j=0; j < maxOccurs; j++) {
      String id=CmsWidgetDialogParameter.createId(base.getName(),j);
      boolean required=(params.size() < base.getMinOccurs()) || (processedParamters.get(id) != null) || (!onPage && base.hasValue(j));
      if (required) {
        CmsWidgetDialogParameter param=new CmsWidgetDialogParameter(base,params.size(),j);
        param.setKeyPrefix(m_prefix);
        base.getWidget().setEditorValue(getCms(),processedParamters,this,param);
        params.add(param);
      }
    }
    m_widgetParamValues.put(base.getName(),params);
  }
}
