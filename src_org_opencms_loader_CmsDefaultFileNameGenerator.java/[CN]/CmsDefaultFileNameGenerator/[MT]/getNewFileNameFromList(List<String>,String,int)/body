{
  String checkFileName, checkTempFileName;
  CmsMacroResolver resolver=CmsMacroResolver.newInstance();
  String macro=I_CmsFileNameGenerator.MACRO_NUMBER;
  int useDigits=defaultDigits;
  int prefixIndex=checkPattern.indexOf(MACRO_NUMBER_START);
  if (prefixIndex >= 0) {
    char n=checkPattern.charAt(prefixIndex + MACRO_NUMBER_START.length());
    macro=macro + ':' + n;
    useDigits=Character.getNumericValue(n);
  }
  CmsNumberFactory numberFactory=new CmsNumberFactory(useDigits);
  resolver.addDynamicMacro(macro,numberFactory);
  int j=0;
  do {
    numberFactory.setNumber(++j);
    checkFileName=resolver.resolveMacros(checkPattern);
    checkTempFileName=CmsWorkplace.getTemporaryFileName(checkFileName);
  }
 while (fileNames.contains(checkFileName) || fileNames.contains(checkTempFileName));
  return checkFileName;
}
