{
  Connection conn=null;
  PreparedStatement stmt=null;
  String key=null;
  boolean hasBatch=false;
  CmsProperty property=null;
  int mappingType=-1;
  String value=null;
  CmsUUID id=null;
  CmsPropertydefinition propdef=null;
  try {
    conn=m_sqlManager.getConnectionForBackup();
    stmt=m_sqlManager.getPreparedStatement(conn,"C_PROPERTIES_CREATE_BACKUP");
    Iterator dummy=properties.iterator();
    while (dummy.hasNext()) {
      hasBatch=false;
      property=(CmsProperty)dummy.next();
      key=property.getKey();
      propdef=readBackupPropertyDefinition(key,resource.getType());
      if (propdef == null) {
        throw new CmsException("[" + this.getClass().getName() + "] "+ key,CmsException.C_NOT_FOUND);
      }
 else {
        for (int i=0; i < 2; i++) {
          mappingType=-1;
          value=null;
          id=null;
          if (i == 0) {
            value=property.getStructureValue();
            mappingType=CmsProperty.C_STRUCTURE_RECORD_MAPPING;
            id=resource.getStructureId();
            if (value == null || "".equals(value)) {
              continue;
            }
          }
 else {
            value=property.getResourceValue();
            mappingType=CmsProperty.C_RESOURCE_RECORD_MAPPING;
            id=resource.getResourceId();
            if (value == null || "".equals(value)) {
              break;
            }
          }
          stmt.setString(1,backupId.toString());
          stmt.setInt(2,m_sqlManager.nextId(m_sqlManager.readQuery("C_TABLE_PROPERTIES_BACKUP")));
          stmt.setInt(3,propdef.getId());
          stmt.setString(4,id.toString());
          stmt.setInt(5,mappingType);
          stmt.setString(6,m_sqlManager.validateNull(value));
          stmt.setInt(7,tagId);
          stmt.setInt(8,versionId);
          stmt.addBatch();
          hasBatch=true;
        }
        if (hasBatch) {
          stmt.executeBatch();
        }
      }
    }
  }
 catch (  SQLException e) {
    throw m_sqlManager.getCmsException(this,null,CmsException.C_SQL_ERROR,e,false);
  }
catch (  Exception e) {
    throw m_sqlManager.getCmsException(this,null,CmsException.C_UNKNOWN_EXCEPTION,e,false);
  }
 finally {
    m_sqlManager.closeAll(conn,stmt,null);
  }
}
