{
  ResultSet res=null;
  PreparedStatement stmt=null;
  Connection conn=null;
  String propertyKey=null;
  String propertyValue=null;
  int mappingType=-1;
  Map propertyMap=new HashMap();
  CmsProperty property=null;
  try {
    conn=m_sqlManager.getConnection(dbc);
    stmt=m_sqlManager.getPreparedStatement(conn,"C_PROPERTIES_READALL_BACKUP");
    stmt.setString(1,resource.getStructureId().toString());
    stmt.setString(2,resource.getResourceId().toString());
    stmt.setInt(3,resource.getTagId());
    res=stmt.executeQuery();
    while (res.next()) {
      propertyKey=res.getString(1);
      propertyValue=res.getString(2);
      mappingType=res.getInt(3);
      if ((property=(CmsProperty)propertyMap.get(propertyKey)) != null) {
switch (mappingType) {
case CmsProperty.STRUCTURE_RECORD_MAPPING:
          property.setStructureValue(propertyValue);
        break;
case CmsProperty.RESOURCE_RECORD_MAPPING:
      property.setResourceValue(propertyValue);
    break;
default :
  throw new CmsDbConsistencyException(Messages.get().container(Messages.ERR_UNKNOWN_PROPERTY_VALUE_MAPPING_3,resource.getRootPath(),new Integer(mappingType),propertyKey));
}
}
 else {
property=new CmsProperty();
property.setName(propertyKey);
switch (mappingType) {
case CmsProperty.STRUCTURE_RECORD_MAPPING:
property.setStructureValue(propertyValue);
property.setResourceValue(null);
break;
case CmsProperty.RESOURCE_RECORD_MAPPING:
property.setStructureValue(null);
property.setResourceValue(propertyValue);
break;
default :
throw new CmsDbConsistencyException(Messages.get().container(Messages.ERR_UNKNOWN_PROPERTY_VALUE_MAPPING_3,resource.getRootPath(),new Integer(mappingType),propertyKey));
}
propertyMap.put(propertyKey,property);
}
}
}
 catch (SQLException e) {
throw new CmsDbSqlException(Messages.get().container(Messages.ERR_GENERIC_SQL_1,CmsDbSqlException.getErrorQuery(stmt)),e);
}
 finally {
m_sqlManager.closeAll(dbc,conn,stmt,res);
}
return new ArrayList(propertyMap.values());
}
