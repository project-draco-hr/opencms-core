{
  List<CmsContextMenuEntryBean> result=new ArrayList<CmsContextMenuEntryBean>();
  CmsContextMenuEntryBean lastBean=null;
  for (  CmsContextMenuEntryBean entry : allEntries) {
    if (entry.isVisible()) {
      if (entry.isSeparator() && !result.isEmpty()) {
        if ((lastBean != null) && !lastBean.isSeparator()) {
          result.add(entry);
        }
      }
 else       if (!CmsCollectionUtil.isEmptyOrNull(entry.getSubMenu())) {
        entry.setSubMenu(filterEntries(entry.getSubMenu()));
        result.add(entry);
      }
 else {
        result.add(entry);
      }
      lastBean=entry;
    }
  }
  if (result.get(result.size() - 1).isSeparator()) {
    result.remove(result.size() - 1);
  }
  return result;
}
