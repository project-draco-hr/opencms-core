{
  List<String> existingResourceNames=new ArrayList<String>();
  List<String> invalidFileNames=new ArrayList<String>();
  boolean isActive=false;
  if (getRequest().getSession().getAttribute(CmsUploadBean.SESSION_ATTRIBUTE_LISTENER_ID) == null) {
    for (    String fileName : fileNames) {
      try {
        Streams.checkFileName(fileName);
        String newResName=CmsResource.getName(fileName.replace('\\','/'));
        String newResPath=getNewResourceName(newResName,targetFolder);
        if (getCmsObject().existsResource(newResPath,CmsResourceFilter.IGNORE_EXPIRATION)) {
          existingResourceNames.add(fileName);
        }
      }
 catch (      InvalidFileNameException e) {
        invalidFileNames.add(fileName);
      }
    }
  }
 else {
    isActive=true;
  }
  return new CmsUploadFileBean(existingResourceNames,invalidFileNames,isActive);
}
