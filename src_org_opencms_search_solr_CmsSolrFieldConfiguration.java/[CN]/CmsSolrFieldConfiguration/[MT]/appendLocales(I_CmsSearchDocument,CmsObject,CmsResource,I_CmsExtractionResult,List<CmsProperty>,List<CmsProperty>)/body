{
  List<String> itemLocales=null;
  List<Locale> resourceLocales=new ArrayList<Locale>();
  if ((extraction != null) && (extraction.getContentItems() != null) && (extraction.getContentItems().get(CmsSearchField.FIELD_RESOURCE_LOCALES) != null)) {
    String localesAsString=extraction.getContentItems().get(CmsSearchField.FIELD_RESOURCE_LOCALES);
    itemLocales=CmsStringUtil.splitAsList(localesAsString,' ');
    for (    String locale : itemLocales) {
      resourceLocales.add(new Locale(locale));
      for (      CmsSolrField sf : m_multiLocaleFields) {
        String effFieldName=CmsSearchFieldConfiguration.getLocaleExtendedName(sf.getName(),locale) + "_s";
        String value=extraction.getContentItems().get(effFieldName);
        CmsSolrField f=new CmsSolrField(effFieldName,null,null,null,0);
        document.addSearchField(f,value);
        effFieldName=CmsSearchFieldConfiguration.getLocaleExtendedName(sf.getName(),locale) + "_txt";
        value=extraction.getContentItems().get(effFieldName);
        f=new CmsSolrField(effFieldName,null,null,null,0);
        document.addSearchField(f,value);
      }
    }
  }
 else {
    resourceLocales=OpenCms.getLocaleManager().getDefaultLocales(cms,resource);
    for (    final CmsProperty prop : propertiesSearched) {
      if (prop.getName().equals(CmsPropertyDefinition.PROPERTY_TITLE)) {
        final String value=prop.getValue();
        final List<Locale> availableLocales=OpenCms.getLocaleManager().getAvailableLocales();
        for (        final Locale locale : availableLocales) {
          final String lang=locale.getLanguage();
          if (!resourceLocales.contains(lang)) {
            final String effFieldName=CmsSearchFieldConfiguration.getLocaleExtendedName(CmsSearchField.FIELD_TITLE_UNSTORED,locale) + "_s";
            final CmsSolrField f=new CmsSolrField(effFieldName,null,null,null,0);
            document.addSearchField(f,value);
          }
        }
      }
    }
  }
  document.addResourceLocales(resourceLocales);
  m_contentLocales=new ArrayList<Locale>();
  if (itemLocales != null) {
    m_contentLocales=resourceLocales;
  }
 else {
    m_contentLocales=getContentLocales(cms,resource,extraction);
  }
  document.addContentLocales(m_contentLocales);
  if (hasLocaleDependencies()) {
    CmsDocumentDependency dep=CmsDocumentDependency.load(cms,resource);
    ((CmsSolrDocument)document).addDocumentDependency(cms,dep);
  }
  return document;
}
