{
  List elementList=CmsDialogElements.computeElements(getCms(),m_page,getParamTempfile(),getElementLocale());
  int counter=0;
  int currentIndex=-1;
  Iterator i=elementList.iterator();
  List options=new ArrayList(elementList.size());
  List values=new ArrayList(elementList.size());
  String elementName=getParamElementname();
  if (CmsStringUtil.isEmpty(elementName)) {
    elementName=getParamOldelementname();
  }
  while (i.hasNext()) {
    CmsDialogElement element=(CmsDialogElement)i.next();
    if (!CmsStringUtil.isEmpty(elementName) && elementName.equals(element.getName())) {
      currentIndex=counter;
    }
    if ((!m_page.hasValue(element.getName(),getElementLocale()) && element.isMandantory()) || m_page.isEnabled(element.getName(),getElementLocale())) {
      options.add(element.getNiceName());
      values.add(element.getName());
      counter++;
    }
  }
  return buildSelect(attributes,options,values,currentIndex,false);
}
