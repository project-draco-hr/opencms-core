{
  String username=(String)theUser.getName();
  Vector oldGroups=cms.getGroupsOfUser(username);
  Vector oldGroupnames=new Vector();
  if (defaultGroupName == null) {
    throw new CmsException("method 'changeGroups': default group set to null",CmsException.C_NO_DEFAULT_GROUP);
  }
  theUser.setDefaultGroup(cms.readGroup(defaultGroupName));
  cms.writeUser(theUser);
  theUser=(CmsUser)cms.readUser(username);
  if (oldGroups != null) {
    for (int z=0; z < oldGroups.size(); z++) {
      oldGroupnames.addElement(((CmsGroup)oldGroups.elementAt(z)).getName());
    }
    String oldDefaultGroup=theUser.getDefaultGroup().getName();
    oldGroupnames.removeElement(oldDefaultGroup);
    for (int z=0; z < oldGroupnames.size(); z++) {
      String groupname=(String)oldGroupnames.elementAt(z);
      if (!newGroups.contains(groupname)) {
        try {
          cms.removeUserFromGroup(username,groupname);
        }
 catch (        CmsException e) {
        }
      }
    }
  }
  if (newGroups != null) {
    for (int z=0; z < newGroups.size(); z++) {
      String groupname=(String)newGroups.elementAt(z);
      if (!cms.userInGroup(username,groupname)) {
        cms.addUserToGroup(username,groupname);
      }
    }
  }
  cms.writeUser(theUser);
  theUser=(CmsUser)cms.readUser(username);
}
