{
  CmsField mailField=(CmsField)getFormConfiguration().getFields().get(getFormConfiguration().getConfirmationMailField());
  String mailTo=mailField.getValue();
  if (getFormConfiguration().getMailType().equals(CmsForm.MAILTYPE_HTML)) {
    CmsHtmlMail theMail=new CmsHtmlMail();
    theMail.setCharset(getCmsObject().getRequestContext().getEncoding());
    if (CmsStringUtil.isNotEmpty(getFormConfiguration().getMailFrom())) {
      theMail.setFrom(getFormConfiguration().getMailFrom());
    }
    theMail.setTo(createInternetAddresses(mailTo));
    theMail.setSubject(getFormConfiguration().getMailSubjectPrefix() + getFormConfiguration().getConfirmationMailSubject());
    theMail.setHtmlMsg(createMailTextFromFields(true,true));
    theMail.setTextMsg(createMailTextFromFields(false,true));
    theMail.send();
  }
 else {
    CmsSimpleMail theMail=new CmsSimpleMail();
    theMail.setCharset(getCmsObject().getRequestContext().getEncoding());
    if (CmsStringUtil.isNotEmpty(getFormConfiguration().getMailFrom())) {
      theMail.setFrom(getFormConfiguration().getMailFrom());
    }
    theMail.setTo(createInternetAddresses(mailTo));
    theMail.setSubject(getFormConfiguration().getMailSubjectPrefix() + getFormConfiguration().getConfirmationMailSubject());
    theMail.setMsg(createMailTextFromFields(false,true));
    theMail.send();
  }
}
