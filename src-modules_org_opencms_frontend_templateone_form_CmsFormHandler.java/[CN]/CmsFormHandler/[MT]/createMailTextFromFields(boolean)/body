{
  List resultList=createValuesFromFields();
  StringBuffer result=new StringBuffer(resultList.size() * 8);
  if (isHtmlMail) {
    result.append("<html><head>\n");
    result.append("<style type=\"text/css\"><!--\n");
    String style=getMessages().key("form.email.style.body");
    if (CmsStringUtil.isNotEmpty(style)) {
      result.append("body,h1,p,td { ");
      result.append(style);
      result.append(" }\n");
    }
    style=getMessages().key("form.email.style.h1");
    if (CmsStringUtil.isNotEmpty(style)) {
      result.append("h1 { ");
      result.append(style);
      result.append(" }\n");
    }
    style=getMessages().key("form.email.style.p");
    if (CmsStringUtil.isNotEmpty(style)) {
      result.append("p { ");
      result.append(style);
      result.append(" }\n");
    }
    style=getMessages().key("form.email.style.fields");
    if (CmsStringUtil.isNotEmpty(style)) {
      result.append("table.fields { ");
      result.append(style);
      result.append(" }\n");
    }
    style=getMessages().key("form.email.style.fieldlabel");
    if (CmsStringUtil.isNotEmpty(style)) {
      result.append("td.fieldlabel { ");
      result.append(style);
      result.append(" }\n");
    }
    style=getMessages().key("form.email.style.fieldvalue");
    if (CmsStringUtil.isNotEmpty(style)) {
      result.append("td.fieldvalue { ");
      result.append(style);
      result.append(" }\n");
    }
    style=getMessages().key("form.email.style.misc");
    if (CmsStringUtil.isNotEmpty(style)) {
      result.append(getMessages().key("form.email.style.misc"));
    }
    result.append("//--></style>\n");
    result.append("</head><body>\n");
    result.append(getFormConfiguration().getMailText());
    result.append("<table border=\"0\" class=\"fields\">\n");
  }
 else {
    result.append(getFormConfiguration().getMailTextPlain());
    result.append("\n\n");
  }
  Iterator i=resultList.iterator();
  while (i.hasNext()) {
    CmsFieldValue current=(CmsFieldValue)i.next();
    if (isHtmlMail) {
      result.append("<tr><td class=\"fieldlabel\">");
      result.append(current.getLabel());
      result.append("</td><td class=\"fieldvalue\">");
      result.append(convertToHtmlValue(current.getValue()));
      result.append("</td></tr>\n");
    }
 else {
      result.append(current.getLabel());
      result.append("\t");
      result.append(current.getValue());
      result.append("\n");
    }
  }
  if (isHtmlMail) {
    result.append("</table>\n");
    result.append("</body></html>");
  }
  return result.toString();
}
