{
  echo("Test result count for changed content of two siblings");
  CmsObject cms=getCmsObject();
  String folder="/reindexPublishedSiblings/";
  cms.createResource(folder,CmsResourceTypeFolder.getStaticTypeId());
  String brother=folder + "test_brother.txt";
  CmsProperty firstTitleProperty=new CmsProperty(CmsPropertyDefinition.PROPERTY_TITLE,"BROTHER AND SISTER",null);
  List<CmsProperty> props=new ArrayList<CmsProperty>();
  props.add(firstTitleProperty);
  CmsResource resource=cms.createResource(brother,CmsResourceTypePlain.getStaticTypeId(),"Solr Enterprise Serach".getBytes(),props);
  String sister=folder + "test_sister.txt";
  cms.createSibling(brother,sister,props);
  OpenCms.getPublishManager().publishResource(cms,folder);
  OpenCms.getPublishManager().waitWhileRunning();
  CmsFile file=cms.readFile(resource);
  file.setContents("OpenCms Enterprise Content Management System".getBytes());
  cms.lockResource(file);
  cms.writeFile(file);
  OpenCms.getPublishManager().publishResource(cms,brother,false,null);
  OpenCms.getPublishManager().waitWhileRunning();
  CmsSolrQuery query=new CmsSolrQuery(getCmsObject(),null);
  query.setQuery("\"OpenCms Enterprise Content Management System\"");
  List<Locale> locles=Collections.emptyList();
  query.setLocales(locles);
  query.setSearchRoots("/");
  query.setRows(new Integer(10));
  CmsSolrIndex oindex=OpenCms.getSearchManager().getIndexSolr(AllTests.SOLR_ONLINE);
  CmsSolrResultList rl=oindex.search(cms,query);
  assertEquals("Both siblings must be found, they have the same content.",2,rl.size());
  CmsSearchResource brotherDoc=rl.get(0);
  CmsSearchResource sisterDoc=rl.get(1);
  assertEquals("Brother must be there","/sites/default/reindexPublishedSiblings/test_brother.txt",brotherDoc.getRootPath());
  assertEquals("Sister must be there","/sites/default/reindexPublishedSiblings/test_sister.txt",sisterDoc.getRootPath());
  assertEquals("The content must be","OpenCms Enterprise Content Management System",brotherDoc.getField("content"));
  assertEquals("The content of the found documents must be equal",brotherDoc.getField("content"),sisterDoc.getField("content"));
  query.setQuery("\"Solr Enterprise Serach\"");
  CmsSolrResultList rl2=oindex.search(cms,query);
  assertEquals("Old content must not be found anymore",0,rl2.size());
  cms.getRequestContext().setCurrentProject(cms.readProject(CmsProject.ONLINE_PROJECT_ID));
  String sisterContent=new String(cms.readFile(sister).getContents());
  String brotherContent=new String(cms.readFile(brother).getContents());
  assertEquals("Sister and brother must have the same content in the online project",sisterContent,brotherContent);
}
