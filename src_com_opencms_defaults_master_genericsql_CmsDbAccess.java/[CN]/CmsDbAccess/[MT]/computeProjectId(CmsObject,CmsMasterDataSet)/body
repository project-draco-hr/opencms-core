{
  int onlineProjectId=I_CmsConstants.C_UNKNOWN_ID;
  int offlineProjectId=I_CmsConstants.C_UNKNOWN_ID;
  offlineProjectId=cms.getRequestContext().currentProject().getId();
  onlineProjectId=I_CmsConstants.C_PROJECT_ONLINE_ID;
  if (!isOnlineProject(cms)) {
    try {
      if ((cms.getRequestContext().currentUser().getId().equals(dataset.m_userId)) || cms.isAdmin()) {
        return offlineProjectId;
      }
    }
 catch (    CmsException exc) {
    }
    String statement_key="read_channel_offline";
    PreparedStatement stmt=null;
    ResultSet res=null;
    Connection conn=null;
    try {
      cms.setContextToCos();
      conn=m_sqlManager.getConnection();
      stmt=m_sqlManager.getPreparedStatement(conn,statement_key);
      stmt.setString(1,dataset.m_masterId.toString());
      res=stmt.executeQuery();
      while (res.next()) {
        int channeldId=res.getInt(1);
        Vector resources=new Vector();
        try {
          resources=cms.getResourcesWithPropertyDefintion(I_CmsConstants.C_PROPERTY_CHANNELID,channeldId + "",CmsResourceTypeFolder.C_RESOURCE_TYPE_ID);
        }
 catch (        CmsException exc) {
        }
        if (resources.size() >= 1) {
          int resProjectId=((CmsResource)resources.get(0)).getProjectId();
          if (resProjectId == offlineProjectId) {
            return offlineProjectId;
          }
        }
      }
    }
  finally {
      cms.setContextToVfs();
      m_sqlManager.closeAll(conn,stmt,res);
    }
  }
  return onlineProjectId;
}
