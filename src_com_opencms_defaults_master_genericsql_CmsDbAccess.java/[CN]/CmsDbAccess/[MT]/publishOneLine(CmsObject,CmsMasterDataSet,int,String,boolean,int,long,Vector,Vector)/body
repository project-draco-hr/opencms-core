{
  try {
    Class.forName(contentDefinitionName).getMethod("beforePublish",new Class[]{CmsObject.class,Boolean.class,Integer.class,Integer.class,Long.class,Vector.class,Vector.class,CmsMasterDataSet.class}).invoke(null,new Object[]{cms,new Boolean(enableHistory),new Integer(subId),new Integer(versionId),new Long(publishingDate),changedRessources,changedModuleData,dataset});
  }
 catch (  Exception e) {
    OpenCms.log(CmsLog.CHANNEL_MODULE,CmsLog.LEVEL_WARN,"[CmsProjectDriver] error calling method beforePublish in class " + contentDefinitionName);
  }
  if (enableHistory) {
    long backupCreationDate=dataset.m_dateCreated;
    publishBackupData(cms,dataset,subId,versionId,publishingDate);
    dataset.m_dateCreated=backupCreationDate;
  }
  publishDeleteData(dataset.m_masterId,subId,"online");
  if (dataset.m_state == I_CmsConstants.C_STATE_DELETED) {
    publishDeleteData(dataset.m_masterId,subId,"offline");
  }
 else {
    publishCopyData(dataset,subId);
  }
  PreparedStatement stmt=null;
  Connection conn=null;
  try {
    conn=m_sqlManager.getConnection();
    stmt=m_sqlManager.getPreparedStatement(conn,"update_state_offline");
    stmt.setInt(1,I_CmsConstants.C_STATE_UNCHANGED);
    stmt.setString(2,CmsUUID.getNullUUID().toString());
    stmt.setString(3,dataset.m_masterId.toString());
    stmt.setInt(4,subId);
    stmt.executeUpdate();
  }
 catch (  SQLException exc) {
    throw new CmsException(CmsException.C_SQL_ERROR,exc);
  }
 finally {
    m_sqlManager.closeAll(conn,stmt,null);
  }
  changedModuleData.add(cms.getRequestContext().addSiteRoot(contentDefinitionName + "/" + dataset.m_masterId));
}
