{
  PreparedStatement stmt=null;
  Connection conn=null;
  cms.getRequestContext().saveSiteRoot();
  cms.getRequestContext().setSiteRoot(I_CmsConstants.VFS_FOLDER_CHANNELS);
  conn=m_sqlManager.getConnection();
  stmt=m_sqlManager.getPreparedStatement(conn,"insert_channel_offline");
  for (int i=0; i < channelToAdd.size(); i++) {
    try {
      stmt.setString(1,masterId.toString());
      CmsResource channel=cms.readFolder((String)channelToAdd.get(i));
      String id=channel.getResourceId().toString();
      stmt.setString(2,id);
      stmt.setString(3,(String)channelToAdd.get(i));
      stmt.executeUpdate();
    }
 catch (    CmsException exc) {
      if (OpenCms.getLog(this).isWarnEnabled()) {
        OpenCms.getLog(this).warn("Couldn't find channel " + channelToAdd.get(i),exc);
      }
    }
  }
  m_sqlManager.closeAll(conn,stmt,null);
  stmt=null;
  conn=null;
  try {
    conn=m_sqlManager.getConnection();
    stmt=m_sqlManager.getPreparedStatement(conn,"delete_channel_offline");
    for (int i=0; i < channelToDelete.size(); i++) {
      stmt.setString(1,masterId.toString());
      stmt.setString(2,(String)channelToDelete.get(i));
      stmt.executeUpdate();
    }
  }
  finally {
    m_sqlManager.closeAll(conn,stmt,null);
    cms.getRequestContext().restoreSiteRoot();
  }
}
