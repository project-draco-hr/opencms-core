{
  PreparedStatement stmt=null;
  PreparedStatement stmt2=null;
  ResultSet res=null;
  Connection conn=null;
  Connection conn2=null;
  CmsUUID masterId=dataset.m_masterId;
  try {
    stmt=null;
    conn=null;
    conn=m_SqlQueries.getConnection();
    stmt=m_SqlQueries.getPreparedStatement(conn,"insert_backup");
    dataset.m_lockedBy=CmsUUID.getNullUUID();
    dataset.m_dateCreated=publishDate;
    String ownerName="";
    try {
      CmsUser owner=cms.readUser(dataset.m_userId);
      ownerName=owner.getName() + " " + owner.getFirstname()+ " "+ owner.getLastname();
    }
 catch (    CmsException ex) {
      ownerName="";
    }
    String groupName="";
    try {
      CmsGroup group=cms.readGroup(dataset.m_groupId);
      groupName=group.getName();
    }
 catch (    CmsException ex) {
      groupName="";
    }
    String userName="";
    try {
      CmsUser user=cms.readUser(dataset.m_lastModifiedBy);
      userName=user.getName() + " " + user.getFirstname()+ " "+ user.getLastname();
    }
 catch (    CmsException ex) {
      userName="";
    }
    int lastId=sqlFillValues(stmt,subId,dataset);
    stmt.setInt(lastId++,versionId);
    stmt.setString(lastId++,ownerName);
    stmt.setString(lastId++,groupName);
    stmt.setString(lastId++,userName);
    stmt.executeUpdate();
  }
 catch (  SQLException exc) {
    throw new CmsException(CmsException.C_SQL_ERROR,exc);
  }
 finally {
    m_SqlQueries.closeAll(conn,stmt,null);
  }
  try {
    stmt=null;
    res=null;
    conn=null;
    conn=m_SqlQueries.getConnection();
    stmt=m_SqlQueries.getPreparedStatement(conn,"read_media_offline");
    stmt.setString(1,masterId.toString());
    res=stmt.executeQuery();
    while (res.next()) {
      int i=1;
      CmsMasterMedia mediaset=new CmsMasterMedia(res.getInt(i++),new CmsUUID(res.getString(i++)),res.getInt(i++),res.getInt(i++),res.getInt(i++),res.getInt(i++),res.getString(i++),res.getInt(i++),res.getString(i++),res.getString(i++),res.getString(i++),res.getBytes(i++));
      try {
        conn2=null;
        stmt2=null;
        conn2=m_SqlQueries.getConnection();
        stmt2=m_SqlQueries.getPreparedStatement(conn2,"insert_media_backup");
        int lastId=sqlFillValues(stmt2,mediaset);
        stmt2.setInt(lastId,versionId);
        stmt2.executeUpdate();
      }
 catch (      SQLException ex) {
        throw ex;
      }
 finally {
        m_SqlQueries.closeAll(conn2,stmt2,null);
      }
    }
  }
 catch (  SQLException exc) {
    throw new CmsException(CmsException.C_SQL_ERROR,exc);
  }
 finally {
    m_SqlQueries.closeAll(conn,stmt,res);
  }
}
