{
  super(req);
  m_controller=controller;
  m_resource=m_controller.getCmsObject().readAbsolutePath(m_controller.getCmsResource());
  CmsObject cms=m_controller.getCmsObject();
  m_includeCalls=Collections.synchronizedSet(new java.util.HashSet(23));
  m_parameters=req.getParameterMap();
  try {
    m_isOnline=cms.getRequestContext().currentProject().isOnlineProject();
  }
 catch (  Exception e) {
  }
  String[] paras=req.getParameterValues(C_PARAMETER_FLEX);
  boolean nocachepara=false;
  boolean dorecompile=false;
  boolean isAdmin=false;
  if (paras != null) {
    try {
      isAdmin=cms.getRequestContext().isAdmin();
    }
 catch (    Exception e) {
    }
    if (isAdmin) {
      List l=Arrays.asList(paras);
      String context=(String)req.getAttribute(C_ATTRIBUTE_PROCESSED);
      boolean firstCall=(context == null);
      if (firstCall) {
        req.setAttribute(C_ATTRIBUTE_PROCESSED,"true");
      }
      nocachepara=l.contains("nocache");
      dorecompile=l.contains("recompile");
      boolean p_on=l.contains("online");
      boolean p_off=l.contains("offline");
      if (l.contains("purge") && firstCall) {
        OpenCms.fireCmsEvent(new CmsEvent(cms,I_CmsEventListener.EVENT_FLEX_PURGE_JSP_REPOSITORY,new java.util.HashMap(0)));
        OpenCms.fireCmsEvent(new CmsEvent(cms,I_CmsEventListener.EVENT_FLEX_CACHE_CLEAR,Collections.singletonMap("action",new Integer(CmsFlexCache.C_CLEAR_ENTRIES))));
        dorecompile=false;
      }
 else       if ((l.contains("clearcache") || dorecompile) && firstCall) {
        if (!(p_on || p_off)) {
          OpenCms.fireCmsEvent(new CmsEvent(cms,I_CmsEventListener.EVENT_FLEX_CACHE_CLEAR,Collections.singletonMap("action",new Integer(CmsFlexCache.C_CLEAR_ALL))));
        }
 else {
          if (p_on) {
            OpenCms.fireCmsEvent(new CmsEvent(cms,I_CmsEventListener.EVENT_FLEX_CACHE_CLEAR,Collections.singletonMap("action",new Integer(CmsFlexCache.C_CLEAR_ONLINE_ALL))));
          }
          if (p_off) {
            OpenCms.fireCmsEvent(new CmsEvent(cms,I_CmsEventListener.EVENT_FLEX_CACHE_CLEAR,Collections.singletonMap("action",new Integer(CmsFlexCache.C_CLEAR_OFFLINE_ALL))));
          }
        }
      }
 else       if (l.contains("clearvariations") && firstCall) {
        if (!(p_on || p_off)) {
          OpenCms.fireCmsEvent(new CmsEvent(cms,I_CmsEventListener.EVENT_FLEX_CACHE_CLEAR,Collections.singletonMap("action",new Integer(CmsFlexCache.C_CLEAR_ENTRIES))));
        }
 else {
          if (p_on) {
            OpenCms.fireCmsEvent(new CmsEvent(cms,I_CmsEventListener.EVENT_FLEX_CACHE_CLEAR,Collections.singletonMap("action",new Integer(CmsFlexCache.C_CLEAR_ONLINE_ENTRIES))));
          }
          if (p_off) {
            OpenCms.fireCmsEvent(new CmsEvent(cms,I_CmsEventListener.EVENT_FLEX_CACHE_CLEAR,Collections.singletonMap("action",new Integer(CmsFlexCache.C_CLEAR_OFFLINE_ENTRIES))));
          }
        }
      }
    }
  }
  m_isWorkplaceResource=m_resource.startsWith(I_CmsWpConstants.C_VFS_PATH_WORKPLACE);
  m_canCache=(((m_isOnline || m_isWorkplaceResource || m_controller.getCmsCache().cacheOffline()) && !nocachepara) || dorecompile);
  m_doRecompile=dorecompile;
  if (DEBUG) {
    System.err.println("[FlexRequest] Constructing new Flex request for resource: " + m_resource);
  }
}
