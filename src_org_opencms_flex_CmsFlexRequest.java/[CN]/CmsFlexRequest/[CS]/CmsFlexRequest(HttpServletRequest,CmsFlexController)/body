{
  super(req);
  m_controller=controller;
  CmsObject cms=m_controller.getCmsObject();
  m_elementUri=cms.getSitePath(m_controller.getCmsResource());
  m_elementUriSiteRoot=cms.getRequestContext().getSiteRoot();
  m_includeCalls=new Vector();
  m_parameters=req.getParameterMap();
  m_isOnline=cms.getRequestContext().currentProject().isOnlineProject();
  String[] paras=req.getParameterValues(C_PARAMETER_FLEX);
  boolean nocachepara=false;
  boolean dorecompile=false;
  if (paras != null) {
    if (cms.hasRole(CmsRole.WORKPLACE_MANAGER)) {
      List l=Arrays.asList(paras);
      boolean firstCall=controller.isEmptyRequestList();
      nocachepara=l.contains("nocache");
      dorecompile=l.contains("recompile");
      boolean p_on=l.contains("online");
      boolean p_off=l.contains("offline");
      if (l.contains("purge") && firstCall) {
        OpenCms.fireCmsEvent(new CmsEvent(I_CmsEventListener.EVENT_FLEX_PURGE_JSP_REPOSITORY,new HashMap(0)));
        OpenCms.fireCmsEvent(new CmsEvent(I_CmsEventListener.EVENT_FLEX_CACHE_CLEAR,Collections.singletonMap("action",new Integer(CmsFlexCache.C_CLEAR_ENTRIES))));
        dorecompile=false;
      }
 else       if ((l.contains("clearcache") || dorecompile) && firstCall) {
        if (!(p_on || p_off)) {
          OpenCms.fireCmsEvent(new CmsEvent(I_CmsEventListener.EVENT_FLEX_CACHE_CLEAR,Collections.singletonMap("action",new Integer(CmsFlexCache.C_CLEAR_ALL))));
        }
 else {
          if (p_on) {
            OpenCms.fireCmsEvent(new CmsEvent(I_CmsEventListener.EVENT_FLEX_CACHE_CLEAR,Collections.singletonMap("action",new Integer(CmsFlexCache.C_CLEAR_ONLINE_ALL))));
          }
          if (p_off) {
            OpenCms.fireCmsEvent(new CmsEvent(I_CmsEventListener.EVENT_FLEX_CACHE_CLEAR,Collections.singletonMap("action",new Integer(CmsFlexCache.C_CLEAR_OFFLINE_ALL))));
          }
        }
      }
 else       if (l.contains("clearvariations") && firstCall) {
        if (!(p_on || p_off)) {
          OpenCms.fireCmsEvent(new CmsEvent(I_CmsEventListener.EVENT_FLEX_CACHE_CLEAR,Collections.singletonMap("action",new Integer(CmsFlexCache.C_CLEAR_ENTRIES))));
        }
 else {
          if (p_on) {
            OpenCms.fireCmsEvent(new CmsEvent(I_CmsEventListener.EVENT_FLEX_CACHE_CLEAR,Collections.singletonMap("action",new Integer(CmsFlexCache.C_CLEAR_ONLINE_ENTRIES))));
          }
          if (p_off) {
            OpenCms.fireCmsEvent(new CmsEvent(I_CmsEventListener.EVENT_FLEX_CACHE_CLEAR,Collections.singletonMap("action",new Integer(CmsFlexCache.C_CLEAR_OFFLINE_ENTRIES))));
          }
        }
      }
    }
  }
  m_canCache=(((m_isOnline || m_controller.getCmsCache().cacheOffline()) && !nocachepara) || dorecompile);
  m_doRecompile=dorecompile;
  if (LOG.isDebugEnabled()) {
    LOG.debug(Messages.get().key(Messages.LOG_FLEXREQUEST_CREATED_NEW_REQUEST_1,m_elementUri));
  }
}
