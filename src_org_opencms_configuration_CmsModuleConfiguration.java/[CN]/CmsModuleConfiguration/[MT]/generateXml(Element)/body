{
  List modules;
  if (OpenCms.getRunLevel() > 1) {
    modules=new ArrayList();
    Iterator names=OpenCms.getModuleManager().getModuleNames().iterator();
    while (names.hasNext()) {
      modules.add(OpenCms.getModuleManager().getModule((String)names.next()));
    }
  }
 else {
    modules=m_modules;
  }
  Element modulesNode=parent.addElement(N_MODULES);
  for (int i=0; i < modules.size(); i++) {
    CmsModule module=(CmsModule)modules.get(i);
    Element moduleNode=CmsModuleXmlHandler.generateXml(module);
    modulesNode.add(moduleNode);
  }
  return modulesNode;
}
