{
  System.err.println("******");
  Enumeration enu=parameters.keys();
  while (enu.hasMoreElements()) {
    String key=(String)enu.nextElement();
    String values=(String)parameters.get(key);
    System.err.println(key + " : " + values);
  }
  System.err.println("-------");
  String template=null;
  String filename=null;
  String title=null;
  String keywords=null;
  String description=null;
  String foldername=null;
  String type=null;
  I_CmsSession session=cms.getRequestContext().getSession(true);
  String initial=(String)parameters.get(C_PARA_INITIAL);
  if (initial != null) {
    session.removeValue(C_PARA_FILE);
    session.removeValue(C_PARA_TITLE);
    session.removeValue(C_PARA_KEYWORDS);
    session.removeValue(C_PARA_DESCRIPTION);
    session.removeValue("lasturl");
  }
  String step=cms.getRequestContext().getRequest().getParameter("step");
  if (step != null) {
    if (step.equals("1")) {
      template="step1";
      filename=cms.getRequestContext().getRequest().getParameter(C_PARA_FILE);
      session.putValue(C_PARA_FILE,filename);
      title=cms.getRequestContext().getRequest().getParameter(C_PARA_TITLE);
      session.putValue(C_PARA_TITLE,title);
      keywords=(String)parameters.get(C_PARA_KEYWORDS);
      session.putValue(C_PARA_KEYWORDS,keywords);
      description=(String)parameters.get(C_PARA_DESCRIPTION);
      session.putValue(C_PARA_DESCRIPTION,description);
    }
 else {
      if (step.equals("2")) {
        foldername=(String)session.getValue(C_PARA_FILELIST);
        title=(String)session.getValue(C_PARA_TITLE);
        if (foldername == null) {
          foldername=cms.rootFolder().getAbsolutePath();
        }
        filename=(String)session.getValue(C_PARA_FILE);
        type=(String)cms.getRequestContext().getRequest().getParameter("type");
        keywords=(String)session.getValue(C_PARA_KEYWORDS);
        description=(String)session.getValue(C_PARA_DESCRIPTION);
        cms.createFile(foldername,filename,new byte[0],type);
        cms.lockResource(foldername + filename);
        cms.writeProperty(foldername + filename,C_PROPERTY_TITLE,title);
        cms.writeProperty(foldername + filename,C_PROPERTY_KEYWORDS,keywords);
        cms.writeProperty(foldername + filename,C_PROPERTY_DESCRIPTION,description);
        session.removeValue(C_PARA_FILE);
        session.removeValue(C_PARA_TITLE);
        session.removeValue(C_PARA_KEYWORDS);
        session.removeValue(C_PARA_DESCRIPTION);
        try {
          cms.getRequestContext().getResponse().sendCmsRedirect(getConfigFile(cms).getWorkplaceActionPath() + C_WP_EXPLORER_FILELIST);
        }
 catch (        Exception e) {
          throw new CmsException("Redirect fails :" + getConfigFile(cms).getWorkplaceActionPath() + C_WP_EXPLORER_FILELIST,CmsException.C_UNKNOWN_EXCEPTION,e);
        }
        return null;
      }
    }
  }
 else {
    session.removeValue(C_PARA_FILE);
  }
  CmsXmlWpTemplateFile xmlTemplateDocument=new CmsXmlWpTemplateFile(cms,templateFile);
  getResources(cms,null,null,null,null,null);
  if (m_names != null) {
    xmlTemplateDocument.setData(C_RADIOSIZE,new Integer(m_names.size()).toString());
  }
  return startProcessing(cms,xmlTemplateDocument,"",parameters,template);
}
