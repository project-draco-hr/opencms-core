{
  if (OpenCms.getLog(this).isDebugEnabled() && C_DEBUG) {
    OpenCms.getLog(this).debug("Getting content of element " + ((elementName == null) ? "<root>" : elementName));
    OpenCms.getLog(this).debug("Template file is: " + templateFile);
    OpenCms.getLog(this).debug("Selected template section is: " + ((templateSelector == null) ? "<default>" : templateSelector));
  }
  CmsXmlWpTemplateFile xmlTemplateDocument=new CmsXmlWpTemplateFile(cms,templateFile);
  I_CmsSession session=cms.getRequestContext().getSession(true);
  CmsXmlLanguageFile lang=xmlTemplateDocument.getLanguageFile();
  String action=(String)parameters.get("action");
  if ("showResult".equals(action)) {
    A_CmsReportThread doTheWork=(A_CmsReportThread)session.getValue(C_STATICEXPORT_THREAD);
    if (doTheWork.isAlive()) {
      xmlTemplateDocument.setData("endMethod","");
      xmlTemplateDocument.setData("text","");
    }
 else {
      xmlTemplateDocument.setData("endMethod",xmlTemplateDocument.getDataValue("endMethod"));
      xmlTemplateDocument.setData("autoUpdate","");
      xmlTemplateDocument.setData("text",lang.getLanguageValue("staticexport.label.exportend"));
    }
    xmlTemplateDocument.setData("data",doTheWork.getReportUpdate());
    return startProcessing(cms,xmlTemplateDocument,elementName,parameters,"updateReport");
  }
  if (action == null || "dynPrint".equals(action)) {
    Vector exportStartPoints=null;
    String allStartPoints="";
    if (exportStartPoints != null) {
      for (int i=0; i < exportStartPoints.size(); i++) {
        xmlTemplateDocument.setData("entry",(String)exportStartPoints.elementAt(i));
        allStartPoints+=xmlTemplateDocument.getProcessedDataValue("exportpoint");
      }
    }
    xmlTemplateDocument.setData("exportpoints",allStartPoints);
    xmlTemplateDocument.setData("path",OpenCms.getStaticExportManager().getExportPath());
  }
  if ((action != null) && ("regTest".equals(action))) {
    String sub=(String)parameters.get("sub");
    String link="";
    String regExpr="";
    String result="";
    if (sub != null && "true".equals(sub)) {
      link=(String)parameters.get("link");
      regExpr=(String)parameters.get("regExpr");
      try {
        Perl5Util subClass=new Perl5Util();
        result=subClass.substitute(regExpr,link);
      }
 catch (      Exception e) {
        result="error: " + e.getMessage();
      }
    }
    xmlTemplateDocument.setData("link",Encoder.escape(link,cms.getRequestContext().getEncoding()));
    xmlTemplateDocument.setData("regExpr",Encoder.escape(regExpr,cms.getRequestContext().getEncoding()));
    xmlTemplateDocument.setData("result",Encoder.escape(result,cms.getRequestContext().getEncoding()));
    return startProcessing(cms,xmlTemplateDocument,elementName,parameters,"regTest");
  }
  if ((action != null) && ("working".equals(action))) {
    A_CmsReportThread doTheWork=(A_CmsReportThread)session.getValue(C_STATICEXPORT_THREAD);
    if (doTheWork.isAlive()) {
      String time=(String)parameters.get("time");
      int wert=Integer.parseInt(time);
      wert+=20;
      xmlTemplateDocument.setData("time","" + wert);
      return startProcessing(cms,xmlTemplateDocument,elementName,parameters,"wait");
    }
 else {
      String errordetails=(String)session.getValue(C_SESSION_THREAD_ERROR);
      session.removeValue(C_SESSION_THREAD_ERROR);
      if (errordetails == null) {
        return startProcessing(cms,xmlTemplateDocument,elementName,parameters,"done");
      }
 else {
        xmlTemplateDocument.setData("details",errordetails);
        return startProcessing(cms,xmlTemplateDocument,elementName,parameters,"error");
      }
    }
  }
  if ("export".equals(action)) {
    if (session.getValue(C_SESSION_THREAD_ERROR) != null) {
      session.removeValue(C_SESSION_THREAD_ERROR);
    }
    A_CmsReportThread doExport=new CmsStaticExportThread(cms);
    doExport.start();
    session.putValue(C_STATICEXPORT_THREAD,doExport);
    xmlTemplateDocument.setData("time","10");
    templateSelector="showresult";
  }
  return startProcessing(cms,xmlTemplateDocument,elementName,parameters,templateSelector);
}
