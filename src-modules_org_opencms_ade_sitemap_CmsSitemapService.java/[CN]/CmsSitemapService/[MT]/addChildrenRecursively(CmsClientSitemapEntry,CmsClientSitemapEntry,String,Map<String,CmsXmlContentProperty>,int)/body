{
  CmsObject cms=getCmsObject();
  if (hasReferenceToSitemap(entry) && (entry != root)) {
    return;
  }
  List<CmsClientSitemapEntry> children=new ArrayList<CmsClientSitemapEntry>();
  for (  CmsSitemapEntry subEntry : OpenCms.getSitemapManager().getSubEntries(cms,entry.getSitePath())) {
    CmsInternalSitemapEntry internalEntry=(CmsInternalSitemapEntry)subEntry;
    CmsClientSitemapEntry child=toClientEntry(subEntry,propConfig);
    children.add(child);
    if (internalEntry.getSubEntries().isEmpty() || hasReferenceToSitemap(internalEntry)) {
      child.setChildrenLoadedInitially();
    }
    if ((depth > 1) || ((path != null) && path.startsWith(subEntry.getSitePath(cms)))) {
      addChildrenRecursively(child,root,path,propConfig,depth - 1);
    }
  }
  entry.setSubEntries(children);
}
