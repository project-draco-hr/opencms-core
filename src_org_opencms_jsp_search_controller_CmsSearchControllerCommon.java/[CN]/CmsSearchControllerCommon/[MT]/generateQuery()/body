{
  final StringBuffer query=new StringBuffer();
  if (!m_config.getIgnoreQueryParam()) {
    String queryString=m_state.getQuery().isEmpty() && m_config.getSearchForEmptyQueryParam() ? "*" : m_state.getQuery();
    query.append("&q=").append(m_config.getModifiedQuery(queryString));
  }
  if (m_config.getSolrIndex() != null) {
    query.append("&index=").append(m_config.getSolrIndex());
  }
  if (m_config.getSolrCore() != null) {
    query.append("&core=").append(m_config.getSolrCore());
  }
  if (!m_config.getExtraSolrParams().isEmpty()) {
    query.append('&').append(m_config.getExtraSolrParams());
  }
  for (  String additionalParam : m_state.getAdditionalParameters().keySet()) {
    query.append('&').append(resolveMacros(m_config.getAdditionalParameters().get(additionalParam),m_state.getAdditionalParameters().get(additionalParam)));
  }
  return query.toString();
}
