{
  String absolutePath=cms.readAbsolutePath(file);
  try {
    CmsXmlPage page=(CmsXmlPage)req.getAttribute(C_XMLPAGE_OBJECT);
    if (page == null) {
      page=CmsXmlPage.read(cms,cms.readFile(absolutePath));
    }
    String elementName=req.getParameter(C_TEMPLATE_ELEMENT);
    String localeName=OpenCms.getLocaleManager().getBestMatchingLocaleName(cms.getRequestContext().getLocaleName(),OpenCms.getLocaleManager().getDefaultLocaleNames(cms,absolutePath),page.getLanguages());
    byte[] result=page.getContent(cms,elementName,localeName).getBytes();
    if (result != null) {
      res.getOutputStream().write(result);
    }
  }
 catch (  CmsException e) {
    if (OpenCms.getLog(this).isErrorEnabled()) {
      OpenCms.getLog(this).error("Error in CmsXmlPageLoader while processing " + absolutePath,e);
    }
    throw new ServletException("Error in CmsXmlPageLoader while processing " + absolutePath,e);
  }
}
