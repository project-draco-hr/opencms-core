{
  String absolutePath=cms.readAbsolutePath(resource);
  CmsXmlPage page=(CmsXmlPage)req.getAttribute(absolutePath);
  if (page == null) {
    page=CmsXmlPage.read(cms,CmsFile.upgrade(resource,cms));
    req.setAttribute(absolutePath,page);
  }
  String elementName=req.getParameter(I_CmsConstants.C_PARAMETER_ELEMENT);
  Locale locale=OpenCms.getLocaleManager().getBestMatchingLocale(cms.getRequestContext().getLocale(),OpenCms.getLocaleManager().getDefaultLocales(cms,absolutePath),page.getLocales());
  byte[] result=page.getContent(cms,elementName,locale).getBytes(page.getEncoding());
  if (result != null) {
    res.getOutputStream().write(result);
  }
}
