{
  byte[] returnValue=byteContent;
  if (!filename.startsWith("/")) {
    filename="/" + filename;
  }
  String fileContent=new String(byteContent);
  String encoding=getEncoding(fileContent);
  if (!"".equals(encoding)) {
    try {
      fileContent=new String(byteContent,encoding);
    }
 catch (    UnsupportedEncodingException e) {
      if (C_DEBUG > 0) {
        System.err.println("[" + this.getClass().getName() + ".convertFile()]: Encoding not supported, using default encoding.");
      }
    }
  }
 else {
    if (C_DEBUG > 0) {
      System.err.println("[" + this.getClass().getName() + ".convertFile()]: Encoding not set, using default encoding and setting it in <?xml...?>.");
    }
    encoding=OpenCms.getDefaultEncoding();
    fileContent=setEncoding(fileContent,encoding);
  }
  if (filename.indexOf("frametemplates") != -1) {
    fileContent=scanFrameTemplate(fileContent);
  }
  fileContent=setDirectories(fileContent,m_cms.getRequestContext().getDirectoryTranslator().getTranslations());
  if (filename.indexOf(C_VFS_PATH_OLD_BODIES) != -1 || filename.indexOf(I_CmsWpConstants.C_VFS_PATH_BODIES) != -1) {
    if (C_DEBUG > 0) {
      System.err.println("[" + this.getClass().getName() + ".convertFile()]: Starting scan of body page.");
    }
    fileContent=convertPageBody(fileContent,filename);
  }
  try {
    returnValue=fileContent.getBytes(encoding);
  }
 catch (  UnsupportedEncodingException e) {
    returnValue=fileContent.getBytes();
  }
  return returnValue;
}
