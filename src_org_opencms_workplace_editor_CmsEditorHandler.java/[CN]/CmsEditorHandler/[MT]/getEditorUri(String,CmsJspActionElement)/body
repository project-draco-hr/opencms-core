{
  boolean editAsText=Boolean.valueOf(jsp.getRequest().getParameter(CmsEditor.PARAM_EDITASTEXT)).booleanValue();
  boolean loadDefault=Boolean.valueOf(jsp.getRequest().getParameter(CmsEditor.PARAM_LOADDEFAULT)).booleanValue();
  int resTypeId=-1;
  String resourceType="";
  if (editAsText) {
    resTypeId=CmsResourceTypePlain.C_RESOURCE_TYPE_ID;
  }
 else {
    try {
      CmsResource res=jsp.getCmsObject().readFileHeader(resource,CmsResourceFilter.ALL);
      resTypeId=res.getTypeId();
    }
 catch (    CmsException e) {
      return showErrorDialog(jsp,e);
    }
  }
  try {
    resourceType=OpenCms.getLoaderManager().getResourceType(resTypeId).getTypeName();
  }
 catch (  CmsException e) {
    return showErrorDialog(jsp,e);
  }
  String editorUri=null;
  String userAgent=jsp.getRequest().getHeader("user-agent");
  if (loadDefault) {
    editorUri=OpenCms.getWorkplaceManager().getWorkplaceEditorManager().getDefaultEditorUri(jsp.getRequestContext(),resourceType,userAgent);
  }
 else {
    editorUri=OpenCms.getWorkplaceManager().getWorkplaceEditorManager().getEditorUri(jsp.getRequestContext(),resourceType,userAgent);
  }
  try {
    jsp.getCmsObject().readFileHeader(editorUri);
  }
 catch (  Throwable t) {
    editorUri=OpenCms.getWorkplaceManager().getWorkplaceEditorManager().getDefaultEditorUri(jsp.getRequestContext(),resourceType,userAgent);
  }
  if (editorUri == null) {
    return showErrorDialog(jsp,null);
  }
  return editorUri;
}
