{
  boolean editAsText="true".equals(jsp.getRequest().getParameter(CmsEditor.PARAM_EDITASTEXT));
  boolean loadDefault="true".equals(jsp.getRequest().getParameter(CmsEditor.PARAM_LOADDEFAULT));
  int resTypeId=-1;
  String resourceType="";
  if (editAsText) {
    resTypeId=CmsResourceTypePlain.C_RESOURCE_TYPE_ID;
  }
 else {
    try {
      CmsResource res=jsp.getCmsObject().readFileHeader(resource,CmsResourceFilter.ALL);
      resTypeId=res.getType();
    }
 catch (    CmsException e) {
      return showErrorDialog(jsp,e);
    }
  }
  try {
    resourceType=jsp.getCmsObject().getResourceType(resTypeId).getResourceTypeName();
  }
 catch (  CmsException e) {
    return showErrorDialog(jsp,e);
  }
  String editorUri=null;
  String userAgent=jsp.getRequest().getHeader("user-agent");
  if (loadDefault) {
    editorUri=OpenCms.getWorkplaceManager().getWorkplaceEditorManager().getDefaultEditorUri(jsp.getRequestContext(),resourceType,userAgent);
  }
 else {
    editorUri=OpenCms.getWorkplaceManager().getWorkplaceEditorManager().getEditorUri(jsp.getRequestContext(),resourceType,userAgent);
  }
  try {
    jsp.getCmsObject().readFileHeader(editorUri);
  }
 catch (  CmsException e) {
    editorUri=OpenCms.getWorkplaceManager().getWorkplaceEditorManager().getDefaultEditorUri(jsp.getRequestContext(),resourceType,userAgent);
  }
  if (editorUri == null) {
    return showErrorDialog(jsp,null);
  }
  return editorUri;
}
