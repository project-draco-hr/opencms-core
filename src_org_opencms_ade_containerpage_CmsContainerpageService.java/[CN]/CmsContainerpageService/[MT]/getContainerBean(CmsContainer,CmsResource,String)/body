{
  CmsObject cms=getCmsObject();
  List<CmsContainerElementBean> elements=new ArrayList<CmsContainerElementBean>();
  for (  CmsContainerElement elementData : container.getElements()) {
    try {
      if (elementData.isNew()) {
        if (CmsResourceTypeXmlContainerPage.GROUP_CONTAINER_TYPE_NAME.equals(elementData.getResourceType())) {
          CmsGroupContainer groupContainer=new CmsGroupContainer();
          groupContainer.setNew(true);
          groupContainer.setElements(new ArrayList<CmsContainerElement>());
          Set<String> types=new HashSet<String>();
          types.add(container.getType());
          groupContainer.setTypes(types);
          CmsPair<CmsContainerElement,List<CmsRemovedElementStatus>> saveResult=internalSaveGroupContainer(cms,containerpage.getStructureId(),groupContainer,locale);
          elementData=saveResult.getFirst();
        }
 else {
          elementData=createNewElement(containerpage.getStructureId(),elementData.getClientId(),elementData.getResourceType(),null,locale);
        }
      }
      CmsContainerElementBean element=getCachedElement(elementData.getClientId());
      CmsResource resource=cms.readResource(element.getId(),CmsResourceFilter.IGNORE_EXPIRATION);
      int containerWidth=container.getWidth();
      CmsADEConfigData config=OpenCms.getADEManager().lookupConfiguration(cms,containerpage.getRootPath());
      CmsFormatterConfiguration formatters=config.getFormatters(cms,resource);
      String typeName=OpenCms.getResourceManager().getResourceType(resource).getTypeName();
      String containerType=null;
      if (CmsResourceTypeXmlContainerPage.GROUP_CONTAINER_TYPE_NAME.equals(typeName) || CmsResourceTypeXmlContainerPage.INHERIT_CONTAINER_TYPE_NAME.equals(typeName)) {
        containerType=CmsFormatterBean.PREVIEW_TYPE;
      }
 else {
        containerType=container.getType();
      }
      CmsFormatterBean formatter=formatters.getFormatter(containerType,containerWidth);
      if (formatter != null) {
        elements.add(new CmsContainerElementBean(element.getId(),formatter.getJspStructureId(),element.getIndividualSettings(),false));
      }
    }
 catch (    Exception e) {
      log(e.getLocalizedMessage(),e);
    }
  }
  CmsContainerBean result=new CmsContainerBean(container.getName(),container.getType(),elements);
  return result;
}
