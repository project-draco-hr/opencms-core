{
  for (  CmsContainer container : containers) {
    for (    CmsContainerElement element : container.getElements()) {
      try {
        CmsContainerElementBean elementBean=getCachedElement(element.getClientId(),containerpage.getRootPath());
        elementBean.initResource(getCmsObject());
        if (element.isContainerModel()) {
          try {
            CmsRelation relation=getContainerModelRelation(getCmsObject(),elementBean.getResource());
            if (relation == null) {
              setContainerModelRelation(getCmsObject(),containerpage,elementBean.getResource());
            }
          }
 catch (          CmsException e) {
            LOG.error(e.getLocalizedMessage(),e);
          }
        }
 else {
          CmsRelation relation=getContainerModelRelation(getCmsObject(),elementBean.getResource());
          if ((relation != null) && relation.getTargetId().equals(containerpage.getStructureId())) {
            removeContainerModelRelation(getCmsObject(),containerpage,elementBean.getResource());
          }
        }
      }
 catch (      Exception e) {
        LOG.error(e.getLocalizedMessage(),e);
      }
    }
  }
}
