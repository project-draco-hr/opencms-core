{
  try {
    CmsUUID structureId=new CmsUUID(clientId);
    CmsObject cms=OpenCms.initCmsObject(getCmsObject());
    CmsResource resource=cms.readResource(structureId,CmsResourceFilter.IGNORE_EXPIRATION);
    if (OpenCms.getResourceManager().matchResourceType(CmsResourceTypeImage.getStaticTypeName(),resource.getTypeId())) {
      CmsResource pageResource=cms.readResource(context.getPageStructureId());
      CmsADEConfigData configData=OpenCms.getADEManager().lookupConfiguration(cms,pageResource.getRootPath());
      CmsResourceTypeConfig resTypeConfig=configData.getResourceType(CmsGwtConstants.TYPE_XML_IMAGE);
      Locale locale=OpenCms.getLocaleManager().getDefaultLocale(cms,pageResource);
      cms.getRequestContext().setLocale(locale);
      CmsResource newResource=resTypeConfig.createNewElement(cms,pageResource.getRootPath());
      CmsFile file=cms.readFile(newResource);
      CmsXmlContent content=CmsXmlContentFactory.unmarshal(cms,file);
      content.getValue(XPATH_XMLIMAGE_IMAGE,locale).setStringValue(cms,cms.getSitePath(resource));
      String title=resource.getName();
      List<CmsProperty> propertyList=cms.readPropertyObjects(cms.getSitePath(resource),false);
      Map<String,CmsProperty> properties=CmsProperty.toObjectMap(propertyList);
      for (      String propName : Arrays.asList(CmsPropertyDefinition.PROPERTY_TITLE,CmsPropertyDefinition.PROPERTY_DESCRIPTION)) {
        CmsProperty currentProperty=properties.get(propName);
        if (currentProperty != null) {
          title=currentProperty.getValue();
          break;
        }
      }
      content.getValue(XPATH_XMLIMAGE_TITLE,locale).setStringValue(cms,title);
      byte[] newContentBytes=content.marshal();
      file.setContents(newContentBytes);
      cms.lockResource(file);
      cms.writeFile(file);
      cms.unlockResource(file);
      return "" + file.getStructureId();
    }
 else {
      return null;
    }
  }
 catch (  Exception e) {
    error(e);
    return null;
  }
}
