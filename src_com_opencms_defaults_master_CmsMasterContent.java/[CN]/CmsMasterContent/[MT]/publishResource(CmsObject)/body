{
  Vector changedResources=new Vector();
  Vector changedModuleData=new Vector();
  int versionId=0;
  long publishDate=System.currentTimeMillis();
  boolean historyEnabled=OpenCms.getSystemInfo().isVersionHistoryEnabled();
  try {
    if (historyEnabled) {
      versionId=cms.getBackupTagId();
      cms.backupProject(cms.getRequestContext().currentProject().getId(),versionId,publishDate);
    }
    getDbAccessObject(getSubId()).publishResource(cms,m_dataSet,getSubId(),this.getClass().getName(),historyEnabled,versionId,publishDate,changedResources,changedModuleData);
    if (CmsXmlTemplateLoader.isElementCacheEnabled()) {
      CmsXmlTemplateLoader.getOnlineElementCache().cleanupCache(changedResources,changedModuleData);
    }
  }
 catch (  Exception e) {
    throw e;
  }
 finally {
    CmsUUID publishId=new CmsUUID();
    cms.postPublishBoResource(new CmsPublishedResource(CmsUUID.getNullUUID(),m_dataSet.m_masterId,I_CmsConstants.C_UNKNOWN_ID,this.getClass().getName(),getSubId(),m_dataSet.m_state,1),publishId,versionId);
    Map eventData=new HashMap();
    eventData.put(I_CmsEventListener.KEY_PUBLISHID,publishId.toString());
    eventData.put(I_CmsEventListener.KEY_PROJECTID,new Integer(cms.getRequestContext().currentProject().getId()));
    OpenCms.fireCmsEvent(new CmsEvent(I_CmsEventListener.EVENT_PUBLISH_PROJECT,eventData));
  }
}
