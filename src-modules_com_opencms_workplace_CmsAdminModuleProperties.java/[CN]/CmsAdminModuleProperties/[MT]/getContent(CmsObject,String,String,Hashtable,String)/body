{
  if (OpenCms.getLog(this).isDebugEnabled() && C_DEBUG) {
    OpenCms.getLog(this).debug("Getting content of element " + ((elementName == null) ? "<root>" : elementName));
    OpenCms.getLog(this).debug("Template file is: " + templateFile);
    OpenCms.getLog(this).debug("Selected template section is: " + ((templateSelector == null) ? "<default>" : templateSelector));
  }
  CmsXmlTemplateFile xmlTemplateDocument=getOwnTemplateFile(cms,templateFile,elementName,parameters,templateSelector);
  I_CmsSession session=CmsXmlTemplateLoader.getSession(cms.getRequestContext(),true);
  String view=(String)parameters.get(C_VIEW);
  String module=(String)parameters.get(C_MODULENAME);
  if ((view != null) && (C_DESCRIPTION.equals(view))) {
    xmlTemplateDocument.setData("name",module);
    xmlTemplateDocument.setData("version","" + OpenCms.getModuleManager().getModule(module).getVersion());
    xmlTemplateDocument.setData("descriptiontext",OpenCms.getModuleManager().getModule(module).getDescription());
    xmlTemplateDocument.setData("author",OpenCms.getModuleManager().getModule(module).getAuthorName());
    xmlTemplateDocument.setData("email",OpenCms.getModuleManager().getModule(module).getAuthorEmail());
    xmlTemplateDocument.setData("createdate",CmsDateUtil.getDateTimeShort(OpenCms.getModuleManager().getModule(module).getDateCreated()));
    xmlTemplateDocument.setData("uploadfrom",OpenCms.getModuleManager().getModule(module).getUserInstalled());
    xmlTemplateDocument.setData("uploaddate",CmsDateUtil.getDateTimeShort(OpenCms.getModuleManager().getModule(module).getDateInstalled()));
    xmlTemplateDocument.setData("view","");
    xmlTemplateDocument.setData("documentation","");
    String dependences="";
    List moduleDependencies=OpenCms.getModuleManager().getModule(module).getDependencies();
    for (int i=0; i < moduleDependencies.size(); i++) {
      CmsModuleDependency dep=(CmsModuleDependency)moduleDependencies.get(i);
      dependences+=dep.getName() + "  " + dep.getVersion()+ " - "+ "*"+ "\n";
    }
    xmlTemplateDocument.setData("dependences",dependences);
    String outputRep="";
    xmlTemplateDocument.setData("repository",outputRep);
    templateSelector=C_DESCRIPTION;
  }
 else {
    if ((view != null) && (C_PARAMETER.equals(view))) {
      xmlTemplateDocument.setData("name",module);
      xmlTemplateDocument.setData("version","" + OpenCms.getModuleManager().getModule(module).getVersion());
      Map moduleParameters=OpenCms.getModuleManager().getModule(module).getParameters();
      String allParameter="";
      Iterator it=moduleParameters.keySet().iterator();
      while (it.hasNext()) {
        String key=(String)it.next();
        xmlTemplateDocument.setData("paraname",key);
        xmlTemplateDocument.setData("paravalue",(String)moduleParameters.get(key));
        allParameter+=xmlTemplateDocument.getProcessedDataValue("parameterentry");
      }
      xmlTemplateDocument.setData("allparameter",allParameter);
      templateSelector=C_PARAMETER;
    }
 else {
      if ((view != null) && (C_CHANGE_PARAMETER.equals(view))) {
        String parameter=(String)parameters.get("selectpara");
        String fromError=(String)parameters.get(C_FROMERRORPAGE);
        if (fromError != null) {
          module=(String)session.getValue(C_SESSION_MODULENAME);
          parameter=(String)session.getValue(C_SESSION_PARAMETER);
          session.removeValue(C_SESSION_MODULENAME);
          session.removeValue(C_SESSION_PARAMETER);
        }
        Map moduleParameters=OpenCms.getModuleManager().getModule(module).getParameters();
        xmlTemplateDocument.setData("name",module);
        xmlTemplateDocument.setData("version","" + OpenCms.getModuleManager().getModule(module).getVersion());
        xmlTemplateDocument.setData("paraname",parameter);
        xmlTemplateDocument.setData("paratext","");
        xmlTemplateDocument.setData("paratype","String");
        xmlTemplateDocument.setData("paravalue",(String)moduleParameters.get(parameter));
        templateSelector=C_CHANGE_PARAMETER;
      }
 else {
        if ((view != null) && (C_NEW_VALUE.equals(view))) {
          String parameter=(String)parameters.get("parameter");
          String value=(String)parameters.get("parawert");
          xmlTemplateDocument.setData("name",module);
          templateSelector="done";
          if (value != null) {
            CmsModule oldModule=OpenCms.getModuleManager().getModule(module);
            Map moduleParameters=new HashMap(oldModule.getParameters());
            moduleParameters.put(parameter,value);
            CmsModule updatedModule=new CmsModule(oldModule.getName(),oldModule.getNiceName(),oldModule.getGroup(),oldModule.getActionClass(),oldModule.getDescription(),oldModule.getVersion(),oldModule.getAuthorName(),oldModule.getAuthorEmail(),oldModule.getDateCreated(),oldModule.getUserInstalled(),oldModule.getDateInstalled(),oldModule.getDependencies(),oldModule.getExportPoints(),oldModule.getResources(),moduleParameters);
            updatedModule.setResourceTypes(oldModule.getResourceTypes());
            updatedModule.setExplorerTypes(oldModule.getExplorerTypes());
            OpenCms.getModuleManager().updateModule(cms,updatedModule);
          }
 else {
            session.putValue(C_SESSION_MODULENAME,module);
            session.putValue(C_SESSION_PARAMETER,parameter);
            templateSelector="error";
            xmlTemplateDocument.setData("paraname",parameter);
            xmlTemplateDocument.setData("DETAILS","");
          }
        }
      }
    }
  }
  return startProcessing(cms,xmlTemplateDocument,elementName,parameters,templateSelector);
}
