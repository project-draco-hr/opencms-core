{
  getJsp().getRequest().setAttribute(C_SESSION_WORKPLACE_CLASS,this);
switch (getAction()) {
case ACTION_REPORT_END:
    actionCloseDialog();
  break;
case ACTION_REPORT_UPDATE:
setParamAction(REPORT_UPDATE);
getJsp().include(C_FILE_REPORT_OUTPUT);
break;
case ACTION_REPORT_BEGIN:
case ACTION_CONFIRMED:
default :
try {
CmsResource publishResource=null;
if ("true".equalsIgnoreCase(getParamDirectpublish())) {
publishResource=getCms().readFileHeader(getParamResource(),true);
org.opencms.lock.CmsLock lock=getCms().getLock(publishResource);
if (!lock.isNullLock()) {
getCms().unlockResource(getParamResource(),false);
}
}
if (showUnlockConfirmation()) {
if ("true".equals(getParamDirectpublish())) {
String folderName=getParamResource();
if (!folderName.endsWith("/")) {
  folderName+="/";
}
getCms().lockResource(folderName);
getCms().unlockResource(folderName,false);
}
 else {
getCms().unlockProject(Integer.parseInt(getParamProjectid()));
}
}
CmsHtmlLinkValidatorThread thread=new CmsHtmlLinkValidatorThread(getCms(),publishResource,"true".equals(getParamPublishsiblings()),getSettings());
setParamAction(REPORT_BEGIN);
setParamThread(thread.getId().toString());
setParamThreadHasNext("true");
setParamReportContinueKey("label.button.continue.brokenlinks");
getJsp().include(C_FILE_REPORT_OUTPUT);
}
 catch (CmsException e) {
setParamErrorstack(e.getStackTraceAsString());
setParamMessage(key("error.message.projectlockchange"));
setParamReasonSuggestion(key("error.reason.projectlockchange") + "<br>\n" + key("error.suggestion.projectlockchange"));
getJsp().include(C_FILE_DIALOG_SCREEN_ERROR);
}
}
}
