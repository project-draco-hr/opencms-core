{
  getJsp().getRequest().setAttribute(C_SESSION_WORKPLACE_CLASS,this);
switch (getAction()) {
case ACTION_REPORT_UPDATE:
    setParamAction(REPORT_UPDATE);
  getJsp().include(C_FILE_REPORT_OUTPUT);
break;
case ACTION_REPORT_BEGIN:
case ACTION_CONFIRMED:
default :
try {
if ("true".equals(getParamDirectpublish())) {
  org.opencms.lock.CmsLock lock=getCms().getLock(getParamResource());
  if (!lock.isNullLock()) {
    getCms().unlockResource(getParamResource(),false);
  }
}
if (showUnlockConfirmation()) {
  if ("true".equals(getParamDirectpublish())) {
    String folderName=getParamResource();
    if (!folderName.endsWith("/")) {
      folderName+="/";
    }
    getCms().lockResource(folderName);
    getCms().unlockResource(folderName,false);
  }
 else {
    getCms().unlockProject(Integer.parseInt(getParamProjectid()));
  }
}
}
 catch (CmsException e) {
setParamErrorstack(e.getStackTraceAsString());
setParamMessage(key("error.message.projectlockchange"));
setParamReasonSuggestion(key("error.reason.projectlockchange") + "<br>\n" + key("error.suggestion.projectlockchange"));
getJsp().include(C_FILE_DIALOG_SCREEN_ERROR);
}
CmsPublishThread thread=null;
if ("true".equals(getParamDirectpublish())) {
thread=new CmsPublishThread(getCms(),getParamResource(),"true".equals(getParamPublishsiblings()));
}
 else {
try {
int projectId=Integer.parseInt(getParamProjectid());
getCms().getRequestContext().setCurrentProject(projectId);
}
 catch (Exception e) {
}
thread=new CmsPublishThread(getCms());
}
thread.start();
setParamAction(REPORT_BEGIN);
setParamThread(thread.getId().toString());
getJsp().include(C_FILE_REPORT_OUTPUT);
break;
}
}
