{
  if (OpenCms.getLog(this).isDebugEnabled() && C_DEBUG) {
    OpenCms.getLog(this).debug("Getting content of element " + ((elementName == null) ? "<root>" : elementName));
    OpenCms.getLog(this).debug("Template file is: " + templateFile);
    OpenCms.getLog(this).debug("Selected template section is: " + ((templateSelector == null) ? "<default>" : templateSelector));
  }
  CmsXmlWpTemplateFile xmlTemplateDocument=(CmsXmlWpTemplateFile)getOwnTemplateFile(cms,templateFile,elementName,parameters,templateSelector);
  String paraAcceptation="checked";
  String paraAll="checked";
  String paraCompletion="checked";
  String paraDelivery="checked";
  CmsUserSettings settings=new CmsUserSettings(cms.getRequestContext().currentUser());
  int messageAt=settings.getTaskMessageValue();
  if ((messageAt & C_TASK_MESSAGES_ACCEPTED) != C_TASK_MESSAGES_ACCEPTED) {
    paraAcceptation="";
  }
  if ((messageAt & C_TASK_MESSAGES_COMPLETED) != C_TASK_MESSAGES_COMPLETED) {
    paraCompletion="";
  }
  if ((messageAt & C_TASK_MESSAGES_FORWARDED) != C_TASK_MESSAGES_FORWARDED) {
    paraDelivery="";
  }
  if ((messageAt & C_TASK_MESSAGES_MEMBERS) != C_TASK_MESSAGES_MEMBERS) {
    paraAll="";
  }
  xmlTemplateDocument.setData(C_TASKPARA_ACCEPTATION,paraAcceptation);
  xmlTemplateDocument.setData(C_TASKPARA_ALL,paraAll);
  xmlTemplateDocument.setData(C_TASKPARA_COMPLETION,paraCompletion);
  xmlTemplateDocument.setData(C_TASKPARA_DELIVERY,paraDelivery);
  if (C_ROLE == null) {
    initConstants(xmlTemplateDocument);
  }
  if (parameters.get("ok") != null) {
    try {
      CmsTaskAction.create(cms,(String)parameters.get("USER"),(String)parameters.get("TEAM"),(String)parameters.get("TASKNAME"),(String)parameters.get("DESCRIPTION"),(String)parameters.get("DATE"),(String)parameters.get("PRIO"),(String)parameters.get("MSG_ACCEPTATION"),(String)parameters.get("MSG_ALL"),(String)parameters.get("MSG_COMPLETION"),(String)parameters.get("MSG_DELIVERY"));
      templateSelector="done";
    }
 catch (    Exception exc) {
      if (OpenCms.getLog(this).isWarnEnabled()) {
        OpenCms.getLog(this).warn("Could not create task",exc);
      }
      xmlTemplateDocument.setData("details",CmsException.getStackTraceAsString(exc));
      templateSelector="error";
    }
  }
  return startProcessing(cms,xmlTemplateDocument,elementName,parameters,templateSelector);
}
