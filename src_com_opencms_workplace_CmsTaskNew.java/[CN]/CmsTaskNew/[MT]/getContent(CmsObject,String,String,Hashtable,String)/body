{
  if (OpenCms.isLogging(CmsLog.CHANNEL_WORKPLACE_XML,CmsLog.LEVEL_WARN) && C_DEBUG) {
    OpenCms.log(CmsLog.CHANNEL_WORKPLACE_XML,CmsLog.LEVEL_WARN,this.getClassName() + "getting content of element " + ((elementName == null) ? "<root>" : elementName));
    OpenCms.log(CmsLog.CHANNEL_WORKPLACE_XML,CmsLog.LEVEL_WARN,this.getClassName() + "template file is: " + templateFile);
    OpenCms.log(CmsLog.CHANNEL_WORKPLACE_XML,CmsLog.LEVEL_WARN,this.getClassName() + "selected template section is: " + ((templateSelector == null) ? "<default>" : templateSelector));
  }
  CmsXmlWpTemplateFile xmlTemplateDocument=(CmsXmlWpTemplateFile)getOwnTemplateFile(cms,templateFile,elementName,parameters,templateSelector);
  String paraAcceptation="checked";
  String paraAll="checked";
  String paraCompletion="checked";
  String paraDelivery="checked";
  Hashtable taskSettings=(Hashtable)(cms.getRequestContext().currentUser().getAdditionalInfo()).get(C_ADDITIONAL_INFO_TASKSETTINGS);
  if (taskSettings != null) {
    int messageAt=((Integer)taskSettings.get(C_TASK_MESSAGES)).intValue();
    if ((messageAt & C_TASK_MESSAGES_ACCEPTED) != C_TASK_MESSAGES_ACCEPTED) {
      paraAcceptation="";
    }
    if ((messageAt & C_TASK_MESSAGES_COMPLETED) != C_TASK_MESSAGES_COMPLETED) {
      paraCompletion="";
    }
    if ((messageAt & C_TASK_MESSAGES_FORWARDED) != C_TASK_MESSAGES_FORWARDED) {
      paraDelivery="";
    }
    if ((messageAt & C_TASK_MESSAGES_MEMBERS) != C_TASK_MESSAGES_MEMBERS) {
      paraAll="";
    }
  }
  xmlTemplateDocument.setData(C_TASKPARA_ACCEPTATION,paraAcceptation);
  xmlTemplateDocument.setData(C_TASKPARA_ALL,paraAll);
  xmlTemplateDocument.setData(C_TASKPARA_COMPLETION,paraCompletion);
  xmlTemplateDocument.setData(C_TASKPARA_DELIVERY,paraDelivery);
  if (C_ROLE == null) {
    initConstants(xmlTemplateDocument);
  }
  if (parameters.get("ok") != null) {
    try {
      CmsTaskAction.create(cms,(String)parameters.get("USER"),(String)parameters.get("TEAM"),(String)parameters.get("TASKNAME"),(String)parameters.get("DESCRIPTION"),(String)parameters.get("DATE"),(String)parameters.get("PRIO"),(String)parameters.get("MSG_ACCEPTATION"),(String)parameters.get("MSG_ALL"),(String)parameters.get("MSG_COMPLETION"),(String)parameters.get("MSG_DELIVERY"));
      templateSelector="done";
    }
 catch (    Exception exc) {
      if (OpenCms.isLogging(CmsLog.CHANNEL_MODULE,CmsLog.LEVEL_WARN)) {
        OpenCms.log(CmsLog.CHANNEL_MODULE,CmsLog.LEVEL_WARN,"Could not create task. " + exc.getMessage());
      }
      xmlTemplateDocument.setData("details",Utils.getStackTrace(exc));
      templateSelector="error";
    }
  }
  return startProcessing(cms,xmlTemplateDocument,elementName,parameters,templateSelector);
}
