{
  CmsPopup popup=new CmsPopup(650);
  popup.setGlassEnabled(true);
  popup.catchNotifications();
  SimplePanel container=new SimplePanel();
  CmsGalleryDialog galleryDialog=new CmsGalleryDialog(null,popup);
  new CmsGalleryController(new CmsGalleryControllerHandler(galleryDialog),GalleryMode.widget,referencePath,galleryPath,currentElement,resourceTypes,galleryTypes,useFormats,imageFormats,imageFormatNames);
  galleryDialog.setWidgetHandler(handler);
  container.setWidget(galleryDialog);
  popup.setMainContent(container);
  popup.addDialogClose(null);
  return popup;
}
