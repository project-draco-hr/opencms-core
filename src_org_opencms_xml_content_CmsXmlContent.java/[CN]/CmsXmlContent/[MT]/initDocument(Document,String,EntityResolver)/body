{
  m_document=document;
  m_encoding=CmsEncoder.lookupEncoding(encoding,encoding);
  m_elementLocales=new HashMap();
  m_elementNames=new HashMap();
  if (resolver != null) {
    m_contentDefinition=getContentDefinition(resolver);
  }
  for (Iterator i=m_document.getRootElement().elementIterator(); i.hasNext(); ) {
    Element node=(Element)i.next();
    try {
      Locale locale=CmsLocaleManager.getLocale(node.attribute(CmsXmlContentDefinition.XSD_ATTRIBUTE_VALUE_LANGUAGE).getValue());
      for (Iterator j=node.elementIterator(); j.hasNext(); ) {
        Element element=(Element)j.next();
        String name=element.getName();
        int pos=0;
        List list=getBookmark(name,locale);
        if (list != null) {
          pos=list.size();
        }
        I_CmsXmlSchemaType schemaType=m_contentDefinition.getSchemaType(name);
        I_CmsXmlContentValue value=schemaType.createValue(element,name,pos);
        addBookmark(name,locale,true,value);
      }
    }
 catch (    NullPointerException e) {
      OpenCms.getLog(this).error("Error while initalizing XML content bookmarks",e);
    }
  }
}
