{
  int todo=0;
  Element parentElement=getLocaleNode(locale);
  I_CmsXmlSchemaType type=m_contentDefinition.getSchemaType(name);
  List values=getValues(name,locale);
  int insertIndex;
  if (values.size() > 0) {
    if (values.size() >= type.getMaxOccurs()) {
      throw new RuntimeException("Element '" + name + "' can occur at maximum "+ type.getMaxOccurs()+ " times");
    }
    Iterator i=parentElement.content().iterator();
    int pos=0;
    int foundCount=0;
    while (i.hasNext()) {
      pos++;
      Node node=(Node)i.next();
      if (node instanceof Element) {
        if (node.getName().equals(name)) {
          foundCount++;
          if (foundCount >= index) {
            if (index == 0) {
              pos--;
            }
            break;
          }
        }
      }
    }
    insertIndex=pos;
  }
 else {
    int typeIndex=m_contentDefinition.getTypeSequence().indexOf(type);
    if (typeIndex == 0) {
      insertIndex=0;
    }
 else {
      List previousTypeNames=new ArrayList();
      for (int i=0; i < typeIndex; i++) {
        I_CmsXmlSchemaType t=(I_CmsXmlSchemaType)m_contentDefinition.getTypeSequence().get(i);
        previousTypeNames.add(t.getElementName());
      }
      Iterator i=parentElement.content().iterator();
      int pos=0;
      while (i.hasNext()) {
        Node node=(Node)i.next();
        if (node instanceof Element) {
          if (!previousTypeNames.contains(node.getName())) {
            break;
          }
        }
        pos++;
      }
      insertIndex=pos;
    }
  }
  I_CmsXmlContentValue newValue=addValue(parentElement,type,insertIndex,index);
  initDocument(m_document,m_encoding,m_contentDefinition);
  return newValue;
}
