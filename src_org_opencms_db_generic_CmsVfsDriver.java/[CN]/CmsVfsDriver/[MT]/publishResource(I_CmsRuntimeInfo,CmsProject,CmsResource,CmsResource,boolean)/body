{
  Connection conn=null;
  PreparedStatement stmt=null;
  int resourceSize=offlineResource.getLength();
  String resourcePath=removeTrailingSeparator(offlineResource.getRootPath());
  try {
    conn=m_sqlManager.getConnection(runtimeInfo,onlineProject);
    if (validateResourceIdExists(runtimeInfo,onlineProject.getId(),offlineResource.getResourceId())) {
      if (writeFileContent && offlineResource.isFile()) {
        writeContent(runtimeInfo,onlineProject,offlineResource.getResourceId(),((CmsFile)offlineResource).getContents());
      }
      stmt=m_sqlManager.getPreparedStatement(conn,onlineProject,"C_RESOURCES_UPDATE_RESOURCES");
      stmt.setInt(1,offlineResource.getTypeId());
      stmt.setInt(2,offlineResource.getFlags());
      stmt.setLong(3,offlineResource.getDateLastModified());
      stmt.setString(4,offlineResource.getUserLastModified().toString());
      stmt.setInt(5,I_CmsConstants.C_STATE_UNCHANGED);
      stmt.setInt(6,resourceSize);
      stmt.setInt(7,offlineResource.getProjectLastModified());
      stmt.setInt(8,this.internalCountSiblings(runtimeInfo,onlineProject.getId(),onlineResource.getResourceId()));
      stmt.setString(9,offlineResource.getResourceId().toString());
      stmt.executeUpdate();
      m_sqlManager.closeAll(null,null,stmt,null);
      String parentId=internalReadParentId(runtimeInfo,onlineProject.getId(),resourcePath);
      stmt=m_sqlManager.getPreparedStatement(conn,onlineProject,"C_RESOURCES_UPDATE_STRUCTURE");
      stmt.setString(1,offlineResource.getResourceId().toString());
      stmt.setString(2,resourcePath);
      stmt.setInt(3,I_CmsConstants.C_STATE_UNCHANGED);
      stmt.setLong(4,offlineResource.getDateReleased());
      stmt.setLong(5,offlineResource.getDateExpired());
      stmt.setString(6,parentId);
      stmt.setString(7,offlineResource.getStructureId().toString());
      stmt.executeUpdate();
    }
 else {
      if (writeFileContent && offlineResource.isFile()) {
        resourceSize=offlineResource.getLength();
        createContent(runtimeInfo,onlineProject,offlineResource.getResourceId(),((CmsFile)offlineResource).getContents(),0);
      }
      stmt=m_sqlManager.getPreparedStatement(conn,onlineProject,"C_RESOURCES_WRITE");
      stmt.setString(1,offlineResource.getResourceId().toString());
      stmt.setInt(2,offlineResource.getTypeId());
      stmt.setInt(3,offlineResource.getFlags());
      stmt.setLong(4,offlineResource.getDateCreated());
      stmt.setString(5,offlineResource.getUserCreated().toString());
      stmt.setLong(6,offlineResource.getDateLastModified());
      stmt.setString(7,offlineResource.getUserLastModified().toString());
      stmt.setInt(8,I_CmsConstants.C_STATE_UNCHANGED);
      stmt.setInt(9,resourceSize);
      stmt.setInt(10,offlineResource.getProjectLastModified());
      stmt.setInt(11,1);
      stmt.executeUpdate();
      m_sqlManager.closeAll(null,null,stmt,null);
      String parentId=internalReadParentId(runtimeInfo,onlineProject.getId(),resourcePath);
      stmt=m_sqlManager.getPreparedStatement(conn,onlineProject,"C_STRUCTURE_WRITE");
      stmt.setString(1,offlineResource.getStructureId().toString());
      stmt.setString(2,offlineResource.getResourceId().toString());
      stmt.setString(3,resourcePath);
      stmt.setInt(4,I_CmsConstants.C_STATE_UNCHANGED);
      stmt.setLong(5,offlineResource.getDateReleased());
      stmt.setLong(6,offlineResource.getDateExpired());
      stmt.setString(7,parentId);
      stmt.executeUpdate();
    }
  }
 catch (  SQLException e) {
    throw m_sqlManager.getCmsException(this,null,CmsException.C_SQL_ERROR,e,false);
  }
 finally {
    m_sqlManager.closeAll(runtimeInfo,conn,stmt,null);
  }
}
