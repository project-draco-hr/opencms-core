{
  PreparedStatement stmt=null;
  Connection conn=null;
  try {
    conn=m_sqlManager.getConnection(project);
    if (!existsResourceId(project.getId(),resource.getResourceId())) {
      stmt=m_sqlManager.getPreparedStatement(conn,project,"C_RESOURCES_WRITE");
      stmt.setString(1,resource.getResourceId().toString());
      stmt.setInt(2,resource.getType());
      stmt.setInt(3,resource.getFlags());
      stmt.setString(4,resource.getFileId().toString());
      stmt.setInt(5,resource.getLoaderId());
      stmt.setTimestamp(6,new Timestamp(resource.getDateCreated()));
      stmt.setString(7,resource.getUserCreated().toString());
      stmt.setTimestamp(8,new Timestamp(resource.getDateLastModified()));
      stmt.setString(9,resource.getUserLastModified().toString());
      stmt.setInt(10,resource.getState());
      stmt.setInt(11,content.length);
      stmt.setString(12,CmsUUID.getNullUUID().toString());
      stmt.setInt(13,project.getId());
      stmt.setInt(14,1);
      stmt.executeUpdate();
      createFileContent(resource.getFileId(),content,0,project.getId(),false);
    }
 else {
      stmt=m_sqlManager.getPreparedStatement(conn,project,"C_RESOURCES_UPDATE_RESOURCES");
      stmt.setInt(1,resource.getType());
      stmt.setInt(2,resource.getFlags());
      stmt.setInt(3,resource.getLoaderId());
      stmt.setTimestamp(4,new Timestamp(resource.getDateLastModified()));
      stmt.setString(5,resource.getUserLastModified().toString());
      stmt.setInt(6,resource.getState());
      stmt.setInt(7,content.length);
      stmt.setString(8,resource.getFileId().toString());
      stmt.setString(9,CmsUUID.getNullUUID().toString());
      stmt.setInt(10,project.getId());
      stmt.setInt(11,countVfsLinks(project.getId(),resource.getResourceId()));
      stmt.setString(12,resource.getResourceId().toString());
      stmt.executeUpdate();
      writeFileContent(resource.getFileId(),content,project.getId(),false);
    }
    m_sqlManager.closeAll(null,stmt,null);
    stmt=m_sqlManager.getPreparedStatement(conn,project,"C_RESOURCES_UPDATE_STRUCTURE");
    stmt.setString(1,oldResource.getParentId().toString());
    stmt.setString(2,resource.getResourceId().toString());
    stmt.setString(3,resource.getResourceName());
    stmt.setInt(4,resource.getState());
    stmt.setString(5,oldResource.getId().toString());
    stmt.executeUpdate();
  }
 catch (  SQLException e) {
    throw m_sqlManager.getCmsException(this,null,CmsException.C_SQL_ERROR,e,false);
  }
 finally {
    m_sqlManager.closeAll(conn,stmt,null);
  }
}
