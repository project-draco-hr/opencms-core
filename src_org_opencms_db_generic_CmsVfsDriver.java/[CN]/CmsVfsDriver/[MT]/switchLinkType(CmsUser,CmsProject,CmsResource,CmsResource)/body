{
  PreparedStatement stmt=null;
  Connection conn=null;
  int state=-1;
  try {
    conn=m_sqlManager.getConnection(currentProject);
    if (softLink != null) {
      state=softLink.getState() == I_CmsConstants.C_STATE_UNCHANGED ? I_CmsConstants.C_STATE_CHANGED : softLink.getState();
      stmt=m_sqlManager.getPreparedStatement(conn,currentProject,"C_RESOURCES_CHANGE_LINK_TYPE");
      stmt.setInt(1,I_CmsConstants.C_VFS_LINK_TYPE_MASTER);
      stmt.setInt(2,state);
      stmt.setTimestamp(3,new Timestamp(System.currentTimeMillis()));
      stmt.setString(4,currentUser.getId().toString());
      stmt.setString(5,softLink.getId().toString());
      stmt.executeUpdate();
    }
    if (hardLink != null) {
      m_sqlManager.closeAll(null,stmt,null);
      stmt=m_sqlManager.getPreparedStatement(conn,currentProject,"C_RESOURCES_CHANGE_LINK_TYPE");
      state=hardLink.getState() == I_CmsConstants.C_STATE_UNCHANGED ? I_CmsConstants.C_STATE_CHANGED : hardLink.getState();
      stmt.setInt(1,I_CmsConstants.C_VFS_LINK_TYPE_SLAVE);
      stmt.setInt(2,state);
      stmt.setTimestamp(3,new Timestamp(System.currentTimeMillis()));
      stmt.setString(4,currentUser.getId().toString());
      stmt.setString(5,hardLink.getId().toString());
      stmt.executeUpdate();
    }
  }
 catch (  SQLException e) {
    throw m_sqlManager.getCmsException(this,null,CmsException.C_SQL_ERROR,e,false);
  }
catch (  Exception exc) {
    throw new CmsException("switchLinkType" + exc.getMessage(),CmsException.C_UNKNOWN_EXCEPTION,exc);
  }
 finally {
    m_sqlManager.closeAll(conn,stmt,null);
  }
}
