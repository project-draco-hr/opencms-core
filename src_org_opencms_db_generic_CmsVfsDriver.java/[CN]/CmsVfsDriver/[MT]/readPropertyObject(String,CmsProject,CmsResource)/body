{
  ResultSet res=null;
  PreparedStatement stmt=null;
  Connection conn=null;
  String propertyValue=null;
  int mappingType=-1;
  CmsProperty property=null;
  int resultSize=0;
  String resourceName=resource.getRootPath();
  if ((resource.isFolder()) && (!resourceName.endsWith(I_CmsConstants.C_FOLDER_SEPARATOR))) {
    resourceName+=I_CmsConstants.C_FOLDER_SEPARATOR;
  }
  try {
    conn=m_sqlManager.getConnection(project.getId());
    stmt=m_sqlManager.getPreparedStatement(conn,project.getId(),"C_PROPERTIES_READ");
    stmt.setString(1,key);
    stmt.setInt(2,resource.getType());
    stmt.setString(3,resource.getStructureId().toString());
    stmt.setString(4,resource.getResourceId().toString());
    res=stmt.executeQuery();
    while (res.next()) {
      if (resultSize >= 2) {
        throw new CmsException("Properties for resource " + resource.getRootPath() + " are inconsitent! A resource may have set max. two property values, one mapped to it's structure and one mapped to it's resource record.",CmsException.C_UNKNOWN_EXCEPTION);
      }
      if (property == null) {
        property=new CmsProperty();
        property.setKey(key);
      }
      propertyValue=res.getString(1);
      mappingType=res.getInt(2);
      if (mappingType == CmsProperty.C_STRUCTURE_RECORD_MAPPING) {
        property.setStructureValue(propertyValue);
        property.setStructureId(resource.getStructureId());
      }
 else       if (mappingType == CmsProperty.C_RESOURCE_RECORD_MAPPING) {
        property.setResourceValue(propertyValue);
        property.setResourceId(resource.getResourceId());
      }
 else {
        throw new CmsException("Unknown property value mapping type found: " + mappingType,CmsException.C_UNKNOWN_EXCEPTION);
      }
      resultSize++;
    }
  }
 catch (  SQLException exc) {
    throw m_sqlManager.getCmsException(this,null,CmsException.C_SQL_ERROR,exc,false);
  }
 finally {
    m_sqlManager.closeAll(conn,stmt,res);
  }
  return (property != null) ? property : CmsProperty.getNullProperty();
}
