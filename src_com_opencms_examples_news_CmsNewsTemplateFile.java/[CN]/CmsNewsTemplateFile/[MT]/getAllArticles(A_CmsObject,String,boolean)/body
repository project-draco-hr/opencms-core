{
  Vector allFiles=null;
  try {
    allFiles=cms.getFilesInFolder(folder);
  }
 catch (  Exception e) {
    if (A_OpenCms.isLogging()) {
      A_OpenCms.log(C_OPENCMS_CRITICAL,"[CmsNewsTemplateFile] " + e);
    }
    allFiles=null;
  }
  if (allFiles == null) {
    String errorMessage="Could not read news article files in folder " + folder;
    if (A_OpenCms.isLogging()) {
      A_OpenCms.log(C_OPENCMS_CRITICAL,"[CmsNewsTemplateFile] " + errorMessage);
    }
    throw new CmsException(errorMessage);
  }
  int numFiles=allFiles.size();
  Vector selectedFiles=new Vector();
  for (int i=0; i < numFiles; i++) {
    A_CmsResource fileHeader=(A_CmsResource)allFiles.elementAt(i);
    if (fileHeader.getState() != CmsFile.C_STATE_DELETED) {
      selectedFiles.addElement(fileHeader);
    }
  }
  Vector sortedFiles=Utils.sort(cms,selectedFiles,Utils.C_SORT_NAME_DOWN);
  Vector listFiles=new Vector();
  numFiles=sortedFiles.size();
  for (int i=0; i < numFiles; i++) {
    CmsNewsTemplateFile newsDoc=new CmsNewsTemplateFile();
    CmsFile fileHeader=(CmsFile)sortedFiles.elementAt(i);
    CmsFile file=cms.readFile(fileHeader.getAbsolutePath());
    newsDoc.init(cms,file);
    if (showInactive || newsDoc.isNewsActive()) {
      listFiles.addElement(newsDoc);
    }
  }
  return listFiles;
}
