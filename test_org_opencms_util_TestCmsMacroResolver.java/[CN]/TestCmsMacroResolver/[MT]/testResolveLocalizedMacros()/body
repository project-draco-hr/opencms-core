{
  CmsMacroResolver resolver=CmsMacroResolver.newInstance();
  CmsMessages messages=new CmsMessages(org.opencms.xml.content.Messages.get().getBundleName(),Locale.ENGLISH);
  resolver.setMessages(messages);
  resolver.addMacro("onesecond","This is the final result");
  resolver.addMacro("twofirst","second");
  resolver.addMacro("three","first");
  String value1, value2;
  String keyName;
  keyName=org.opencms.xml.content.Messages.GUI_EDITOR_XMLCONTENT_VALIDATION_ERROR_2;
  value1=messages.key(keyName);
  value2=resolver.resolveMacros("${key." + keyName + "}");
  assertEquals("Invalid value \"{0}\" according to rule {1}",value1);
  assertEquals(value1,value2);
  value1=messages.key(keyName,new Object[]{"'value'","'rule'"});
  value2=resolver.resolveMacros("${key." + keyName + "|'value'|'rule'}");
  assertEquals("Invalid value \"'value'\" according to rule 'rule'",value1);
  assertEquals(value1,value2);
  value1=messages.key(keyName,new Object[]{"This is the final result","second"});
  value2=resolver.resolveMacros("${key." + keyName + "|${one${two${three}}}|${two${three}}}");
  assertEquals("Invalid value \"This is the final result\" according to rule second",value1);
  assertEquals(value1,value2);
  keyName=org.opencms.xml.content.Messages.GUI_EDITOR_XMLCONTENT_VALIDATION_WARNING_2;
  value1=messages.key(keyName);
  value2=resolver.resolveMacros("${key." + keyName + "}");
  assertEquals("Bad value \"{0}\" according to rule {1}",value1);
  assertEquals(value1,value2);
  value1=messages.key(keyName,new Object[]{"some value","the rule"});
  value2=resolver.resolveMacros("${key." + keyName + "|some value|the rule}");
  assertEquals("Bad value \"some value\" according to rule the rule",value1);
  assertEquals(value1,value2);
  value1=messages.key(keyName,new Object[]{"This is the final result","second"});
  value2=resolver.resolveMacros("${key." + keyName + "|${one${two${three}}}|${two${three}}}");
  assertEquals("Bad value \"This is the final result\" according to rule second",value1);
  assertEquals(value1,value2);
}
