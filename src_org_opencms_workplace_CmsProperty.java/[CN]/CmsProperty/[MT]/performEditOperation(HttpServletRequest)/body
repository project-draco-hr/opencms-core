{
  Vector propertyDef=getPropertyDefinitions();
  Map activeProperties=getCms().readProperties(getParamResource());
  boolean lockChecked=false;
  for (int i=0; i < propertyDef.size(); i++) {
    CmsPropertydefinition curProperty=(CmsPropertydefinition)propertyDef.elementAt(i);
    String propName=Encoder.escapeXml(curProperty.getName());
    String paramValue=request.getParameter(PREFIX_VALUE + propName);
    boolean emptyParam=true;
    if (paramValue != null) {
      if (!"".equals(paramValue.trim())) {
        emptyParam=false;
      }
    }
    if (emptyParam) {
      if (activeProperties.containsKey(curProperty.getName())) {
        if (!lockChecked) {
          checkLock(getParamResource());
          lockChecked=true;
        }
        getCms().deleteProperty(getParamResource(),curProperty.getName());
      }
    }
 else {
      String oldValue=request.getParameter(PREFIX_HIDDEN + propName);
      if (!paramValue.equals(oldValue)) {
        if (!lockChecked) {
          checkLock(getParamResource());
          lockChecked=true;
        }
        getCms().writeProperty(getParamResource(),curProperty.getName(),paramValue);
      }
    }
  }
  return true;
}
