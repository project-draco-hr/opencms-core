{
  String resourceName=getParamResource();
  CmsResource file=null;
  CmsLock lock=null;
  try {
    file=getCms().readFileHeader(resourceName);
    if (file.isFolder()) {
      resourceName+="/";
    }
  }
 catch (  CmsException e) {
  }
  try {
    lock=getCms().getLock(resourceName);
  }
 catch (  CmsException e) {
    lock=CmsLock.getNullLock();
    if (OpenCms.getLog(this).isErrorEnabled()) {
      OpenCms.getLog(this).error("Error getting lock state for resource " + resourceName,e);
    }
  }
  if (!lock.isNullLock()) {
    if (lock.getType() != CmsLock.C_TYPE_SHARED_EXCLUSIVE && lock.getType() != CmsLock.C_TYPE_SHARED_INHERITED && lock.getUserId().equals(getCms().getRequestContext().currentUser().getId())) {
      if (getCms().getRequestContext().currentProject().getId() == lock.getProjectId() || "true".equals(getParamUsetempfileproject())) {
        return true;
      }
    }
  }
 else   if (getSettings().getAutoLockResources()) {
    return true;
  }
  return false;
}
