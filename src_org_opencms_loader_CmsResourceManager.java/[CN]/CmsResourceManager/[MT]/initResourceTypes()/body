{
  if (CmsLog.INIT.isInfoEnabled()) {
    CmsLog.INIT.info(Messages.get().getBundle().key(Messages.INIT_STARTING_LOADER_CONFIG_0));
  }
  CmsResourceManagerConfiguration newConfiguration=new CmsResourceManagerConfiguration();
  if (CmsLog.INIT.isInfoEnabled()) {
    CmsLog.INIT.info(Messages.get().getBundle().key(Messages.INIT_ADD_RESTYPE_FROM_FILE_2,new Integer(m_resourceTypesFromXml.size()),CmsVfsConfiguration.DEFAULT_XML_FILE_NAME));
  }
  Iterator i;
  i=m_resourceTypesFromXml.iterator();
  while (i.hasNext()) {
    I_CmsResourceType resourceType=(I_CmsResourceType)i.next();
    initResourceType(resourceType,newConfiguration);
  }
  CmsModuleManager moduleManager=OpenCms.getModuleManager();
  if (moduleManager != null) {
    i=moduleManager.getModuleNames().iterator();
    while (i.hasNext()) {
      CmsModule module=moduleManager.getModule((String)i.next());
      if ((module != null) && (module.getResourceTypes().size() > 0)) {
        if (CmsLog.INIT.isInfoEnabled()) {
          CmsLog.INIT.info(Messages.get().getBundle().key(Messages.INIT_ADD_NUM_RESTYPES_FROM_MOD_2,new Integer(module.getResourceTypes().size()),module.getName()));
        }
        Iterator j=module.getResourceTypes().iterator();
        while (j.hasNext()) {
          I_CmsResourceType resourceType=(I_CmsResourceType)j.next();
          I_CmsResourceType conflictingType=null;
          if (resourceType.getTypeId() == CmsResourceTypeUnknownFile.RESOURCE_TYPE_ID) {
            if (m_restypeUnknownFile != null) {
              conflictingType=m_restypeUnknownFile;
            }
 else {
              m_restypeUnknownFile=resourceType;
              continue;
            }
          }
 else           if (resourceType.getTypeId() == CmsResourceTypeUnknownFolder.RESOURCE_TYPE_ID) {
            if (m_restypeUnknownFolder != null) {
              conflictingType=m_restypeUnknownFolder;
            }
 else {
              m_restypeUnknownFolder=resourceType;
              continue;
            }
          }
 else {
            int conflictIndex=newConfiguration.getResourceTypeList().indexOf(resourceType);
            if (conflictIndex >= 0) {
              conflictingType=(I_CmsResourceType)newConfiguration.getResourceTypeList().get(conflictIndex);
            }
          }
          if (conflictingType != null) {
            throw new CmsConfigurationException(Messages.get().container(Messages.ERR_CONFLICTING_MODULE_RESOURCE_TYPES_5,new Object[]{resourceType.getTypeName(),new Integer(resourceType.getTypeId()),module.getName(),conflictingType.getTypeName(),new Integer(conflictingType.getTypeId())}));
          }
          initResourceType(resourceType,newConfiguration);
        }
      }
    }
  }
  newConfiguration.freeze();
  m_configuration=newConfiguration;
  m_frozen=true;
  if (CmsLog.INIT.isInfoEnabled()) {
    CmsLog.INIT.info(Messages.get().getBundle().key(Messages.INIT_RESOURCE_TYPE_INITIALIZED_0));
  }
}
