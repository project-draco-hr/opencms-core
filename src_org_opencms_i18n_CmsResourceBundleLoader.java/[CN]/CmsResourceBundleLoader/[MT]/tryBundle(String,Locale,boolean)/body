{
  String language=locale.getLanguage();
  String country=locale.getCountry();
  String variant=locale.getVariant();
  int baseLen=baseName.length();
  StringBuffer sb=new StringBuffer(baseLen + variant.length() + 7);
  sb.append(baseName);
  if (language.length() > 0) {
    sb.append('_');
    sb.append(language);
    if (country.length() > 0) {
      sb.append('_');
      sb.append(country);
      if (variant.length() > 0) {
        sb.append('_');
        sb.append(variant);
      }
    }
  }
  String bundleName=sb.toString();
  CmsResourceBundle first=null;
  CmsResourceBundle last=null;
  while (true) {
    CmsResourceBundle foundBundle=tryBundle(bundleName);
    if (foundBundle != null) {
      if (first == null) {
        first=foundBundle;
      }
      if (last != null) {
        last.setParent(foundBundle);
      }
      foundBundle.setLocale(locale);
      last=foundBundle;
    }
    int idx=bundleName.lastIndexOf('_');
    if ((idx > baseLen) || ((idx == baseLen) && ((first != null) || wantBase))) {
      bundleName=bundleName.substring(0,idx);
    }
 else {
      break;
    }
  }
  return first;
}
