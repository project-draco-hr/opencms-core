{
  CmsObject cms=getCmsObject();
  echo("Testing overwriting a deleted file");
  String source="/folder1/page1.html";
  String destination1="/folder1/page2.html";
  long timestamp=System.currentTimeMillis();
  cms.lockResource(destination1);
  cms.deleteResource(destination1,I_CmsConstants.C_DELETE_OPTION_PRESERVE_SIBLINGS);
  int warning=0;
  cms.readResource(destination1,CmsResourceFilter.ALL);
  storeResources(cms,source);
  cms.copyResource(source,destination1);
  assertFilter(cms,source,OpenCmsTestResourceFilter.FILTER_EQUAL);
  assertProject(cms,destination1,cms.getRequestContext().currentProject());
  assertState(cms,destination1,I_CmsConstants.C_STATE_CHANGED);
  assertDateCreatedAfter(cms,destination1,timestamp);
  assertUserCreated(cms,source,cms.getRequestContext().currentUser());
  assertLock(cms,destination1,CmsLock.C_TYPE_EXCLUSIVE);
  setMapping(destination1,source);
  assertFilter(cms,destination1,OpenCmsTestResourceFilter.FILTER_COPY_AS_NEW);
}
