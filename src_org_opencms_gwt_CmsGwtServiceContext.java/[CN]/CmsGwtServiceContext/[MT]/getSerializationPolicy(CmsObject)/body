{
  boolean online=cms.getRequestContext().getCurrentProject().isOnlineProject();
  if (online && (m_serPolicyOnline != null)) {
    return m_serPolicyOnline;
  }
 else   if (!online && (m_serPolicyOffline != null)) {
    return m_serPolicyOffline;
  }
  SerializationPolicy serializationPolicy=null;
  InputStream is;
  try {
    is=new ByteArrayInputStream(cms.readFile(m_serializationPolicyPath).getContents());
  }
 catch (  CmsException ex) {
    String message="ERROR: The serialization policy file '" + m_serializationPolicyPath + "' was not found; did you forget to include it in this deployment?";
    LOG.warn(message);
    LOG.warn(ex.getLocalizedMessage(),ex);
    return new CmsDummySerializationPolicy();
  }
  try {
    serializationPolicy=SerializationPolicyLoader.loadFromStream(is,null);
  }
 catch (  ParseException e) {
    LOG.error("ERROR: Failed to parse the policy file '" + m_serializationPolicyPath + "'",e);
  }
catch (  IOException e) {
    LOG.error("ERROR: Could not read the policy file '" + m_serializationPolicyPath + "'",e);
  }
 finally {
    try {
      is.close();
    }
 catch (    IOException e) {
    }
  }
  if (online) {
    m_serPolicyOnline=serializationPolicy;
  }
 else {
    m_serPolicyOffline=serializationPolicy;
  }
  return serializationPolicy;
}
