{
  if (isInternal()) {
    if ((cms == null) || (getUri().length() == 0) || (getUri().charAt(0) == '#')) {
      return getUri();
    }
    checkConsistency(cms);
    Object obj=cms.getRequestContext().getAttribute(CmsObjectWrapper.ATTRIBUTE_NAME);
    if (obj != null) {
      CmsObjectWrapper wrapper=(CmsObjectWrapper)obj;
      m_uri=wrapper.rewriteLink(getUri());
    }
    if (!processEditorLinks && (cms.getRequestContext().getSiteRoot().length() == 0)) {
      return OpenCms.getLinkManager().substituteLink(cms,getUri());
    }
    String siteRoot=getSiteRoot();
    if (siteRoot == null) {
      return OpenCms.getLinkManager().substituteLink(cms,getUri());
    }
    return OpenCms.getLinkManager().substituteLink(cms,getVfsUri(),siteRoot);
  }
 else {
    return getUri();
  }
}
