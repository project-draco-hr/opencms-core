{
  Vector allSubFolders=new Vector();
  Vector allSubFiles=new Vector();
  getAllResources(cms,oldname,allSubFiles,allSubFolders);
  String parent=((CmsResource)cms.readFileHeader(oldname)).getParent();
  if (!cms.accessWrite(oldname)) {
    throw new CmsException(oldname,CmsException.C_NO_ACCESS);
  }
  cms.doCopyFolder(oldname,parent + newname + "/");
  for (int i=0; i < allSubFolders.size(); i++) {
    CmsFolder curFolder=(CmsFolder)allSubFolders.elementAt(i);
    if (curFolder.getState() != C_STATE_DELETED) {
      String curDestination=parent + newname + "/"+ curFolder.getAbsolutePath().substring(oldname.length());
      cms.doCopyFolder(curFolder.getAbsolutePath(),curDestination);
    }
  }
  for (int i=0; i < allSubFiles.size(); i++) {
    CmsFile curFile=(CmsFile)allSubFiles.elementAt(i);
    if (curFile.getState() != C_STATE_DELETED) {
      String curDest=parent + newname + "/"+ curFile.getAbsolutePath().substring(oldname.length());
      cms.moveResource(curFile.getAbsolutePath(),curDest);
    }
  }
  deleteResource(cms,oldname);
}
