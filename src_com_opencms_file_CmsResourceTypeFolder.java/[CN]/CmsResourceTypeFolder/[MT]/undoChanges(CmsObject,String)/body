{
  Vector allSubFolders=new Vector();
  Vector allSubFiles=new Vector();
  getAllResources(cms,resource,allSubFiles,allSubFolders);
  String parent=((CmsResource)cms.readFileHeader(resource)).getParent();
  if (!cms.accessWrite(resource)) {
    throw new CmsException("[" + this.getClass().getName() + "]"+ resource,CmsException.C_NO_ACCESS);
  }
  cms.doUndoChanges(resource);
  for (int i=0; i < allSubFolders.size(); i++) {
    CmsFolder curFolder=(CmsFolder)allSubFolders.elementAt(i);
    if (curFolder.getState() != C_STATE_NEW) {
      if (curFolder.getState() == C_STATE_DELETED) {
        undeleteResource(cms,curFolder.getAbsolutePath());
        lockResource(cms,curFolder.getAbsolutePath(),true);
      }
      undoChanges(cms,curFolder.getAbsolutePath());
    }
 else {
      try {
        deleteResource(cms,curFolder.getAbsolutePath());
      }
 catch (      CmsException ex) {
        if (ex.getType() != CmsException.C_NOT_FOUND) {
          throw ex;
        }
      }
    }
  }
  for (int i=0; i < allSubFiles.size(); i++) {
    CmsFile curFile=(CmsFile)allSubFiles.elementAt(i);
    if (curFile.getState() != C_STATE_NEW) {
      if (curFile.getState() == C_STATE_DELETED) {
        cms.undeleteResource(curFile.getAbsolutePath());
        cms.lockResource(curFile.getAbsolutePath(),true);
      }
      cms.undoChanges(curFile.getAbsolutePath());
    }
 else {
      try {
        cms.deleteResource(curFile.getAbsolutePath());
      }
 catch (      CmsException ex) {
        if (ex.getType() != CmsException.C_NOT_FOUND) {
          throw ex;
        }
      }
    }
  }
}
