{
  CmsFolder folder=cms.readFolder(filename);
  if ((cms.getRequestContext().currentUser().equals(cms.readOwner(folder))) || (cms.userInGroup(cms.getRequestContext().currentUser().getName(),C_GROUP_ADMIN))) {
    cms.doChgrp(filename,newGroup);
    String bodyFolder=C_VFS_PATH_BODIES.substring(0,C_VFS_PATH_BODIES.lastIndexOf("/")) + folder.getAbsolutePath();
    try {
      cms.readFolder(bodyFolder);
      cms.doChgrp(bodyFolder,newGroup);
    }
 catch (    CmsException ex) {
    }
    if (chRekursive) {
      Vector allFolders=new Vector();
      Vector allFiles=new Vector();
      getAllResources(cms,filename,allFiles,allFolders);
      for (int i=0; i < allFolders.size(); i++) {
        CmsFolder curfolder=(CmsFolder)allFolders.elementAt(i);
        if (curfolder.getState() != C_STATE_DELETED) {
          cms.doChgrp(curfolder.getAbsolutePath(),newGroup);
          bodyFolder=C_VFS_PATH_BODIES.substring(0,C_VFS_PATH_BODIES.lastIndexOf("/")) + curfolder.getAbsolutePath();
          try {
            cms.readFolder(bodyFolder);
            cms.doChgrp(bodyFolder,newGroup);
          }
 catch (          CmsException ex) {
          }
        }
      }
      for (int i=0; i < allFiles.size(); i++) {
        CmsFile newfile=(CmsFile)allFiles.elementAt(i);
        if (newfile.getState() != C_STATE_DELETED) {
          try {
            cms.chgrp(newfile.getAbsolutePath(),newGroup);
          }
 catch (          CmsException e) {
            if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
              A_OpenCms.log(A_OpenCms.C_OPENCMS_CRITICAL,"[" + this.getClass().getName() + "] "+ newfile.getAbsolutePath()+ ": "+ e.getStackTraceAsString());
            }
          }
        }
      }
    }
  }
 else {
    throw new CmsException("[" + this.getClass().getName() + "] "+ filename,CmsException.C_NO_ACCESS);
  }
}
