{
  CmsFolder folder=cms.readFolder(filename);
  if ((cms.getRequestContext().currentUser().equals(cms.readOwner(folder))) || (cms.userInGroup(cms.getRequestContext().currentUser().getName(),C_GROUP_ADMIN))) {
    cms.doChmod(filename,flags);
    String bodyFolder=C_CONTENTBODYPATH.substring(0,C_CONTENTBODYPATH.lastIndexOf("/")) + folder.getAbsolutePath();
    try {
      cms.readFolder(bodyFolder);
      cms.doChmod(bodyFolder,flags);
    }
 catch (    CmsException ex) {
    }
    if (chRekursive) {
      Vector allFolders=new Vector();
      Vector allFiles=new Vector();
      getAllResources(cms,filename,allFiles,allFolders);
      for (int i=0; i < allFolders.size(); i++) {
        CmsFolder curfolder=(CmsFolder)allFolders.elementAt(i);
        if (curfolder.getState() != C_STATE_DELETED) {
          cms.doChmod(curfolder.getAbsolutePath(),flags);
          bodyFolder=C_CONTENTBODYPATH.substring(0,C_CONTENTBODYPATH.lastIndexOf("/")) + curfolder.getAbsolutePath();
          try {
            cms.readFolder(bodyFolder);
            cms.doChmod(bodyFolder,flags);
          }
 catch (          CmsException ex) {
          }
        }
      }
      for (int i=0; i < allFiles.size(); i++) {
        CmsFile newfile=(CmsFile)allFiles.elementAt(i);
        if (newfile.getState() != C_STATE_DELETED) {
          try {
            cms.chmod(newfile.getAbsolutePath(),flags);
          }
 catch (          CmsException e) {
            A_OpenCms.log(A_OpenCms.C_OPENCMS_CRITICAL,"[" + this.getClass().getName() + "] "+ newfile.getAbsolutePath()+ ": "+ e.getStackTrace());
          }
        }
      }
    }
  }
 else {
    throw new CmsException("[" + this.getClass().getName() + "] "+ filename,CmsException.C_NO_ACCESS);
  }
}
