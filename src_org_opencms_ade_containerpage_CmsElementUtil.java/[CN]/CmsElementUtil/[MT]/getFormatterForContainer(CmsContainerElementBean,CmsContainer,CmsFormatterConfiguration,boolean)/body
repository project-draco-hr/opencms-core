{
  I_CmsFormatterBean formatter;
  String formatterId=element.getSettings().get(CmsFormatterConfig.getSettingsKeyForContainer(container.getName()));
  if (formatterId != null) {
    Map<String,I_CmsFormatterBean> formatters=configs.getFormatterSelection(container.getType(),container.getWidth(),allowNested);
    formatter=formatters.get(formatterId);
    if (formatter == null) {
      for (      I_CmsFormatterBean currentFormatter : formatters.values()) {
        if ((currentFormatter.getJspStructureId() != null) && currentFormatter.getJspStructureId().equals(element.getFormatterId())) {
          formatter=currentFormatter;
          break;
        }
      }
    }
    if (formatter == null) {
      formatter=configs.getDefaultFormatter(container.getType(),container.getWidth(),allowNested);
    }
  }
 else {
    formatter=configs.getDefaultFormatter(container.getType(),container.getWidth(),allowNested);
  }
  return formatter;
}
