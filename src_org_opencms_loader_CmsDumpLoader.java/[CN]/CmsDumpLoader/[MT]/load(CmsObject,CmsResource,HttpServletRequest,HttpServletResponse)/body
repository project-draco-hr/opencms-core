{
  CmsFile file=CmsFile.upgrade(resource,cms);
  if (file.getState() == I_CmsConstants.C_STATE_UNCHANGED) {
    if (req.getDateHeader("If-Modified-Since") == file.getDateLastModified()) {
      res.setStatus(HttpServletResponse.SC_NOT_MODIFIED);
      return;
    }
  }
  res.setStatus(HttpServletResponse.SC_OK);
  res.setContentLength(file.getContents().length);
  res.setDateHeader("Last-Modified",file.getDateLastModified());
  int expireTime;
  if (cms.getRequestContext().currentProject().isOnlineProject()) {
    expireTime=86400;
  }
 else {
    expireTime=10;
  }
  if (!res.containsHeader("Cache-Control")) {
    res.setHeader("Cache-Control","max-age=" + expireTime);
    res.setDateHeader("Expires",System.currentTimeMillis() + (expireTime * 1000));
  }
  service(cms,file,req,res);
}
