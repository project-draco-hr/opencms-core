{
  String dest=cms.getRequestContext().addSiteRoot(destination);
  if (!CmsResource.isFolder(dest)) {
    dest=dest.concat("/");
  }
  if (resource.getRootPath().equals(dest)) {
    throw new CmsVfsException(org.opencms.file.Messages.get().container(org.opencms.file.Messages.ERR_MOVE_SAME_NAME_1,destination));
  }
  if (dest.startsWith(resource.getRootPath())) {
    throw new CmsVfsException(org.opencms.file.Messages.get().container(org.opencms.file.Messages.ERR_MOVE_SAME_FOLDER_2,cms.getSitePath(resource),destination));
  }
  dest=validateFoldername(dest);
  securityManager.moveResource(cms.getRequestContext(),resource,dest);
  CmsFolder folder=securityManager.readFolder(cms.getRequestContext(),dest,CmsResourceFilter.ALL);
  List resources=securityManager.readResources(cms.getRequestContext(),folder,CmsResourceFilter.ALL,true);
  if (resources != null) {
    CmsMultiException me=new CmsMultiException();
    for (int i=0; i < resources.size(); i++) {
      CmsResource childResource=(CmsResource)resources.get(i);
      if (childResource.isFolder()) {
        continue;
      }
      try {
        getResourceType(childResource).writeFile(cms,securityManager,cms.readFile(childResource));
      }
 catch (      CmsException e) {
        me.addException(e);
      }
catch (      CmsRuntimeException e) {
        me.addException(new CmsException(e.getMessageContainer(),e));
      }
    }
    if (!me.getExceptions().isEmpty()) {
      if (LOG.isWarnEnabled()) {
        LOG.warn(me);
      }
    }
  }
}
