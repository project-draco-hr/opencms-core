{
  setCms(cms);
  setReport(report);
  setExportFileName(exportFile);
  m_excludeSystem=excludeSystem;
  m_excludeUnchanged=excludeUnchanged;
  m_exportUserdata=exportUserdata;
  m_contentAge=contentAge;
  m_exportCount=0;
  report.println(report.key("report.clearcache"),I_CmsReport.C_FORMAT_NOTE);
  OpenCms.fireCmsEvent(new CmsEvent(new CmsObject(),I_CmsEventListener.EVENT_CLEAR_CACHES,Collections.EMPTY_MAP,false));
  try {
    Element exportNode=openExportFile();
    if (moduleElement != null) {
      exportNode.add(moduleElement);
      digestElement(exportNode,moduleElement);
    }
    exportAllResources(exportNode,resourcesToExport);
    if (m_exportUserdata) {
      Element userGroupData=exportNode.addElement(I_CmsConstants.C_EXPORT_TAG_USERGROUPDATA);
      getSaxWriter().writeOpen(userGroupData);
      exportGroups(userGroupData);
      exportUsers(userGroupData);
      getSaxWriter().writeClose(userGroupData);
      exportNode.remove(userGroupData);
    }
    closeExportFile(exportNode);
  }
 catch (  SAXException se) {
    getReport().println(se);
    if (OpenCms.getLog(this).isErrorEnabled()) {
      OpenCms.getLog(this).error("Error exporting to file " + getExportFileName(),se);
    }
    throw new CmsException(CmsException.C_UNKNOWN_EXCEPTION,se);
  }
catch (  IOException ioe) {
    getReport().println(ioe);
    if (OpenCms.getLog(this).isErrorEnabled()) {
      OpenCms.getLog(this).error("Error exporting to file " + getExportFileName(),ioe);
    }
    throw new CmsException(CmsException.C_UNKNOWN_EXCEPTION,ioe);
  }
}
