{
  try {
    Element e=parent.addElement(CmsImportVersion7.N_USER);
    e.addElement(CmsImportVersion7.N_NAME).addText(user.getSimpleName());
    String passwd=new String(Base64.encodeBase64(user.getPassword().getBytes()));
    e.addElement(CmsImportVersion7.N_PASSWORD).addCDATA(passwd);
    e.addElement(CmsImportVersion7.N_FIRSTNAME).addText(user.getFirstname());
    e.addElement(CmsImportVersion7.N_LASTNAME).addText(user.getLastname());
    e.addElement(CmsImportVersion7.N_EMAIL).addText(user.getEmail());
    e.addElement(CmsImportVersion7.N_FLAGS).addText(Integer.toString(user.getFlags()));
    e.addElement(CmsImportVersion7.N_DATECREATED).addText(Long.toString(user.getDateCreated()));
    Element userInfoNode=e.addElement(CmsImportVersion7.N_USERINFO);
    List keys=new ArrayList(user.getAdditionalInfo().keySet());
    Collections.sort(keys);
    Iterator itInfoKeys=keys.iterator();
    while (itInfoKeys.hasNext()) {
      String key=(String)itInfoKeys.next();
      if (key == null) {
        continue;
      }
      Object value=user.getAdditionalInfo(key);
      if (value == null) {
        continue;
      }
      Element entryNode=userInfoNode.addElement(CmsImportVersion7.N_USERINFO_ENTRY);
      entryNode.addAttribute(CmsImportVersion7.A_NAME,key);
      entryNode.addAttribute(CmsImportVersion7.A_TYPE,value.getClass().getName());
      try {
        entryNode.addCDATA(CmsDataTypeUtil.dataExport(value));
      }
 catch (      IOException ioe) {
        getReport().println(ioe);
        if (LOG.isErrorEnabled()) {
          LOG.error(Messages.get().getBundle().key(Messages.ERR_IMPORTEXPORT_ERROR_EXPORTING_USER_1,user.getName()),ioe);
        }
      }
    }
    Element userGroups=e.addElement(CmsImportVersion7.N_USERGROUPS);
    List groups=getCms().getGroupsOfUser(user.getName(),true,true);
    for (int i=0; i < groups.size(); i++) {
      String groupName=((CmsGroup)groups.get(i)).getName();
      userGroups.addElement(CmsImportVersion7.N_USERGROUP).addText(groupName);
    }
    Element userRoles=e.addElement(CmsImportVersion7.N_USERROLES);
    List roles=OpenCms.getRoleManager().getRolesOfUser(getCms(),user.getName(),"",true,true,true);
    for (int i=0; i < roles.size(); i++) {
      String roleName=((CmsRole)roles.get(i)).getFqn();
      userRoles.addElement(CmsImportVersion7.N_USERROLE).addText(roleName);
    }
    digestElement(parent,e);
  }
 catch (  CmsException e) {
    if (LOG.isDebugEnabled()) {
      LOG.debug(e.getLocalizedMessage(),e);
    }
    throw new CmsImportExportException(e.getMessageContainer(),e);
  }
}
