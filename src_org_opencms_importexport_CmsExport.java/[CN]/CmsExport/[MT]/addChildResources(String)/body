{
  if (m_exportingModuleData) {
    String channelId=m_cms.readFolder(folderName).getResourceId().toString();
    if (channelId != null) {
      if (!m_exportedChannelIds.contains(channelId)) {
        m_exportedChannelIds.add(channelId);
      }
    }
  }
  List subFolders=m_cms.getSubFolders(folderName);
  List subFiles=m_cms.getFilesInFolder(folderName);
  for (int i=0; i < subFiles.size(); i++) {
    CmsResource file=(CmsResource)subFiles.get(i);
    int state=file.getState();
    long age=file.getDateLastModified();
    if (m_isOnlineProject || (!m_excludeUnchanged) || state == I_CmsConstants.C_STATE_NEW || state == I_CmsConstants.C_STATE_CHANGED) {
      if ((state != I_CmsConstants.C_STATE_DELETED) && (!file.getName().startsWith("~")) && (age >= m_contentAge)) {
        exportFile(m_cms.readFile(m_cms.readAbsolutePath(file)));
      }
    }
    subFiles.set(i,null);
  }
  subFiles=null;
  for (int i=0; i < subFolders.size(); i++) {
    CmsResource folder=(CmsResource)subFolders.get(i);
    if (folder.getState() != I_CmsConstants.C_STATE_DELETED) {
      String export=m_cms.readAbsolutePath(folder);
      if (export.equalsIgnoreCase(I_CmsWpConstants.C_VFS_PATH_SYSTEM) || export.startsWith(I_CmsWpConstants.C_VFS_PATH_BODIES) || export.startsWith(I_CmsWpConstants.C_VFS_PATH_GALLERIES)|| !(m_excludeSystem && export.startsWith(I_CmsWpConstants.C_VFS_PATH_SYSTEM))) {
        if (folder.getDateLastModified() >= m_contentAge) {
          exportResource(folder,false);
        }
        addChildResources(m_cms.readAbsolutePath(folder));
      }
    }
    subFolders.set(i,null);
  }
}
