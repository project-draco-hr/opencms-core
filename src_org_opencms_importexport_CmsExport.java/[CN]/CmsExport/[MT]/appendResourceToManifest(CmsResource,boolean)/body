{
  CmsProperty property=null;
  String key=null, value=null;
  Element propertyElement=null;
  Element fileElement=m_fileNode.addElement(I_CmsConstants.C_EXPORT_TAG_FILE);
  String fileName=trimResourceName(getCms().readAbsolutePath(resource));
  if (resource.isFile()) {
    if (source) {
      fileElement.addElement(I_CmsConstants.C_EXPORT_TAG_SOURCE).addText(fileName);
    }
  }
 else {
    getReport().print(" ( " + ++m_exportCount + " ) ",I_CmsReport.C_FORMAT_NOTE);
    getReport().print(getReport().key("report.exporting"),I_CmsReport.C_FORMAT_NOTE);
    getReport().print(getCms().readAbsolutePath(resource));
    getReport().print(getReport().key("report.dots"));
    getReport().println(getReport().key("report.ok"),I_CmsReport.C_FORMAT_OK);
  }
  fileElement.addElement(I_CmsConstants.C_EXPORT_TAG_DESTINATION).addText(fileName);
  fileElement.addElement(I_CmsConstants.C_EXPORT_TAG_TYPE).addText(getCms().getResourceType(resource.getType()).getResourceTypeName());
  fileElement.addElement(I_CmsConstants.C_EXPORT_TAG_UUIDRESOURCE).addText(resource.getResourceId().toString());
  fileElement.addElement(I_CmsConstants.C_EXPORT_TAG_UUIDCONTENT).addText(resource.getFileId().toString());
  fileElement.addElement(I_CmsConstants.C_EXPORT_TAG_DATELASTMODIFIED).addText(String.valueOf(resource.getDateLastModified()));
  fileElement.addElement(I_CmsConstants.C_EXPORT_TAG_USERLASTMODIFIED).addText(getCms().readUser(resource.getUserLastModified()).getName());
  fileElement.addElement(I_CmsConstants.C_EXPORT_TAG_DATECREATED).addText(String.valueOf(resource.getDateCreated()));
  fileElement.addElement(I_CmsConstants.C_EXPORT_TAG_USERCREATED).addText(getCms().readUser(resource.getUserCreated()).getName());
  int resFlags=resource.getFlags();
  resFlags&=~I_CmsConstants.C_RESOURCEFLAG_LABELLINK;
  fileElement.addElement(I_CmsConstants.C_EXPORT_TAG_FLAGS).addText(Integer.toString(resFlags));
  Element propertiesElement=fileElement.addElement(I_CmsConstants.C_EXPORT_TAG_PROPERTIES);
  List properties=getCms().readPropertyObjects(getCms().readAbsolutePath(resource),false);
  for (int i=0, n=properties.size(); i < n; i++) {
    property=(CmsProperty)properties.get(i);
    key=property.getKey();
    if (isExportingCosData() && I_CmsConstants.C_PROPERTY_CHANNELID.equals(key)) {
      continue;
    }
    for (int j=0; j < 2; j++) {
      if ((j == 0 && (value=property.getStructureValue()) != null) || (j == 1 && (value=property.getResourceValue()) != null)) {
        propertyElement=propertiesElement.addElement(I_CmsConstants.C_EXPORT_TAG_PROPERTY);
        if (j == 1) {
          propertyElement.addAttribute(I_CmsConstants.C_EXPORT_TAG_PROPERTY_ATTRIB_TYPE,I_CmsConstants.C_EXPORT_TAG_PROPERTY_ATTRIB_TYPE_SHARED);
        }
        propertyElement.addElement(I_CmsConstants.C_EXPORT_TAG_NAME).addText(key);
        propertyElement.addElement(I_CmsConstants.C_EXPORT_TAG_VALUE).addCDATA(value);
      }
    }
  }
  Element acl=fileElement.addElement(I_CmsConstants.C_EXPORT_TAG_ACCESSCONTROL_ENTRIES);
  Vector fileAcEntries=getCms().getAccessControlEntries(getCms().readAbsolutePath(resource),false);
  Iterator i=fileAcEntries.iterator();
  while (i.hasNext()) {
    CmsAccessControlEntry ace=(CmsAccessControlEntry)i.next();
    Element a=acl.addElement(I_CmsConstants.C_EXPORT_TAG_ACCESSCONTROL_ENTRY);
    int flags=ace.getFlags();
    String acePrincipalName="";
    CmsUUID acePrincipal=ace.getPrincipal();
    if ((flags & I_CmsConstants.C_ACCESSFLAGS_GROUP) > 0) {
      acePrincipalName=CmsImportExportConfiguration.C_PRINCIPAL_GROUP + "." + getCms().readGroup(acePrincipal).getName();
    }
 else {
      acePrincipalName=CmsImportExportConfiguration.C_PRINCIPAL_USER + "." + getCms().readUser(acePrincipal).getName();
    }
    a.addElement(I_CmsConstants.C_EXPORT_TAG_ACCESSCONTROL_PRINCIPAL).addText(acePrincipalName);
    a.addElement(I_CmsConstants.C_EXPORT_TAG_FLAGS).addText(Integer.toString(flags));
    Element b=a.addElement(I_CmsConstants.C_EXPORT_TAG_ACCESSCONTROL_PERMISSIONSET);
    b.addElement(I_CmsConstants.C_EXPORT_TAG_ACCESSCONTROL_ALLOWEDPERMISSIONS).addText(Integer.toString(ace.getAllowedPermissions()));
    b.addElement(I_CmsConstants.C_EXPORT_TAG_ACCESSCONTROL_DENIEDPERMISSIONS).addText(Integer.toString(ace.getDeniedPermissions()));
  }
  digestElement(m_fileNode,fileElement);
}
