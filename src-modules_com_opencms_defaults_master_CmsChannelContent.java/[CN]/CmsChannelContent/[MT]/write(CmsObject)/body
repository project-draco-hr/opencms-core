{
  CmsResource newChannel=null;
  CmsLock lock=null;
  cms.getRequestContext().saveSiteRoot();
  cms.getRequestContext().setSiteRoot(CmsResource.VFS_FOLDER_CHANNELS);
  try {
    if ((CmsDbUtil.UNKNOWN_ID + "").equals(m_channelId)) {
      setNewChannelId();
      newChannel=cms.createResource(m_parentchannel + m_channelname,CmsResourceTypeFolder.RESOURCE_TYPE_ID,null,CmsProperty.toList(m_properties));
      cms.lockResource(cms.getSitePath(newChannel));
    }
 else {
      if (!"".equals(m_channel.getName())) {
        newChannel=cms.readFolder(cms.getSitePath(m_channel));
      }
      if (newChannel != null && !cms.getSitePath(newChannel).equals(m_parentchannel + m_channelname + "/")) {
        String parent=CmsResource.getParentFolder(cms.getSitePath(newChannel));
        if (!parent.equals(m_parentchannel)) {
          cms.moveResource(cms.getSitePath(newChannel),m_parentchannel + m_channelname);
        }
 else         if (!newChannel.getName().equals(m_channelname)) {
          cms.renameResource(cms.getSitePath(newChannel),m_channelname);
        }
      }
      newChannel=cms.readFolder(m_parentchannel + m_channelname + "/");
      lock=cms.getLock(newChannel);
      String propTitle=cms.readProperty(cms.getSitePath(newChannel),CmsPropertyDefinition.PROPERTY_TITLE);
      if (propTitle == null) {
        propTitle="";
      }
      if (!propTitle.equals(this.getTitle())) {
        cms.writeProperty(cms.getSitePath(newChannel),CmsPropertyDefinition.PROPERTY_TITLE,this.getTitle());
      }
      if (!lock.getUserId().equals(this.getLockstate()) || lock.getProjectId() != cms.getRequestContext().currentProject().getId()) {
        if (this.getLockstate().isNullUUID()) {
          cms.unlockResource(cms.getSitePath(newChannel));
        }
 else {
          cms.lockResource(cms.getSitePath(newChannel));
        }
      }
    }
    m_channel=cms.readFolder(cms.getSitePath(newChannel));
  }
 catch (  CmsException exc) {
    throw exc;
  }
 finally {
    cms.getRequestContext().restoreSiteRoot();
  }
}
