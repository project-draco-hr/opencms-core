{
  CmsSetupBean bean=new CmsSetupBean();
  bean.init("",null,null);
  String base=getTestDataPath(File.separator + "WEB-INF" + File.separator+ "base");
  String inputFile=base + CmsSystemInfo.FILE_PROPERTIES;
  String outputFile=base + "output.properties";
  System.out.println("Reading properties from " + inputFile);
  ExtendedProperties oldProperties=bean.loadProperties(inputFile);
  System.out.println("Writing properties to " + outputFile);
  bean.copyFile(inputFile,outputFile);
  bean.saveProperties(oldProperties,outputFile,false);
  System.out.println("Checking properties from " + outputFile);
  ExtendedProperties newProperties=bean.loadProperties(outputFile);
  Iterator it=oldProperties.entrySet().iterator();
  while (it.hasNext()) {
    Map.Entry e=(Map.Entry)it.next();
    String key=(String)e.getKey();
    Object obj=e.getValue();
    String oldValue="", newValue="";
    if (obj instanceof Vector) {
      StringBuffer buf;
      buf=new StringBuffer();
      for (Iterator j=((Vector)obj).iterator(); j.hasNext(); ) {
        buf.append("[" + (String)j.next() + "]");
      }
      oldValue=buf.toString();
      buf=new StringBuffer();
      for (Iterator j=((Vector)newProperties.get(key)).iterator(); j.hasNext(); ) {
        buf.append("[" + (String)j.next() + "]");
      }
      newValue=buf.toString();
    }
 else {
      oldValue=(String)obj;
      newValue=(String)newProperties.get(key);
    }
    System.out.println(key);
    System.out.println(oldValue);
    System.out.println(newValue);
    System.out.println("---");
    assertEquals(oldValue,newValue);
  }
  File output=new File(outputFile);
  output.delete();
}
