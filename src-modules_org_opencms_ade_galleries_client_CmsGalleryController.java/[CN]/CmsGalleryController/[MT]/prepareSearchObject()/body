{
  CmsGallerySearchObject searchObj=m_searchObject;
  CmsGallerySearchObject preparedSearchObj=new CmsGallerySearchObject(searchObj);
  if (searchObj.getTypes().isEmpty()) {
    if (m_searchObject.getGalleries().isEmpty()) {
      if (m_dialogMode.equals(I_CmsGalleryProviderConstants.GalleryMode.widget) || m_dialogMode.equals(I_CmsGalleryProviderConstants.GalleryMode.editor)) {
        ArrayList<String> availableGalleries=new ArrayList<String>();
        for (        CmsGalleriesListInfoBean galleryPath : m_dialogBean.getGalleries()) {
          availableGalleries.add(galleryPath.getId());
        }
        preparedSearchObj.setGalleries(availableGalleries);
      }
      ArrayList<String> availableTypes=new ArrayList<String>();
      for (      CmsTypesListInfoBean type : m_dialogBean.getTypes()) {
        availableTypes.add(type.getId());
      }
      preparedSearchObj.setTypes(availableTypes);
    }
 else     if (searchObj.getGalleries().size() > 0) {
      HashSet<String> contentTypes=new HashSet<String>();
      for (      CmsGalleriesListInfoBean gallery : m_dialogBean.getGalleries()) {
        if (searchObj.getGalleries().contains(gallery.getId())) {
          contentTypes.addAll(gallery.getContentTypes());
        }
      }
      ArrayList<String> availableTypes=new ArrayList<String>();
      for (      CmsTypesListInfoBean type : m_dialogBean.getTypes()) {
        availableTypes.add(type.getId());
      }
      ArrayList<String> checkedTypes=new ArrayList<String>();
      for (      String type : contentTypes) {
        if (availableTypes.contains(type) && !checkedTypes.contains(type)) {
          checkedTypes.add(type);
        }
      }
      preparedSearchObj.setTypes(checkedTypes);
    }
    return preparedSearchObj;
  }
 else {
    return preparedSearchObj;
  }
}
