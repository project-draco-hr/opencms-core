{
  echo("Testing OpenCms content notification");
  CmsObject cms=getCmsObject();
  GregorianCalendar today=new GregorianCalendar(TimeZone.getDefault(),CmsLocaleManager.getDefaultLocale());
  today.setTimeInMillis(cms.getRequestContext().getRequestTime());
  GregorianCalendar inFiveDays=(GregorianCalendar)today.clone();
  inFiveDays.add(Calendar.DAY_OF_YEAR,5);
  GregorianCalendar inEightDays=(GregorianCalendar)today.clone();
  inEightDays.add(Calendar.DAY_OF_YEAR,8);
  GregorianCalendar oneDayBefore=(GregorianCalendar)today.clone();
  oneDayBefore.add(Calendar.DAY_OF_YEAR,-1);
  echo("yesterday: " + oneDayBefore.getTimeInMillis());
  echo("today: " + today.getTimeInMillis());
  echo("in five days: " + inFiveDays.getTimeInMillis());
  echo("inEightDays: " + inEightDays.getTimeInMillis());
  CmsUser fry=cms.createUser("fry","password","First test user",new HashMap());
  String folder="folder1/";
  String expired01="folder1/expired01.html";
  CmsResource expired=cms.createResource(expired01,CmsResourceTypeXmlPage.getStaticTypeId());
  cms.chacc(expired01,I_CmsPrincipal.PRINCIPAL_USER,fry.getName(),"+s");
  cms.setDateExpired(expired01,inFiveDays.getTimeInMillis(),false);
  String expired02="folder1/expired02.html";
  cms.createResource(expired02,CmsResourceTypeXmlPage.getStaticTypeId());
  cms.chacc(expired02,I_CmsPrincipal.PRINCIPAL_USER,fry.getName(),"+s");
  cms.setDateExpired(expired02,inEightDays.getTimeInMillis(),false);
  String expired03="folder1/expired03.html";
  cms.createResource(expired03,CmsResourceTypeXmlPage.getStaticTypeId());
  cms.chacc(expired03,I_CmsPrincipal.PRINCIPAL_USER,fry.getName(),"+s");
  cms.setDateExpired(expired03,oneDayBefore.getTimeInMillis(),false);
  String released01="folder1/released01.html";
  CmsResource released=cms.createResource(released01,CmsResourceTypeXmlPage.getStaticTypeId());
  cms.chacc(released01,I_CmsPrincipal.PRINCIPAL_USER,fry.getName(),"+s");
  cms.setDateReleased(released01,inFiveDays.getTimeInMillis(),false);
  String released02Name="folder1/released02.html";
  cms.createResource(released02Name,CmsResourceTypeXmlPage.getStaticTypeId());
  cms.chacc(released02Name,I_CmsPrincipal.PRINCIPAL_USER,fry.getName(),"+s");
  cms.setDateReleased(released02Name,inEightDays.getTimeInMillis(),false);
  String released03="folder1/released03.html";
  cms.createResource(released03,CmsResourceTypeXmlPage.getStaticTypeId());
  cms.chacc(released03,I_CmsPrincipal.PRINCIPAL_USER,fry.getName(),"+s");
  cms.setDateReleased(released03,oneDayBefore.getTimeInMillis(),false);
  cms.lockResource(folder);
  cms.writePropertyObject(folder,new CmsProperty(CmsPropertyDefinition.PROPERTY_ENABLE_NOTIFICATION,CmsStringUtil.TRUE,CmsStringUtil.TRUE));
  cms.unlockResource(folder);
  cms.publishProject();
  Iterator notifications=new CmsNotificationCandidates(cms).getContentNotifications().iterator();
  while (notifications.hasNext()) {
    CmsContentNotification notification=(CmsContentNotification)notifications.next();
    assertTrue(notification.getResponsible().equals(fry));
    Collection notificationCauses=notification.getNotificationCauses();
    assertTrue(notificationCauses.contains(new CmsExtendedNotificationCause(expired,CmsExtendedNotificationCause.RESOURCE_EXPIRES,new Date(expired.getDateExpired()))));
    assertTrue(notificationCauses.contains(new CmsExtendedNotificationCause(released,CmsExtendedNotificationCause.RESOURCE_RELEASE,new Date(released.getDateReleased()))));
    assertEquals(notificationCauses.size(),2);
  }
}
