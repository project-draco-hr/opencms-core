{
  CmsObject cms=getCmsObject();
  echo("Testing searching with limiting to time ranges");
  CmsSolrIndex index=OpenCms.getSearchManager().getIndexSolr(TestCmsSearch.SOLR_OFFLINE);
  String query="q=+text_en:OpenCms";
  List<CmsSearchResource> results=index.search(getCmsObject(),query);
  int orgCount=results.size();
  Date stamp=new Date();
  String date=DateField.formatExternal(stamp);
  query+=" +created:[" + date + " TO NOW]";
  results=index.search(getCmsObject(),query);
  assertEquals(0,results.size());
  String resName="search_new.txt";
  cms.createResource(resName,CmsResourceTypePlain.getStaticTypeId(),"OpenCms".getBytes(),null);
  I_CmsReport report=new CmsShellReport(cms.getRequestContext().getLocale());
  OpenCms.getSearchManager().rebuildIndex(TestCmsSearch.SOLR_OFFLINE,report);
  results=index.search(getCmsObject(),query);
  assertEquals(1,results.size());
  String maxDate=DateField.formatExternal(new Date(stamp.getTime() - 1000));
  query="q=+text_en:OpenCms  +created:[* TO " + maxDate + "]";
  results=index.search(getCmsObject(),query);
  assertEquals(orgCount,results.size());
  query="q=+text_en:OpenCms  +created:[* TO NOW]";
  results=index.search(getCmsObject(),query);
  assertEquals(orgCount + 1,results.size());
  stamp=new Date();
  date=DateField.formatExternal(stamp);
  query="q=+text_en:OpenCms +lastmodified:[" + date + " TO NOW]";
  results=index.search(getCmsObject(),query);
  assertEquals(0,results.size());
  CmsFile file=cms.readFile(resName);
  file.setContents("OpenCms ist toll".getBytes());
  cms.writeFile(file);
  report=new CmsShellReport(cms.getRequestContext().getLocale());
  OpenCms.getSearchManager().rebuildIndex(TestCmsSearch.SOLR_OFFLINE,report);
  results=index.search(getCmsObject(),query);
  assertEquals(1,results.size());
  maxDate=DateField.formatExternal(new Date(stamp.getTime() - 1000));
  query="q=+text_en:OpenCms +lastmodified:[* TO " + maxDate + "]";
  results=index.search(getCmsObject(),query);
  assertEquals(orgCount,results.size());
  query="q=+text_en:OpenCms +lastmodified:[* TO NOW]";
  results=index.search(getCmsObject(),query);
  assertEquals(orgCount + 1,results.size());
}
