{
  CmsObject cms=getCmsObject();
  echo("Testing deleting folder in project");
  String projectName="testDeleteFolderInProject";
  cms.getRequestContext().setSiteRoot("/sites/default/");
  String folderName="/types/";
  CmsProject project=cms.createProject(projectName,projectName,OpenCms.getDefaultUsers().getGroupUsers(),OpenCms.getDefaultUsers().getGroupProjectmanagers(),CmsProject.PROJECT_TYPE_NORMAL);
  cms.getRequestContext().setCurrentProject(project);
  cms.copyResourceToProject(folderName);
  List<String> resNames=cms.readProjectResources(project);
  assertEquals(1,resNames.size());
  assertEquals(cms.getRequestContext().addSiteRoot(folderName),resNames.get(0));
  cms.lockResource(folderName);
  cms.deleteResource(folderName,CmsResourceDeleteMode.MODE_DELETE_REMOVE_SIBLINGS);
  resNames=cms.readProjectResources(project);
  assertEquals(1,resNames.size());
  assertEquals(cms.getRequestContext().addSiteRoot(folderName),resNames.get(0));
  OpenCms.getPublishManager().publishResource(cms,folderName);
  OpenCms.getPublishManager().waitWhileRunning();
  resNames=cms.readProjectResources(project);
  assertTrue(resNames.isEmpty());
  folderName="/folder2/";
  String subfolder="/folder2/subfolder21/";
  cms.copyResourceToProject(subfolder);
  resNames=cms.readProjectResources(project);
  assertEquals(1,resNames.size());
  assertEquals(cms.getRequestContext().addSiteRoot(subfolder),resNames.get(0));
  cms.lockResource(folderName);
  cms.deleteResource(folderName,CmsResourceDeleteMode.MODE_DELETE_REMOVE_SIBLINGS);
  resNames=cms.readProjectResources(project);
  assertEquals(1,resNames.size());
  assertEquals(cms.getRequestContext().addSiteRoot(subfolder),resNames.get(0));
  OpenCms.getPublishManager().publishResource(cms,folderName);
  OpenCms.getPublishManager().waitWhileRunning();
  resNames=cms.readProjectResources(project);
  assertTrue(resNames.isEmpty());
}
