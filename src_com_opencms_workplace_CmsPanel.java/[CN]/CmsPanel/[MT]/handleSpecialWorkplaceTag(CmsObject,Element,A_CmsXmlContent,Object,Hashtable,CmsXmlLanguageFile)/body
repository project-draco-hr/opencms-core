{
  String selectedPanel=(String)parameters.get(C_PARA_PANEL);
  if (selectedPanel == null) {
    selectedPanel="";
  }
  CmsXmlWpTemplateFile paneldef=getPanelDefinitions(cms);
  CmsRequestContext reqCont=cms.getRequestContext();
  String url=reqCont.getRequest().getServletUrl() + reqCont.getUri();
  if (url.indexOf("?") >= 0) {
    url=url + "&panel=";
  }
 else {
    url=url + "?panel=";
  }
  Node nodeLoop;
  String panelName=null;
  StringBuffer resultBg=new StringBuffer();
  StringBuffer resultTxt=new StringBuffer();
  StringBuffer resultAll=new StringBuffer();
  NodeList nl=n.getChildNodes();
  Vector panels=new Vector();
  for (int i=0; i < nl.getLength(); i++) {
    Element tempElem=null;
    nodeLoop=nl.item(i);
    if (nodeLoop.getNodeType() == Node.ELEMENT_NODE) {
      tempElem=(Element)nodeLoop;
      if (tempElem.getNodeName().toLowerCase().equals(C_WPTAG_PANEL)) {
        panelName=tempElem.getAttribute(C_WPTAG_ATTR_PANELNAME);
        if (panelName != null && !panelName.equals("")) {
          panels.addElement(panelName);
        }
      }
    }
  }
  int currentPanelNo=panels.indexOf(selectedPanel);
  for (int i=0; i < panels.size(); i++) {
    panelName=(String)panels.elementAt(i);
    paneldef.setData(C_PANEL_LINK,panelName);
    paneldef.setData(C_PANEL_NAME,lang.getLanguageValue("panel." + panelName));
    if (i == currentPanelNo) {
      resultBg.append(paneldef.getProcessedDataValue(C_TAG_PANEL_BGACTIVE,callingObject,null));
      resultTxt.append(paneldef.getProcessedDataValue(C_TAG_PANEL_TEXTACTIVE));
    }
 else {
      resultBg.append(paneldef.getProcessedDataValue(C_TAG_PANEL_BGINACTIVE,callingObject,null));
      resultTxt.append(paneldef.getProcessedDataValue(C_TAG_PANEL_TEXTINACTIVE));
    }
  }
  resultAll.append(paneldef.getDataValue(C_TAG_PANEL_STARTSEQ));
  resultAll.append(resultBg.toString());
  resultAll.append(paneldef.getDataValue(C_TAG_PANEL_SEPBGTEXT));
  resultAll.append(resultTxt.toString());
  resultAll.append(paneldef.getDataValue(C_TAG_PANEL_ENDSEQ));
  return resultAll.toString();
}
