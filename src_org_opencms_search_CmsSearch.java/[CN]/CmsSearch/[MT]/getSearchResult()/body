{
  if (m_cms != null && m_result == null && m_index != null && CmsStringUtil.isNotEmpty(m_query)) {
    if ((this.getQueryLength() > 0) && (m_query.trim().length() < this.getQueryLength())) {
      m_lastException=new CmsSearchException(Messages.get().container(Messages.ERR_QUERY_TOO_SHORT_1,new Integer(this.getQueryLength())));
      return m_result;
    }
    try {
      CmsSearchResultList result=m_index.search(m_cms,getParameters(),m_page,m_matchesPerPage);
      if (result.size() > 0) {
        m_result=result;
        m_searchResultCount=result.getHitCount();
        m_categoriesFound=result.getCategories();
        m_pageCount=m_searchResultCount / m_matchesPerPage;
        if ((m_searchResultCount % m_matchesPerPage) != 0) {
          m_pageCount++;
        }
        String url=m_cms.getRequestContext().getUri() + getSearchParameters() + "&page=";
        if (m_page > 1) {
          m_prevUrl=url + (m_page - 1);
        }
        if (m_page < m_pageCount) {
          m_nextUrl=url + (m_page + 1);
        }
      }
 else {
        m_result=Collections.EMPTY_LIST;
        m_searchResultCount=0;
        m_categoriesFound=null;
        m_pageCount=0;
        m_prevUrl=null;
        m_nextUrl=null;
      }
    }
 catch (    Exception exc) {
      if (LOG.isDebugEnabled()) {
        LOG.debug(Messages.get().key(Messages.LOG_SEARCHING_FAILED_1,this.getClass().getName()),exc);
      }
      m_result=null;
      m_searchResultCount=0;
      m_pageCount=0;
      m_lastException=exc;
    }
  }
  return m_result;
}
