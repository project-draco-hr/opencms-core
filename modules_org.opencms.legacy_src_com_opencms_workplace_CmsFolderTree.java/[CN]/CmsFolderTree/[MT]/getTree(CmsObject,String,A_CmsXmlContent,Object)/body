{
  StringBuffer output=new StringBuffer();
  I_CmsSession session=CmsXmlTemplateLoader.getSession(cms.getRequestContext(),true);
  CmsXmlWpConfigFile configFile=this.getConfigFile(cms);
  String filelist=null;
  String currentFolder;
  String currentFilelist;
  String rootFolder;
  String files=null;
  boolean displayFiles=false;
  boolean enableOnlineFiles=false;
  currentFolder=CmsXmlTemplateLoader.getRequest(cms.getRequestContext()).getParameter(C_PARA_FOLDERTREE);
  if (currentFolder.trim().equalsIgnoreCase("/")) {
    currentFolder=(String)session.getValue(C_PARA_FOLDERTREE);
    if (currentFolder == null) {
      currentFolder="/";
      session.putValue(C_PARA_FOLDERTREE,currentFolder);
    }
  }
 else   if (currentFolder != null) {
    session.putValue(C_PARA_FOLDERTREE,currentFolder);
  }
  currentFilelist=CmsWorkplaceAction.getCurrentFolder(CmsXmlTemplateLoader.getRequest(cms.getRequestContext()).getOriginalRequest());
  if (currentFilelist == null) {
    currentFilelist=cms.getSitePath(cms.readFolder(I_CmsConstants.C_ROOT));
  }
  files=(String)session.getValue(C_PARA_VIEWFILE);
  if (files != null) {
    displayFiles=true;
  }
  String offselect=(String)session.getValue("onlineselect_in_foldertree");
  if (offselect != null) {
    enableOnlineFiles=true;
  }
  rootFolder=cms.getSitePath(cms.readFolder(I_CmsConstants.C_ROOT));
  CmsXmlWpTemplateFile template=(CmsXmlWpTemplateFile)doc;
  if (filelist != null) {
    template.setData("PREVIOUS",filelist);
  }
 else {
    template.setData("PREVIOUS",currentFilelist);
  }
  String tab=template.getProcessedDataValue(C_TREEIMG_EMPTY0,this);
  showTree(cms,rootFolder,currentFolder,currentFilelist,template,output,tab,displayFiles,enableOnlineFiles,configFile);
  return output.toString();
}
