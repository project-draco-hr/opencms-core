{
  CmsObject cms=getCms();
  String uri="";
  String serverPrefix="";
  String vfsName=CmsLinkManager.getAbsoluteUri(getParamResource(),cms.getRequestContext().getUri());
  String secureResource="";
  try {
    if (resourceIsFolder()) {
      vfsName=vfsName.concat("/");
    }
    secureResource=getCms().readPropertyObject(getParamResource(),CmsPropertyDefinition.PROPERTY_SECURE,true).getValue();
  }
 catch (  CmsException e) {
    if (LOG.isInfoEnabled()) {
      LOG.info(e.getLocalizedMessage());
    }
  }
  CmsSite currentSite=CmsSiteManager.getCurrentSite(getCms());
  CmsProject currentProject=cms.getRequestContext().currentProject();
  try {
    cms.getRequestContext().setCurrentProject(cms.readProject(CmsProject.ONLINE_PROJECT_ID));
    uri=OpenCms.getLinkManager().substituteLink(cms,getParamResource(),currentSite.getSiteRoot());
  }
 catch (  CmsException e) {
    if (LOG.isErrorEnabled()) {
      LOG.error(e.getLocalizedMessage());
    }
  }
 finally {
    cms.getRequestContext().setCurrentProject(currentProject);
  }
  if (currentSite == OpenCms.getSiteManager().getDefaultSite()) {
    serverPrefix=OpenCms.getSiteManager().getWorkplaceServer();
  }
 else {
    if (Boolean.valueOf(secureResource).booleanValue()) {
      serverPrefix=currentSite.getSecureUrl();
    }
 else {
      serverPrefix=currentSite.getUrl();
    }
  }
  if (!uri.startsWith(serverPrefix)) {
    uri=serverPrefix + uri;
  }
  return uri;
}
