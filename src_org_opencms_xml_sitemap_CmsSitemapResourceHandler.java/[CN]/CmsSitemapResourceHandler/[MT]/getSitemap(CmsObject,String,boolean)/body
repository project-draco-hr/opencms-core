{
  CmsFile sitemapFile;
  String cacheKey=normalizePath(cms.getRequestContext().addSiteRoot(path));
  if (online) {
    sitemapFile=m_sitemapsOnline.get(cacheKey);
  }
 else {
    sitemapFile=m_sitemapsOffline.get(cacheKey);
  }
  if (sitemapFile != null) {
    return CmsXmlSitemapFactory.unmarshal(cms,sitemapFile);
  }
  String sitemapPath=path;
  if (path.equals("/")) {
    sitemapPath=cms.readPropertyObject("/",CmsPropertyDefinition.PROPERTY_SITEMAP,false).getValue("/sitemap");
    String cacheKey2=normalizePath(cms.getRequestContext().addSiteRoot(sitemapPath));
    if (!cacheKey.equals(cacheKey2)) {
      CmsXmlSitemap sitemap=getSitemap(cms,sitemapPath,online);
      if (sitemap != null) {
        if (online) {
          m_sitemapsOnline.put(cacheKey2,m_sitemapsOnline.get(cacheKey));
        }
 else {
          m_sitemapsOffline.put(cacheKey2,m_sitemapsOffline.get(cacheKey));
        }
      }
      return sitemap;
    }
  }
  try {
    sitemapFile=cms.readFile(sitemapPath);
  }
 catch (  Exception e) {
    LOG.error(e.getLocalizedMessage(),e);
    return null;
  }
  if (online) {
    m_sitemapsOnline.put(cacheKey,sitemapFile);
  }
 else {
    m_sitemapsOffline.put(cacheKey,sitemapFile);
  }
  return CmsXmlSitemapFactory.unmarshal(cms,sitemapFile);
}
