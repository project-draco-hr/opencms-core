{
  boolean online=cms.getRequestContext().currentProject().isOnlineProject();
  CmsFile sitemap;
  if (online) {
    sitemap=m_sitemapsOnline.get(path);
  }
 else {
    sitemap=m_sitemapsOffline.get(path);
  }
  if (sitemap == null) {
    if (path.equals(normalizePath(cms.getRequestContext().getSiteRoot()))) {
      String sitemapPath=cms.readPropertyObject("/",CmsPropertyDefinition.PROPERTY_SITEMAP,false).getValue("/sitemap");
      try {
        sitemap=cms.readFile(sitemapPath);
      }
 catch (      Exception e) {
        LOG.error(e.getLocalizedMessage(),e);
        return null;
      }
      sitemapPath=normalizePath(cms.getRequestContext().addSiteRoot(sitemapPath));
      if (online) {
        m_sitemapsOnline.put(sitemapPath,sitemap);
      }
 else {
        m_sitemapsOffline.put(sitemapPath,sitemap);
      }
    }
 else {
      try {
        sitemap=cms.readFile(path);
      }
 catch (      Exception e) {
        LOG.error(e.getLocalizedMessage(),e);
        return null;
      }
    }
    if (online) {
      m_sitemapsOnline.put(path,sitemap);
    }
 else {
      m_sitemapsOffline.put(path,sitemap);
    }
  }
  return CmsXmlSitemapFactory.unmarshal(cms,sitemap,req).getSitemap(cms,cms.getRequestContext().getLocale());
}
