{
  CmsResource file=getCms().readResource(getParamResource(),CmsResourceFilter.ALL);
  String temporaryFilename=CmsResource.getFolderPath(getCms().getSitePath(file)) + I_CmsConstants.C_TEMP_PREFIX + file.getName();
  if (getCms().existsResource(temporaryFilename,CmsResourceFilter.ALL)) {
    if (!getCms().getLock(temporaryFilename).equals(CmsLock.getNullLock())) {
      getCms().changeLock(temporaryFilename);
    }
 else {
      getCms().lockResource(temporaryFilename);
    }
    getCms().deleteResource(temporaryFilename,I_CmsConstants.C_DELETE_OPTION_PRESERVE_SIBLINGS);
  }
  switchToTempProject();
  try {
    getCms().copyResource(getCms().getSitePath(file),temporaryFilename,I_CmsConstants.C_COPY_AS_NEW);
    getCms().touch(temporaryFilename,System.currentTimeMillis(),CmsResource.DATE_RELEASED_DEFAULT,CmsResource.DATE_EXPIRED_DEFAULT,false);
    int flags=getCms().readResource(temporaryFilename).getFlags();
    if ((flags & I_CmsConstants.C_ACCESS_INTERNAL_READ) == 0) {
      flags+=I_CmsConstants.C_ACCESS_INTERNAL_READ;
    }
    getCms().chflags(temporaryFilename,flags);
  }
 catch (  CmsException e) {
    switchToCurrentProject();
    throw e;
  }
  switchToCurrentProject();
  return temporaryFilename;
}
