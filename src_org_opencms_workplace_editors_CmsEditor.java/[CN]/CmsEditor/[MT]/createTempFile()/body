{
  CmsResource file=getCms().readResource(getParamResource(),CmsResourceFilter.ALL);
  String temporaryFilename=CmsResource.getFolderPath(getCms().getSitePath(file)) + CmsWorkplace.TEMP_FILE_PREFIX + file.getName();
  if (getCms().existsResource(temporaryFilename,CmsResourceFilter.ALL)) {
    if (!getCms().getLock(temporaryFilename).equals(CmsLock.getNullLock())) {
      getCms().changeLock(temporaryFilename);
    }
 else {
      getCms().lockResource(temporaryFilename);
    }
    getCms().deleteResource(temporaryFilename,CmsResource.DELETE_PRESERVE_SIBLINGS);
  }
  switchToTempProject();
  try {
    getCms().copyResource(getCms().getSitePath(file),temporaryFilename,CmsResource.COPY_AS_NEW);
    getCms().setDateLastModified(temporaryFilename,System.currentTimeMillis(),false);
    CmsResource tempFile=getCms().readResource(temporaryFilename,CmsResourceFilter.ALL);
    int flags=tempFile.getFlags();
    if ((flags & CmsResource.FLAG_TEMPFILE) == 0) {
      flags+=CmsResource.FLAG_TEMPFILE;
    }
    getCms().chflags(temporaryFilename,flags);
    getCms().setDateReleased(temporaryFilename,CmsResource.DATE_RELEASED_DEFAULT,false);
    getCms().setDateExpired(temporaryFilename,CmsResource.DATE_EXPIRED_DEFAULT,false);
    if (getCms().hasPermissions(tempFile,CmsPermissionSet.ACCESS_CONTROL)) {
      getCms().chacc(temporaryFilename,I_CmsPrincipal.PRINCIPAL_GROUP,OpenCms.getDefaultUsers().getGroupUsers(),"-v");
      getCms().chacc(temporaryFilename,I_CmsPrincipal.PRINCIPAL_GROUP,OpenCms.getDefaultUsers().getGroupProjectmanagers(),"-v");
    }
  }
 catch (  CmsException e) {
    switchToCurrentProject();
    throw e;
  }
  switchToCurrentProject();
  return temporaryFilename;
}
