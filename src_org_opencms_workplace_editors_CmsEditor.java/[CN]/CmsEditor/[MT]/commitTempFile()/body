{
  CmsObject cms=getCms();
  CmsFile tempFile;
  List properties;
  try {
    switchToTempProject();
    tempFile=cms.readFile(getParamTempfile(),CmsResourceFilter.ALL);
    properties=cms.readPropertyObjects(getParamTempfile(),false);
  }
  finally {
    switchToCurrentProject();
  }
  if (cms.existsResource(getParamResource(),CmsResourceFilter.ALL)) {
    cms.writePropertyObjects(getParamResource(),properties);
    CmsFile orgFile=cms.readFile(getParamResource(),CmsResourceFilter.ALL);
    orgFile.setContents(tempFile.getContents());
    getCloneCms().writeFile(orgFile);
  }
 else {
    OpenCms.getWorkplaceManager().removeTempFilePermissions(cms,getParamTempfile(),getSettings().getProject());
    cms.copyResource(getParamTempfile(),getParamResource(),CmsResource.COPY_AS_NEW);
  }
  int flags=cms.readResource(getParamResource(),CmsResourceFilter.ALL).getFlags();
  if ((flags & CmsResource.FLAG_TEMPFILE) == CmsResource.FLAG_TEMPFILE) {
    flags^=CmsResource.FLAG_TEMPFILE;
    cms.chflags(getParamResource(),flags);
  }
}
