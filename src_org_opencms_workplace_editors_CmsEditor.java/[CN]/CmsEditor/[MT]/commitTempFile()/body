{
  switchToTempProject();
  CmsFile tempFile;
  List properties;
  try {
    tempFile=getCms().readFile(getParamTempfile(),CmsResourceFilter.ALL);
    properties=getCms().readPropertyObjects(getParamTempfile(),false);
  }
  finally {
    switchToCurrentProject();
  }
  if (getCms().existsResource(getParamResource(),CmsResourceFilter.ALL)) {
    getCms().writePropertyObjects(getParamResource(),properties);
    CmsFile orgFile=getCms().readFile(getParamResource(),CmsResourceFilter.ALL);
    orgFile.setContents(tempFile.getContents());
    getCloneCms().writeFile(orgFile);
  }
 else {
    if (getCms().hasPermissions(tempFile,CmsPermissionSet.ACCESS_CONTROL)) {
      getCms().rmacc(getParamTempfile(),I_CmsPrincipal.PRINCIPAL_GROUP,OpenCms.getDefaultUsers().getGroupUsers());
      getCms().rmacc(getParamTempfile(),I_CmsPrincipal.PRINCIPAL_GROUP,OpenCms.getDefaultUsers().getGroupUsers());
    }
    getCms().copyResource(getParamTempfile(),getParamResource(),CmsResource.COPY_AS_NEW);
  }
  int flags=getCms().readResource(getParamResource(),CmsResourceFilter.ALL).getFlags();
  if ((flags & CmsResource.FLAG_TEMPFILE) == CmsResource.FLAG_TEMPFILE) {
    flags^=CmsResource.FLAG_TEMPFILE;
    getCms().chflags(getParamResource(),flags);
  }
}
