{
  int highlightFragmentSizeInBytes=60;
  int maxNumFragmentsRequired=5;
  String fragmentSeparator=" ... ";
  String excerpt=null;
  Analyzer analyzer=null;
  Query query=null;
  CmsHighlightFinder highlighter=null;
  I_CmsTermHighlighter termHighlighter=null;
  int maxExcerptLength=OpenCms.getSearchManager().getMaxExcerptLength();
  IndexReader reader=null;
  try {
    if (rawContent != null) {
      reader=IndexReader.open(m_path);
      analyzer=OpenCms.getSearchManager().getAnalyzer(m_locale);
      query=QueryParser.parse(searchQuery,I_CmsDocumentFactory.DOC_CONTENT,analyzer);
      query=query.rewrite(reader);
      termHighlighter=OpenCms.getSearchManager().getHighlighter();
      highlighter=new CmsHighlightFinder(termHighlighter,query,analyzer);
      excerpt=highlighter.getBestFragments(rawContent,highlightFragmentSizeInBytes,maxNumFragmentsRequired,fragmentSeparator);
      excerpt=excerpt.replaceAll("[\\t\\n\\x0B\\f\\r]"," ");
      if (excerpt != null && excerpt.length() > maxExcerptLength) {
        excerpt=excerpt.substring(0,maxExcerptLength);
      }
    }
  }
 catch (  Exception e) {
    String message="[Analyzer: " + analyzer + "][Query: "+ query+ "][CmsHighlightExtractor: "+ highlighter+ "][RawContent: ";
    if (rawContent != null) {
      message+=rawContent.length() + "]";
    }
 else {
      message+=rawContent + "]";
    }
    throw new CmsException(message,e);
  }
 finally {
    if (reader != null) {
      try {
        reader.close();
      }
 catch (      IOException exc) {
      }
    }
  }
  return excerpt;
}
