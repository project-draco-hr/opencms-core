{
  int highlightFragmentSizeInBytes=60;
  int maxNumFragmentsRequired=5;
  String fragmentSeparator=".. ";
  String excerpt=null;
  Analyzer analyzer=null;
  Query query=null;
  CmsHighlightExtractor highlighter=null;
  I_TermHighlighter termHighlighter=null;
  int maxExcerptLength=OpenCms.getSearchManager().getMaxExcerptLength();
  try {
    if (rawContent != null) {
      if (!C_SEARCH_QUERY_RETURN_ALL.equalsIgnoreCase(searchQuery)) {
        analyzer=OpenCms.getSearchManager().getAnalyzer(m_locale);
        query=QueryParser.parse(searchQuery,I_CmsDocumentFactory.DOC_CONTENT,analyzer);
        termHighlighter=OpenCms.getSearchManager().getHighlighter();
        highlighter=new CmsHighlightExtractor(termHighlighter,query,analyzer);
        excerpt=highlighter.getBestFragments(rawContent,highlightFragmentSizeInBytes,maxNumFragmentsRequired,fragmentSeparator);
        excerpt=excerpt.replaceAll("[\\t\\n\\x0B\\f\\r]","");
      }
 else {
        excerpt=rawContent.replaceAll("[\\t\\n\\x0B\\f\\r]","");
      }
      if (excerpt != null && excerpt.length() > maxExcerptLength) {
        excerpt=excerpt.substring(0,maxExcerptLength);
      }
    }
  }
 catch (  Exception e) {
    String message="[Analyzer: " + analyzer + "][Query: "+ query+ "][CmsHighlightExtractor: "+ highlighter+ "][RawContent: ";
    if (rawContent != null) {
      message+=rawContent.length() + "]";
    }
 else {
      message+=rawContent + "]";
    }
    throw new CmsException(message,e);
  }
  return excerpt;
}
