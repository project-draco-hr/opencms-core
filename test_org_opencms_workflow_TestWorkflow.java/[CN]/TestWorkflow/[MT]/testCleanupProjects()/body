{
  try {
    OpenCmsTestLogAppender.setBreakOnError(false);
    CmsWorkflowManager wfm=OpenCms.getWorkflowManager();
    CmsObject cms=getCmsObject();
    List<CmsResource> resources=new ArrayList<CmsResource>();
    CmsResource r1=cms.createResource("/system/r5",1);
    CmsResource r2=cms.createResource("/system/r6",1);
    resources.add(r1);
    resources.add(r2);
    CmsWorkflowResponse response=wfm.executeAction(getCmsObject(),CmsWorkflowManager.ACTION_RELEASE,resources);
    CmsUUID workflowId=response.getWorkflowId();
    assertTrue("Project should exist",existsProject(workflowId));
    publish("/system/r5");
    assertTrue("Project should still exist because it isn't empty yet.",existsProject(workflowId));
    publish("/system/r6");
    assertFalse("The project should have been removed because all the workflow resources have been published.",existsProject(workflowId));
  }
  finally {
    OpenCmsTestLogAppender.setBreakOnError(true);
  }
}
