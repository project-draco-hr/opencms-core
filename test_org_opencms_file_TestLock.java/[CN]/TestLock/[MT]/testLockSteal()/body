{
  CmsObject cms=getCmsObject();
  echo("Testing stealing a lock");
  String source="/folder1/subfolder11/page1.html";
  String sibling1="/folder1/subfolder12/page1.html";
  String sibling2="/folder2/subfolder22/page1.html";
  storeResources(cms,source);
  CmsProject offlineProject=cms.readProject("Offline");
  cms.loginUser("test1","test1");
  cms.getRequestContext().setCurrentProject(offlineProject);
  cms.lockResource(source);
  assertLock(cms,source,CmsLock.C_TYPE_EXCLUSIVE);
  assertLock(cms,sibling1,CmsLock.C_TYPE_SHARED_EXCLUSIVE);
  assertLock(cms,sibling2,CmsLock.C_TYPE_SHARED_EXCLUSIVE);
  cms.loginUser("Admin","admin");
  cms.getRequestContext().setCurrentProject(offlineProject);
  cms.changeLock(sibling1);
  assertLock(cms,sibling1,CmsLock.C_TYPE_EXCLUSIVE);
  assertLock(cms,source,CmsLock.C_TYPE_SHARED_EXCLUSIVE);
  assertLock(cms,sibling2,CmsLock.C_TYPE_SHARED_EXCLUSIVE);
}
