{
  CmsObject cms=getCmsObject();
  echo("Testing lock state after sibling creation");
  String source="/folder2/index.html";
  String destination1="/folder2/index_sib1.html";
  String destination2="/folder2/index_sib2.html";
  storeResources(cms,source);
  cms.copyResource(source,destination1,CmsResource.COPY_AS_SIBLING);
  assertLock(cms,source,CmsLockType.SHARED_EXCLUSIVE);
  assertLock(cms,destination1,CmsLockType.EXCLUSIVE);
  cms.copyResource(source,destination2,CmsResource.COPY_AS_SIBLING);
  assertLock(cms,source,CmsLockType.SHARED_EXCLUSIVE);
  assertLock(cms,destination1,CmsLockType.EXCLUSIVE);
  assertLock(cms,destination2,CmsLockType.SHARED_EXCLUSIVE);
  source="/folder2/page1.html";
  destination1="/folder2/page1_sib1.html";
  destination2="/folder2/page1_sib2.html";
  cms.lockResource(source);
  cms.createSibling(source,destination1,null);
  assertLock(cms,source,CmsLockType.EXCLUSIVE);
  assertLock(cms,destination1,CmsLockType.SHARED_EXCLUSIVE);
  cms.createSibling(destination1,destination2,null);
  assertLock(cms,source,CmsLockType.EXCLUSIVE);
  assertLock(cms,destination1,CmsLockType.SHARED_EXCLUSIVE);
  assertLock(cms,destination2,CmsLockType.SHARED_EXCLUSIVE);
  source="/folder2/image1.gif";
  String destination="/folder2/image2.gif";
  cms.lockResource(source);
  cms.lockResource(destination);
  cms.deleteResource(destination,CmsResource.DELETE_PRESERVE_SIBLINGS);
  assertLock(cms,source,CmsLockType.EXCLUSIVE);
  assertLock(cms,destination,CmsLockType.EXCLUSIVE);
  cms.copyResource(source,destination,CmsResource.COPY_AS_SIBLING);
  assertLock(cms,source,CmsLockType.EXCLUSIVE);
  assertLock(cms,destination,CmsLockType.SHARED_EXCLUSIVE);
}
