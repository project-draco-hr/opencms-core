{
  if (parameters.containsKey(elementName + "._TEMPLATESELECTOR_")) {
    return (String)parameters.get(elementName + "._TEMPLATESELECTOR_");
  }
 else {
    if (doc.hasSubtemplateSelector(elementName)) {
      return doc.getSubtemplateSelector(elementName);
    }
 else {
      CmsElementDefinitionCollection elDefs=(CmsElementDefinitionCollection)parameters.get("_ELDEFS_");
      if (elDefs != null) {
        CmsElementDefinition elDef=elDefs.get(elementName);
        if (elDef != null) {
          return elDef.getTemplateSelector();
        }
      }
      return null;
    }
  }
}
