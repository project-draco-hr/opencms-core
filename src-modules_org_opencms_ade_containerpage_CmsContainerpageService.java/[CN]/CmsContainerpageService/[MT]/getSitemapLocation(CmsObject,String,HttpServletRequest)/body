{
  String sitemap=null;
  String sitePath=cntPageUri;
  CmsResource cntPageRes=cms.readResource(cntPageUri);
  CmsSitemapManager manager=OpenCms.getSitemapManager();
  CmsSitemapEntry sitemapInfo=manager.getRuntimeInfo(request);
  if (sitemapInfo != null) {
    sitemap=manager.getSitemapForUri(cms,sitemapInfo.getSitePath(cms));
    sitePath=CmsSitemapManager.getNavigationUri(cms,request);
  }
  if (sitemap == null) {
    List<CmsResource> sitemaps=manager.getSitemapsForResource(cms,cntPageRes);
    if (sitemaps.size() > 0) {
      CmsResource sitemapRes=sitemaps.get(0);
      sitemap=cms.getSitePath(sitemapRes);
      sitePath=manager.getSitePathForResource(cms,cntPageRes,sitemapRes);
    }
  }
  sitemap=(sitemap == null) ? "" : OpenCms.getLinkManager().substituteLink(cms,sitemap);
  return new CmsSitemapLocation(sitemap,sitePath);
}
