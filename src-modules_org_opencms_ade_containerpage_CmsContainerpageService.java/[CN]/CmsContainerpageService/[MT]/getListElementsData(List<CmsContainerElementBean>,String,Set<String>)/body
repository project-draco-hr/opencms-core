{
  CmsObject cms=getCmsObject();
  CmsElementUtil elemUtil=new CmsElementUtil(cms,containerpageUri,getRequest(),getResponse());
  LinkedHashMap<String,CmsContainerElement> result=new LinkedHashMap<String,CmsContainerElement>();
  for (  CmsContainerElementBean element : listElements) {
    if (cms.existsResource(element.getElementId(),CmsResourceFilter.ONLY_VISIBLE_NO_DELETED)) {
      CmsContainerElement elementData=elemUtil.getElementData(element,containerTypes);
      result.put(element.getClientId(),elementData);
      if (elementData.isSubContainer()) {
        CmsResource elementRes=cms.readResource(element.getElementId());
        CmsXmlSubContainer xmlSubContainer=CmsXmlSubContainerFactory.unmarshal(cms,elementRes,getRequest());
        CmsSubContainerBean subContainer=xmlSubContainer.getSubContainer(cms,cms.getRequestContext().getLocale());
        for (        CmsContainerElementBean subElement : subContainer.getElements()) {
          String subId=subElement.getClientId();
          CmsContainerElement subItemData=elemUtil.getElementData(subElement,containerTypes);
          result.put(subId,subItemData);
        }
      }
    }
  }
  return result;
}
