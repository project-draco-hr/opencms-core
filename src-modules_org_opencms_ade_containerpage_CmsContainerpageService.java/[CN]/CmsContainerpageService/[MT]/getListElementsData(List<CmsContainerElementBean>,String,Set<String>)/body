{
  CmsObject cms=getCmsObject();
  CmsElementUtil elemUtil=new CmsElementUtil(cms,containerpageUri,getRequest(),getResponse());
  List<CmsContainerElementData> result=new ArrayList<CmsContainerElementData>();
  for (  CmsContainerElementBean element : listElements) {
    if (cms.existsResource(element.getElementId(),CmsResourceFilter.ONLY_VISIBLE_NO_DELETED)) {
      CmsContainerElementData elementData=elemUtil.getElementData(element,containerTypes);
      result.add(elementData);
      if (elementData.isSubContainer()) {
        CmsResource elementRes=cms.readResource(element.getElementId());
        CmsXmlSubContainer xmlSubContainer=CmsXmlSubContainerFactory.unmarshal(cms,elementRes,getRequest());
        CmsSubContainerBean subContainer=xmlSubContainer.getSubContainer(cms,cms.getRequestContext().getLocale());
        for (        CmsContainerElementBean subElement : subContainer.getElements()) {
          CmsContainerElementData subItemData=elemUtil.getElementData(subElement,containerTypes);
          result.add(subItemData);
        }
      }
    }
  }
  return result;
}
