{
  CmsSetupBean bean=new CmsSetupBean();
  bean.init("",null);
  String base=getTestDataPath() + File.separator + "WEB-INF"+ File.separator+ "config"+ File.separator;
  String inputFile=base + "opencms.properties";
  String outputFile=base + "output.properties";
  System.out.println("Reading properties from " + inputFile);
  ExtendedProperties oldProperties=bean.loadProperties(inputFile);
  System.out.println("Writing properties to " + outputFile);
  bean.copyFile(inputFile,outputFile);
  bean.saveProperties(oldProperties,outputFile,false);
  System.out.println("Checking properties from " + outputFile);
  ExtendedProperties newProperties=bean.loadProperties(outputFile);
  for (Iterator i=oldProperties.keySet().iterator(); i.hasNext(); ) {
    String key=(String)i.next();
    String oldValue="", newValue="";
    Object obj=oldProperties.get(key);
    if (obj instanceof Vector) {
      StringBuffer buf;
      buf=new StringBuffer();
      for (Iterator j=((Vector)obj).iterator(); j.hasNext(); ) {
        buf.append("[" + (String)j.next() + "]");
      }
      oldValue=buf.toString();
      buf=new StringBuffer();
      for (Iterator j=((Vector)newProperties.get(key)).iterator(); j.hasNext(); ) {
        buf.append("[" + (String)j.next() + "]");
      }
      newValue=buf.toString();
    }
 else {
      oldValue=(String)obj;
      newValue=(String)newProperties.get(key);
    }
    System.err.println(key);
    System.err.println(oldValue);
    System.err.println(newValue);
    System.err.println("---");
    assertEquals(oldValue,newValue);
  }
  File output=new File(outputFile);
  output.delete();
}
