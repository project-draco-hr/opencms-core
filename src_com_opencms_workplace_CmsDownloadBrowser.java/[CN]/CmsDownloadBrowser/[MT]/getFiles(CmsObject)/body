{
  I_CmsSession session=cms.getRequestContext().getSession(true);
  Vector files=new Vector();
  Vector filteredFiles=(Vector)session.getValue("_DOWNLIST_");
  int numFiles=filteredFiles.size();
  String pageText=(String)session.getValue(C_PARA_PAGE);
  if (pageText == null || "".equals(pageText)) {
    pageText="1";
  }
  int page=new Integer(pageText).intValue();
  int from=(page - 1) * C_DOWNBROWSER_MAXENTRIES;
  int to=((from + C_DOWNBROWSER_MAXENTRIES) > numFiles) ? numFiles : (from + C_DOWNBROWSER_MAXENTRIES);
  String folder=(String)session.getValue(C_PARA_FOLDER);
  if (folder == null || "".equals(folder)) {
    folder=getConfigFile(cms).getDownGalleryPath();
    Vector galleries=cms.getSubFolders(folder);
    if (galleries.size() > 0) {
      folder=((CmsResource)galleries.elementAt(0)).getAbsolutePath();
    }
    session.putValue(C_PARA_FOLDER,folder);
  }
  for (int i=from; i < to; i++) {
    CmsResource currFile=(CmsResource)filteredFiles.elementAt(i);
    files.addElement(currFile);
  }
  return files;
}
