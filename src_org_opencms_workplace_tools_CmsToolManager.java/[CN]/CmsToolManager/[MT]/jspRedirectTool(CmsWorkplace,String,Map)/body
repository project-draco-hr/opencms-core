{
  Map myParams=params;
  if (myParams == null) {
    myParams=new HashMap();
  }
  if (myParams.containsKey(CmsToolDialog.PARAM_PATH)) {
    myParams.remove(CmsToolDialog.PARAM_PATH);
  }
  if (!myParams.containsKey(CmsDialog.PARAM_CLOSELINK)) {
    Map argMap=new HashMap();
    String toolParams=resolveAdminTool(getCurrentToolPath(wp)).getHandler().getParameters();
    if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(toolParams)) {
      toolParams=wp.resolveMacros(toolParams);
      Iterator itArgs=CmsStringUtil.splitAsList(toolParams,"&").iterator();
      while (itArgs.hasNext()) {
        String arg=(String)itArgs.next();
        int pos=arg.indexOf("=");
        argMap.put(arg.substring(0,pos),arg.substring(pos + 1));
      }
    }
    myParams.put(CmsDialog.PARAM_CLOSELINK,linkForPath(wp.getJsp(),getCurrentToolPath(wp),argMap));
  }
  wp.getJsp().getResponse().sendRedirect(linkForPath(wp.getJsp(),toolPath,myParams));
}
