{
  Map newParams=params;
  if (newParams == null) {
    newParams=new HashMap();
  }
  newParams.put(CmsToolDialog.PARAM_PATH,toolPath);
  if (!newParams.containsKey(CmsDialog.PARAM_CLOSELINK)) {
    Map argMap=new HashMap();
    String toolParams=resolveAdminTool(getCurrentToolPath(wp)).getHandler().getParameters();
    if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(toolParams)) {
      toolParams=wp.resolveMacros(toolParams);
      Iterator itArgs=CmsStringUtil.splitAsList(toolParams,"&").iterator();
      while (itArgs.hasNext()) {
        String arg=(String)itArgs.next();
        int pos=arg.indexOf("=");
        argMap.put(arg.substring(0,pos),arg.substring(pos + 1));
      }
    }
    newParams.put(CmsDialog.PARAM_CLOSELINK,linkForToolPath(wp.getJsp(),getCurrentToolPath(wp),argMap));
  }
  CmsRequestUtil.forwardRequest(OpenCms.getSystemInfo().getServletPath() + C_VIEW_JSPPAGE_LOCATION,CmsRequestUtil.createParameterMap(newParams),wp.getJsp().getRequest(),wp.getJsp().getResponse());
}
