{
  Map newParams=new HashMap();
  if (url.indexOf("?") > 0) {
    String query=url.substring(url.indexOf("?"));
    Map reqParameters=CmsRequestUtil.createParameterMap(query);
    newParams.putAll(reqParameters);
  }
  if (params != null) {
    newParams.putAll(params);
  }
  if (!newParams.containsKey(CmsDialog.PARAM_CLOSELINK)) {
    Map argMap=resolveAdminTool(getCurrentRoot(wp).getKey(),getCurrentToolPath(wp)).getHandler().getParameters(wp);
    newParams.put(CmsDialog.PARAM_CLOSELINK,linkForToolPath(wp.getJsp(),getCurrentToolPath(wp),argMap));
  }
  return newParams;
}
