{
  CmsXmlWpConfigFile configFile=getConfigFile(cms);
  String templatePath=configFile.getCommonTemplatePath();
  Vector allTemplateFiles=cms.getFilesInFolder(templatePath);
  String currentTemplate=(String)parameters.get("template");
  int currentTemplateIndex=0;
  int numTemplates=allTemplateFiles.size();
  for (int i=0; i < numTemplates; i++) {
    CmsResource file=(CmsResource)allTemplateFiles.elementAt(i);
    if (file.getState() != C_STATE_DELETED) {
      String title=cms.readProperty(file.getAbsolutePath(),C_PROPERTY_TITLE);
      if (title == null || "".equals(title)) {
        title=file.getName();
      }
      values.addElement(file.getAbsolutePath());
      names.addElement(title);
      if (currentTemplate.equals(file.getAbsolutePath()) || currentTemplate.equals(file.getName())) {
        currentTemplateIndex=i;
      }
    }
  }
  return new Integer(currentTemplateIndex);
}
