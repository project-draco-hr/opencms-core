{
  String temporaryFilename=file.getPath() + C_TEMP_PREFIX + file.getName();
  String extendedTempFile=null;
  boolean ok=true;
  cms.getRequestContext().setCurrentProject(tempProject);
  try {
    cms.copyFile(file.getAbsolutePath(),temporaryFilename);
    cms.chmod(temporaryFilename,91);
  }
 catch (  CmsException e) {
    if ((e.getType() != e.C_FILE_EXISTS) && (e.getType() != e.C_SQL_ERROR)) {
      cms.getRequestContext().setCurrentProject(curProject);
      throw e;
    }
 else {
      try {
        cms.deleteResource(temporaryFilename);
        cms.copyFile(file.getAbsolutePath(),temporaryFilename);
        cms.chmod(temporaryFilename,91);
      }
 catch (      CmsException ex) {
        cms.getRequestContext().setCurrentProject(curProject);
        throw ex;
      }
    }
    ok=false;
  }
  extendedTempFile=temporaryFilename;
  cms.getRequestContext().setCurrentProject(curProject);
  temporaryFilename=extendedTempFile;
  return temporaryFilename;
}
