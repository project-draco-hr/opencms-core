{
  int maxOccurrence=getEntityType().getAttributeMaxOccurrence(m_attributeName);
  EntityAttribute attribute=m_entity.getAttribute(m_attributeName);
  boolean mayHaveMore=((attribute == null) || (attribute.getValueCount() < maxOccurrence));
  if (mayHaveMore && value.getTypeName().equals(m_attributeType)) {
    m_entity.addAttributeValue(m_attributeName,value);
    int valueIndex=m_entity.getAttribute(m_attributeName).getValueCount() - 1;
    AttributeValueView valueView=null;
    if ((m_attributeValueViews.size() == 1) && !m_attributeValueViews.get(0).hasValue()) {
      valueView=m_attributeValueViews.get(0);
    }
 else {
      valueView=new AttributeValueView(this,m_widgetService.getAttributeLabel(m_attributeName),m_widgetService.getAttributeHelp(m_attributeName));
    }
    Renderer.setAttributeChoice(m_widgetService,valueView,getAttributeType());
    ((FlowPanel)m_attributeValueViews.get(0).getParent()).add(valueView);
    insertHandlers(valueIndex);
    I_EntityRenderer renderer=m_widgetService.getRendererForAttribute(m_attributeName,getAttributeType());
    valueView.setValueEntity(renderer,value);
    UndoRedoHandler handler=UndoRedoHandler.getInstance();
    if (handler.isIntitalized()) {
      handler.addChange(m_entity.getId(),m_attributeName,valueIndex,ChangeType.add);
    }
  }
}
