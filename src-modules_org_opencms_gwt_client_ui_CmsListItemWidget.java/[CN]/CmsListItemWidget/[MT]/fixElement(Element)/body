{
  CmsTextMetrics tm=CmsTextMetrics.get();
  tm.bind(element);
  String text=element.getInnerText();
  int textWidth=tm.getWidth(text);
  tm.release();
  int elementWidth=CmsDomUtil.getCurrentStyleInt(element,CmsDomUtil.Style.width);
  getDebug().printLine("fixElement: ");
  getDebug().printLine("text: " + text);
  getDebug().printLine("elemWidth: " + elementWidth);
  getDebug().printLine("textWidth: " + textWidth);
  if (elementWidth == 0) {
    elementWidth=textWidth;
  }
  if (elementWidth < textWidth) {
    int maxChars=(int)((float)elementWidth / (float)textWidth * text.length());
    if (maxChars < 1) {
      maxChars=1;
    }
    String newText=text.substring(0,maxChars - 1);
    if (text.startsWith("/")) {
      newText=CmsStringUtil.formatResourceName(text,maxChars);
    }
 else     if (maxChars > 2) {
      newText+="&hellip;";
    }
    if (newText.isEmpty()) {
      newText="&nbsp;";
    }
    element.setInnerHTML(newText);
    element.setAttribute("title",text);
  }
}
