{
  m_cms=cms;
  m_startpoints=startpoints;
  m_changedLinks=changedLinks;
  m_allExportedLinks=allExportedLinks;
  m_exportPath=CmsObject.getStaticExportProperties().getExportPath();
  c_perlUtil=new Perl5Util();
  m_report=report;
  if (changedResources != null) {
    m_afterPublish=true;
  }
  if (!doTheExport) {
    if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
      A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_STATICEXPORT,"[CmsStaticExport] Generating the dynamic rulesets.");
    }
    createDynamicRules();
  }
 else {
    try {
      m_servletUrl=cms.getRequestContext().getRequest().getServletUrl();
      m_webAppUrl=cms.getRequestContext().getRequest().getWebAppUrl();
      if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
        A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_STATICEXPORT,"[CmsStaticExport] Starting the static export.");
      }
      createDynamicRules();
      checkExportPath();
      Vector exportLinks=null;
      if (m_afterPublish) {
        exportLinks=getChangedLinks(changedResources);
      }
 else {
        exportLinks=getStartLinks();
      }
      if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
        A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_STATICEXPORT,"[CmsStaticExport] got " + exportLinks.size() + " links to start with.");
      }
      m_report.addSeperator(4);
      m_report.addString(" " + exportLinks.size());
      m_report.addSeperator(0);
      m_report.addSeperator(0);
      for (int i=0; i < exportLinks.size(); i++) {
        m_report.addString(" " + i + " ");
        String aktLink=(String)exportLinks.elementAt(i);
        exportLink(aktLink,exportLinks,true);
      }
      setChangedLinkVector(exportLinks);
      if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
        A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_STATICEXPORT,"[CmsStaticExport] all done.");
      }
      m_report.addSeperator(0);
    }
 catch (    NullPointerException e) {
      if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
        A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_STATICEXPORT,"[CmsStaticExport] Nothing found to export.");
      }
    }
  }
}
