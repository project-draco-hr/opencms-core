{
  try {
    OpenCms.getEventManager().fireEvent(I_CmsEventListener.EVENT_CLEAR_CACHES);
    CacheLoadLogHandler logHandler=new CacheLoadLogHandler();
    OpenCmsTestLogAppender.setHandler(logHandler);
    writeConfiguration(1,"a");
    writeConfiguration(2,"b");
    writeConfiguration(3,"c");
    publish();
    String level3="/system/level1/level2/level3";
    checkConfigurationForPath(level3,"alpha",OFFLINE,"key=c","key=a","key=b");
    assertEquals(3,logHandler.getOfflineLoads());
    assertEquals(0,logHandler.getOnlineLoads());
    checkConfigurationForPath(level3,"alpha",ONLINE,"key=c","key=a","key=b");
    assertEquals(3,logHandler.getOfflineLoads());
    assertEquals(3,logHandler.getOnlineLoads());
    checkConfigurationForPath(level3,"alpha",OFFLINE,"key=c","key=a","key=b");
    checkConfigurationForPath(level3,"alpha",ONLINE,"key=c","key=a","key=b");
    assertEquals(3,logHandler.getOfflineLoads());
    assertEquals(3,logHandler.getOnlineLoads());
    logHandler.clear();
    writeConfiguration(2,"d");
    checkConfigurationForPath(level3,"alpha",OFFLINE,"key=c","key=a","key=d");
    assertEquals(0,logHandler.getOnlineLoads());
    assertEquals(1,logHandler.getOfflineLoads());
    checkConfigurationForPath(level3,"alpha",ONLINE,"key=c","key=a","key=b");
    assertEquals(0,logHandler.getOnlineLoads());
    assertEquals(1,logHandler.getOfflineLoads());
    publish();
    checkConfigurationForPath(level3,"alpha",ONLINE,"key=c","key=a","key=d");
    assertEquals(1,logHandler.getOnlineLoads());
    assertEquals(1,logHandler.getOfflineLoads());
    deleteConfiguration(3);
    writeConfiguration(1,"b");
    logHandler.clear();
    checkConfigurationForPath(level3,"alpha",ONLINE,"key=c","key=a","key=d");
    checkConfigurationForPath(level3,"alpha",OFFLINE,"key=d","key=b");
    assertEquals(2,logHandler.getOfflineLoads());
    assertEquals(0,logHandler.getOnlineLoads());
    checkConfigurationForPath(level3,"alpha",ONLINE,"key=c","key=a","key=d");
    checkConfigurationForPath(level3,"alpha",OFFLINE,"key=d","key=b");
    assertEquals(2,logHandler.getOfflineLoads());
    assertEquals(0,logHandler.getOnlineLoads());
    publish();
    logHandler.clear();
    checkConfigurationForPath(level3,"alpha",ONLINE,"key=d","key=b");
    assertEquals(0,logHandler.getOfflineLoads());
    checkConfigurationForPath(level3,"alpha",OFFLINE,"key=d","key=b");
    assertEquals(1,logHandler.getOfflineLoads());
    assertEquals(1,logHandler.getOnlineLoads());
  }
  finally {
    OpenCmsTestLogAppender.setHandler(null);
  }
}
