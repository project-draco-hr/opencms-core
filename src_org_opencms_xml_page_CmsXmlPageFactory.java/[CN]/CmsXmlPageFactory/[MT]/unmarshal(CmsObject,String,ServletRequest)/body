{
  String rootPath=cms.getRequestContext().addSiteRoot(filename);
  A_CmsXmlDocument doc=(A_CmsXmlDocument)req.getAttribute(rootPath);
  if (doc != null) {
    return doc;
  }
  CmsFile file=cms.readFile(filename,CmsResourceFilter.IGNORE_EXPIRATION);
  if (file.getTypeId() == CmsResourceTypeXmlPage.C_RESOURCE_TYPE_ID) {
    doc=CmsXmlPageFactory.unmarshal(cms,file);
  }
 else   if ((OpenCms.getResourceManager().getLoader(file) instanceof CmsXmlContentLoader)) {
    doc=CmsXmlContentFactory.unmarshal(cms,file);
  }
 else {
    throw new CmsXmlException("Resource '" + filename + "' is not a vaild A_CmsXmlDocument resource");
  }
  req.setAttribute(rootPath,doc);
  return doc;
}
