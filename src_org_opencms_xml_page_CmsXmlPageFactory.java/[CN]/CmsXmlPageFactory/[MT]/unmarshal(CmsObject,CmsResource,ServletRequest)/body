{
  String sitePath=cms.getSitePath(resource);
  if (resource.getTypeId() != CmsResourceTypeXmlPage.C_RESOURCE_TYPE_ID) {
    throw new CmsXmlException("Resource '" + sitePath + "' is not of required type XML page");
  }
  CmsXmlPage page=(CmsXmlPage)req.getAttribute(sitePath);
  if (page == null) {
    page=unmarshal(cms,CmsFile.upgrade(resource,cms));
    req.setAttribute(sitePath,page);
  }
  return page;
}
