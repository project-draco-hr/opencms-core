{
  String result=null;
  try {
    String resourceRootFolder=structureId != null ? CmsResource.getFolderPath(getCmsObject().readResource(structureId).getRootPath()) : getCmsObject().getRequestContext().getSiteRoot();
switch (linkMode) {
case oldWorkplace:
      result=CmsWorkplace.getWorkplaceExplorerLink(getCmsObject(),resourceRootFolder);
    break;
case newWorkplace:
  CmsSite site=OpenCms.getSiteManager().getSiteForRootPath(resourceRootFolder);
String siteRoot=site != null ? site.getSiteRoot() : OpenCms.getSiteManager().startsWithShared(resourceRootFolder) ? OpenCms.getSiteManager().getSharedFolder() : "";
CmsObject siteCms=OpenCms.initCmsObject(getCmsObject());
String link=CmsVaadinUtils.getWorkplaceLink() + "#!explorer/" + getCmsObject().getRequestContext().getCurrentProject().getUuid()+ "!!"+ siteRoot+ "!!"+ siteCms.getRequestContext().removeSiteRoot(resourceRootFolder);
result=link;
break;
case auto:
default :
boolean newWp=CmsWorkplace.getWorkplaceSettings(getCmsObject(),getRequest()).getUserSettings().usesNewWorkplace();
result=getWorkplaceLink(structureId,newWp ? CmsWorkplaceLinkMode.newWorkplace : CmsWorkplaceLinkMode.oldWorkplace);
break;
}
}
 catch (Throwable e) {
error(e);
}
return result;
}
