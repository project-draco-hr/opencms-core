{
  CmsSessionInfo sessionInfo=OpenCms.getSessionManager().getSessionInfo(getRequest().getSession());
  if (sessionInfo == null) {
    return null;
  }
  String sessionId=sessionInfo.getSessionId().toString();
  Buffer messageQueue=OpenCms.getSessionManager().getBroadcastQueue(sessionId);
  if (!messageQueue.isEmpty()) {
    CmsMessages messages=org.opencms.workplace.Messages.get().getBundle(OpenCms.getWorkplaceManager().getWorkplaceLocale(getCmsObject()));
    StringBuffer result=new StringBuffer(512);
    while (!messageQueue.isEmpty()) {
      CmsBroadcast broadcastMessage=(CmsBroadcast)messageQueue.remove();
      result.append("<p>[");
      result.append(messages.getDateTime(broadcastMessage.getSendTime()));
      result.append("] ");
      result.append(messages.key(org.opencms.workplace.Messages.GUI_LABEL_BROADCASTMESSAGEFROM_0));
      result.append(" <b>");
      if (broadcastMessage.getUser() != null) {
        result.append(broadcastMessage.getUser().getName());
      }
 else {
        result.append(messages.key(org.opencms.workplace.Messages.GUI_LABEL_BROADCAST_FROM_SYSTEM_0));
      }
      result.append("</b>:</p>\n<p>\n");
      result.append(broadcastMessage.getMessage().replaceAll("\\n","&nbsp;</p>\n<p>\n"));
      result.append("\n</p><p></p>");
    }
    return result.toString();
  }
  return null;
}
