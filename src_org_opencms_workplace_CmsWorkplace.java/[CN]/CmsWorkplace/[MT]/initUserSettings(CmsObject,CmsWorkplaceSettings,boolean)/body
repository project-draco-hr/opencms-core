{
  if (settings == null) {
    settings=new CmsWorkplaceSettings();
  }
  CmsUser user;
  if (update) {
    try {
      user=cms.readUser(cms.getRequestContext().currentUser().getId());
    }
 catch (    CmsException e) {
      if (LOG.isInfoEnabled()) {
        LOG.info(e.getLocalizedMessage());
      }
      user=cms.getRequestContext().currentUser();
    }
  }
 else {
    user=cms.getRequestContext().currentUser();
  }
  settings.setUser(user);
  CmsUserSettings newUserSettings=new CmsUserSettings(cms,user);
  if (update && settings.getUserSettings() != null) {
    newUserSettings.setSynchronizeSettings(settings.getUserSettings().getSynchronizeSettings());
  }
  settings.setUserSettings(newUserSettings);
  return settings;
}
