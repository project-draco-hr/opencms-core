{
  CmsResource res=getCms().readResource(resource,CmsResourceFilter.ALL);
  CmsLock lock=getCms().getLock(res);
  if (OpenCms.getWorkplaceManager().autoLockResources()) {
    if (lock.isNullLock()) {
      getCms().lockResource(resource,mode);
    }
 else     if (!lock.getUserId().equals(getCms().getRequestContext().currentUser().getId())) {
      throw new CmsException(Messages.get().container(Messages.ERR_WORKPLACE_LOCK_RESOURCE_1,resource));
    }
  }
 else {
    if (lock.isNullLock() || (!lock.isNullLock() && !lock.getUserId().equals(getCms().getRequestContext().currentUser().getId()))) {
      throw new CmsException(Messages.get().container(Messages.ERR_WORKPLACE_LOCK_RESOURCE_1,resource));
    }
  }
}
