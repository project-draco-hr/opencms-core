{
  HashMap targetProperties=null;
  Vector linkPropertyDefs=null;
  CmsResource res=cms.doCreateFile(resourcename,contents,getResourceTypeName(),properties);
  cms.lockResource(resourcename);
  if (parameter != null) {
    targetProperties=(HashMap)parameter;
    Vector propertyDefs=cms.readAllPropertydefinitions(getResourceTypeName());
    Enumeration allPropertyDefs=propertyDefs.elements();
    linkPropertyDefs=new Vector(propertyDefs.size());
    while (allPropertyDefs.hasMoreElements()) {
      CmsPropertydefinition currentPropertyDefinition=(CmsPropertydefinition)allPropertyDefs.nextElement();
      linkPropertyDefs.add((String)currentPropertyDefinition.getName());
    }
    Iterator i=targetProperties.keySet().iterator();
    while (i.hasNext()) {
      String currentProperty=(String)i.next();
      if (!linkPropertyDefs.contains((String)currentProperty)) {
        if (DEBUG > 0)         System.out.println("adding property definition " + currentProperty + " for resource type "+ getResourceTypeName());
        cms.createPropertydefinition(currentProperty,getResourceType());
      }
      if (DEBUG > 0)       System.out.println("writing property " + currentProperty + " with value "+ (String)targetProperties.get(currentProperty));
      cms.writeProperty(resourcename,currentProperty,(String)targetProperties.get(currentProperty));
    }
  }
  return res;
}
