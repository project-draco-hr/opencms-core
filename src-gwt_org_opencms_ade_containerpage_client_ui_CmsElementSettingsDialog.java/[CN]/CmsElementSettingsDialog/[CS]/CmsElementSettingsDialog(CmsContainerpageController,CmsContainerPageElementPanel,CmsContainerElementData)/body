{
  super(Messages.get().key(Messages.GUI_PROPERTY_DIALOG_TITLE_0),new CmsForm(false),700);
  m_elementWidget=elementWidget;
  m_controller=controller;
  m_elementBean=elementBean;
  m_contextInfo=m_controller.getData().getTemplateContextInfo();
  m_containerId=m_elementWidget.getParentTarget().getContainerId();
  CmsListInfoBean infoBean=new CmsListInfoBean();
  infoBean.setTitle(elementBean.getTitle());
  infoBean.setSubTitle(elementBean.getSitePath());
  infoBean.setResourceType(elementBean.getResourceType());
  m_settings=elementBean.getSettings();
  A_CmsFormFieldPanel formFieldPanel=null;
  boolean isEditableModelGroup=CmsCoreProvider.get().getUserInfo().isDeveloper() && CmsContainerpageController.get().getData().isModelGroup();
  boolean isDeveloper=CmsCoreProvider.get().getUserInfo().isDeveloper();
  if (m_contextInfo.shouldShowElementTemplateContextSelection() || isDeveloper || isEditableModelGroup|| m_elementBean.hasAlternativeFormatters(m_containerId)) {
    CmsFieldsetFormFieldPanel fieldSetPanel=new CmsFieldsetFormFieldPanel(infoBean,org.opencms.ade.containerpage.client.Messages.get().key(org.opencms.ade.containerpage.client.Messages.GUI_SETTINGS_LEGEND_0));
    formFieldPanel=fieldSetPanel;
    if (m_elementBean.hasAlternativeFormatters(m_containerId)) {
      CmsFieldSet formatterFieldset=new CmsFieldSet();
      fieldSetPanel.getMainPanel().insert(formatterFieldset,1);
      formatterFieldset.setLegend(org.opencms.ade.containerpage.client.Messages.get().key(org.opencms.ade.containerpage.client.Messages.GUI_FORMATTERS_LEGEND_0));
      formatterFieldset.getElement().getStyle().setMarginTop(10,Style.Unit.PX);
      LinkedHashMap<String,String> formatters=new LinkedHashMap<String,String>();
      m_formatterSelect=new CmsSelectBox();
      for (      CmsFormatterConfig formatter : m_elementBean.getFormatters().get(m_containerId).values()) {
        formatters.put(formatter.getId(),formatter.getLabel());
        m_formatterSelect.setTitle(formatter.getId(),formatter.getJspRootPath());
      }
      m_formatterSelect.setItems(formatters);
      m_formatterSelect.selectValue(m_elementBean.getFormatterConfig(m_containerId).getId());
      m_formatterSelect.addValueChangeHandler(new ValueChangeHandler<String>(){
        public void onValueChange(        ValueChangeEvent<String> event){
          onFormatterChange(event.getValue());
        }
      }
);
      formatterFieldset.add(m_formatterSelect);
    }
    if (isEditableModelGroup) {
      CmsFieldSet modelGroupFieldSet=new CmsFieldSet();
      modelGroupFieldSet.setLegend(org.opencms.ade.containerpage.client.Messages.get().key(org.opencms.ade.containerpage.client.Messages.GUI_CREATE_NEW_LEGEND_0));
      modelGroupFieldSet.getElement().getStyle().setMarginTop(10,Unit.PX);
      m_modelGroupCheckBox=new CmsCheckBox(org.opencms.ade.containerpage.client.Messages.get().key(org.opencms.ade.containerpage.client.Messages.GUI_USE_AS_MODEL_GROUP_LABEL_0));
      m_modelGroupCheckBox.setDisplayInline(false);
      m_modelGroupCheckBox.getElement().getStyle().setMarginTop(7,Style.Unit.PX);
      modelGroupFieldSet.add(m_modelGroupCheckBox);
      m_modelGroupCheckBox.setChecked(elementWidget.isModelGroup());
      if (m_controller.hasModelGroupParent(elementWidget)) {
        m_modelGroupCheckBox.disable(org.opencms.ade.containerpage.client.Messages.get().key(org.opencms.ade.containerpage.client.Messages.GUI_MODEL_GROUP_DISABLED_PARENT_0));
      }
      if (m_controller.hasModelGroupChild(elementWidget)) {
        m_modelGroupCheckBox.disable(org.opencms.ade.containerpage.client.Messages.get().key(org.opencms.ade.containerpage.client.Messages.GUI_MODEL_GROUP_DISABLED_CHILD_0));
      }
      CmsFormRow titleRow=new CmsFormRow();
      titleRow.getLabel().setText("Model group title");
      m_modelGroupTitle=new CmsTextBox();
      titleRow.getWidgetContainer().add(m_modelGroupTitle);
      modelGroupFieldSet.add(titleRow);
      CmsFormRow descriptionRow=new CmsFormRow();
      descriptionRow.getLabel().setText("Model group description");
      m_modelGroupDescription=new CmsTextBox();
      descriptionRow.getWidgetContainer().add(m_modelGroupDescription);
      modelGroupFieldSet.add(descriptionRow);
      if (elementWidget.isModelGroup()) {
        m_modelGroupTitle.setFormValueAsString(elementBean.getSettings().get(CmsContainerElement.MODEL_GROUP_TITLE));
        m_modelGroupDescription.setFormValueAsString(elementBean.getSettings().get(CmsContainerElement.MODEL_GROUP_DESCRIPTION));
      }
      m_useAsCopyModel=new CmsCheckBox("Use as copy model");
      m_useAsCopyModel.setDisplayInline(false);
      m_useAsCopyModel.getElement().getStyle().setMarginTop(7,Style.Unit.PX);
      m_useAsCopyModel.setChecked(Boolean.valueOf(elementBean.getSettings().get(CmsContainerElement.USE_AS_COPY_MODEL)).booleanValue());
      modelGroupFieldSet.add(m_useAsCopyModel);
      m_createNewCheckBox=new CmsCheckBox(org.opencms.ade.containerpage.client.Messages.get().key(org.opencms.ade.containerpage.client.Messages.GUI_CREATE_NEW_LABEL_0));
      m_createNewCheckBox.setDisplayInline(false);
      m_createNewCheckBox.getElement().getStyle().setMarginTop(7,Style.Unit.PX);
      modelGroupFieldSet.add(m_createNewCheckBox);
      fieldSetPanel.getMainPanel().insert(modelGroupFieldSet,1);
      m_createNewCheckBox.setChecked(elementWidget.isCreateNew());
    }
 else {
      m_createNewCheckBox=null;
    }
    if (m_contextInfo.shouldShowElementTemplateContextSelection()) {
      String templateContexts=m_settings.get(CmsTemplateContextInfo.SETTING);
      if (templateContexts == null) {
        templateContexts=CmsStringUtil.listAsString(new ArrayList<String>(CmsContainerpageController.get().getData().getTemplateContextInfo().getContextLabels().keySet()),"|");
      }
 else       if (templateContexts.equals(CmsTemplateContextInfo.EMPTY_VALUE)) {
        templateContexts="";
      }
      m_settings.put(CmsTemplateContextInfo.SETTING,templateContexts);
      CmsFieldSet contextsFieldset=new CmsFieldSet();
      contextsFieldset.setLegend(m_contextInfo.getSettingDefinition().getNiceName());
      contextsFieldset.getElement().getStyle().setMarginTop(10,Style.Unit.PX);
      m_contextsWidget=new CmsMultiCheckBox(CmsStringUtil.splitAsMap(m_contextInfo.getSettingDefinition().getWidgetConfiguration(),"|",":"));
      for (      CmsCheckBox checkbox : m_contextsWidget.getCheckboxes()) {
        Style checkboxStyle=checkbox.getElement().getStyle();
        checkbox.getButton().getElement().getStyle().setFontWeight(Style.FontWeight.NORMAL);
        checkboxStyle.setMarginTop(7,Style.Unit.PX);
      }
      m_contextsWidget.setFormValueAsString(m_settings.get(CmsTemplateContextInfo.SETTING));
      m_contextsWidget.addValueChangeHandler(new ValueChangeHandler<String>(){
        public void onValueChange(        ValueChangeEvent<String> event){
          setTemplateContextChanged(true);
        }
      }
);
      contextsFieldset.add(m_contextsWidget);
      fieldSetPanel.getMainPanel().add(contextsFieldset);
    }
    if (m_elementBean.getSettingConfig(m_containerId).isEmpty()) {
      fieldSetPanel.getFieldSet().setVisible(false);
    }
  }
 else {
    formFieldPanel=new CmsInfoBoxFormFieldPanel(infoBean);
  }
  getForm().setWidget(formFieldPanel);
  formFieldPanel.addStyleName(I_CmsInputLayoutBundle.INSTANCE.inputCss().formGradientBackground());
  I_CmsFormSubmitHandler submitHandler=new I_CmsFormSubmitHandler(){
    /** 
 * @see org.opencms.gwt.client.ui.input.form.I_CmsFormSubmitHandler#onSubmitForm(org.opencms.gwt.client.ui.input.form.CmsForm,java.util.Map,java.util.Set)
 */
    public void onSubmitForm(    CmsForm formParam,    final Map<String,String> fieldValues,    Set<String> editedFields){
      submitForm(formParam,fieldValues,editedFields);
    }
  }
;
  CmsDialogFormHandler formHandler=new CmsDialogFormHandler();
  formHandler.setSubmitHandler(submitHandler);
  getForm().setFormHandler(formHandler);
  formHandler.setDialog(this);
  renderSettingsForm(m_elementBean.getSettingConfig(m_containerId));
}
