{
  FormPanel form=new FormPanel();
  form.setAction(CmsCoreProvider.get().getUploadUri());
  form.setEncoding(FormPanel.ENCODING_MULTIPART);
  form.setMethod(FormPanel.METHOD_POST);
  FlowPanel inputFieldsPanel=new FlowPanel();
  int count=0;
  for (  CmsFileInput input : getInputsToUpload()) {
    String filename=input.getFiles()[0].getFileName();
    input.setName("file_" + count++);
    if (getFilesToUpload().containsKey(filename)) {
      inputFieldsPanel.add(input);
    }
  }
  final Hidden targetFolder=new Hidden();
  targetFolder.setName(CmsCoreData.UPLOAD_TARGET_FOLDER_FIELD_NAME);
  targetFolder.setValue(getTargetFolder());
  inputFieldsPanel.add(targetFolder);
  form.setWidget(inputFieldsPanel);
  return form;
}
