{
  boolean hasRedFlag=false;
  try {
    CmsResource res=cms.readFileHeader(resourceName,CmsResourceFilter.ALL);
    hasRedFlag=(res.getState() != I_CmsConstants.C_STATE_UNCHANGED);
    hasRedFlag&=(res.getProjectLastModified() == cms.getRequestContext().currentProject().getId());
    hasRedFlag&=(res.getUserLastModified().equals(cms.getRequestContext().currentUser().getId()));
    if (shouldHaveRedFlag && !hasRedFlag) {
      fail("[HasRedFlag " + resourceName + " must have a red flag]");
    }
 else     if (hasRedFlag && !shouldHaveRedFlag) {
      fail("[HasRedFlag " + resourceName + " must not have a red flag]");
    }
  }
 catch (  CmsException e) {
    fail("cannot read resource " + resourceName + " "+ CmsException.getStackTraceAsString(e));
  }
}
