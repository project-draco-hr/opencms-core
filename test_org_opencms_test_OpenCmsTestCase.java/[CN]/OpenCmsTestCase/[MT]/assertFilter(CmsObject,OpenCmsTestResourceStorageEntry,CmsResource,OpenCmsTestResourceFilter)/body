{
  String noMatches=null;
  String resourceName=null;
  try {
    noMatches="";
    resourceName=cms.getRequestContext().removeSiteRoot(res.getRootPath());
    if (filter.testContentId()) {
      if (!storedResource.getFileId().equals(res.getFileId())) {
        noMatches+="[ContentId " + storedResource.getFileId() + " <-> "+ res.getFileId()+ "]";
      }
    }
    if (filter.testContents()) {
      byte[] contents;
      if (res.isFile()) {
        contents=cms.readFile(resourceName,CmsResourceFilter.ALL).getContents();
        if (!new String(storedResource.getContents()).equals(new String(contents))) {
          noMatches+="[Content does not match]";
        }
        contents=null;
      }
    }
    if (filter.testDateCreated()) {
      if (storedResource.getDateCreated() != res.getDateCreated()) {
        noMatches+="[DateCreated " + storedResource.getDateCreated() + " <-> "+ res.getDateCreated()+ "]";
      }
    }
    if (filter.testDateExpired()) {
      if (storedResource.getDateExpired() != res.getDateExpired()) {
        noMatches+="[DateExpired " + storedResource.getDateExpired() + " <-> "+ res.getDateExpired()+ "]";
      }
    }
    if (filter.testDateLastModified()) {
      if (storedResource.getDateLastModified() != res.getDateLastModified()) {
        noMatches+="[DateLastModified " + storedResource.getDateLastModified() + " <-> "+ res.getDateLastModified()+ "]";
      }
    }
    if (filter.testDateReleased()) {
      if (storedResource.getDateReleased() != res.getDateReleased()) {
        noMatches+="[DateReleased " + storedResource.getDateReleased() + " <-> "+ res.getDateReleased()+ "]";
      }
    }
    if (filter.testFlags()) {
      if (storedResource.getFlags() != res.getFlags()) {
        noMatches+="[Flags " + storedResource.getFlags() + " <-> "+ res.getFlags()+ "]";
      }
    }
    if (filter.testLength()) {
      if (storedResource.getLength() != res.getLength()) {
        noMatches+="[Length " + storedResource.getLength() + " <-> "+ res.getLength()+ "]";
      }
    }
    if (filter.testSiblingCount()) {
      if (storedResource.getSiblingCount() != res.getLinkCount()) {
        noMatches+="[LinkCount " + storedResource.getSiblingCount() + " <-> "+ res.getLinkCount()+ "]";
      }
    }
    if (filter.testLoaderId()) {
      if (storedResource.getLoaderId() != res.getLoaderId()) {
        noMatches+="[LoaderId " + storedResource.getLoaderId() + " <-> "+ res.getLoaderId()+ "]";
      }
    }
    if (filter.testLock()) {
      CmsLock resLock=cms.getLock(res);
      if (!storedResource.getLock().equals(resLock)) {
        noMatches+="[Lockstate " + storedResource.getLock() + " <-> "+ resLock+ "]";
      }
    }
    if (filter.testName()) {
      if (!storedResource.getName().equals(res.getName())) {
        noMatches+="[Name " + storedResource.getName() + " <-> "+ res.getName()+ "]";
      }
    }
    if (filter.testParentId()) {
      if (!storedResource.getParentStructureId().equals(res.getParentStructureId())) {
        noMatches+="[ParentId " + storedResource.getParentStructureId() + " <-> "+ res.getParentStructureId()+ "]";
      }
    }
    if (filter.testProjectLastModified()) {
      if (storedResource.getProjectLastModified() != res.getProjectLastModified()) {
        noMatches+="[ProjectLastModified " + storedResource.getProjectLastModified() + " <-> "+ res.getProjectLastModified()+ "]";
      }
    }
    if (filter.testProperties()) {
      noMatches+=compareProperties(cms,resourceName,storedResource,null);
    }
    if (filter.testAccess()) {
      noMatches+=compareAccessEntries(cms,resourceName,storedResource,null);
      noMatches+=compareAccessLists(cms,resourceName,storedResource,null);
    }
    if (filter.testResourceId()) {
      if (!storedResource.getResourceId().equals(res.getResourceId())) {
        noMatches+="[ResourceId " + storedResource.getResourceId() + " <-> "+ res.getResourceId()+ "]";
      }
    }
    if (filter.testState()) {
      if (storedResource.getState() != res.getState()) {
        noMatches+="[State " + storedResource.getState() + " <-> "+ res.getState()+ "]";
      }
    }
    if (filter.testStructureId()) {
      if (!storedResource.getStructureId().equals(res.getStructureId())) {
        noMatches+="[StructureId " + storedResource.getStructureId() + " <-> "+ res.getStructureId()+ "]";
      }
    }
    if (filter.testTouched()) {
      if (storedResource.isTouched() != res.isTouched()) {
        noMatches+="[Touched " + storedResource.isTouched() + " <-> "+ res.isTouched()+ "]";
      }
    }
    if (filter.testType()) {
      if (storedResource.getType() != res.getType()) {
        noMatches+="[Type " + storedResource.getType() + " <-> "+ res.getType()+ "]";
      }
    }
    if (filter.testUserCreated()) {
      if (!storedResource.getUserCreated().equals(res.getUserCreated())) {
        noMatches+="[UserCreated " + storedResource.getUserCreated() + " <-> "+ res.getUserCreated()+ "]";
      }
    }
    if (filter.testUserLastModified()) {
      if (!storedResource.getUserLastModified().equals(res.getUserLastModified())) {
        noMatches+="[UserLastModified " + storedResource.getUserLastModified() + " <-> "+ res.getUserLastModified()+ "]";
      }
    }
    if (noMatches.length() > 0) {
      fail("error comparing resource " + resourceName + " with stored values: "+ noMatches);
    }
  }
 catch (  CmsException e) {
    fail("cannot assert filter " + resourceName + " "+ CmsException.getStackTraceAsString(e));
  }
}
