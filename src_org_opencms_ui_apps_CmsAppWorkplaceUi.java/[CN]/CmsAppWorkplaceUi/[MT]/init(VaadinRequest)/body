{
  super.init(req);
  getSession().setErrorHandler(new CmsVaadinErrorHandler());
  m_navigationStateManager=new Navigator.UriFragmentManager(getPage());
  Navigator navigator=new Navigator(this,m_navigationStateManager,this);
  navigator.addProvider(this);
  setNavigator(navigator);
  String fragment=getPage().getUriFragment();
  Page.getCurrent().addBrowserWindowResizeListener(new BrowserWindowResizeListener(){
    private static final long serialVersionUID=1L;
    public void browserWindowResized(    BrowserWindowResizeEvent event){
      markAsDirtyRecursive();
    }
  }
);
  m_history=new CmsHistoryExtension(getCurrent());
  CmsWindowCloseExtension windowClose=new CmsWindowCloseExtension(getCurrent());
  windowClose.addWindowCloseListener(this);
  navigator.addViewChangeListener(this);
  if (fragment != null) {
    navigator.navigateTo(fragment);
  }
 else {
    showHome();
  }
}
