{
  super.init(req);
  getSession().setErrorHandler(new CmsVaadinErrorHandler(this));
  m_cachedViews=new HashMap<String,I_CmsAppView>();
  m_navigationStateManager=new Navigator.UriFragmentManager(getPage());
  Navigator navigator=new Navigator(this,m_navigationStateManager,this);
  navigator.addProvider(this);
  setNavigator(navigator);
  Page.getCurrent().addBrowserWindowResizeListener(new BrowserWindowResizeListener(){
    private static final long serialVersionUID=1L;
    public void browserWindowResized(    BrowserWindowResizeEvent event){
      markAsDirtyRecursive();
    }
  }
);
  m_history=new CmsHistoryExtension(getCurrent());
  CmsWindowCloseExtension windowClose=new CmsWindowCloseExtension(getCurrent());
  windowClose.addWindowCloseListener(this);
  navigator.addViewChangeListener(this);
  navigateToFragment();
}
