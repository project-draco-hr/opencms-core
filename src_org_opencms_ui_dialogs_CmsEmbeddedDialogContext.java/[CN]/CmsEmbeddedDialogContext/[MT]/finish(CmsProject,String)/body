{
  if ((project != null) || (siteRoot != null)) {
    String sitePath="/";
    if (siteRoot != null) {
      @SuppressWarnings("unchecked") Map<String,String> openedPaths=(Map<String,String>)UI.getCurrent().getSession().getAttribute(CmsFileExplorer.OPENED_PATHS);
      if ((openedPaths != null) && openedPaths.containsKey(siteRoot)) {
        sitePath=openedPaths.get(siteRoot);
      }
    }
 else     if ((m_resources != null) && !m_resources.isEmpty()) {
      sitePath=A_CmsUI.getCmsObject().getSitePath(m_resources.get(0));
    }
    String serverLink=OpenCms.getLinkManager().getServerLink(getCms(),sitePath);
    if (!PROTOCOL_PATTERN.matcher(serverLink).matches()) {
      serverLink="http://" + serverLink;
    }
    getClientRPC().finishForProjectOrSiteChange(sitePath,serverLink);
  }
 else {
    finish(null);
  }
}
