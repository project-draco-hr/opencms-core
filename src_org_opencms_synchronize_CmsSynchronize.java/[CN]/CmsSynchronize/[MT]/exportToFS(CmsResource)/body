{
  CmsFile vfsFile;
  File fsFile;
  String resourcename;
  CmsSynchronizeList sync=(CmsSynchronizeList)m_syncList.get(translate(m_cms.readAbsolutePath(res)));
  if (sync != null) {
    resourcename=sync.getResName();
  }
 else {
    resourcename=m_cms.readAbsolutePath(res);
    String parent=CmsResource.getParentFolder(resourcename);
    CmsSynchronizeList parentSync=(CmsSynchronizeList)m_newSyncList.get(parent);
    if (parentSync != null) {
      resourcename=parentSync.getResName() + res.getName();
    }
  }
  if ((res.isFolder()) && (!resourcename.endsWith("/"))) {
    resourcename+="/";
  }
  fsFile=getFileInFs(resourcename);
  try {
    if (res.getState() != I_CmsConstants.C_STATE_DELETED) {
      m_report.print("( " + m_count++ + " ) ",I_CmsReport.C_FORMAT_NOTE);
      if (res.isFile()) {
        m_report.print(m_report.key("report.sync_exporting_file"),I_CmsReport.C_FORMAT_NOTE);
        m_report.print(m_cms.readAbsolutePath(res));
        m_report.print(m_report.key("report.sync_to_file_system_as"),I_CmsReport.C_FORMAT_NOTE);
        m_report.print(fsFile.getAbsolutePath().replace('\\','/'));
        m_report.print(m_report.key("report.dots"));
        if (!fsFile.exists()) {
          createNewLocalFile(fsFile);
        }
        vfsFile=m_cms.readFile(m_cms.readAbsolutePath(res));
        writeFileByte(vfsFile.getContents(),fsFile);
        Iterator i=m_synchronizeModifications.iterator();
        while (i.hasNext()) {
          try {
            ((I_CmsSynchonizeModification)i.next()).modifyFs(m_cms,vfsFile,fsFile);
          }
 catch (          CmsSynchronizeException e) {
            if (OpenCms.getLog(this).isWarnEnabled()) {
              OpenCms.getLog(this).warn(". CmsSyncModification class : exportTo FS " + res.getRootPath(),e);
            }
            break;
          }
        }
      }
 else {
        m_report.print(m_report.key("report.sync_exporting_folder"),I_CmsReport.C_FORMAT_NOTE);
        m_report.print(m_cms.readAbsolutePath(res));
        m_report.print(m_report.key("report.sync_to_file_system_as"),I_CmsReport.C_FORMAT_NOTE);
        m_report.print(fsFile.getAbsolutePath().replace('\\','/'));
        m_report.print(m_report.key("report.dots"));
        fsFile.mkdir();
      }
      CmsSynchronizeList syncList=new CmsSynchronizeList(resourcename,translate(resourcename),res.getDateLastModified(),fsFile.lastModified());
      m_newSyncList.put(translate(resourcename),syncList);
      m_syncList.remove(translate(resourcename));
      m_report.println(m_report.key("report.ok"),I_CmsReport.C_FORMAT_OK);
    }
    vfsFile=null;
  }
 catch (  Exception e) {
    throw new CmsException(e.getMessage());
  }
}
