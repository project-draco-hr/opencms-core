{
  CmsObject cms=getCmsObject();
  if (CmsStringUtil.isEmptyOrWhitespaceOnly(entityId)) {
    entityId=uuidToEntityId(resource.getStructureId());
  }
  CmsFile file=cms.readFile(resource);
  CmsXmlContent content=CmsXmlContentFactory.unmarshal(cms,file);
  TypeVisitor visitor=new TypeVisitor();
  visitor.visitTypes(content.getContentDefinition(),locale);
  Entity entity=null;
  if (content.hasLocale(locale)) {
    entity=readEntity(content,locale,"/",entityId,getTypeUri(content.getContentDefinition()),visitor.getTypes());
  }
  return new ContentDefinition(entity,visitor.getAttributeConfigurations(),visitor.getTypes(),locale.toString());
}
