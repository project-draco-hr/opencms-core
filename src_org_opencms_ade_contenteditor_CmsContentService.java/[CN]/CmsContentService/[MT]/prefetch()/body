{
  String paramResource=getRequest().getParameter(CmsDialog.PARAM_RESOURCE);
  String paramNewLink=getRequest().getParameter(CmsXmlContentEditor.PARAM_NEWLINK);
  boolean createNew=false;
  if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(paramNewLink)) {
    createNew=true;
    paramNewLink=decodeNewLink(paramNewLink);
  }
  String paramLocale=getRequest().getParameter(CmsEditor.PARAM_ELEMENTLANGUAGE);
  Locale locale=null;
  CmsObject cms=getCmsObject();
  if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(paramResource)) {
    try {
      CmsResource resource=cms.readResource(paramResource,CmsResourceFilter.IGNORE_EXPIRATION);
      if (CmsResourceTypeXmlContent.isXmlContent(resource)) {
        if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(paramLocale)) {
          locale=CmsLocaleManager.getLocale(paramLocale);
        }
        if (createNew) {
          if (locale == null) {
            locale=OpenCms.getLocaleManager().getDefaultLocale(cms,paramResource);
          }
          CmsUUID modelFileId=null;
          String paramModelFile=getRequest().getParameter(CmsNewResourceXmlContent.PARAM_MODELFILE);
          if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(paramModelFile)) {
            modelFileId=cms.readResource(paramModelFile).getStructureId();
          }
          return readContentDefnitionForNew(paramNewLink,resource,modelFileId,locale);
        }
 else {
          CmsFile file=cms.readFile(resource);
          CmsXmlContent content=CmsXmlContentFactory.unmarshal(cms,file);
          if (locale == null) {
            locale=getBestAvailableLocale(resource,content);
          }
          return readContentDefinition(file,content,null,locale,false);
        }
      }
    }
 catch (    Throwable e) {
      error(e);
    }
  }
  return null;
}
