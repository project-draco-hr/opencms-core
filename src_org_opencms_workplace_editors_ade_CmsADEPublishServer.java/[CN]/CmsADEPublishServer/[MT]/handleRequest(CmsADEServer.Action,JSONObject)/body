{
  HttpServletRequest request=m_jsp.getRequest();
  CmsPublishOptions options=((CmsADESessionCache)request.getSession().getAttribute(CmsADESessionCache.SESSION_ATTR_ADE_CACHE)).getADEPublishOptions();
  if (checkParameters(request,null,ParamPublish.RELATED)) {
    String relatedParam=request.getParameter(ParamPublish.RELATED.getName());
    options.setIncludeRelated(Boolean.parseBoolean(relatedParam));
  }
  if (checkParameters(request,null,ParamPublish.SIBLINGS)) {
    String siblingsParam=request.getParameter(ParamPublish.SIBLINGS.getName());
    options.setIncludeSiblings(Boolean.parseBoolean(siblingsParam));
  }
  if (checkParameters(request,null,ParamPublish.PROJECT)) {
    String projectParam=request.getParameter(ParamPublish.PROJECT.getName());
    options.setProjectId(new CmsUUID(projectParam));
  }
  CmsADEPublish publish=new CmsADEPublish(m_cms);
  publish.getOptions().setIncludeRelated(options.isIncludeRelated());
  publish.getOptions().setIncludeSiblings(options.isIncludeSiblings());
  publish.getOptions().setProjectId(options.getProjectId());
  if (action.equals(CmsADEServer.Action.PUBLISH_LIST)) {
    if (checkParameters(request,null,ParamPublish.REMOVE_RESOURCES)) {
      String remResParam=request.getParameter(ParamPublish.REMOVE_RESOURCES.getName());
      JSONArray resourcesToRemove=new JSONArray(remResParam);
      Set<CmsUUID> idsToRemove=new HashSet<CmsUUID>();
      for (int i=0; i < resourcesToRemove.length(); i++) {
        String id=resourcesToRemove.optString(i);
        idsToRemove.add(new CmsUUID(id));
      }
      publish.removeResourcesFromPublishList(idsToRemove);
    }
    JSONArray groupsToPublish=toJsonArray(publish.getPublishGroups());
    result.put(JsonResponse.GROUPS.getName(),groupsToPublish);
  }
 else   if (action.equals(CmsADEServer.Action.PROJECTS)) {
    JSONArray manageableProjects=toJsonArray(publish.getManageableProjects());
    result.put(JsonResponse.PROJECTS.getName(),manageableProjects);
  }
 else   if (action.equals(CmsADEServer.Action.PUBLISH)) {
    if (!checkParameters(request,result,ParamPublish.RESOURCES)) {
      return result;
    }
    String resourcesParam=request.getParameter(ParamPublish.RESOURCES.getName());
    JSONArray idsToPublish=new JSONArray(resourcesParam);
    List<CmsResource> pubResources;
    try {
      pubResources=resourcesFromJson(idsToPublish);
    }
 catch (    CmsException e) {
      LOG.error(e.getLocalizedMessage(),e);
      result.put(CmsADEServer.JsonResponse.ERROR.getName(),e.getLocalizedMessage());
      return result;
    }
    Collections.sort(pubResources,I_CmsResource.COMPARE_DATE_LAST_MODIFIED);
    JSONArray resources=toJsonArray(publish.getBrokenResources(pubResources));
    if (resources.length() == 0) {
      publish.publishResources(pubResources);
    }
 else {
      result.put(JsonResponse.RESOURCES.getName(),resources);
    }
  }
  return result;
}
