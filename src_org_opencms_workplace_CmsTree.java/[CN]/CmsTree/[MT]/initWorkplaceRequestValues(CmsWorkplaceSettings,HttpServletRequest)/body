{
  setIncludeFiles("true".equals(request.getParameter("includefiles")));
  boolean rootloaded="true".equals(request.getParameter("rootloaded"));
  String resource=request.getParameter("resource");
  setTreeType(request.getParameter("type"));
  String currentResource;
  if (getTreeType() == null) {
    currentResource=getSettings().getExplorerResource();
  }
 else {
    currentResource=getSettings().getTreeResource(getTreeType());
  }
  String lastknown=request.getParameter("lastknown");
  if (resource != null) {
    resource=CmsResource.getFolderPath(resource);
    if (resource.startsWith(I_CmsConstants.VFS_FOLDER_SYSTEM + "/") && (!resource.startsWith(getSettings().getSite()))) {
      resource="/";
    }
  }
  if ((lastknown != null) && (!lastknown.endsWith("/"))) {
    lastknown+="/";
  }
  if ("/".equals(resource) && !"/".equals(currentResource) && (lastknown == null)&& !rootloaded) {
    lastknown="/";
    resource=currentResource;
    setNewTree(true);
  }
 else   if ("/".equals(resource)) {
    setNewTree(!rootloaded);
  }
 else {
    setNewTree(false);
  }
  if (getTreeType() != null) {
    getSettings().setTreeResource(getTreeType(),resource);
  }
  setTargetFolder(resource);
  setStartFolder(lastknown);
}
