{
  CmsObject cms=getCmsObject();
  CmsResource target=cms.readResource(changes.getTargetStructureId(),CmsResourceFilter.IGNORE_EXPIRATION);
  CmsLockActionRecord actionRecord=ensureLock(cms.getSitePath(target));
  try {
    internalUpdateProperties(cms,target,changes.getChanges());
  }
  finally {
    if (actionRecord.getChange() == LockChange.locked) {
      cms.unlockResource(cms.getSitePath(target));
    }
  }
}
