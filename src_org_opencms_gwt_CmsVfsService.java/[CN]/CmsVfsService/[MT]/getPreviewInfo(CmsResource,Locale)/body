{
  CmsObject cms=getCmsObject();
  String title="";
  try {
    CmsProperty titleProperty=cms.readPropertyObject(resource,CmsPropertyDefinition.PROPERTY_TITLE,false);
    title=titleProperty.getValue("");
  }
 catch (  CmsException e) {
    LOG.warn(e.getLocalizedMessage(),e);
  }
  if (CmsResourceTypeXmlContainerPage.isContainerPage(resource) || CmsResourceTypeXmlPage.isXmlPage(resource)) {
    return new CmsPreviewInfo(null,OpenCms.getLinkManager().substituteLinkForUnknownTarget(cms,resource.getRootPath()) + "?" + CmsJspTagEditable.PARAM_DISABLE_DIRECT_EDIT+ "=true",false,title,cms.getSitePath(resource));
  }
  if (CmsResourceTypeImage.getStaticTypeId() == resource.getTypeId()) {
    CmsImageScaler scaler=new CmsImageScaler(cms,resource);
    String content="<img src=\"" + OpenCms.getLinkManager().substituteLinkForUnknownTarget(cms,resource.getRootPath()) + "\" title=\""+ title+ "\" style=\"display:block\" />";
    CmsPreviewInfo result=new CmsPreviewInfo(content,null,false,title,cms.getSitePath(resource));
    result.setHeight(scaler.getHeight());
    result.setWidth(scaler.getWidth());
    return result;
  }
  if (CmsResourceTypeXmlContent.isXmlContent(resource)) {
    String previewContent=CmsPreviewService.getPreviewContent(getRequest(),getResponse(),cms,resource,locale);
    if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(previewContent)) {
      return new CmsPreviewInfo(previewContent,null,false,title,cms.getSitePath(resource));
    }
  }
  return new CmsPreviewInfo(null,OpenCms.getLinkManager().substituteLinkForUnknownTarget(cms,resource.getRootPath()) + "?" + CmsJspTagEditable.PARAM_DISABLE_DIRECT_EDIT+ "=true",true,title,cms.getSitePath(resource));
}
