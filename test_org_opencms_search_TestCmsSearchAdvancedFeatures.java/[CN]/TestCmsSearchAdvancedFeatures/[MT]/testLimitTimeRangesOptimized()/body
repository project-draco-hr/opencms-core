{
  CmsObject cms=getCmsObject();
  echo("Testing searching with optimized limiting to time ranges");
  CmsSearchIndex index=OpenCms.getSearchManager().getIndex(INDEX_OFFLINE);
  index.addConfigurationParameter(CmsSearchIndex.TIME_RANGE,"false");
  assertFalse("Index '" + INDEX_OFFLINE + "' checking time range but should not",index.isCheckingTimeRange());
  CmsSearch searchBean=new CmsSearch();
  List<CmsSearchResult> searchResult;
  String query="OpenCms";
  searchBean.init(cms);
  searchBean.setIndex(INDEX_OFFLINE);
  searchBean.setMatchesPerPage(1000);
  searchBean.setQuery(query);
  searchResult=searchBean.getSearchResult();
  int orgCount=searchResult.size();
  Date stamp=new Date();
  searchBean.getParameters().setMinDateCreated(stamp.getTime() - 1000);
  searchBean.init(cms);
  searchResult=searchBean.getSearchResult();
  assertEquals(1,searchResult.size());
  String resName="search_new_2.txt";
  cms.createResource(resName,CmsResourceTypePlain.getStaticTypeId(),"OpenCms".getBytes(),null);
  I_CmsReport report=new CmsShellReport(cms.getRequestContext().getLocale());
  OpenCms.getSearchManager().rebuildIndex(INDEX_OFFLINE,report);
  searchBean.init(cms);
  searchResult=searchBean.getSearchResult();
  assertEquals(2,searchResult.size());
  searchBean.getParameters().setMaxDateCreated(stamp.getTime() - 1000 * 60 * 60* 24);
  searchBean.getParameters().setMinDateCreated(Long.MIN_VALUE);
  searchBean.init(cms);
  searchResult=searchBean.getSearchResult();
  assertEquals(orgCount - 1,searchResult.size());
  searchBean.getParameters().setMaxDateCreated(stamp.getTime());
  searchBean.init(cms);
  searchResult=searchBean.getSearchResult();
  assertEquals(orgCount + 1,searchResult.size());
  stamp=new Date();
  searchBean.getParameters().setMinDateLastModified(stamp.getTime() + 1000 * 60 * 60* 24);
  searchBean.init(cms);
  searchResult=searchBean.getSearchResult();
  assertEquals(0,searchResult.size());
  CmsFile file=cms.readFile(resName);
  file.setContents("OpenCms ist toll".getBytes());
  cms.writeFile(file);
  report=new CmsShellReport(cms.getRequestContext().getLocale());
  OpenCms.getSearchManager().rebuildIndex(INDEX_OFFLINE,report);
  searchBean.getParameters().setMinDateLastModified(stamp.getTime());
  searchBean.init(cms);
  searchResult=searchBean.getSearchResult();
  assertEquals(2,searchResult.size());
  searchBean.getParameters().setMaxDateLastModified(stamp.getTime() - 1000 * 60 * 60* 24);
  searchBean.getParameters().setMinDateLastModified(Long.MIN_VALUE);
  searchBean.init(cms);
  searchResult=searchBean.getSearchResult();
  assertEquals(orgCount - 1,searchResult.size());
  searchBean.getParameters().setMaxDateLastModified(Long.MAX_VALUE);
  searchBean.init(cms);
  searchResult=searchBean.getSearchResult();
  assertEquals(orgCount + 1,searchResult.size());
}
