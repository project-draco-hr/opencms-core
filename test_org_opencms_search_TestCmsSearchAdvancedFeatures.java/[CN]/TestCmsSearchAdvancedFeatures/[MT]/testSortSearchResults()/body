{
  CmsObject cms=getCmsObject();
  echo("Testing sorting of search results");
  CmsSearch searchBean=new CmsSearch();
  List searchResult;
  String query="OpenCms";
  OpenCms.getSearchManager().rebuildIndex(INDEX_OFFLINE,new CmsShellReport(cms.getRequestContext().getLocale()));
  searchBean.init(cms);
  searchBean.setIndex(INDEX_OFFLINE);
  searchBean.setQuery(query);
  searchResult=searchBean.getSearchResult();
  Iterator i=searchResult.iterator();
  System.out.println("Result sorted by relevance:");
  while (i.hasNext()) {
    CmsSearchResult res=(CmsSearchResult)i.next();
    System.out.print(CmsStringUtil.padRight(cms.getRequestContext().removeSiteRoot(res.getPath()),50));
    System.out.print(CmsStringUtil.padRight(res.getTitle(),40));
    System.out.print(CmsDateUtil.getHeaderDate(res.getDateLastModified().getTime()));
    System.out.println("  score: " + res.getScore());
  }
  String lastTitle=null;
  searchBean.setSortOrder(CmsSearch.SORT_TITLE);
  searchResult=searchBean.getSearchResult();
  i=searchResult.iterator();
  System.out.println("Result sorted by title:");
  while (i.hasNext()) {
    CmsSearchResult res=(CmsSearchResult)i.next();
    System.out.print(CmsStringUtil.padRight(cms.getRequestContext().removeSiteRoot(res.getPath()),50));
    System.out.print(CmsStringUtil.padRight(res.getTitle(),40));
    System.out.print(CmsDateUtil.getHeaderDate(res.getDateLastModified().getTime()));
    System.out.println("  score: " + res.getScore());
    if (lastTitle != null) {
      assertTrue(lastTitle.compareTo(res.getTitle()) <= 0);
    }
    lastTitle=res.getTitle();
  }
  long lastTime=0;
  searchBean.setSortOrder(CmsSearch.SORT_DATE_LASTMODIFIED);
  searchResult=searchBean.getSearchResult();
  i=searchResult.iterator();
  System.out.println("Result sorted by date last modified:");
  while (i.hasNext()) {
    CmsSearchResult res=(CmsSearchResult)i.next();
    System.out.print(CmsStringUtil.padRight(cms.getRequestContext().removeSiteRoot(res.getPath()),50));
    System.out.print(CmsStringUtil.padRight(res.getTitle(),40));
    System.out.print(CmsDateUtil.getHeaderDate(res.getDateLastModified().getTime()));
    System.out.println("  score: " + res.getScore());
    if (lastTime > 0) {
      assertTrue(lastTime >= res.getDateLastModified().getTime());
      assertTrue(res.getScore() <= 100);
    }
    lastTime=res.getDateLastModified().getTime();
  }
  assertNull(searchBean.getSearchResultCategories());
}
