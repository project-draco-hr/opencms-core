{
  byte[] parsedHtml;
  m_tidy.setInputEncoding(encoding);
  m_tidy.setOutputEncoding(encoding);
  ByteArrayInputStream in=new ByteArrayInputStream(htmlInput);
  ByteArrayOutputStream out=new ByteArrayOutputStream();
  m_tidy.parse(in,out);
  int errors=m_tidy.getParseErrors();
  if (errors > 0) {
    if (OpenCms.getLog(this).isWarnEnabled()) {
      OpenCms.getLog(this).warn("[" + this.getClass().getName() + "] "+ " parse error converting HTML ");
    }
    throw new CmsHtmlConverterException("Found " + errors + " errors during HTML parsing",CmsHtmlConverterException.C_HTML_PARSING_ERROR);
  }
  parsedHtml=out.toByteArray();
  return parsedHtml;
}
