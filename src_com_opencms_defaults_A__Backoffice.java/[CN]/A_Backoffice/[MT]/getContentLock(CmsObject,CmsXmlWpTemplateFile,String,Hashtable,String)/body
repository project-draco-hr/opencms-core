{
  byte[] processResult=null;
  I_CmsSession session=(CmsSession)cms.getRequestContext().getSession(true);
  Class cdClass=getContentDefinitionClass();
  String id=(String)parameters.get("id");
  if (id == null)   id="";
  if (id != "") {
    session.putValue("idsave",id);
  }
 else {
    String idsave=(String)session.getValue("idsave");
    if (idsave == null)     idsave="";
    id=idsave;
    session.removeValue("idsave");
  }
  parameters.put("idlock",id);
  String action=(String)parameters.get("action");
  if (action == null || action.equals("")) {
    templateSelector="lock";
    Integer idInteger=null;
    String ls="";
    try {
      idInteger=Integer.valueOf(id);
    }
 catch (    Exception e) {
      String title="no title";
      Object o=null;
      o=getContentDefinitionConstructor(cms,cdClass,id);
      try {
        Method getLockstateMethod=(Method)cdClass.getMethod("getLockstate",new Class[]{});
        ls=(String)getLockstateMethod.invoke(o,new Object[0]);
      }
 catch (      Exception exc) {
        exc.printStackTrace();
      }
    }
    String title="no title";
    Object o=null;
    if (idInteger != null) {
      o=getContentDefinitionConstructor(cms,cdClass,idInteger);
      try {
        Method getLockstateMethod=(Method)cdClass.getMethod("getLockstate",new Class[]{});
        ls=(String)getLockstateMethod.invoke(o,new Object[0]);
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
    }
 else {
      o=getContentDefinitionConstructor(cms,cdClass,id);
      try {
        Method getLockstateMethod=(Method)cdClass.getMethod("getLockstate",new Class[]{});
        ls=(String)getLockstateMethod.invoke(o,new Object[0]);
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
    }
    String moduleName="";
    moduleName=(String)getClass().toString();
    moduleName=moduleName.substring(5);
    moduleName=moduleName.trim();
    moduleName=moduleName.replace('.','_');
    CmsXmlLanguageFile lang=new CmsXmlLanguageFile(cms);
    if (ls.equals("lock")) {
      template.setData("locktitle",lang.getLanguageValue("messagebox.title.unlock"));
      template.setData("lockstate",lang.getLanguageValue("messagebox.message1.unlock"));
    }
    if (ls.equals("nolock")) {
      template.setData("locktitle",lang.getLanguageValue("messagebox.title.lock"));
      template.setData("lockstate",lang.getLanguageValue("messagebox.message1.lock"));
    }
    if (ls.equals("lockuser")) {
      template.setData("locktitle",lang.getLanguageValue("messagebox.title.lockchange"));
      template.setData("lockstate",lang.getLanguageValue("messagebox.message1.lockchange"));
    }
    template.setData("newsentry",id);
    template.setData("setaction","default");
    parameters.put("action","done");
  }
 else {
    templateSelector="done";
    session.removeValue("idsave");
    Integer idInteger=null;
    String ls="";
    try {
      idInteger=Integer.valueOf(id);
    }
 catch (    Exception e) {
      ls="";
      String title="no title";
      Object o=null;
      o=getContentDefinitionConstructor(cms,cdClass,id);
      try {
        Method getLockstateMethod=(Method)cdClass.getMethod("getLockstate",new Class[]{});
        ls=(String)getLockstateMethod.invoke(o,new Object[0]);
      }
 catch (      Exception exce) {
        exce.printStackTrace();
      }
    }
    Object o=null;
    if (idInteger != null) {
      o=getContentDefinitionConstructor(cms,cdClass,idInteger);
      try {
        Method getLockstateMethod=(Method)cdClass.getMethod("getLockstate",new Class[]{});
        ls=(String)getLockstateMethod.invoke(o,new Object[0]);
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
    }
 else {
      o=getContentDefinitionConstructor(cms,cdClass,id);
      try {
        Method getLockstateMethod=(Method)cdClass.getMethod("getLockstate",new Class[]{});
        ls=(String)getLockstateMethod.invoke(o,new Object[0]);
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
    }
    try {
      Method getLockstateMethod=(Method)cdClass.getMethod("getLockstate",new Class[]{});
      ls=(String)getLockstateMethod.invoke(o,new Object[0]);
    }
 catch (    Exception e) {
      if (A_OpenCms.isLogging()) {
        A_OpenCms.log(C_OPENCMS_INFO,getClassName() + " Backoffice getContentLock: Method getLockstate throwed an exception!");
      }
    }
    if (ls.equals("lockuser")) {
      try {
        Method setLockstateMethod=(Method)cdClass.getMethod("setLockstate",new Class[]{String.class});
        setLockstateMethod.invoke(o,new Object[]{"lock"});
      }
 catch (      Exception e) {
        if (A_OpenCms.isLogging()) {
          A_OpenCms.log(C_OPENCMS_INFO,getClassName() + " Backoffice getContentLock: Method setLockstate throwed an exception!");
        }
      }
      try {
        Method writeMethod=(Method)cdClass.getMethod("write",new Class[]{CmsObject.class});
        writeMethod.invoke(o,new Object[]{cms});
      }
 catch (      Exception e) {
        if (A_OpenCms.isLogging()) {
          A_OpenCms.log(C_OPENCMS_INFO,getClassName() + " Backoffice getContentLock: Method write throwed an exception!");
        }
      }
      templateSelector="done";
    }
 else {
      if (ls.equals("lock")) {
        try {
          Method setLockstateMethod=(Method)cdClass.getMethod("setLockstate",new Class[]{String.class});
          setLockstateMethod.invoke(o,new Object[]{"nolock"});
        }
 catch (        Exception e) {
          if (A_OpenCms.isLogging()) {
            A_OpenCms.log(C_OPENCMS_INFO,getClassName() + ": Backoffice getContentLock: Could not set lockstate!");
          }
        }
        try {
          Method writeMethod=(Method)cdClass.getMethod("write",new Class[]{CmsObject.class});
          writeMethod.invoke(o,new Object[]{cms});
        }
 catch (        Exception e) {
          if (A_OpenCms.isLogging()) {
            A_OpenCms.log(C_OPENCMS_INFO,getClassName() + ": Backoffice getContentLock: Could not set lockstate!");
          }
        }
        templateSelector="done";
      }
 else {
        try {
          Method setLockstateMethod=(Method)cdClass.getMethod("setLockstate",new Class[]{String.class});
          setLockstateMethod.invoke(o,new Object[]{"lock"});
        }
 catch (        Exception e) {
          if (A_OpenCms.isLogging()) {
            A_OpenCms.log(C_OPENCMS_INFO,getClassName() + ": Backoffice getContentLock: Could not set lockstate!");
          }
        }
        try {
          Method writeMethod=(Method)cdClass.getMethod("write",new Class[]{CmsObject.class});
          writeMethod.invoke(o,new Object[]{cms});
        }
 catch (        Exception e) {
          if (A_OpenCms.isLogging()) {
            A_OpenCms.log(C_OPENCMS_INFO,getClassName() + ": Backoffice getContentLock: Could not write to content definition!");
          }
        }
      }
    }
  }
  processResult=startProcessing(cms,template,elementName,parameters,templateSelector);
  return processResult;
}
