{
  byte[] processResult=null;
  Class cdClass=getContentDefinitionClass();
  String singleSelection="";
  String allSelections="";
  CmsSession session=(CmsSession)cms.getRequestContext().getSession(true);
  String selectBoxValue=(String)parameters.get("selectbox");
  if (selectBoxValue == null) {
    if ((String)session.getValue("selectBoxValue") != null) {
      selectBoxValue=(String)session.getValue("selectBoxValue");
    }
 else {
      selectBoxValue="0";
    }
  }
  boolean filterChanged=true;
  if (selectBoxValue.equals((String)session.getValue("selectBoxValue"))) {
    filterChanged=false;
  }
 else {
    filterChanged=true;
  }
  System.err.println("getContentHead selectBoxValue: " + selectBoxValue + " session: "+ (String)session.getValue("selectBoxValue"));
  session.putValue("selectBoxValue",selectBoxValue);
  session.putValue("filter",selectBoxValue);
  String filterParam=(String)parameters.get("filterparameter");
  System.err.println("getContentHead selectBoxValue: " + selectBoxValue + " filterParam: "+ filterParam);
  String action=(String)parameters.get("action");
  String setaction=(String)parameters.get("setaction");
  System.err.println("getContentHead: action: " + action);
  if (filterParam != null) {
    session.putValue("filterparameter",filterParam);
  }
  String moduleName="";
  moduleName=(String)getClass().toString();
  moduleName=moduleName.substring(5);
  moduleName=moduleName.trim();
  moduleName=moduleName.replace('.','_');
  CmsXmlLanguageFile lang=new CmsXmlLanguageFile(cms);
  template.setData("filterlabel",lang.getLanguageValue(moduleName + ".label.filter"));
  template.setData("filterparameterlabel",lang.getLanguageValue(moduleName + ".label.filterparameter"));
  Vector filterMethods=getFilterMethods(cms);
  FilterMethod filterMethod=null;
  if (selectBoxValue == null) {
    System.err.println("store the default filter in the session...");
    FilterMethod defaultFilter=(FilterMethod)filterMethods.firstElement();
    session.putValue("selectbox",defaultFilter.getFilterName());
  }
  FilterMethod currentFilter=(FilterMethod)filterMethods.elementAt(Integer.parseInt(selectBoxValue));
  if (currentFilter.hasUserParameter()) {
    if (filterChanged) {
      template.setData("filterparameter",currentFilter.getDefaultFilterParam());
      session.putValue("filterparameter",currentFilter.getDefaultFilterParam());
    }
 else {
      if (filterParam != null) {
        template.setData("filterparameter",filterParam);
      }
 else {
        template.setData("filterparameter",(String)session.getValue("filterparameter"));
      }
    }
    template.setData("insertFilter",template.getProcessedDataValue("selectboxWithParam",this,parameters));
  }
 else {
    template.setData("insertFilter",template.getProcessedDataValue("singleSelectbox",this,parameters));
  }
  String createButton=null;
  try {
    createButton=(String)getCreateUrl(cms,null,null,null);
  }
 catch (  Exception e) {
  }
  if (createButton == null) {
    String cb=template.getDataValue("nowand");
    template.setData("createbutton",cb);
  }
 else {
    String cb=template.getProcessedDataValue("wand",this,parameters);
    template.setData("createbutton",cb);
  }
  processResult=startProcessing(cms,template,elementName,parameters,templateSelector);
  return processResult;
}
