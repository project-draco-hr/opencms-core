{
  StringBuffer html=new StringBuffer(512);
  if (m_con == null) {
    return null;
  }
  SQLException exception=null;
  if (db.equals("mysql")) {
    String statement="SELECT @@max_allowed_packet;";
    Statement stmt=null;
    ResultSet rs=null;
    long map=0;
    try {
      stmt=m_con.createStatement();
      rs=stmt.executeQuery(statement);
      if (rs.next()) {
        map=rs.getLong(1);
      }
    }
 catch (    SQLException e) {
      exception=e;
    }
 finally {
      if (stmt != null) {
        try {
          stmt.close();
        }
 catch (        SQLException e) {
        }
      }
    }
    if (exception == null) {
      if (map > 0) {
        html.append("MySQL system variable <code>'max_allowed_packet'</code> is set to ");
        html.append(map);
        html.append(" Bytes.<p>\n");
      }
      html.append("Please, note that it will not be possible for OpenCms to handle files bigger than this value.<p>\n");
      if (map < 15 * 1024 * 1024) {
        m_errors.add("<b>Your <code>'max_allowed_packet'</code> variable is set to less than 16Mb (" + map + ").</b>\n"+ "The recommended value for running OpenCms is 16Mb."+ "Please change your MySQL configuration (in your <code>mi.ini</code> or <code>my.cnf</code> file).\n");
      }
    }
  }
  if ((exception != null) || db.equals("mysql_3")) {
    html.append("<i>OpenCms was not able to detect the value of your <code>'max_allowed_packet'</code> variable.</i><p>\n");
    html.append("Please, note that it will not be possible for OpenCms to handle files bigger than this value.<p>\n");
    html.append("<b>The recommended value for running OpenCms is 16Mb, please set it in your MySQL configuration (in your <code>mi.ini</code> or <code>my.cnf</code> file).</b>\n");
    if (exception != null) {
      html.append(CmsException.getStackTraceAsString(exception));
    }
  }
  if (html.length() == 0) {
    return null;
  }
  return html.toString();
}
