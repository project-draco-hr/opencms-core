{
  ComboBox siteSelect=new ComboBox();
  siteSelect.addContainerProperty("Title",String.class,null);
  siteSelect.setItemCaptionPropertyId("Title");
  List<CmsSite> sites=OpenCms.getSiteManager().getAvailableSites(getCmsObject(),true);
  CmsSite current=null;
  for (  CmsSite site : sites) {
    Item selectItem=siteSelect.addItem(site);
    selectItem.getItemProperty("Title").setValue(substituteSiteTitle(site.getTitle()));
    if (((site.getSiteRoot() != null) && site.getSiteRoot().equals(getCmsObject().getRequestContext().getSiteRoot())) || ((site.getSiteRoot() == null) && (getCmsObject().getRequestContext().getSiteRoot() == null))) {
      current=site;
    }
  }
  siteSelect.setValue(current);
  siteSelect.setImmediate(true);
  siteSelect.addValueChangeListener(new ValueChangeListener(){
    public void valueChange(    ValueChangeEvent event){
      Notification.show("Selected site: " + ((CmsSite)event.getProperty().getValue()).getTitle());
      getCmsObject().getRequestContext().setSiteRoot(((CmsSite)event.getProperty().getValue()).getSiteRoot());
      m_fileBrowser.populateFolderTree();
      m_fileBrowser.populateFileTable("/");
    }
  }
);
  m_buttonBar.addComponent(siteSelect);
}
