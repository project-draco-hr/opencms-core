{
  CmsDialogUploadButtonHandler buttonHandler=new CmsDialogUploadButtonHandler(new Supplier<I_CmsUploadContext>(){
    @Override public I_CmsUploadContext get(){
      return new I_CmsUploadContext(){
        @Override public void onUploadFinished(        Collection<CmsFileInfo> uploadedFiles){
          if ((uploadedFiles != null) && !uploadedFiles.isEmpty()) {
            setValue(m_uploadTarget + uploadedFiles.iterator().next().getFileName(),true);
          }
        }
      }
;
    }
  }
);
  buttonHandler.setIsTargetRootPath(false);
  m_uploadButton=new CmsUploadButton(buttonHandler);
  m_uploadButton.setText(null);
  m_uploadButton.setButtonStyle(ButtonStyle.TRANSPARENT,null);
  m_uploadButton.setImageClass(I_CmsImageBundle.INSTANCE.style().uploadSmallIcon());
  m_uploadButton.removeStyleName(I_CmsLayoutBundle.INSTANCE.generalCss().cornerAll());
  m_main=uibinder.createAndBindUi(this);
  initWidget(m_main);
  m_allowUploads=allowUploads;
  if (m_allowUploads) {
    m_fieldBox.addClassName(I_CmsLayoutBundle.INSTANCE.galleryFieldCss().hasUpload());
  }
  m_configuration=configuration;
  I_CmsLayoutBundle.INSTANCE.galleryFieldCss().ensureInjected();
  m_opener.setButtonStyle(ButtonStyle.TRANSPARENT,null);
  m_opener.setImageClass(I_CmsImageBundle.INSTANCE.style().popupIcon());
}
