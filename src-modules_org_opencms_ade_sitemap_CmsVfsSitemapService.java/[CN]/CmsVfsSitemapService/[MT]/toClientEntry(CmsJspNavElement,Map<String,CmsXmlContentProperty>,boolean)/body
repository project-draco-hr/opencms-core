{
  CmsResource entryPage=null;
  CmsObject cms=getCmsObject();
  CmsClientSitemapEntry clientEntry=new CmsClientSitemapEntry();
  CmsResource entryFolder=null;
  Map<String,CmsSimplePropertyValue> clientProperties=CmsXmlContentPropertyHelper.convertPropertySimpleValues(getCmsObject(),Collections.<String,CmsSimplePropertyValue>emptyMap(),propertyConfig,true);
  if (navElement.getResource().isFolder()) {
    entryFolder=navElement.getResource();
    entryPage=cms.readDefaultFile(entryFolder);
    clientEntry.setName(entryFolder.getName());
    Map<String,String> pageProperties;
    if (entryPage == null) {
      pageProperties=Collections.emptyMap();
      entryPage=entryFolder;
    }
 else {
      pageProperties=CmsProperty.toMap(cms.readPropertyObjects(entryPage,false));
    }
    clientProperties=generatePropertyValues(propertyConfig,pageProperties,navElement.getProperties());
    if (!isRoot && isSubSitemap(navElement)) {
      clientEntry.setEntryType(EntryType.subSitemap);
    }
  }
 else   if (isRoot) {
    entryFolder=cms.readResource("/");
    entryPage=navElement.getResource();
    clientEntry.setName("");
    clientProperties=generatePropertyValues(propertyConfig,navElement.getProperties(),CmsProperty.toMap(cms.readPropertyObjects(entryFolder,false)));
  }
 else {
    entryPage=navElement.getResource();
    clientEntry.setName(entryPage.getName());
    clientEntry.setEntryType(EntryType.leaf);
  }
  if (entryPage == null) {
    return null;
  }
  String path=cms.getSitePath(entryPage);
  if (entryFolder != null) {
    CmsLock folderLock=cms.getLock(entryFolder);
    clientEntry.setHasForeignFolderLock(!folderLock.isUnlocked() && !folderLock.isOwnedBy(cms.getRequestContext().currentUser()));
  }
  clientEntry.setId(entryPage.getStructureId());
  if (navElement.isInNavigation()) {
    clientEntry.setTitle(navElement.getNavText());
  }
 else {
    String title=navElement.getProperty(CmsPropertyDefinition.PROPERTY_TITLE);
    if (CmsStringUtil.isEmptyOrWhitespaceOnly(title)) {
      title=clientEntry.getName();
    }
    clientEntry.setTitle(title);
  }
  clientEntry.setVfsPath(path);
  navElement.getProperties();
  clientEntry.setProperties(clientProperties);
  clientEntry.setSitePath(CmsResource.getFolderPath(path));
  clientEntry.setLock(generateClientLock(entryPage));
  clientEntry.setInNavigation(isRoot || navElement.isInNavigation());
  return clientEntry;
}
