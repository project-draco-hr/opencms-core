{
  CmsBrokenLinkData result=null;
  try {
    CmsObject cms=getCmsObject();
    List<CmsResource> descendands=new ArrayList<CmsResource>();
    List<CmsClientSitemapEntry> closedEntryTrees=new ArrayList<CmsClientSitemapEntry>();
    for (    CmsUUID uuid : closed) {
      CmsResource res=getCmsObject().readResource(uuid);
      closedEntryTrees.add(getSubTree(cms,getCmsObject().getSitePath(res)));
      descendands.add(res);
      descendands.addAll(getDescendants(getCmsObject().readResource(uuid)));
    }
    for (    CmsUUID uuid : open) {
      descendands.add(getCmsObject().readResource(uuid));
    }
    MultiValueMap linkMap=MultiValueMap.decorate(new HashMap<Object,Object>(),FactoryUtils.instantiateFactory(HashSet.class));
    for (    CmsResource resource : descendands) {
      List<CmsResource> linkSources=getLinkSources(cms,resource.getStructureId());
      for (      CmsResource source : linkSources) {
        linkMap.put(resource,source);
      }
    }
    result=new CmsBrokenLinkData();
    result.setBrokenLinks(getBrokenLinkBeans(linkMap));
    result.setClosedEntries(closedEntryTrees);
  }
 catch (  Throwable e) {
    error(e);
  }
  return result;
}
