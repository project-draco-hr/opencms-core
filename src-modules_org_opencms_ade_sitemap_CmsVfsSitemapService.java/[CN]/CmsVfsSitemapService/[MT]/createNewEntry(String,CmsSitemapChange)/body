{
  CmsObject cms=getCmsObject();
  CmsClientSitemapEntry newEntry=null;
  if (change.getParentId() != null) {
    CmsResource parentFolder=cms.readResource(change.getParentId());
    String entryPath="";
    CmsResource entryFolder=null;
    CmsResource newRes=null;
    byte[] content=null;
    if (change.getNewCopyResourceId() != null) {
      CmsResource copyPage=cms.readResource(change.getNewCopyResourceId());
      content=cms.readFile(copyPage).getContents();
    }
    if (isRedirectType(change.getNewResourceTypeId())) {
      entryPath=CmsStringUtil.joinPaths(cms.getSitePath(parentFolder),change.getName());
      newRes=cms.createResource(entryPath,change.getNewResourceTypeId(),content,null);
      cms.writePropertyObjects(newRes,generateInheritProperties(change,newRes));
    }
 else {
      String entryFolderPath=CmsStringUtil.joinPaths(cms.getSitePath(parentFolder),change.getName() + "/");
      CmsUUID entryId=change.getEntryId() != null ? change.getEntryId() : new CmsUUID();
      entryFolder=new CmsResource(entryId,new CmsUUID(),entryFolderPath,CmsResourceTypeFolder.getStaticTypeId(),true,0,cms.getRequestContext().getCurrentProject().getUuid(),CmsResource.STATE_NEW,System.currentTimeMillis(),cms.getRequestContext().getCurrentUser().getId(),System.currentTimeMillis(),cms.getRequestContext().getCurrentUser().getId(),CmsResource.DATE_RELEASED_DEFAULT,CmsResource.DATE_EXPIRED_DEFAULT,1,0,System.currentTimeMillis(),0);
      entryFolder=cms.createResource(entryFolderPath,entryFolder,null,generateInheritProperties(change,entryFolder));
      entryPath=CmsStringUtil.joinPaths(entryFolderPath,"index.html");
      newRes=cms.createResource(entryPath,change.getNewResourceTypeId(),content,generateOwnProperties(change));
    }
    if (entryFolder != null) {
      tryUnlock(entryFolder);
      newEntry=toClientEntry(getNavBuilder().getNavigationForResource(cms.getSitePath(entryFolder)),false);
    }
    tryUnlock(newRes);
    if (newEntry == null) {
      newEntry=toClientEntry(getNavBuilder().getNavigationForResource(cms.getSitePath(newRes)),false);
    }
    newEntry.setPosition(-1);
    change.getClipBoardData().getModifications().remove(null);
    change.getClipBoardData().getModifications().put(newEntry.getId(),newEntry);
  }
  return newEntry;
}
