{
  CmsSitemapData result=null;
  CmsObject cms=getCmsObject();
  CmsSitemapManager sitemapMgr=OpenCms.getSitemapManager();
  try {
    String openPath=getRequest().getParameter("path");
    if (CmsStringUtil.isEmptyOrWhitespaceOnly(openPath)) {
      openPath="/";
    }
    String entryPoint=sitemapMgr.findEntryPoint(cms,openPath);
    Map<String,CmsXmlContentProperty> propertyConfig=sitemapMgr.getElementPropertyConfiguration(cms,entryPoint);
    Map<String,CmsComputedPropertyValue> parentProperties=generateParentProperties(propertyConfig,entryPoint);
    String siteRoot=cms.getRequestContext().getSiteRoot();
    String exportName=sitemapMgr.getExportnameForSiteRoot(siteRoot);
    String exportRfsPrefix=OpenCms.getStaticExportManager().getDefaultRfsPrefix();
    CmsSite site=OpenCms.getSiteManager().getSiteForSiteRoot(siteRoot);
    boolean isSecure=site.hasSecureServer();
    CmsSitemapRuntimeInfo sitemapInfo=sitemapMgr.getRuntimeInfoForSite(cms,siteRoot,cms.getRequestContext().getLocale());
    CmsDetailPageTable detailPages=sitemapInfo.getDetailPageTable();
    List<CmsResourceTypeInfo> resourceTypeInfos=new ArrayList<CmsResourceTypeInfo>();
    resourceTypeInfos=getResourceTypeInfos(getCmsObject(),entryPoint);
    String parentSitemap=null;
    if (!entryPoint.equals("/")) {
      parentSitemap=sitemapMgr.findEntryPoint(cms,CmsResource.getParentFolder(entryPoint));
    }
    result=new CmsSitemapData(getDefaultTemplate(entryPoint),getTemplates(),propertyConfig,getClipboardData(),parentProperties,exportName,exportRfsPrefix,isSecure,"",isDisplayToolbar(getRequest()),OpenCms.getResourceManager().getResourceType(CmsResourceTypeXmlContainerPage.getStaticTypeName()).getTypeId(),parentSitemap,getRootEntry(entryPoint,propertyConfig),openPath,30,detailPages,resourceTypeInfos);
  }
 catch (  Throwable e) {
    error(e);
  }
  return result;
}
