{
  CmsSitemapData result=null;
  CmsObject cms=getCmsObject();
  CmsSitemapManager sitemapMgr=OpenCms.getSitemapManager();
  try {
    String openPath=getRequest().getParameter("path");
    if (CmsStringUtil.isEmptyOrWhitespaceOnly(openPath)) {
      openPath="/";
    }
    CmsResource sitemap=cms.readResource(sitemapUri);
    CmsProperty configProp=cms.readPropertyObject(openPath,CmsPropertyDefinition.PROPERTY_ADE_SITEMAP_CONFIG,true);
    String configFilePath=configProp.getValue();
    Map<String,CmsXmlContentProperty> propertyConfig=sitemapMgr.getElementPropertyConfiguration(cms,sitemap,true);
    I_CmsXmlContentHandler contentHandler=CmsXmlContentDefinition.getContentHandlerForResource(cms,sitemap);
    CmsMacroResolver resolver=CmsXmlContentPropertyHelper.getMacroResolverForProperties(cms,contentHandler);
    Map<String,CmsXmlContentProperty> resolvedProps=CmsXmlContentPropertyHelper.resolveMacrosInProperties(propertyConfig,resolver);
    String entryPoint="/";
    Map<String,CmsComputedPropertyValue> parentProperties=generateParentProperties(propertyConfig,entryPoint);
    String siteRoot=cms.getRequestContext().getSiteRoot();
    String exportName=sitemapMgr.getExportnameForSiteRoot(siteRoot);
    String exportRfsPrefix=OpenCms.getStaticExportManager().getDefaultRfsPrefix();
    CmsSite site=OpenCms.getSiteManager().getSiteForSiteRoot(siteRoot);
    boolean isSecure=site.hasSecureServer();
    CmsSitemapRuntimeInfo sitemapInfo=sitemapMgr.getRuntimeInfoForSite(cms,siteRoot,cms.getRequestContext().getLocale());
    CmsDetailPageTable detailPages=sitemapInfo.getDetailPageTable();
    List<CmsResourceTypeInfo> resourceTypeInfos=new ArrayList<CmsResourceTypeInfo>();
    resourceTypeInfos=getResourceTypeInfos(getCmsObject(),sitemapUri);
    int maxDepth=sitemapMgr.getMaxDepth(cms,sitemap);
    result=new CmsSitemapData(getDefaultTemplate(sitemapUri),getTemplates(),resolvedProps,getClipboardData(),parentProperties,exportName,exportRfsPrefix,isSecure,"",isDisplayToolbar(getRequest()),OpenCms.getResourceManager().getResourceType(CmsResourceTypeXmlContainerPage.getStaticTypeName()).getTypeId(),null,getRootEntry(propertyConfig),sitemap.getDateLastModified(),openPath,maxDepth,detailPages,resourceTypeInfos,configFilePath);
  }
 catch (  Throwable e) {
    error(e);
  }
  return result;
}
