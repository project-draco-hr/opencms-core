{
  CmsSitemapData result=null;
  CmsObject cms=getCmsObject();
  CmsSitemapManager sitemapMgr=OpenCms.getSitemapManager();
  try {
    String openPath=getRequest().getParameter("path");
    if (CmsStringUtil.isEmptyOrWhitespaceOnly(openPath)) {
      openPath="/";
    }
    String entryPoint=sitemapMgr.findEntryPoint(cms,openPath);
    Map<String,CmsXmlContentProperty> propertyConfig=new HashMap<String,CmsXmlContentProperty>(sitemapMgr.getElementPropertyConfiguration(cms,entryPoint));
    Map<String,CmsComputedPropertyValue> parentProperties=generateParentProperties(propertyConfig,entryPoint);
    String siteRoot=cms.getRequestContext().getSiteRoot();
    String exportName=sitemapMgr.getExportnameForSiteRoot(siteRoot);
    String exportRfsPrefix=OpenCms.getStaticExportManager().getDefaultRfsPrefix();
    CmsSite site=OpenCms.getSiteManager().getSiteForSiteRoot(siteRoot);
    boolean isSecure=site.hasSecureServer();
    String parentSitemap=null;
    if (!entryPoint.equals("/")) {
      parentSitemap=sitemapMgr.findEntryPoint(cms,CmsResource.getParentFolder(entryPoint));
    }
    CmsSitemapConfigurationData sitemapConfig=OpenCms.getADEConfigurationManager().getSitemapConfiguration(cms,cms.getRequestContext().addSiteRoot(openPath));
    String noEdit="";
    CmsNewResourceInfo defaultNewInfo=null;
    List<CmsNewResourceInfo> newResourceInfos=null;
    CmsDetailPageTable detailPages=null;
    List<CmsNewResourceInfo> resourceTypeInfos=null;
    boolean canEditDetailPages=false;
    boolean isOnlineProject=CmsProject.isOnlineProject(cms.getRequestContext().currentProject().getUuid());
    if (sitemapConfig == null) {
      noEdit="No sitemap configuration available.";
    }
 else {
      detailPages=sitemapConfig.getDetailPageTable();
      if (!isOnlineProject) {
        CmsConfigurationItem containerpageConfigItem=sitemapConfig.getTypeConfiguration().get(CmsResourceTypeXmlContainerPage.getStaticTypeName());
        if (containerpageConfigItem != null) {
          resourceTypeInfos=getResourceTypeInfos(getCmsObject(),entryPoint,containerpageConfigItem.getSourceFile().getStructureId());
          defaultNewInfo=createNewResourceInfo(cms,containerpageConfigItem);
        }
        canEditDetailPages=!(sitemapConfig.getLastSource().isModuleConfiguration());
        newResourceInfos=getNewResourceInfos(cms,entryPoint);
      }
    }
    if (isOnlineProject) {
      noEdit="Can't edit sitemap in online project.";
    }
    result=new CmsSitemapData(getDefaultTemplate(entryPoint),getTemplates(),propertyConfig,getClipboardData(),parentProperties,exportName,exportRfsPrefix,isSecure,noEdit,isDisplayToolbar(getRequest()),defaultNewInfo,newResourceInfos,parentSitemap,getRootEntry(entryPoint,propertyConfig),openPath,30,detailPages,resourceTypeInfos,canEditDetailPages);
  }
 catch (  Throwable e) {
    error(e);
  }
  return result;
}
