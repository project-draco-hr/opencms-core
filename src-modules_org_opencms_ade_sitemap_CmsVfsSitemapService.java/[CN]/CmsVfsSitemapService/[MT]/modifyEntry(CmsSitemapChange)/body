{
  CmsObject cms=getCmsObject();
  CmsResource entryPage=null;
  CmsResource entryFolder=null;
  try {
    if (hasPageChanges(change)) {
      entryPage=cms.readResource(change.getEntryId());
      cms.lockResourceTemporary(entryPage);
    }
    if (hasFolderChanges(change)) {
      entryFolder=cms.readParentFolder(change.getEntryId());
      cms.lockResourceTemporary(entryFolder);
    }
    if (entryPage != null) {
      cms.writePropertyObjects(cms.getSitePath(entryPage),generateOwnProperties(change));
    }
    if (entryFolder != null) {
      if (change.hasNewParent() || change.hasChangedName()) {
        String destinationPath;
        if (change.hasNewParent()) {
          CmsResource futureParent=cms.readParentFolder(change.getParentId());
          destinationPath=CmsStringUtil.joinPaths(cms.getSitePath(futureParent),change.getName() + "/");
        }
 else {
          destinationPath=CmsStringUtil.joinPaths(CmsResource.getParentFolder(cms.getSitePath(entryFolder)),change.getName());
        }
        cms.moveResource(cms.getSitePath(entryFolder),destinationPath);
        entryFolder=cms.readResource(entryFolder.getStructureId());
      }
      cms.writePropertyObjects(cms.getSitePath(entryFolder),generateInheritProperties(change,entryFolder));
    }
  }
  finally {
    if (entryPage != null) {
      try {
        cms.unlockResource(entryPage);
      }
 catch (      CmsException e) {
        LOG.debug(e);
      }
    }
    if (entryFolder != null) {
      try {
        cms.unlockResource(entryFolder);
      }
 catch (      CmsException e) {
        LOG.debug(e);
      }
    }
  }
}
