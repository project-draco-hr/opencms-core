{
  int keepVersions=Integer.parseInt((String)parameters.get(PARAM_KEEPVERSIONS));
  boolean clearDeleted=Boolean.valueOf((String)parameters.get(PARAM_CLEARDELETED)).booleanValue();
  String keepTimeRangeStr=(String)parameters.get(PARAM_KEEPTIMERANGE);
  int keepTimeRange=-1;
  if (!CmsStringUtil.isEmptyOrWhitespaceOnly(keepTimeRangeStr)) {
    keepTimeRange=Integer.parseInt(keepTimeRangeStr);
  }
  long timeDeleted=-1;
  if (clearDeleted) {
    GregorianCalendar cal=new GregorianCalendar();
    cal.add(Calendar.DAY_OF_YEAR,(keepTimeRange) * -1);
    timeDeleted=cal.getTimeInMillis();
  }
  int keepDeletedVersions=keepVersions;
  if (!clearDeleted) {
    keepDeletedVersions=-1;
  }
  CmsLogReport report=new CmsLogReport(cms.getRequestContext().getLocale(),CmsHistoryClearJob.class);
  cms.deleteHistoricalVersions(cms.getRequestContext().getUri(),keepVersions,keepDeletedVersions,timeDeleted,report);
  return null;
}
