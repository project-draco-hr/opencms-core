{
  CmsObject cms=getCmsObject();
  originalSchema="org/opencms/xml/content/" + originalSchema;
  originalFile="org/opencms/xml/content/" + originalFile;
  changedSchema="org/opencms/xml/content/" + changedSchema;
  changedFile="org/opencms/xml/content/" + changedFile;
  CmsXmlEntityResolver resolver=new CmsXmlEntityResolver(cms);
  cacheSchema(resolver,schemaId,originalSchema);
  String content=CmsFileUtil.readFile(originalFile,CmsEncoder.ENCODING_UTF_8);
  CmsXmlContent xmlcontent=CmsXmlContentFactory.unmarshal(content,CmsEncoder.ENCODING_UTF_8,resolver);
  cms.createResource(filename,OpenCms.getResourceManager().getResourceType("xmlcontent").getTypeId(),xmlcontent.toString().getBytes(xmlcontent.getEncoding()),Collections.<CmsProperty>emptyList());
  CmsFile file=cms.readFile(filename);
  CmsXmlContent xmlcontent2=CmsXmlContentFactory.unmarshal(cms,file);
  cms.getRequestContext().setAttribute(CmsXmlContent.AUTO_CORRECTION_ATTRIBUTE,Boolean.TRUE);
  cms.writeFile(file);
  assertXmlContent(xmlcontent2,originalFile,resolver);
  cacheSchema(resolver,schemaId,changedSchema);
  cms.writeFile(file);
  file=cms.readFile(filename);
  xmlcontent2=CmsXmlContentFactory.unmarshal(cms,file);
  assertXmlContent(xmlcontent2,changedFile,resolver);
}
