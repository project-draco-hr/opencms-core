{
  CmsFlexController controller=CmsFlexController.getController(req);
  FileUse useAction=FileUse.URI;
  if (action != null) {
    useAction=FileUse.parse(action);
  }
  String vfsUri=null;
  String sitemapUri=null;
  boolean search=false;
  if (useAction != null) {
switch (useAction) {
case URI:
case PARENT:
      vfsUri=controller.getCmsObject().getRequestContext().getUri();
    break;
case SEARCH:
case SEARCH_URI:
case SEARCH_PARENT:
  vfsUri=controller.getCmsObject().getRequestContext().getUri();
search=true;
break;
case ELEMENT_URI:
case THIS:
vfsUri=controller.getCurrentRequest().getElementUri();
break;
case SEARCH_ELEMENT_URI:
case SEARCH_THIS:
vfsUri=controller.getCurrentRequest().getElementUri();
search=true;
break;
case SITEMAP:
sitemapUri=(String)req.getAttribute(CmsSitemapResourceHandler.SITEMAP_CURRENT_URI);
if (sitemapUri == null) {
vfsUri=controller.getCmsObject().getRequestContext().getUri();
}
break;
case SEARCH_SITEMAP:
sitemapUri=(String)req.getAttribute(CmsSitemapResourceHandler.SITEMAP_CURRENT_URI);
if (sitemapUri == null) {
vfsUri=controller.getCmsObject().getRequestContext().getUri();
}
search=true;
break;
}
}
 else {
vfsUri=CmsLinkManager.getAbsoluteUri(action,controller.getCurrentRequest().getElementUri());
search=false;
}
String value;
if (vfsUri != null) {
value=controller.getCmsObject().readPropertyObject(vfsUri,property,search).getValue(defaultValue);
}
 else if (!search) {
value=((CmsSiteEntryBean)req.getAttribute(CmsADEManager.ATTR_SITEMAP_ENTRY)).getProperties().get(property);
}
 else {
value=CmsSitemapResourceHandler.getInstance().getSearchProperties(controller.getCmsObject(),sitemapUri).get(property);
}
if (escape) {
value=CmsEncoder.escapeHtml(value);
}
return value;
}
