{
  CmsObject cms=getCmsObject();
  echo("Testing the validation for values in the XML content");
  CmsXmlEntityResolver resolver=new CmsXmlEntityResolver(cms);
  String content;
  CmsXmlContent xmlcontent;
  content=CmsFileUtil.readFile("org/opencms/xml/content/xmlcontent-definition-7.xsd",CmsEncoder.C_UTF8_ENCODING);
  CmsXmlEntityResolver.cacheSystemId(C_SCHEMA_SYSTEM_ID_7,content.getBytes(CmsEncoder.C_UTF8_ENCODING));
  content=CmsFileUtil.readFile("org/opencms/xml/content/xmlcontent-7.xml",CmsEncoder.C_UTF8_ENCODING);
  xmlcontent=CmsXmlContentFactory.unmarshal(content,CmsEncoder.C_UTF8_ENCODING,resolver);
  xmlcontent.addValue(cms,"DeepCascade",Locale.ENGLISH,0);
  xmlcontent.addValue(cms,"DeepCascade",Locale.ENGLISH,1);
  xmlcontent.addLocale(cms,Locale.GERMAN);
  xmlcontent.addValue(cms,"DeepCascade",Locale.GERMAN,0);
  System.out.println(xmlcontent.toString());
  CmsXmlContentErrorHandler errorHandler;
  errorHandler=xmlcontent.validate(cms);
  assertFalse(errorHandler.hasErrors());
  assertFalse(errorHandler.hasWarnings());
  I_CmsXmlContentValue value1;
  value1=xmlcontent.getValue("Test",Locale.ENGLISH);
  value1.setStringValue(cms,"This produces a warning!");
  errorHandler=xmlcontent.validate(cms);
  assertFalse(errorHandler.hasErrors());
  assertTrue(errorHandler.hasWarnings());
  value1.setStringValue(cms,"This produces a warning and an error!");
  errorHandler=xmlcontent.validate(cms);
  assertTrue(errorHandler.hasErrors());
  assertTrue(errorHandler.hasWarnings());
  assertEquals(1,errorHandler.getErrors().size());
  assertEquals(1,errorHandler.getWarnings().size());
  value1=xmlcontent.getValue("Toast",Locale.ENGLISH);
  value1.setStringValue(cms,"This produces a warning but no error!");
  errorHandler=xmlcontent.validate(cms);
  assertTrue(errorHandler.hasErrors());
  assertTrue(errorHandler.hasWarnings());
  assertEquals(1,errorHandler.getErrors(Locale.ENGLISH).size());
  assertEquals(2,errorHandler.getWarnings(Locale.ENGLISH).size());
  value1=xmlcontent.addValue(cms,"Option",Locale.ENGLISH,0);
  assertEquals("Default value from the appinfos",value1.getStringValue(cms));
  System.out.println(xmlcontent.toString());
  xmlcontent=CmsXmlContentFactory.unmarshal(xmlcontent.toString(),CmsEncoder.C_UTF8_ENCODING,resolver);
  xmlcontent.validateXmlStructure(resolver);
  value1=xmlcontent.getValue("DeepCascade[1]/Cascade[1]/VfsLink",Locale.ENGLISH);
  value1.setStringValue(cms,"/system/workplace/warning");
  value1=xmlcontent.getValue("DeepCascade[1]/Cascade[1]/Html",Locale.ENGLISH);
  value1.setStringValue(cms,"This HTML contains an error!");
  value1=xmlcontent.addValue(cms,"DeepCascade[1]/Cascade[1]/Option",Locale.ENGLISH,0);
  assertEquals("Default value from the XML",value1.getStringValue(cms));
  System.out.println(xmlcontent.toString());
  xmlcontent=CmsXmlContentFactory.unmarshal(xmlcontent.toString(),CmsEncoder.C_UTF8_ENCODING,resolver);
  xmlcontent.validateXmlStructure(resolver);
  errorHandler=xmlcontent.validate(cms);
  assertTrue(errorHandler.hasErrors());
  assertTrue(errorHandler.hasWarnings());
  assertEquals(2,errorHandler.getErrors(Locale.ENGLISH).size());
  assertEquals(3,errorHandler.getWarnings(Locale.ENGLISH).size());
}
