{
  CmsObject cms=getCmsObject();
  echo("Testing mapping of values in the XML content");
  CmsXmlEntityResolver resolver=new CmsXmlEntityResolver(cms);
  String content;
  CmsXmlContent xmlcontent;
  content=CmsFileUtil.readFile("org/opencms/xml/content/xmlcontent-definition-8.xsd",CmsEncoder.ENCODING_UTF_8);
  CmsXmlEntityResolver.cacheSystemId(SCHEMA_SYSTEM_ID_8,content.getBytes(CmsEncoder.ENCODING_ISO_8859_1));
  content=CmsFileUtil.readFile("org/opencms/xml/content/xmlcontent-8.xml",CmsEncoder.ENCODING_ISO_8859_1);
  xmlcontent=CmsXmlContentFactory.unmarshal(content,CmsEncoder.ENCODING_ISO_8859_1,resolver);
  xmlcontent.validateXmlStructure(resolver);
  String resourcename="/mappingtext.html";
  cms.createResource(resourcename,OpenCms.getResourceManager().getResourceType("xmlcontent").getTypeId(),content.getBytes(CmsEncoder.ENCODING_ISO_8859_1),Collections.EMPTY_LIST);
  CmsFile file=cms.readFile(resourcename);
  xmlcontent=CmsXmlContentFactory.unmarshal(cms,file);
  CmsProperty titleProperty=cms.readPropertyObject(resourcename,CmsPropertyDefinition.PROPERTY_TITLE,false);
  assertSame(titleProperty,CmsProperty.getNullProperty());
  CmsProperty localeProperty=cms.readPropertyObject(resourcename,CmsPropertyDefinition.PROPERTY_LOCALE,false);
  assertSame(localeProperty,CmsProperty.getNullProperty());
  CmsProperty navImageProperty=cms.readPropertyObject(resourcename,CmsPropertyDefinition.PROPERTY_NAVIMAGE,false);
  assertSame(navImageProperty,CmsProperty.getNullProperty());
  CmsProperty navInfoProperty=cms.readPropertyObject(resourcename,CmsPropertyDefinition.PROPERTY_NAVINFO,false);
  assertSame(navInfoProperty,CmsProperty.getNullProperty());
  String titleStr="This must be the Title";
  String navImageStr="This is the String with xpath String[2]";
  String navInfoStr="Here we have the String with xpath String[3]";
  I_CmsXmlContentValue value;
  value=xmlcontent.addValue(cms,"String",Locale.ENGLISH,0);
  value.setStringValue(cms,titleStr);
  CmsXmlContentValueSequence seq=xmlcontent.getValueSequence("String",Locale.ENGLISH);
  assertEquals(1,seq.getElementCount());
  value=seq.addValue(cms,1);
  value.setStringValue(cms,navImageStr);
  value=seq.addValue(cms,2);
  value.setStringValue(cms,navInfoStr);
  String localeStr="en";
  value=xmlcontent.addValue(cms,"Locale",Locale.ENGLISH,0);
  value.setStringValue(cms,localeStr);
  file.setContents(xmlcontent.toString().getBytes(CmsEncoder.ENCODING_ISO_8859_1));
  cms.writeFile(file);
  titleProperty=cms.readPropertyObject(resourcename,CmsPropertyDefinition.PROPERTY_TITLE,false);
  assertEquals(titleStr,titleProperty.getValue());
  assertEquals(titleStr,titleProperty.getStructureValue());
  assertNull(titleProperty.getResourceValue());
  CmsProperty myTitleProperty=cms.readPropertyObject(resourcename,"MyTitle",false);
  assertEquals(titleStr,myTitleProperty.getValue());
  assertEquals(titleStr,myTitleProperty.getStructureValue());
  assertNull(myTitleProperty.getResourceValue());
  navImageProperty=cms.readPropertyObject(resourcename,CmsPropertyDefinition.PROPERTY_NAVIMAGE,false);
  assertEquals(navImageStr,navImageProperty.getValue());
  assertEquals(navImageStr,navImageProperty.getResourceValue());
  assertNull(navImageProperty.getStructureValue());
  navInfoProperty=cms.readPropertyObject(resourcename,CmsPropertyDefinition.PROPERTY_NAVINFO,false);
  assertEquals(navInfoStr,navInfoProperty.getValue());
  assertEquals(navInfoStr,navInfoProperty.getStructureValue());
  assertNull(navInfoProperty.getResourceValue());
  localeProperty=cms.readPropertyObject(resourcename,CmsPropertyDefinition.PROPERTY_LOCALE,false);
  assertEquals(localeStr,localeProperty.getValue());
  assertEquals(localeStr,localeProperty.getResourceValue());
  assertNull(localeProperty.getStructureValue());
}
