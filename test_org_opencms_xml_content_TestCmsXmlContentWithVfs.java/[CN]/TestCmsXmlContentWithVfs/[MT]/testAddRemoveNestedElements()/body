{
  CmsObject cms=getCmsObject();
  echo("Testing adding and removing nested elements from an XML content");
  CmsXmlEntityResolver resolver=new CmsXmlEntityResolver(cms);
  String content;
  CmsXmlContent xmlcontent;
  content=CmsFileUtil.readFile("org/opencms/xml/content/xmlcontent-definition-7.xsd",CmsEncoder.C_UTF8_ENCODING);
  CmsXmlEntityResolver.cacheSystemId(C_SCHEMA_SYSTEM_ID_7,content.getBytes(CmsEncoder.C_UTF8_ENCODING));
  content=CmsFileUtil.readFile("org/opencms/xml/content/xmlcontent-7.xml",CmsEncoder.C_UTF8_ENCODING);
  xmlcontent=CmsXmlContentFactory.unmarshal(content,CmsEncoder.C_UTF8_ENCODING,resolver);
  CmsXmlContentValueSequence nestedSequence;
  nestedSequence=xmlcontent.getValueSequence("Cascade",Locale.ENGLISH);
  assertEquals(1,nestedSequence.getElementCount());
  I_CmsXmlContentValue newValue;
  newValue=nestedSequence.addValue(cms,0);
  assertNotNull(newValue);
  assertFalse(newValue.isSimpleType());
  assertEquals(CmsXmlNestedContentDefinition.class.getName(),newValue.getClass().getName());
  content=xmlcontent.toString();
  System.out.println(content);
  xmlcontent=CmsXmlContentFactory.unmarshal(content,CmsEncoder.C_UTF8_ENCODING,resolver);
  xmlcontent.validateXmlStructure(resolver);
  nestedSequence=xmlcontent.getValueSequence("Cascade",Locale.ENGLISH);
  assertEquals(2,nestedSequence.getElementCount());
  CmsXmlContentValueSequence deepNestedSequence;
  deepNestedSequence=xmlcontent.getValueSequence("DeepCascade",Locale.ENGLISH);
  assertEquals(0,deepNestedSequence.getElementCount());
  newValue=deepNestedSequence.addValue(cms,0);
  assertNotNull(newValue);
  assertFalse(newValue.isSimpleType());
  assertEquals(CmsXmlNestedContentDefinition.class.getName(),newValue.getClass().getName());
  content=xmlcontent.toString();
  System.out.println(content);
  xmlcontent=CmsXmlContentFactory.unmarshal(content,CmsEncoder.C_UTF8_ENCODING,resolver);
  xmlcontent.validateXmlStructure(resolver);
  deepNestedSequence=xmlcontent.getValueSequence("DeepCascade",Locale.ENGLISH);
  assertEquals(1,deepNestedSequence.getElementCount());
  nestedSequence=xmlcontent.getValueSequence("Cascade",Locale.ENGLISH);
  assertEquals(2,nestedSequence.getElementCount());
  nestedSequence.removeValue(1);
  deepNestedSequence.removeValue(0);
  content=xmlcontent.toString();
  System.out.println(content);
  xmlcontent=CmsXmlContentFactory.unmarshal(content,CmsEncoder.C_UTF8_ENCODING,resolver);
  xmlcontent.validateXmlStructure(resolver);
  deepNestedSequence=xmlcontent.getValueSequence("DeepCascade",Locale.ENGLISH);
  assertEquals(0,deepNestedSequence.getElementCount());
  nestedSequence=xmlcontent.getValueSequence("Cascade",Locale.ENGLISH);
  assertEquals(1,nestedSequence.getElementCount());
}
