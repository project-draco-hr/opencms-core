{
  CmsObject cms=getCmsObject();
  echo("Testing for nested XML content schemas");
  CmsXmlEntityResolver resolver=new CmsXmlEntityResolver(cms);
  String content;
  content=CmsFileUtil.readFile("org/opencms/xml/content/xmlcontent-definition-4.xsd",CmsEncoder.ENCODING_UTF_8);
  CmsXmlContentDefinition definition=CmsXmlContentDefinition.unmarshal(content,SCHEMA_SYSTEM_ID_4,resolver);
  CmsXmlEntityResolver.cacheSystemId(SCHEMA_SYSTEM_ID_4,content.getBytes(CmsEncoder.ENCODING_UTF_8));
  content=CmsFileUtil.readFile("org/opencms/xml/content/xmlcontent-4.xml",CmsEncoder.ENCODING_UTF_8);
  CmsXmlContent xmlcontent=CmsXmlContentFactory.unmarshal(content,CmsEncoder.ENCODING_UTF_8,resolver);
  System.out.println(xmlcontent.toString());
  xmlcontent.validateXmlStructure(resolver);
  assertTrue(xmlcontent.hasValue("Title",Locale.ENGLISH));
  assertTrue(xmlcontent.hasValue("Title[1]",Locale.ENGLISH));
  assertTrue(xmlcontent.hasValue("Cascade[1]/Html[1]",Locale.ENGLISH));
  assertTrue(xmlcontent.hasValue("Cascade[1]/VfsLink[1]",Locale.ENGLISH));
  assertTrue(xmlcontent.hasValue("Cascade[1]/VfsLink[2]",Locale.ENGLISH));
  assertTrue(xmlcontent.hasValue("Cascade[2]/Html[1]",Locale.ENGLISH));
  assertTrue(xmlcontent.hasValue("Cascade[2]/VfsLink[1]",Locale.ENGLISH));
  assertTrue(xmlcontent.hasValue("Cascade[2]/Html",Locale.ENGLISH));
  assertTrue(xmlcontent.hasValue("Cascade[2]/VfsLink",Locale.ENGLISH));
  assertTrue(xmlcontent.hasValue("Cascade",Locale.ENGLISH));
  assertTrue(xmlcontent.hasValue("Cascade[1]",Locale.ENGLISH));
  assertTrue(xmlcontent.hasValue("Cascade[2]",Locale.ENGLISH));
  assertTrue(xmlcontent.hasValue("Cascade/Html",Locale.ENGLISH));
  assertTrue(xmlcontent.hasValue("Cascade/Html[1]",Locale.ENGLISH));
  assertTrue(xmlcontent.hasValue("Cascade/VfsLink",Locale.ENGLISH));
  assertTrue(xmlcontent.hasValue("Cascade/VfsLink[1]",Locale.ENGLISH));
  assertTrue(xmlcontent.hasValue("Cascade/VfsLink[2]",Locale.ENGLISH));
  assertFalse(xmlcontent.hasValue("Title[0]",Locale.ENGLISH));
  assertFalse(xmlcontent.hasValue("Cascade[0]",Locale.ENGLISH));
  I_CmsXmlContentValue value1;
  I_CmsXmlContentValue value2;
  value1=xmlcontent.getValue("Title",Locale.ENGLISH);
  value2=xmlcontent.getValue("Title[1]",Locale.ENGLISH);
  assertSame(value1,value2);
  value2=xmlcontent.getValue("Title",Locale.ENGLISH,0);
  assertSame(value1,value2);
  String xpath="Cascade[1]/VfsLink[2]";
  value1=xmlcontent.getValue(xpath,Locale.ENGLISH);
  assertEquals(xpath,value1.getPath());
  xpath="Title[1]";
  value1=xmlcontent.getValue(xpath,Locale.ENGLISH);
  assertEquals(xpath,value1.getPath());
  xpath="Cascade/Html";
  value1=xmlcontent.getValue(xpath,Locale.ENGLISH);
  assertEquals(CmsXmlUtils.createXpath(xpath,1),value1.getPath());
  xpath="Cascade";
  value1=xmlcontent.getValue(xpath,Locale.ENGLISH);
  assertEquals(CmsXmlUtils.createXpath(xpath,1),value1.getPath());
  assertSame(definition.getContentHandler().getClass().getName(),TestXmlContentHandler.class.getName());
}
