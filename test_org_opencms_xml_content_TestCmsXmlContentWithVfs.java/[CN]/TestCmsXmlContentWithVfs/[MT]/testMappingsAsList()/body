{
  CmsObject cms=getCmsObject();
  echo("Testing element mappings fom XML content to a property list");
  CmsXmlEntityResolver resolver=new CmsXmlEntityResolver(cms);
  String content;
  CmsXmlContent xmlcontent;
  content=CmsFileUtil.readFile("org/opencms/xml/content/xmlcontent-8.xml",CmsEncoder.ENCODING_ISO_8859_1);
  xmlcontent=CmsXmlContentFactory.unmarshal(content,CmsEncoder.ENCODING_ISO_8859_1,resolver);
  xmlcontent.validateXmlStructure(resolver);
  String resourcename="/mappinglist.html";
  cms.createResource(resourcename,OpenCms.getResourceManager().getResourceType("xmlcontent").getTypeId(),content.getBytes(CmsEncoder.ENCODING_ISO_8859_1),Collections.<CmsProperty>emptyList());
  CmsFile file=cms.readFile(resourcename);
  xmlcontent=CmsXmlContentFactory.unmarshal(cms,file);
  CmsProperty prop;
  prop=cms.readPropertyObject(resourcename,CmsPropertyDefinition.PROPERTY_DESCRIPTION,false);
  assertSame(prop,CmsProperty.getNullProperty());
  I_CmsXmlContentValue value;
  CmsXmlContentValueSequence seq=xmlcontent.getValueSequence("VfsFile",Locale.ENGLISH);
  assertEquals(0,seq.getElementCount());
  String res1="/index.html";
  String res2="/xmlcontent/";
  String res3="/xmlcontent/article_0001.html";
  String res4="/folder1/index.html";
  String sr=cms.getRequestContext().getSiteRoot();
  String propValue=sr + res1 + "|"+ sr+ res2+ "|"+ sr+ res3+ "|"+ sr+ res4;
  value=seq.addValue(cms,0);
  value.setStringValue(cms,res1);
  value=seq.addValue(cms,1);
  value.setStringValue(cms,res2);
  value=seq.addValue(cms,2);
  value.setStringValue(cms,res3);
  value=seq.addValue(cms,3);
  value.setStringValue(cms,res4);
  assertEquals(4,seq.getElementCount());
  xmlcontent.validateXmlStructure(resolver);
  file.setContents(xmlcontent.toString().getBytes(CmsEncoder.ENCODING_ISO_8859_1));
  cms.writeFile(file);
  prop=cms.readPropertyObject(resourcename,CmsPropertyDefinition.PROPERTY_DESCRIPTION,false);
  List<String> list=prop.getValueList();
  assertNotNull(list);
  assertEquals(4,list.size());
  assertEquals(sr + res1,list.get(0));
  assertEquals(sr + res2,list.get(1));
  assertEquals(sr + res3,list.get(2));
  assertEquals(sr + res4,list.get(3));
  assertEquals(propValue,prop.getValue());
  assertEquals(propValue,prop.getStructureValue());
  assertNull(prop.getResourceValue());
  CmsProperty prop2;
  prop2=cms.readPropertyObject(resourcename,CmsPropertyDefinition.PROPERTY_KEYWORDS,false);
  assertSame(prop2,CmsProperty.getNullProperty());
  I_CmsXmlContentValue value2;
  CmsXmlContentValueSequence seq2=xmlcontent.getValueSequence("VfsFile2",Locale.ENGLISH);
  assertEquals(0,seq2.getElementCount());
  value2=seq2.addValue(cms,0);
  value2.setStringValue(cms,res1);
  value2=seq2.addValue(cms,1);
  value2.setStringValue(cms,res2);
  value2=seq2.addValue(cms,2);
  value2.setStringValue(cms,res3);
  value2=seq2.addValue(cms,3);
  value2.setStringValue(cms,res4);
  assertEquals(4,seq2.getElementCount());
  xmlcontent.validateXmlStructure(resolver);
  file.setContents(xmlcontent.toString().getBytes(CmsEncoder.ENCODING_ISO_8859_1));
  cms.writeFile(file);
  prop2=cms.readPropertyObject(resourcename,CmsPropertyDefinition.PROPERTY_KEYWORDS,false);
  List<String> list2=prop.getValueList();
  assertNotNull(list2);
  assertEquals(4,list2.size());
  assertEquals(sr + res1,list2.get(0));
  assertEquals(sr + res2,list2.get(1));
  assertEquals(sr + res3,list2.get(2));
  assertEquals(sr + res4,list2.get(3));
  assertEquals(propValue,prop2.getValue());
  assertEquals(propValue,prop2.getResourceValue());
  assertNull(prop2.getStructureValue());
  CmsProperty prop3;
  prop3=cms.readPropertyObject(resourcename,CmsPropertyDefinition.PROPERTY_NAVTEXT,false);
  assertSame(prop3,CmsProperty.getNullProperty());
  I_CmsXmlContentValue value3;
  CmsXmlContentValueSequence seq3=xmlcontent.getValueSequence("VfsFile3",Locale.ENGLISH);
  assertEquals(0,seq3.getElementCount());
  value3=seq3.addValue(cms,0);
  value3.setStringValue(cms,res1);
  value3=seq3.addValue(cms,1);
  value3.setStringValue(cms,res2);
  value3=seq3.addValue(cms,2);
  value3.setStringValue(cms,res3);
  value3=seq3.addValue(cms,3);
  value3.setStringValue(cms,res4);
  assertEquals(4,seq3.getElementCount());
  xmlcontent.validateXmlStructure(resolver);
  file.setContents(xmlcontent.toString().getBytes(CmsEncoder.ENCODING_ISO_8859_1));
  cms.writeFile(file);
  prop3=cms.readPropertyObject(resourcename,CmsPropertyDefinition.PROPERTY_NAVTEXT,false);
  List<String> list3=prop.getValueList();
  assertNotNull(list3);
  assertEquals(4,list3.size());
  assertEquals(sr + res1,list3.get(0));
  assertEquals(sr + res2,list3.get(1));
  assertEquals(sr + res3,list3.get(2));
  assertEquals(sr + res4,list3.get(3));
  assertEquals(propValue,prop3.getValue());
  assertEquals(propValue,prop3.getStructureValue());
  assertNull(prop3.getResourceValue());
}
