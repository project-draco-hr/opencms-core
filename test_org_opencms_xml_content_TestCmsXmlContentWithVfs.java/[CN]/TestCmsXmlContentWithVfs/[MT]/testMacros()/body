{
  CmsObject cms=getCmsObject();
  echo("Testing macros in the XML content");
  CmsUser admin=cms.getRequestContext().currentUser();
  admin.setFirstname("Hans");
  admin.setLastname("Mustermann");
  admin.setEmail("hans.mustermann@germany.de");
  admin.setAddress("Heidestra?e 17, M?nchen");
  cms.writeUser(admin);
  CmsXmlEntityResolver resolver=new CmsXmlEntityResolver(cms);
  String content;
  CmsXmlContent xmlcontent;
  content=CmsFileUtil.readFile("org/opencms/xml/content/xmlcontent-definition-9.xsd",CmsEncoder.C_UTF8_ENCODING);
  CmsXmlEntityResolver.cacheSystemId(C_SCHEMA_SYSTEM_ID_9,content.getBytes(CmsEncoder.C_UTF8_ENCODING));
  content=CmsFileUtil.readFile("org/opencms/xml/content/xmlcontent-9.xml",CmsEncoder.C_UTF8_ENCODING);
  xmlcontent=CmsXmlContentFactory.unmarshal(content,CmsEncoder.C_UTF8_ENCODING,resolver);
  CmsXmlContentErrorHandler errorHandler;
  I_CmsXmlContentValue value1;
  value1=xmlcontent.getValue("Test",Locale.ENGLISH);
  value1.setStringValue(cms,"This produces a warning!");
  errorHandler=xmlcontent.validate(cms);
  assertFalse(errorHandler.hasErrors());
  assertTrue(errorHandler.hasWarnings());
  value1.setStringValue(cms,"This produces a warning and an error!");
  errorHandler=xmlcontent.validate(cms);
  assertTrue(errorHandler.hasErrors());
  assertTrue(errorHandler.hasWarnings());
  assertEquals(1,errorHandler.getErrors().size());
  assertEquals(1,errorHandler.getWarnings().size());
  value1=xmlcontent.getValue("Toast",Locale.ENGLISH);
  value1.setStringValue(cms,"This produces a warning but no error!");
  errorHandler=xmlcontent.validate(cms);
  assertTrue(errorHandler.hasErrors());
  assertTrue(errorHandler.hasWarnings());
  assertEquals(1,errorHandler.getErrors(Locale.ENGLISH).size());
  assertEquals(2,errorHandler.getWarnings(Locale.ENGLISH).size());
  value1=xmlcontent.addValue(cms,"Option",Locale.ENGLISH,0);
  assertEquals("The author is: Hans Mustermann (Admin), Heidestra?e 17, M?nchen - hans.mustermann@germany.de",value1.getStringValue(cms));
  value1=xmlcontent.addValue(cms,"Option",Locale.GERMAN,0);
  assertEquals("Der Autor ist: Hans Mustermann (Admin), Heidestra?e 17, M?nchen - hans.mustermann@germany.de",value1.getStringValue(cms));
  System.out.println(xmlcontent.toString());
  xmlcontent=CmsXmlContentFactory.unmarshal(xmlcontent.toString(),CmsEncoder.C_UTF8_ENCODING,resolver);
  xmlcontent.validateXmlStructure(resolver);
  errorHandler=xmlcontent.validate(cms);
  assertTrue(errorHandler.hasErrors());
  assertTrue(errorHandler.hasWarnings());
  assertEquals(1,errorHandler.getErrors(Locale.ENGLISH).size());
  assertEquals(2,errorHandler.getWarnings(Locale.ENGLISH).size());
}
