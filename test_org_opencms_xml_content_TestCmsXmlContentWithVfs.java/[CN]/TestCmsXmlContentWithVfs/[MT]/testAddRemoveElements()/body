{
  CmsObject cms=getCmsObject();
  echo("Testing adding and removing elements from an XML content");
  CmsXmlEntityResolver resolver=new CmsXmlEntityResolver(cms);
  String content;
  CmsXmlContent xmlcontent;
  content=CmsFileUtil.readFile("org/opencms/xml/content/xmlcontent-definition-6.xsd",CmsEncoder.ENCODING_UTF_8);
  CmsXmlEntityResolver.cacheSystemId(SCHEMA_SYSTEM_ID_6,content.getBytes(CmsEncoder.ENCODING_UTF_8));
  content=CmsFileUtil.readFile("org/opencms/xml/content/xmlcontent-6.xml",CmsEncoder.ENCODING_UTF_8);
  xmlcontent=CmsXmlContentFactory.unmarshal(content,CmsEncoder.ENCODING_UTF_8,resolver);
  CmsXmlContentValueSequence titleSequence;
  titleSequence=xmlcontent.getValueSequence("Title",Locale.ENGLISH);
  assertEquals("Title",titleSequence.getElementName());
  assertEquals(1,titleSequence.getElementCount());
  assertEquals(1,titleSequence.getMinOccurs());
  assertEquals(5,titleSequence.getMaxOccurs());
  assertEquals("This is just a modification test",titleSequence.getValue(0).getStringValue(cms));
  CmsXmlStringValue newValue;
  newValue=(CmsXmlStringValue)titleSequence.addValue(cms,0);
  assertEquals(2,titleSequence.getElementCount());
  assertEquals(newValue,titleSequence.getValue(0));
  newValue.setStringValue(cms,"This is another Value!");
  content=xmlcontent.toString();
  System.out.println(content);
  xmlcontent=CmsXmlContentFactory.unmarshal(content,CmsEncoder.ENCODING_UTF_8,resolver);
  titleSequence=xmlcontent.getValueSequence("Title",Locale.ENGLISH);
  assertEquals("Title",titleSequence.getElementName());
  assertEquals(2,titleSequence.getElementCount());
  assertEquals(1,titleSequence.getMinOccurs());
  assertEquals(5,titleSequence.getMaxOccurs());
  assertEquals("This is another Value!",titleSequence.getValue(0).getStringValue(cms));
  assertEquals("This is just a modification test",titleSequence.getValue(1).getStringValue(cms));
  newValue=(CmsXmlStringValue)titleSequence.addValue(cms,2);
  newValue.setStringValue(cms,"This is the last value.");
  assertEquals(newValue,titleSequence.getValue(2));
  newValue=(CmsXmlStringValue)titleSequence.addValue(cms,1);
  newValue.setStringValue(cms,"This is the 2nd value.");
  assertEquals(newValue,titleSequence.getValue(1));
  assertEquals(4,titleSequence.getElementCount());
  content=xmlcontent.toString();
  System.out.println(content);
  xmlcontent=CmsXmlContentFactory.unmarshal(content,CmsEncoder.ENCODING_UTF_8,resolver);
  titleSequence=xmlcontent.getValueSequence("Title",Locale.ENGLISH);
  assertEquals("Title",titleSequence.getElementName());
  assertEquals(4,titleSequence.getElementCount());
  assertEquals(1,titleSequence.getMinOccurs());
  assertEquals(5,titleSequence.getMaxOccurs());
  assertEquals("This is another Value!",titleSequence.getValue(0).getStringValue(cms));
  assertEquals("This is the 2nd value.",titleSequence.getValue(1).getStringValue(cms));
  assertEquals("This is just a modification test",titleSequence.getValue(2).getStringValue(cms));
  assertEquals("This is the last value.",titleSequence.getValue(3).getStringValue(cms));
  CmsXmlContentValueSequence optionSequence;
  optionSequence=xmlcontent.getValueSequence("Option",Locale.ENGLISH);
  assertEquals("Option",optionSequence.getElementName());
  assertEquals(0,optionSequence.getElementCount());
  assertEquals(0,optionSequence.getMinOccurs());
  assertEquals(2,optionSequence.getMaxOccurs());
  newValue=(CmsXmlStringValue)optionSequence.addValue(cms,0);
  newValue.setStringValue(cms,"Optional value 1");
  assertEquals(newValue,optionSequence.getValue(0));
  newValue=(CmsXmlStringValue)optionSequence.addValue(cms,0);
  newValue.setStringValue(cms,"Optional value 0");
  assertEquals(newValue,optionSequence.getValue(0));
  assertEquals(2,optionSequence.getElementCount());
  content=xmlcontent.toString();
  System.out.println(content);
  xmlcontent=CmsXmlContentFactory.unmarshal(content,CmsEncoder.ENCODING_UTF_8,resolver);
  optionSequence=xmlcontent.getValueSequence("Option",Locale.ENGLISH);
  assertEquals("Option",optionSequence.getElementName());
  assertEquals(2,optionSequence.getElementCount());
  assertEquals(0,optionSequence.getMinOccurs());
  assertEquals(2,optionSequence.getMaxOccurs());
  assertEquals("Optional value 0",optionSequence.getValue(0).getStringValue(cms));
  assertEquals("Optional value 1",optionSequence.getValue(1).getStringValue(cms));
  optionSequence.removeValue(1);
  assertEquals(1,optionSequence.getElementCount());
  assertEquals("Optional value 0",optionSequence.getValue(0).getStringValue(cms));
  optionSequence.removeValue(0);
  assertEquals(0,optionSequence.getElementCount());
  content=xmlcontent.toString();
  System.out.println(content);
  xmlcontent=CmsXmlContentFactory.unmarshal(content,CmsEncoder.ENCODING_UTF_8,resolver);
  titleSequence=xmlcontent.getValueSequence("Title",Locale.ENGLISH);
  assertEquals(4,titleSequence.getElementCount());
  titleSequence.removeValue(0);
  titleSequence.removeValue(2);
  assertEquals(2,titleSequence.getElementCount());
  assertEquals("This is the 2nd value.",titleSequence.getValue(0).getStringValue(cms));
  assertEquals("This is just a modification test",titleSequence.getValue(1).getStringValue(cms));
  content=xmlcontent.toString();
  System.out.println(content);
}
