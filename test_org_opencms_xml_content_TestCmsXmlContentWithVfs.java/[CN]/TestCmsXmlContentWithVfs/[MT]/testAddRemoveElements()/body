{
  CmsObject cms=getCmsObject();
  echo("Testing adding and removing elements from an XML content");
  CmsXmlEntityResolver resolver=new CmsXmlEntityResolver(cms);
  String content;
  CmsXmlContent xmlcontent;
  content=CmsFileUtil.readFile("org/opencms/xml/content/xmlcontent-definition-6.xsd",CmsEncoder.C_UTF8_ENCODING);
  CmsXmlEntityResolver.cacheSystemId(C_SCHEMA_SYSTEM_ID_6,content.getBytes(CmsEncoder.C_UTF8_ENCODING));
  content=CmsFileUtil.readFile("org/opencms/xml/content/xmlcontent-6.xml",CmsEncoder.C_UTF8_ENCODING);
  xmlcontent=CmsXmlContentFactory.unmarshal(content,CmsEncoder.C_UTF8_ENCODING,resolver);
  CmsXmlContentValueSequence titleSequence;
  titleSequence=xmlcontent.getValueSequence("Title",Locale.ENGLISH);
  assertEquals("Title",titleSequence.getElementName());
  assertEquals(1,titleSequence.getElementCount());
  assertEquals(1,titleSequence.getMinOccurs());
  assertEquals(5,titleSequence.getMaxOccurs());
  assertEquals("This is just a modification test",((CmsXmlStringValue)titleSequence.getValues().get(0)).getStringValue(cms,xmlcontent));
  CmsXmlStringValue newValue;
  newValue=(CmsXmlStringValue)titleSequence.addValue(0);
  assertEquals(2,titleSequence.getElementCount());
  assertEquals(newValue,titleSequence.getValues().get(0));
  newValue.setStringValue("This is another Value!");
  content=xmlcontent.toString();
  System.out.println(content);
  xmlcontent=CmsXmlContentFactory.unmarshal(content,CmsEncoder.C_UTF8_ENCODING,resolver);
  titleSequence=xmlcontent.getValueSequence("Title",Locale.ENGLISH);
  assertEquals("Title",titleSequence.getElementName());
  assertEquals(2,titleSequence.getElementCount());
  assertEquals(1,titleSequence.getMinOccurs());
  assertEquals(5,titleSequence.getMaxOccurs());
  assertEquals("This is another Value!",((CmsXmlStringValue)titleSequence.getValues().get(0)).getStringValue(cms,xmlcontent));
  assertEquals("This is just a modification test",((CmsXmlStringValue)titleSequence.getValues().get(1)).getStringValue(cms,xmlcontent));
  newValue=(CmsXmlStringValue)titleSequence.addValue(2);
  newValue.setStringValue("This is the last value.");
  assertEquals(newValue,titleSequence.getValues().get(2));
  newValue=(CmsXmlStringValue)titleSequence.addValue(1);
  newValue.setStringValue("This is the 2nd value.");
  assertEquals(newValue,titleSequence.getValues().get(1));
  assertEquals(4,titleSequence.getElementCount());
  content=xmlcontent.toString();
  System.out.println(content);
  xmlcontent=CmsXmlContentFactory.unmarshal(content,CmsEncoder.C_UTF8_ENCODING,resolver);
  titleSequence=xmlcontent.getValueSequence("Title",Locale.ENGLISH);
  assertEquals("Title",titleSequence.getElementName());
  assertEquals(4,titleSequence.getElementCount());
  assertEquals(1,titleSequence.getMinOccurs());
  assertEquals(5,titleSequence.getMaxOccurs());
  assertEquals("This is another Value!",((CmsXmlStringValue)titleSequence.getValues().get(0)).getStringValue(cms,xmlcontent));
  assertEquals("This is the 2nd value.",((CmsXmlStringValue)titleSequence.getValues().get(1)).getStringValue(cms,xmlcontent));
  assertEquals("This is just a modification test",((CmsXmlStringValue)titleSequence.getValues().get(2)).getStringValue(cms,xmlcontent));
  assertEquals("This is the last value.",((CmsXmlStringValue)titleSequence.getValues().get(3)).getStringValue(cms,xmlcontent));
  CmsXmlContentValueSequence optionSequence;
  optionSequence=xmlcontent.getValueSequence("Option",Locale.ENGLISH);
  assertEquals("Option",optionSequence.getElementName());
  assertEquals(0,optionSequence.getElementCount());
  assertEquals(0,optionSequence.getMinOccurs());
  assertEquals(2,optionSequence.getMaxOccurs());
  newValue=(CmsXmlStringValue)optionSequence.addValue(0);
  newValue.setStringValue("Optional value 1");
  assertEquals(newValue,optionSequence.getValues().get(0));
  newValue=(CmsXmlStringValue)optionSequence.addValue(0);
  newValue.setStringValue("Optional value 0");
  assertEquals(newValue,optionSequence.getValues().get(0));
  assertEquals(2,optionSequence.getElementCount());
  content=xmlcontent.toString();
  System.out.println(content);
  xmlcontent=CmsXmlContentFactory.unmarshal(content,CmsEncoder.C_UTF8_ENCODING,resolver);
  optionSequence=xmlcontent.getValueSequence("Option",Locale.ENGLISH);
  assertEquals("Option",optionSequence.getElementName());
  assertEquals(2,optionSequence.getElementCount());
  assertEquals(0,optionSequence.getMinOccurs());
  assertEquals(2,optionSequence.getMaxOccurs());
  assertEquals("Optional value 0",((CmsXmlStringValue)optionSequence.getValues().get(0)).getStringValue(cms,xmlcontent));
  assertEquals("Optional value 1",((CmsXmlStringValue)optionSequence.getValues().get(1)).getStringValue(cms,xmlcontent));
  optionSequence.removeValue(1);
  assertEquals(1,optionSequence.getElementCount());
  assertEquals("Optional value 0",((CmsXmlStringValue)optionSequence.getValues().get(0)).getStringValue(cms,xmlcontent));
  optionSequence.removeValue(0);
  assertEquals(0,optionSequence.getElementCount());
  content=xmlcontent.toString();
  System.out.println(content);
  xmlcontent=CmsXmlContentFactory.unmarshal(content,CmsEncoder.C_UTF8_ENCODING,resolver);
  titleSequence=xmlcontent.getValueSequence("Title",Locale.ENGLISH);
  assertEquals(4,titleSequence.getElementCount());
  titleSequence.removeValue(0);
  titleSequence.removeValue(2);
  assertEquals(2,titleSequence.getElementCount());
  assertEquals("This is the 2nd value.",((CmsXmlStringValue)titleSequence.getValues().get(0)).getStringValue(cms,xmlcontent));
  assertEquals("This is just a modification test",((CmsXmlStringValue)titleSequence.getValues().get(1)).getStringValue(cms,xmlcontent));
  content=xmlcontent.toString();
  System.out.println(content);
}
