{
  HttpSession session=((HttpServletRequest)cms.getRequestContext().getRequest().getOriginalRequest()).getSession(true);
  String template=null;
  String filename=(String)parameters.get(C_PARA_FILE);
  if (filename != null) {
    session.putValue(C_PARA_FILE,filename);
  }
  String propertydef=(String)parameters.get("selectproperty");
  if (propertydef != null) {
    session.putValue(C_PARA_PROPERTYDEF,propertydef);
  }
  filename=(String)session.getValue(C_PARA_FILE);
  propertydef=(String)session.getValue(C_PARA_PROPERTYDEF);
  CmsFile file=(CmsFile)cms.readFileHeader(filename);
  String edit=(String)parameters.get("EDIT");
  String delete=(String)parameters.get("DELETE");
  String newproperty=(String)parameters.get("NEWPROPERTY");
  String newpropertydef=(String)parameters.get("ORGANIZE");
  if (file.isLockedBy() == cms.getRequestContext().currentUser().getId()) {
    if (edit != null) {
      template="editproperty";
    }
 else     if (delete != null) {
      template="deleteproperty";
    }
 else     if (newproperty != null) {
      template="newproperty";
    }
 else     if (newpropertydef != null) {
      template="newpropertydef";
    }
 else {
      template="ownlocked";
    }
  }
  CmsXmlWpTemplateFile xmlTemplateDocument=new CmsXmlWpTemplateFile(cms,templateFile);
  if (edit != null) {
    if (propertydef != null) {
      xmlTemplateDocument.setXmlData("PROPERTYDEF",propertydef);
      String newValue=(String)parameters.get("EDITEDPROPERTY");
      if (newValue != null) {
        cms.writeMetainformation(filename,propertydef,newValue);
        template="ownlocked";
        session.removeValue(C_PARA_PROPERTYDEF);
      }
    }
 else {
      template="ownlocked";
    }
  }
  if (delete != null) {
    if (delete.equals("true")) {
      if (propertydef != null) {
        cms.deleteMetainformation(filename,propertydef);
        template="ownlocked";
        session.removeValue(C_PARA_PROPERTYDEF);
      }
    }
  }
  if (newproperty != null) {
    if (newproperty.equals("true")) {
      String newValue=(String)parameters.get("NEWPROPERTYVALUE");
      if ((newValue != null) && (propertydef != null)) {
        String testValue=cms.readMetainformation(filename,propertydef);
        if (testValue == null) {
          cms.writeMetainformation(filename,propertydef,newValue);
          template="ownlocked";
          session.removeValue(C_PARA_PROPERTYDEF);
        }
 else {
        }
      }
 else {
        template="ownlocked";
        session.removeValue(C_PARA_PROPERTYDEF);
      }
    }
  }
  if (newpropertydef != null) {
    if (newpropertydef.equals("true")) {
      String newValue=(String)parameters.get("NEWPROPERTYDEF");
      if (newValue != null) {
        String testValue=cms.readMetainformation(filename,propertydef);
        if (testValue == null) {
          A_CmsResourceType type=cms.getResourceType(file.getType());
          A_CmsMetadefinition def=cms.createMetadefinition(newValue,type.getResourceName(),C_METADEF_TYPE_NORMAL);
          cms.writeMetadefinition(def);
          template="ownlocked";
          session.removeValue(C_PARA_PROPERTYDEF);
        }
 else {
        }
      }
 else {
        template="ownlocked";
        session.removeValue(C_PARA_PROPERTYDEF);
      }
    }
  }
  String title=cms.readMetainformation(file.getAbsolutePath(),C_METAINFO_TITLE);
  if (title == null) {
    title="";
  }
  A_CmsUser owner=cms.readOwner(file);
  xmlTemplateDocument.setXmlData("TITLE",title);
  xmlTemplateDocument.setXmlData("STATE",getState(cms,file,new CmsXmlLanguageFile(cms)));
  xmlTemplateDocument.setXmlData("OWNER",owner.getFirstname() + " " + owner.getLastname()+ "("+ owner.getName()+ ")");
  xmlTemplateDocument.setXmlData("GROUP",cms.readGroup(file).getName());
  xmlTemplateDocument.setXmlData("FILENAME",file.getName());
  return startProcessing(cms,xmlTemplateDocument,"",parameters,template);
}
