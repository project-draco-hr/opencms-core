{
  String requestedUri=cms.getRequestContext().getUri();
  int size=resources.size();
  int max=0;
  for (int i=0; i < size; i++) {
    CmsResource currentResource=(CmsResource)resources.get(i);
    String path=cms.getSitePath(currentResource);
    String pos=cms.readProperty(path,CmsPropertyDefinition.PROPERTY_NAVPOS);
    String text=cms.readProperty(path,CmsPropertyDefinition.PROPERTY_NAVTEXT);
    if (currentResource.getState() != CmsResource.STATE_DELETED) {
      if (pos != null && text != null && (!"".equals(pos)) && (!"".equals(text)) && ((!currentResource.getName().startsWith(CmsWorkplace.TEMP_FILE_PREFIX)) || path.equals(requestedUri))) {
        navLink[max]=path;
        navText[max]=text;
        navPos[max]=new Float(pos).floatValue();
        max++;
      }
    }
  }
  sortNav(max,navLink,navText,navPos);
  return max;
}
