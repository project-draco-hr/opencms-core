{
  CmsResource resource=(CmsResource)indexResource.getData();
  PDDocument pdfDocument=null;
  String rawContent=null;
  try {
    CmsFile file=cms.readFile(cms.getRequestContext().removeSiteRoot(resource.getRootPath()),CmsResourceFilter.IGNORE_EXPIRATION);
    if (!(file.getLength() > 0)) {
      throw new CmsIndexException("Resource " + resource.getRootPath() + " has no content.");
    }
    PDFParser parser=new PDFParser(new ByteArrayInputStream(file.getContents()));
    parser.parse();
    pdfDocument=parser.getPDDocument();
    if (pdfDocument.isEncrypted()) {
      DocumentEncryption decryptor=new DocumentEncryption(pdfDocument);
      decryptor.decryptDocument("");
    }
    CharArrayWriter writer=new CharArrayWriter();
    PDFTextStripper stripper=new PDFTextStripper();
    stripper.writeText(pdfDocument,writer);
    rawContent=writer.toString();
    writer.close();
  }
 catch (  CryptographyException exc) {
    throw new CmsIndexException("Decrypting resource " + resource.getRootPath() + " failed.",exc);
  }
catch (  InvalidPasswordException exc) {
    throw new CmsIndexException("Resource " + resource.getRootPath() + " is password protected.",exc);
  }
catch (  IOException exc) {
    throw new CmsIndexException("Reading resource " + resource.getRootPath() + " failed: "+ exc.getMessage(),exc);
  }
 finally {
    try {
      pdfDocument.close();
    }
 catch (    Exception exc) {
    }
  }
  return rawContent;
}
