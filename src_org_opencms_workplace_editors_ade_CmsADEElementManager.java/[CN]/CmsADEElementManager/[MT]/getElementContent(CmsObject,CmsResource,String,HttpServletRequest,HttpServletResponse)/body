{
  CmsResource resFormatter=cms.readResource(formatterUri);
  CmsTemplateLoaderFacade loaderFacade=new CmsTemplateLoaderFacade(OpenCms.getResourceManager().getLoader(resFormatter),resource,resFormatter);
  String oldUri=cms.getRequestContext().getUri();
  try {
    cms.getRequestContext().setUri(cms.getSitePath(resource));
    CmsResource loaderRes=loaderFacade.getLoaderStartResource();
    return new String(loaderFacade.getLoader().dump(cms,loaderRes,null,null,req,res));
  }
  finally {
    cms.getRequestContext().setUri(oldUri);
  }
}
