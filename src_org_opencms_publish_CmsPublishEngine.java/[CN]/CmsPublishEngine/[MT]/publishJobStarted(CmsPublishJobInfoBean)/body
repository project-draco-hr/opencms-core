{
  CmsDbContext dbc=m_dbContextFactory.getDbContext(publishJob.getCmsObject().getRequestContext());
  m_publishQueue.update(publishJob);
  try {
    Map eventData=new HashMap();
    eventData.put(I_CmsEventListener.KEY_REPORT,publishJob.getPublishReport());
    eventData.put(I_CmsEventListener.KEY_PUBLISHLIST,publishJob.getPublishList());
    eventData.put(I_CmsEventListener.KEY_PROJECTID,dbc.currentProject().getUuid());
    eventData.put(I_CmsEventListener.KEY_DBCONTEXT,dbc);
    CmsEvent beforePublishEvent=new CmsEvent(I_CmsEventListener.EVENT_BEFORE_PUBLISH_PROJECT,eventData);
    OpenCms.fireCmsEvent(beforePublishEvent);
  }
 catch (  Throwable t) {
    publishJob.getPublishReport().println(t);
  }
 finally {
    dbc.clear();
    dbc=null;
  }
  m_listeners.fireStart(new CmsPublishJobEnqueued(publishJob));
}
