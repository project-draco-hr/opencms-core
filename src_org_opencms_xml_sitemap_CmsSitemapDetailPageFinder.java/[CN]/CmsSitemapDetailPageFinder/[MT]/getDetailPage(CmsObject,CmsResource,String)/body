{
  if (!CmsResourceTypeXmlContent.isXmlContent(res)) {
    return null;
  }
  CmsSitemapManager sitemapManager=OpenCms.getSitemapManager();
  CmsSitemapEntry entry=sitemapManager.getEntryForUri(cms,linkSource);
  String type=OpenCms.getResourceManager().getResourceType(res.getTypeId()).getTypeName();
  CmsDetailPageInfo detailPageInfo=null;
  if (entry.isSitemap()) {
    detailPageInfo=entry.getSitemapInfo().getBestDetailPage(type);
  }
  if (detailPageInfo == null) {
    CmsSitemapRuntimeInfo info=sitemapManager.getRuntimeInfoForSite(cms,cms.getRequestContext().getSiteRoot(),cms.getRequestContext().getLocale());
    if (info != null) {
      detailPageInfo=info.getBestDetailPage(type);
    }
  }
  if (detailPageInfo == null) {
    return (new CmsPropertyDetailPageFinder()).getDetailPage(cms,res,linkSource);
  }
  return detailPageInfo.getUri();
}
