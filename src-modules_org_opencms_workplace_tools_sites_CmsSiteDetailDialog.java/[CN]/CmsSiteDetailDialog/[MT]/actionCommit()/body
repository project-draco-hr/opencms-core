{
  try {
    validateDialog();
    CmsObject cms=OpenCms.initCmsObject(getCms());
    cms.getRequestContext().setSiteRoot("");
    String siteRoot="/sites".concat(m_sitename);
    m_site.setSiteRoot(siteRoot);
    CmsResource siteRootResource=null;
    try {
      siteRootResource=cms.readResource(siteRoot);
    }
 catch (    CmsVfsResourceNotFoundException e) {
      siteRootResource=cms.createResource(siteRoot,CmsResourceTypeFolder.RESOURCE_TYPE_ID);
      OpenCms.getPublishManager().publishResource(cms,siteRoot,false,new CmsLogReport(cms.getRequestContext().getLocale(),getClass()));
      if (m_createou) {
        OpenCms.getOrgUnitManager().createOrganizationalUnit(cms,"/" + siteRootResource.getName(),m_ouDescription.replace("%(site)",m_site.getTitle() + " [" + m_site.getSiteRoot()+ "]"),0,siteRootResource.getRootPath());
      }
    }
    OpenCms.getSiteManager().updateSite(getCms(),m_site.getOriginalSite(),m_site.toCmsSite());
    OpenCms.writeConfiguration(CmsSystemConfiguration.class);
    Map<?,?> objects=(Map<?,?>)getSettings().getListObject();
    if (objects != null) {
      objects.remove(CmsSitesOverviewList.class.getName());
    }
  }
 catch (  Exception e) {
    addCommitError(e);
  }
}
