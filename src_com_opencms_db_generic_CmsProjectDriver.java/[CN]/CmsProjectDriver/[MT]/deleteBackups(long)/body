{
  ResultSet res=null;
  PreparedStatement stmt=null;
  Connection conn=null;
  int maxVersion=0;
  try {
    conn=m_sqlManager.getConnectionForBackup();
    stmt=m_sqlManager.getPreparedStatement(conn,"C_BACKUP_READ_MAXVERSION");
    stmt.setTimestamp(1,new Timestamp(maxdate));
    res=stmt.executeQuery();
    if (res.next()) {
      maxVersion=res.getInt(1);
    }
    res.close();
    stmt.close();
    if (maxVersion > 0) {
      String[] statements={"C_BACKUP_DELETE_PROJECT_BYVERSION","C_BACKUP_DELETE_PROJECTRESOURCES_BYVERSION","C_BACKUP_DELETE_RESOURCES_BYVERSION","C_BACKUP_DELETE_FILES_BYVERSION","C_BACKUP_DELETE_PROPERTIES_BYVERSION","C_BACKUP_DELETE_MODULEMASTER_BYVERSION","C_BACKUP_DELETE_MODULEMEDIA_BYVERSION"};
      for (int i=0; i < statements.length; i++) {
        stmt=m_sqlManager.getPreparedStatement(conn,statements[i]);
        stmt.setInt(1,maxVersion);
        stmt.executeUpdate();
        stmt.close();
      }
    }
  }
 catch (  SQLException e) {
    throw m_sqlManager.getCmsException(this,null,CmsException.C_SQL_ERROR,e);
  }
catch (  Exception ex) {
    throw m_sqlManager.getCmsException(this,null,CmsException.C_UNKNOWN_EXCEPTION,ex);
  }
 finally {
    m_sqlManager.closeAll(conn,stmt,res);
  }
  return maxVersion;
}
