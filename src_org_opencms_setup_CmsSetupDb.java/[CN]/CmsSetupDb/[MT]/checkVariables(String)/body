{
  StringBuffer html=new StringBuffer(512);
  if (db.startsWith("mysql") && !db.startsWith("mysql_41")) {
    String statement="SELECT @@max_allowed_packet;";
    Statement stmt=null;
    ResultSet rs=null;
    long map=0;
    if (m_con != null) {
      try {
        stmt=m_con.createStatement();
        rs=stmt.executeQuery(statement);
        if (rs.next()) {
          map=rs.getLong(1);
        }
      }
 catch (      SQLException e) {
        if (m_errorLogging) {
          m_errors.addElement("Error executing SQL statement: " + statement);
          m_errors.addElement(CmsException.getStackTraceAsString(e));
        }
      }
 finally {
        if (stmt != null) {
          try {
            stmt.close();
          }
 catch (          SQLException e) {
          }
        }
      }
    }
    if (map > 0) {
      html.append("MySQL system variable <code>'max_allowed_packet'</code> is set to ");
      html.append(map);
      html.append(" Bytes.<p>\n");
    }
 else {
      html.append("<i>OpenCms was not able to detect the value of your <code>'max_allowed_packet'</code> variable.</i><p>\n");
    }
    html.append("Please, note that it will not be possible for OpenCms to handle files bigger than this value.<p>\n");
    if (map < 15 * 1024 * 1024) {
      html.append("<b>The recommended value for running OpenCms is 16Mb, please change your MySQL configuration (in your <code>mi.ini</code> or <code>my.cnf</code> file).</b>\n");
    }
  }
  if (html.length() == 0) {
    return null;
  }
  return html.toString();
}
