{
  final String id=elementWidget.getId();
  m_controller.getElement(id,new I_CmsSimpleCallback<CmsContainerElementData>(){
    public void execute(    final CmsContainerElementData elementBean){
      Map<String,String> settings=elementBean.getSettings();
      Map<String,CmsXmlContentProperty> propertyConfig=elementBean.getSettingConfig();
      final CmsTemplateContextInfo contextInfo=CmsContainerpageController.get().getData().getTemplateContextInfo();
      final boolean useTemplateContext=contextInfo.getCurrentContext() != null;
      if ((propertyConfig.size() == 0) && !useTemplateContext) {
        String message=Messages.get().key(Messages.GUI_NO_SETTINGS_0);
        String title=Messages.get().key(Messages.GUI_NO_SETTINGS_TITLE_0);
        (new CmsAlertDialog(title,message)).center();
        return;
      }
      if (useTemplateContext) {
        String templateContexts=settings.get(CmsTemplateContextInfo.SETTING);
        if (templateContexts == null) {
          templateContexts=CmsStringUtil.listAsString(new ArrayList<String>(CmsContainerpageController.get().getData().getTemplateContextInfo().getContextLabels().keySet()),"|");
        }
 else         if (templateContexts.equals(CmsTemplateContextInfo.EMPTY_VALUE)) {
          templateContexts="";
        }
        settings.put(CmsTemplateContextInfo.SETTING,templateContexts);
      }
      final CmsForm form=new CmsForm(false);
      CmsListInfoBean infoBean=new CmsListInfoBean();
      infoBean.setTitle(elementBean.getTitle());
      infoBean.setSubTitle(elementBean.getSitePath());
      infoBean.setResourceType(elementBean.getResourceType());
      A_CmsFormFieldPanel formFieldPanel=null;
      final boolean[] changedContext=new boolean[]{false};
      CmsMultiCheckBox contextsWidget=null;
      final CmsMultiCheckBox[] contextsWidgets=new CmsMultiCheckBox[]{null};
      if (useTemplateContext) {
        String settingsLegend=org.opencms.ade.containerpage.client.Messages.get().key(org.opencms.ade.containerpage.client.Messages.GUI_SETTINGS_LEGEND_0);
        CmsFieldsetFormFieldPanel fieldSetPanel=new CmsFieldsetFormFieldPanel(infoBean,settingsLegend);
        formFieldPanel=fieldSetPanel;
        CmsFieldSet contextsFieldset=new CmsFieldSet();
        contextsFieldset.setLegend(contextInfo.getSettingDefinition().getNiceName());
        contextsFieldset.getElement().getStyle().setMarginTop(10,Style.Unit.PX);
        contextsWidget=new CmsMultiCheckBox(CmsStringUtil.splitAsMap(contextInfo.getSettingDefinition().getWidgetConfiguration(),"|",":"));
        contextsWidget.setFormValueAsString(settings.get(CmsTemplateContextInfo.SETTING));
        contextsWidgets[0]=contextsWidget;
        contextsWidget.addValueChangeHandler(new ValueChangeHandler<String>(){
          public void onValueChange(          ValueChangeEvent<String> event){
            changedContext[0]=true;
          }
        }
);
        contextsFieldset.add(contextsWidget);
        fieldSetPanel.getMainPanel().add(contextsFieldset);
      }
 else {
        formFieldPanel=new CmsInfoBoxFormFieldPanel(infoBean);
      }
      form.setWidget(formFieldPanel);
      I_CmsFormSubmitHandler submitHandler=new I_CmsFormSubmitHandler(){
        /** 
 * @see org.opencms.gwt.client.ui.input.form.I_CmsFormSubmitHandler#onSubmitForm(org.opencms.gwt.client.ui.input.form.CmsForm,java.util.Map,java.util.Set)
 */
        public void onSubmitForm(        CmsForm formParam,        final Map<String,String> fieldValues,        Set<String> editedFields){
          if (CmsInheritanceContainerEditor.getInstance() != null) {
            CmsInheritanceContainerEditor.getInstance().onSettingsEdited();
          }
          if (useTemplateContext) {
            String newTemplateContexts=contextsWidgets[0].getFormValueAsString();
            if ((newTemplateContexts == null) || "".equals(newTemplateContexts)) {
              newTemplateContexts=CmsTemplateContextInfo.EMPTY_VALUE;
            }
            fieldValues.put(CmsTemplateContextInfo.SETTING,newTemplateContexts);
          }
          final Map<String,String> filteredFieldValues=new HashMap<String,String>();
          for (          Map.Entry<String,String> entry : fieldValues.entrySet()) {
            String key=entry.getKey();
            String value=entry.getValue();
            if ((value != null) && (value.length() > 0)) {
              filteredFieldValues.put(key,value);
            }
          }
          m_controller.reloadElementWithSettings(elementWidget,elementBean.getClientId(),filteredFieldValues,new AsyncCallback<CmsContainerPageElementPanel>(){
            public void onFailure(            Throwable caught){
            }
            public void onSuccess(            CmsContainerPageElementPanel result){
              if (changedContext[0]) {
                CmsContainerpageController.get().handleChangeTemplateContext(result,filteredFieldValues.get(CmsTemplateContextInfo.SETTING));
              }
            }
          }
);
        }
      }
;
      CmsDialogFormHandler formHandler=new CmsDialogFormHandler();
      formHandler.setSubmitHandler(submitHandler);
      form.setFormHandler(formHandler);
      String title=Messages.get().key(Messages.GUI_PROPERTY_DIALOG_TITLE_0);
      CmsFormDialog dialog=new CmsFormDialog(title,form);
      formHandler.setDialog(dialog);
      Map<String,I_CmsFormField> formFields=CmsBasicFormField.createFields(propertyConfig.values());
      for (      I_CmsFormField field : formFields.values()) {
        String fieldId=field.getId();
        String initialValue=settings.get(fieldId);
        if (initialValue == null) {
          CmsXmlContentProperty propDef=propertyConfig.get(fieldId);
          initialValue=propDef.getDefault();
        }
        form.addField(field,initialValue);
      }
      form.render();
      dialog.center();
    }
  }
);
}
