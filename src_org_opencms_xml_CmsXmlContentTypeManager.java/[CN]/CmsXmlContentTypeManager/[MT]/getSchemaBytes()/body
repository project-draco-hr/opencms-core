{
  StringBuffer schema=new StringBuffer(512);
  schema.append("<?xml version=\"1.0\" encoding=\"UTF-8\"?>");
  schema.append("<xsd:schema xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" elementFormDefault=\"qualified\">");
  Iterator i=m_registeredTypes.values().iterator();
  while (i.hasNext()) {
    I_CmsXmlSchemaType type=(I_CmsXmlSchemaType)i.next();
    schema.append(type.getSchemaDefinition());
  }
  schema.append("</xsd:schema>");
  String schemaStr=schema.toString();
  try {
    Document doc=CmsXmlUtils.unmarshalHelper(schemaStr,null);
    schemaStr=CmsXmlUtils.marshal(doc,CmsEncoder.C_UTF8_ENCODING);
  }
 catch (  CmsXmlException e) {
    OpenCms.getLog(this).error("Error pretty-printing schema bytes",e);
  }
  try {
    return schemaStr.getBytes(CmsEncoder.C_UTF8_ENCODING);
  }
 catch (  UnsupportedEncodingException e) {
    OpenCms.getLog(this).error("Error converting schema bytes",e);
  }
  return null;
}
