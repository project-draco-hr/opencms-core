{
  if (!CmsXmlContentDefinition.XSD_NODE_ELEMENT.equals(typeElement.getQName())) {
    throw new CmsXmlException("Invalid OpenCms content definition XML schema structure");
  }
  if (typeElement.elements().size() > 0) {
    throw new CmsXmlException("Invalid OpenCms content definition XML schema structure");
  }
  String elementName=typeElement.attributeValue(CmsXmlContentDefinition.XSD_ATTRIBUTE_NAME);
  String typeName=typeElement.attributeValue(CmsXmlContentDefinition.XSD_ATTRIBUTE_TYPE);
  String defaultValue=typeElement.attributeValue(CmsXmlContentDefinition.XSD_ATTRIBUTE_DEFAULT);
  String maxOccrs=typeElement.attributeValue(CmsXmlContentDefinition.XSD_ATTRIBUTE_MAX_OCCURS);
  String minOccrs=typeElement.attributeValue(CmsXmlContentDefinition.XSD_ATTRIBUTE_MIN_OCCURS);
  if (CmsStringUtil.isEmpty(elementName) || CmsStringUtil.isEmpty(typeName)) {
    throw new CmsXmlException("Invalid OpenCms content definition XML schema structure");
  }
  boolean simpleType=true;
  I_CmsXmlSchemaType schemaType=(I_CmsXmlSchemaType)m_registeredTypes.get(typeName);
  if (schemaType == null) {
    Iterator i=nestedDefinitions.iterator();
    while (i.hasNext()) {
      CmsXmlContentDefinition cd=(CmsXmlContentDefinition)i.next();
      if (typeName.equals(cd.getTypeName())) {
        simpleType=false;
        return new CmsXmlNestedContentDefinition(cd,elementName,minOccrs,maxOccrs);
      }
    }
    if (simpleType) {
      throw new CmsXmlException("Invalid OpenCms content definition XML schema structure: Schema type '" + typeName + "' unknown");
    }
  }
  if (simpleType) {
    schemaType=schemaType.newInstance(elementName,minOccrs,maxOccrs);
    if (CmsStringUtil.isNotEmpty(defaultValue)) {
      schemaType.setDefault(defaultValue);
    }
  }
  return schemaType;
}
