{
  int spaceAssurance=20;
  int space=getToolbarWidth() + (2 * spaceAssurance);
  int windowWidth=Window.getClientWidth();
  int minLeft=(windowWidth - space) / 2;
  if (minLeft < spaceAssurance) {
    minLeft=spaceAssurance;
  }
  int maxRight=minLeft + space;
  CmsPositionBean buttonPosition=CmsPositionBean.generatePositionInfo(m_button.getElement());
  int buttonMiddle=(buttonPosition.getLeft() - Window.getScrollLeft()) + (buttonPosition.getWidth() / 2);
  int contentWidth=m_popup.getOffsetWidth();
  int contentLeft=buttonMiddle - (contentWidth / 2);
  if (minLeft > contentLeft) {
    contentLeft=minLeft;
  }
 else   if ((contentLeft + contentWidth) > maxRight) {
    contentLeft=maxRight - contentWidth;
  }
  if ((contentLeft + contentWidth + spaceAssurance) > windowWidth) {
    contentLeft=windowWidth - contentWidth - spaceAssurance;
  }
  if (contentLeft < spaceAssurance) {
    contentLeft=spaceAssurance;
  }
  int arrowSpace=10;
  int arrowWidth=I_CmsLayoutBundle.INSTANCE.gwtImages().menuArrowTopImage().getWidth();
  int arrowHeight=I_CmsLayoutBundle.INSTANCE.gwtImages().menuArrowTopImage().getHeight();
  int arrowLeft=buttonMiddle - contentLeft - (arrowWidth / 2);
  if ((arrowLeft + arrowWidth + arrowSpace) > contentWidth) {
    arrowLeft=contentWidth - arrowWidth - arrowSpace;
  }
 else   if ((arrowLeft - arrowSpace) < 0) {
    arrowLeft=arrowWidth + arrowSpace;
  }
  int arrowTop=-(arrowHeight - 2);
  String arrowClass=I_CmsLayoutBundle.INSTANCE.dialogCss().menuArrowTop();
  int contentTop=(((buttonPosition.getTop() + buttonPosition.getHeight()) - Window.getScrollTop()) + arrowHeight) - 2;
  if (!m_isToolbarMode) {
    contentTop=(buttonPosition.getTop() + buttonPosition.getHeight() + arrowHeight) - 2;
    int contentHeight=m_popup.getOffsetHeight();
    int windowHeight=Window.getClientHeight();
    if (((contentHeight + spaceAssurance) < windowHeight) && ((buttonPosition.getTop() - Window.getScrollTop()) > contentHeight) && (((contentHeight + spaceAssurance + contentTop) - Window.getScrollTop()) > windowHeight)) {
      contentTop=((buttonPosition.getTop() - arrowHeight) + 2) - contentHeight;
      arrowTop=contentHeight - 1;
      arrowClass=I_CmsLayoutBundle.INSTANCE.dialogCss().menuArrowBottom();
    }
  }
 else {
    contentLeft=contentLeft - Window.getScrollLeft();
    m_popup.setPositionFixed();
  }
  m_arrow.setClassName(arrowClass);
  m_arrow.getStyle().setLeft(arrowLeft,Unit.PX);
  m_arrow.getStyle().setTop(arrowTop,Unit.PX);
  m_popup.showArrow(m_arrow);
  m_popup.setPopupPosition(contentLeft + Window.getScrollLeft(),contentTop);
}
