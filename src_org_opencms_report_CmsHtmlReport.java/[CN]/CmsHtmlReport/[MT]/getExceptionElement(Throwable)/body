{
  StringBuffer buf=new StringBuffer();
  if (!m_writeHtml) {
    if (m_showExceptionStackTracke) {
      buf.append("aT('");
      buf.append(Messages.get().key(getLocale(),Messages.RPT_EXCEPTION_0,null));
      String exception=CmsEncoder.escapeXml(CmsException.getStackTraceAsString(throwable));
      exception=CmsStringUtil.escapeJavaScript(exception);
      StringTokenizer tok=new StringTokenizer(exception,"\r\n");
      while (tok.hasMoreTokens()) {
        buf.append(tok.nextToken());
        buf.append(getLineBreak());
      }
      buf.append("'); ");
      m_content.add(buf);
    }
 else {
      buf.append("aT('");
      buf.append(Messages.get().key(getLocale(),Messages.RPT_EXCEPTION_0,null));
      buf.append(CmsStringUtil.escapeJavaScript(throwable.toString()));
      buf.append("'); ");
      m_content.add(buf);
    }
  }
 else {
    if (m_showExceptionStackTracke) {
      buf.append("<span class='throw'>");
      buf.append(Messages.get().key(getLocale(),Messages.RPT_EXCEPTION_0,null));
      String exception=CmsEncoder.escapeXml(CmsException.getStackTraceAsString(throwable));
      exception=CmsStringUtil.escapeJavaScript(exception);
      StringTokenizer tok=new StringTokenizer(exception,"\r\n");
      while (tok.hasMoreTokens()) {
        buf.append(tok.nextToken());
        buf.append(getLineBreak());
      }
      buf.append("</span>");
    }
 else {
      buf.append("<span class='throw'>");
      buf.append(Messages.get().key(getLocale(),Messages.RPT_EXCEPTION_0,null));
      buf.append(CmsStringUtil.escapeJavaScript(throwable.toString()));
      buf.append("</span>");
      buf.append(getLineBreak());
    }
  }
  return buf;
}
