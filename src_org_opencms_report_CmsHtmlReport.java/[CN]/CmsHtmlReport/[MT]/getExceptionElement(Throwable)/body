{
  StringBuffer buf=new StringBuffer();
  if (!m_writeHtml) {
    if (m_showExceptionStackTracke) {
      buf.append("aT('");
      buf.append(key("report.exception"));
      String exception=CmsEncoder.escapeXml(CmsException.getStackTraceAsString(throwable));
      exception=CmsStringUtil.substitute(exception,"\\","\\\\");
      StringTokenizer tok=new StringTokenizer(exception,"\r\n");
      while (tok.hasMoreTokens()) {
        buf.append(tok.nextToken());
        buf.append(getLineBreak());
      }
      buf.append("'); ");
      m_content.add(buf);
    }
 else {
      buf.append("aT('");
      buf.append(key("report.exception"));
      buf.append(throwable.toString());
      buf.append("'); ");
      m_content.add(buf);
    }
  }
 else {
    if (m_showExceptionStackTracke) {
      buf.append("<span class='throw'>");
      buf.append(key("report.exception"));
      String exception=CmsEncoder.escapeXml(CmsException.getStackTraceAsString(throwable));
      exception=CmsStringUtil.substitute(exception,"\\","\\\\");
      StringTokenizer tok=new StringTokenizer(exception,"\r\n");
      while (tok.hasMoreTokens()) {
        buf.append(tok.nextToken());
        buf.append(getLineBreak());
      }
      buf.append("</span>");
    }
 else {
      buf.append("<span class='throw'>");
      buf.append(key("report.exception"));
      buf.append(throwable.toString());
      buf.append("</span>");
      buf.append(getLineBreak());
    }
  }
  return buf;
}
