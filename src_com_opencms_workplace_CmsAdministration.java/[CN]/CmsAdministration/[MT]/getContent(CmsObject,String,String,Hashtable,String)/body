{
  I_CmsSession session=cms.getRequestContext().getSession(true);
  CmsXmlWpTemplateFile templateDocument=new CmsXmlWpTemplateFile(cms,templateFile);
  CmsXmlLanguageFile lang=templateDocument.getLanguageFile();
  String navPos=(String)session.getValue(C_SESSION_ADMIN_POS);
  templateDocument.setData("emptyPic",(String)resourcesUri(cms,"empty.gif",null,null));
  CmsXmlWpConfigFile confFile=new CmsXmlWpConfigFile(cms);
  String sentBy=(String)parameters.get("sender");
  if (sentBy == null) {
    if (navPos == null) {
      sentBy=confFile.getWorkplaceAdministrationPath();
    }
 else {
      if (!navPos.endsWith("/")) {
        navPos=navPos.substring(0,navPos.indexOf("/") + 1);
      }
      sentBy=navPos;
    }
  }
  if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging() && C_DEBUG) {
    A_OpenCms.log(C_OPENCMS_DEBUG,this.getClassName() + "getting content of element " + ((elementName == null) ? "<root>" : elementName));
    A_OpenCms.log(C_OPENCMS_DEBUG,this.getClassName() + "template file is: " + templateFile);
    A_OpenCms.log(C_OPENCMS_DEBUG,this.getClassName() + "selected template section is: " + ((templateSelector == null) ? "<default>" : templateSelector));
    A_OpenCms.log(C_OPENCMS_DEBUG,this.getClassName() + "sentBy: " + sentBy);
  }
  Vector iconVector=new Vector();
  if (sentBy.endsWith("/administration/")) {
    sentBy=confFile.getWorkplaceAdministrationPath();
    iconVector=cms.getSubFolders(sentBy);
    Vector modules=new Vector();
    modules=cms.getSubFolders(I_CmsWpConstants.C_VFS_PATH_MODULES);
    for (int i=0; i < modules.size(); i++) {
      Vector moduleAdminPoints=new Vector();
      String dummy=cms.readAbsolutePath((CmsFolder)modules.elementAt(i));
      dummy+="administration/";
      moduleAdminPoints=cms.getSubFolders(dummy);
      for (int j=0; j < moduleAdminPoints.size(); j++) {
        CmsFolder currentModuleAdminFolder=(CmsFolder)moduleAdminPoints.elementAt(j);
        iconVector.addElement(currentModuleAdminFolder);
      }
    }
  }
 else {
    iconVector=cms.getSubFolders(sentBy);
  }
  session.putValue(C_SESSION_ADMIN_POS,sentBy);
  Vector iconVector2=cms.getFilesInFolder(sentBy);
  int numFolders=iconVector.size();
  if (numFolders > 0) {
    String iconNames[]=new String[numFolders];
    int index[]=new int[numFolders];
    String folderTitles[]=new String[numFolders];
    String folderLangKeys[]=new String[numFolders];
    String folderPos[]=new String[numFolders];
    String folderVisible[]=new String[numFolders];
    String folderActiv[]=new String[numFolders];
    String accessVisible[]=new String[numFolders];
    for (int i=0; i < numFolders; i++) {
      CmsResource aktIcon=(CmsResource)iconVector.elementAt(i);
      try {
        Map propertyinfos=cms.readProperties(cms.readAbsolutePath(aktIcon));
        iconNames[i]=cms.readAbsolutePath(aktIcon);
        index[i]=i;
        folderLangKeys[i]=getStringValue((String)propertyinfos.get(C_PROPERTY_NAVTEXT));
        folderTitles[i]=getStringValue((String)propertyinfos.get(C_PROPERTY_TITLE));
        folderPos[i]=getStringValue((String)propertyinfos.get(C_PROPERTY_NAVPOS));
        if (folderPos[i].equals("")) {
          folderPos[i]="101";
        }
        folderVisible[i]=getStringValue((String)propertyinfos.get(C_PROPERTY_VISIBLE));
        folderActiv[i]=getStringValue((String)propertyinfos.get(C_PROPERTY_ACTIV));
        accessVisible[i]=new Boolean(checkVisible(cms,aktIcon)).toString();
      }
 catch (      CmsException e) {
        if (e.getType() != CmsException.C_NO_ACCESS && e.getType() != CmsException.C_ACCESS_DENIED) {
          throw e;
        }
      }
catch (      Exception exc) {
        throw new CmsException("[" + this.getClass().getName() + "] "+ exc.getMessage(),CmsException.C_SQL_ERROR,exc);
      }
    }
    sort(iconNames,index,folderPos,numFolders);
    String completeTable="";
    int element=0;
    int zeile=0;
    while (element < numFolders) {
      String completeRow="";
      while ((element < numFolders)) {
        int pos=index[element];
        if (iconNames[element] != null) {
          completeRow+=generateIcon(cms,templateDocument,parameters,lang,folderTitles[pos],iconNames[element],folderLangKeys[pos],folderActiv[pos],folderVisible[pos],accessVisible[pos]);
        }
        element++;
      }
      templateDocument.setData("entrys",completeRow);
      completeTable+=templateDocument.getProcessedDataValue("list_row");
      zeile++;
    }
    templateDocument.setData("iconTable",completeTable);
  }
 else {
    try {
      cms.getRequestContext().getResponse().sendCmsRedirect(sentBy + "index.html?initial=true");
    }
 catch (    Exception e) {
      throw new CmsException("Redirect fails :" + cms.readAbsolutePath((CmsFile)iconVector2.elementAt(0)),CmsException.C_UNKNOWN_EXCEPTION,e);
    }
    return null;
  }
  return startProcessing(cms,templateDocument,elementName,parameters,templateSelector);
}
