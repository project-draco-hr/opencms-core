{
  if (C_DEBUG && A_OpenCms.isLogging()) {
    A_OpenCms.log(C_OPENCMS_DEBUG,this.getClassName() + "getting content of element " + ((elementName == null) ? "<root>" : elementName));
    A_OpenCms.log(C_OPENCMS_DEBUG,this.getClassName() + "template file is: " + templateFile);
    A_OpenCms.log(C_OPENCMS_DEBUG,this.getClassName() + "selected template section is: " + ((templateSelector == null) ? "<default>" : templateSelector));
  }
  I_CmsSession session=cms.getRequestContext().getSession(true);
  CmsXmlWpTemplateFile templateDocument=new CmsXmlWpTemplateFile(cms,templateFile);
  CmsXmlLanguageFile lang=templateDocument.getLanguageFile();
  String navPos=(String)session.getValue(C_SESSION_ADMIN_POS);
  templateDocument.setData("emptyPic",(String)picsUrl(cms,"empty.gif",null,null));
  CmsXmlWpConfigFile confFile=new CmsXmlWpConfigFile(cms);
  String sendBy=(String)parameters.get("sender");
  if (sendBy == null) {
    if (navPos == null) {
      sendBy=confFile.getWorkplaceAdministrationPath();
    }
 else {
      if (!navPos.endsWith("/")) {
        navPos=navPos.substring(0,navPos.indexOf("/") + 1);
      }
      sendBy=navPos;
    }
  }
  session.putValue(C_SESSION_ADMIN_POS,sendBy);
  Vector iconVector=cms.getSubFolders(sendBy);
  Vector iconVector2=cms.getFilesInFolder(sendBy);
  int numFolders=iconVector.size();
  if (numFolders > 0) {
    String iconNames[]=new String[numFolders];
    int index[]=new int[numFolders];
    String folderTitles[]=new String[numFolders];
    String folderLangKeys[]=new String[numFolders];
    String folderPos[]=new String[numFolders];
    String folderVisible[]=new String[numFolders];
    String folderActiv[]=new String[numFolders];
    for (int i=0; i < numFolders; i++) {
      CmsResource aktIcon=(CmsResource)iconVector.elementAt(i);
      try {
        iconNames[i]=aktIcon.getAbsolutePath();
        index[i]=i;
        Hashtable propertyinfos=cms.readAllProperties(iconNames[i]);
        folderLangKeys[i]=(String)propertyinfos.get(C_PROPERTY_NAVTEXT);
        folderTitles[i]=(String)propertyinfos.get(C_PROPERTY_TITLE);
        folderPos[i]=(String)propertyinfos.get(C_PROPERTY_NAVPOS);
        folderVisible[i]=(String)propertyinfos.get(C_PROPERTY_VISIBLE);
        folderActiv[i]=(String)propertyinfos.get(C_PROPERTY_ACTIV);
      }
 catch (      Exception exc) {
        throw new CmsException("[" + this.getClass().getName() + "] "+ exc.getMessage(),CmsException.C_SQL_ERROR,exc);
      }
    }
    sort(iconNames,index,folderPos,numFolders);
    String completeTable="";
    int element=0;
    int zeile=0;
    while (element < numFolders) {
      String completeRow="";
      while ((element < numFolders) && (element < (zeile + 1) * C_ELEMENT_PER_ROW)) {
        int pos=index[element];
        completeRow+=generateIcon(cms,templateDocument,parameters,lang,folderTitles[pos],iconNames[element],folderLangKeys[pos],folderActiv[pos],folderVisible[pos]);
        element++;
      }
      templateDocument.setData("entrys",completeRow);
      completeTable+=templateDocument.getProcessedDataValue("list_row");
      zeile++;
    }
    templateDocument.setData("iconTable",completeTable);
  }
 else {
    try {
      cms.getRequestContext().getResponse().sendCmsRedirect(sendBy + "index.html?initial=true");
    }
 catch (    Exception e) {
      throw new CmsException("Redirect fails :" + ((CmsFile)iconVector2.elementAt(0)).getAbsolutePath(),CmsException.C_UNKNOWN_EXCEPTION,e);
    }
  }
  return startProcessing(cms,templateDocument,elementName,parameters,templateSelector);
}
