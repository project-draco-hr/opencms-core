{
  CmsFlexController controller=CmsFlexController.getController(req);
  if (target == null) {
    target=controller.getCmsObject().getRequestContext().getUri();
  }
  target=CmsLinkManager.getAbsoluteUri(target,controller.getCurrentRequest().getElementUri());
  try {
    target=OpenCms.getResourceManager().resolveIncludeExtensions(target,element,editable,paramMap,req,res);
    controller.getCmsObject().readResource(target);
  }
 catch (  CmsException e) {
    controller.setThrowable(e,target);
    throw new JspException(e);
  }
  boolean directEditOpen=editable && CmsJspTagEditable.startDirectEdit(context,new CmsDirectEditParams(target,element));
  Map oldParameterMap=req.getParameterMap();
  try {
    Map parameterMap=(paramMap == null) ? new HashMap() : new HashMap(paramMap);
    if (cacheable && (element != null)) {
      addParameter(parameterMap,I_CmsResourceLoader.PARAMETER_ELEMENT,element,true);
    }
    controller.getCurrentRequest().addParameterMap(parameterMap);
    if (cacheable) {
      includeActionWithCache(controller,context,target,parameterMap,req,res);
    }
 else {
      includeActionNoCache(controller,context,target,element,locale,req,res);
    }
  }
  finally {
    if (oldParameterMap != null) {
      controller.getCurrentRequest().setParameterMap(oldParameterMap);
    }
  }
  if (directEditOpen) {
    CmsJspTagEditable.endDirectEdit(context);
  }
}
