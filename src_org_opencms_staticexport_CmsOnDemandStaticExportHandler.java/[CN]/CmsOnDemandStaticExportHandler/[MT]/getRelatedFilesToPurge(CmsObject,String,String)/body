{
  List<File> filesToPurge=new ArrayList<File>();
  addFileToPurge(cms,filesToPurge,vfsName);
  try {
    List<CmsRelation> relations=cms.getRelationsForResource(vfsName,CmsRelationFilter.SOURCES);
    for (    CmsRelation relation : relations) {
      CmsResource source=null;
      try {
        source=relation.getSource(cms,CmsResourceFilter.ALL);
      }
 catch (      CmsException e) {
        if (LOG.isErrorEnabled()) {
          LOG.error(e.getLocalizedMessage(),e);
        }
        continue;
      }
      if (source != null) {
        if (CmsResourceTypeXmlContainerPage.isContainerPage(source)) {
          List<CmsInternalSitemapEntry> entries=OpenCms.getSitemapManager().getEntriesForStructureId(cms,source.getStructureId());
          for (          CmsInternalSitemapEntry entry : entries) {
            addFileToPurge(cms,filesToPurge,entry.getRootPath());
          }
        }
        addFileToPurge(cms,filesToPurge,source.getRootPath());
      }
    }
  }
 catch (  CmsException e) {
    if (LOG.isErrorEnabled()) {
      LOG.error(e.getLocalizedMessage(),e);
    }
  }
  return filesToPurge;
}
