{
  int pos=m_paramNewLink.indexOf('|');
  String collectorName=m_paramNewLink.substring(0,pos);
  String param=m_paramNewLink.substring(pos + 1);
  I_CmsResourceCollector collector=OpenCms.getResourceManager().getContentCollector(collectorName);
  String newFileName="";
  try {
    CmsFile templateFile=getCms().readFile(getParamResource(),CmsResourceFilter.IGNORE_EXPIRATION);
    CmsXmlContent template=CmsXmlContentFactory.unmarshal(getCloneCms(),templateFile);
    Locale locale=(Locale)OpenCms.getLocaleManager().getDefaultLocales(getCms(),getParamResource()).get(0);
    CmsXmlContent newContent=CmsXmlContentFactory.createDocument(getCms(),locale,template.getEncoding(),template.getContentDefinition());
    newFileName=collector.getCreateLink(getCms(),collectorName,param);
    boolean useModelFile=false;
    if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(getParamModelFile())) {
      getCms().getRequestContext().setAttribute(CmsRequestContext.ATTRIBUTE_MODEL,getParamModelFile());
      useModelFile=true;
    }
    getCms().createResource(newFileName,templateFile.getTypeId());
    CmsFile newFile=getCms().readFile(newFileName,CmsResourceFilter.ALL);
    if (!useModelFile) {
      newFile.setContents(newContent.marshal());
      getCloneCms().writeFile(newFile);
    }
    setParamNewLink(null);
    setParamAction(null);
    setParamResource(newFileName);
    setAction(ACTION_DEFAULT);
    setParamTempfile(createTempFile());
    m_file=getCms().readFile(getParamTempfile(),CmsResourceFilter.ALL);
    if (!useModelFile) {
      m_content=newContent;
    }
 else {
      m_content=CmsXmlContentFactory.unmarshal(getCms(),m_file);
    }
  }
 catch (  CmsException e) {
    if (LOG.isErrorEnabled()) {
      LOG.error(Messages.get().getBundle().key(Messages.LOG_CREATE_XML_CONTENT_ITEM_1,m_paramNewLink),e);
    }
    throw new JspException(e);
  }
 finally {
    try {
      getCms().deleteResource(newFileName,CmsResource.DELETE_REMOVE_SIBLINGS);
    }
 catch (    CmsException e) {
    }
  }
}
