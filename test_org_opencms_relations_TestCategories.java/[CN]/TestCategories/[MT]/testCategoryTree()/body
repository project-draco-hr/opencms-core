{
  System.out.println("Testing the category tree access with different repositories.");
  CmsObject cms=getCmsObject();
  cms.createResource(CmsCategoryService.CENTRALIZED_REPOSITORY,CmsResourceTypeFolder.RESOURCE_TYPE_ID);
  List<CmsCategory> cats=CmsCategoryService.getInstance().readCategories(cms,null,true,"index.html");
  assertTrue(cats.isEmpty());
  CmsCategory catA=CmsCategoryService.getInstance().createCategory(cms,null,"a","A","A test",null);
  assertEquals("a/",catA.getPath());
  assertEquals("A",catA.getTitle());
  assertEquals("A test",catA.getDescription());
  assertEquals(CmsCategoryService.CENTRALIZED_REPOSITORY,catA.getBasePath());
  CmsResource resA=cms.readResource(cms.getRequestContext().removeSiteRoot(catA.getRootPath()));
  assertEquals(catA.getId(),resA.getStructureId());
  assertEquals(catA.getRootPath(),resA.getRootPath());
  assertEquals(catA.getTitle(),cms.readPropertyObject(resA,CmsPropertyDefinition.PROPERTY_TITLE,false).getValue());
  assertEquals(catA.getDescription(),cms.readPropertyObject(resA,CmsPropertyDefinition.PROPERTY_DESCRIPTION,false).getValue());
  cats=CmsCategoryService.getInstance().readCategories(cms,null,true,"index.html");
  assertEquals(1,cats.size());
  assertEquals(catA,cats.get(0));
  cms.createResource(CmsCategoryService.getInstance().getRepositoryBaseFolderName(cms),CmsResourceTypeFolder.RESOURCE_TYPE_ID);
  CmsCategory catB=CmsCategoryService.getInstance().createCategory(cms,null,"b","B","B test","index.html");
  assertEquals("b/",catB.getPath());
  assertEquals("B",catB.getTitle());
  assertEquals("B test",catB.getDescription());
  assertEquals(cms.getRequestContext().getSiteRoot() + CmsCategoryService.getInstance().getRepositoryBaseFolderName(cms),catB.getBasePath());
  CmsResource resB=cms.readResource(cms.getRequestContext().removeSiteRoot(catB.getRootPath()));
  assertEquals(catB.getId(),resB.getStructureId());
  assertEquals(catB.getRootPath(),resB.getRootPath());
  assertEquals(catB.getTitle(),cms.readPropertyObject(resB,CmsPropertyDefinition.PROPERTY_TITLE,false).getValue());
  assertEquals(catB.getDescription(),cms.readPropertyObject(resB,CmsPropertyDefinition.PROPERTY_DESCRIPTION,false).getValue());
  assertTrue(catA.compareTo(catA) == 0);
  assertTrue(catB.compareTo(catB) == 0);
  assertTrue(catA.compareTo(catB) < 0);
  assertTrue(catB.compareTo(catA) > 0);
  cats=CmsCategoryService.getInstance().readCategories(cms,null,true,"index.html");
  assertEquals(2,cats.size());
  assertEquals(catA,cats.get(0));
  assertEquals(catB,cats.get(1));
  CmsCategory catAA=CmsCategoryService.getInstance().createCategory(cms,catA,"aa","AA","AA test",null);
  assertEquals("a/aa/",catAA.getPath());
  assertEquals("AA",catAA.getTitle());
  assertEquals("AA test",catAA.getDescription());
  assertEquals(CmsCategoryService.CENTRALIZED_REPOSITORY,catAA.getBasePath());
  CmsResource resAA=cms.readResource(cms.getRequestContext().removeSiteRoot(catAA.getRootPath()));
  assertEquals(catAA.getId(),resAA.getStructureId());
  assertEquals(catAA.getRootPath(),resAA.getRootPath());
  assertEquals(catAA.getTitle(),cms.readPropertyObject(resAA,CmsPropertyDefinition.PROPERTY_TITLE,false).getValue());
  assertEquals(catAA.getDescription(),cms.readPropertyObject(resAA,CmsPropertyDefinition.PROPERTY_DESCRIPTION,false).getValue());
  cats=CmsCategoryService.getInstance().readCategories(cms,null,true,"index.html");
  assertEquals(3,cats.size());
  assertEquals(catA,cats.get(0));
  assertEquals(catAA,cats.get(1));
  assertEquals(catB,cats.get(2));
  cms.getRequestContext().setSiteRoot("");
  cats=CmsCategoryService.getInstance().readCategories(cms,null,true,"index.html");
  assertEquals(2,cats.size());
  assertEquals(catA,cats.get(0));
  assertEquals(catAA,cats.get(1));
}
