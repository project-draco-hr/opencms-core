{
  System.out.println("Testing the category assignment with different repositories.");
  CmsObject cms=getCmsObject();
  List<CmsCategory> cats=CmsCategoryService.getInstance().readCategories(cms,null,true,"index.html");
  assertEquals(3,cats.size());
  CmsCategory catA=cats.get(0);
  CmsCategory catAA=cats.get(1);
  CmsCategory catB=cats.get(2);
  assertEquals(CmsCategoryService.CENTRALIZED_REPOSITORY + "a/",catA.getRootPath());
  assertEquals(CmsCategoryService.CENTRALIZED_REPOSITORY + "a/aa/",catAA.getRootPath());
  assertEquals(cms.getRequestContext().getSiteRoot() + CmsCategoryService.getInstance().getRepositoryBaseFolderName(cms) + "b/",catB.getRootPath());
  assertTrue(CmsCategoryService.getInstance().readResourceCategories(cms,"index.html").isEmpty());
  assertTrue(CmsCategoryService.getInstance().readCategoryResources(cms,catA.getPath(),true,"index.html").isEmpty());
  assertTrue(CmsCategoryService.getInstance().readCategoryResources(cms,catAA.getPath(),true,"index.html").isEmpty());
  assertTrue(CmsCategoryService.getInstance().readCategoryResources(cms,catB.getPath(),true,"index.html").isEmpty());
  cms.lockResource("index.html");
  CmsCategoryService.getInstance().addResourceToCategory(cms,"index.html",catB);
  cats=CmsCategoryService.getInstance().readResourceCategories(cms,"index.html");
  assertEquals(1,cats.size());
  assertEquals(catB,cats.get(0));
  assertTrue(CmsCategoryService.getInstance().readCategoryResources(cms,catA.getPath(),true,"index.html").isEmpty());
  assertTrue(CmsCategoryService.getInstance().readCategoryResources(cms,catAA.getPath(),true,"index.html").isEmpty());
  List<CmsResource> resources=CmsCategoryService.getInstance().readCategoryResources(cms,catB.getPath(),true,"index.html");
  assertEquals(1,resources.size());
  assertEquals(cms.readResource("index.html"),resources.get(0));
  CmsCategoryService.getInstance().addResourceToCategory(cms,"index.html",catB);
  cats=CmsCategoryService.getInstance().readResourceCategories(cms,"index.html");
  assertEquals(1,cats.size());
  assertEquals(catB,cats.get(0));
  assertTrue(CmsCategoryService.getInstance().readCategoryResources(cms,catA.getPath(),true,"index.html").isEmpty());
  assertTrue(CmsCategoryService.getInstance().readCategoryResources(cms,catAA.getPath(),true,"index.html").isEmpty());
  resources=CmsCategoryService.getInstance().readCategoryResources(cms,catB.getPath(),true,"index.html");
  assertEquals(1,resources.size());
  assertEquals(cms.readResource("index.html"),resources.get(0));
  CmsCategoryService.getInstance().addResourceToCategory(cms,"index.html",catAA);
  cats=CmsCategoryService.getInstance().readResourceCategories(cms,"index.html");
  assertEquals(3,cats.size());
  assertEquals(catA,cats.get(0));
  assertEquals(catAA,cats.get(1));
  assertEquals(catB,cats.get(2));
  resources=CmsCategoryService.getInstance().readCategoryResources(cms,catA.getPath(),true,"index.html");
  assertEquals(1,resources.size());
  assertEquals(cms.readResource("index.html"),resources.get(0));
  resources=CmsCategoryService.getInstance().readCategoryResources(cms,catAA.getPath(),true,"index.html");
  assertEquals(1,resources.size());
  assertEquals(cms.readResource("index.html"),resources.get(0));
  resources=CmsCategoryService.getInstance().readCategoryResources(cms,catB.getPath(),true,"index.html");
  assertEquals(1,resources.size());
  assertEquals(cms.readResource("index.html"),resources.get(0));
  CmsCategoryService.getInstance().removeResourceFromCategory(cms,"index.html",catAA);
  cats=CmsCategoryService.getInstance().readResourceCategories(cms,"index.html");
  assertEquals(2,cats.size());
  assertEquals(catA,cats.get(0));
  assertEquals(catB,cats.get(1));
  resources=CmsCategoryService.getInstance().readCategoryResources(cms,catA.getPath(),true,"index.html");
  assertEquals(1,resources.size());
  assertEquals(cms.readResource("index.html"),resources.get(0));
  assertTrue(CmsCategoryService.getInstance().readCategoryResources(cms,catAA.getPath(),true,"index.html").isEmpty());
  resources=CmsCategoryService.getInstance().readCategoryResources(cms,catB.getPath(),true,"index.html");
  assertEquals(1,resources.size());
  assertEquals(cms.readResource("index.html"),resources.get(0));
  CmsCategoryService.getInstance().removeResourceFromCategory(cms,"index.html",catA);
  cats=CmsCategoryService.getInstance().readResourceCategories(cms,"index.html");
  assertEquals(1,cats.size());
  assertEquals(catB,cats.get(0));
  assertTrue(CmsCategoryService.getInstance().readCategoryResources(cms,catA.getPath(),true,"index.html").isEmpty());
  assertTrue(CmsCategoryService.getInstance().readCategoryResources(cms,catAA.getPath(),true,"index.html").isEmpty());
  resources=CmsCategoryService.getInstance().readCategoryResources(cms,catB.getPath(),true,"index.html");
  assertEquals(1,resources.size());
  assertEquals(cms.readResource("index.html"),resources.get(0));
  CmsCategoryService.getInstance().addResourceToCategory(cms,"index.html",catA);
  cats=CmsCategoryService.getInstance().readResourceCategories(cms,"index.html");
  assertEquals(2,cats.size());
  assertEquals(catA,cats.get(0));
  assertEquals(catB,cats.get(1));
  resources=CmsCategoryService.getInstance().readCategoryResources(cms,catA.getPath(),true,"index.html");
  assertEquals(1,resources.size());
  assertEquals(cms.readResource("index.html"),resources.get(0));
  assertTrue(CmsCategoryService.getInstance().readCategoryResources(cms,catAA.getPath(),true,"index.html").isEmpty());
  resources=CmsCategoryService.getInstance().readCategoryResources(cms,catB.getPath(),true,"index.html");
  assertEquals(1,resources.size());
  assertEquals(cms.readResource("index.html"),resources.get(0));
}
