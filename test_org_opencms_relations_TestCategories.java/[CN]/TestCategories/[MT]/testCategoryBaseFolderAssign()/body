{
  System.out.println("Testing category assignment when changing the base folder name of the category repositories.");
  CmsObject cms=getCmsObject();
  List cats=CmsCategoryService.getInstance().readCategories(cms,null,true,"index.html");
  assertEquals(3,cats.size());
  CmsCategory catA=(CmsCategory)cats.get(0);
  CmsCategory catAA=(CmsCategory)cats.get(1);
  CmsCategory catC=(CmsCategory)cats.get(2);
  assertEquals(CmsCategoryService.CENTRALIZED_REPOSITORY + "a/",catA.getRootPath());
  assertEquals(CmsCategoryService.CENTRALIZED_REPOSITORY + "a/aa/",catAA.getRootPath());
  assertEquals(cms.getRequestContext().getSiteRoot() + CmsCategoryService.getInstance().getRepositoryBaseFolderName(cms) + "c/",catC.getRootPath());
  cats=CmsCategoryService.getInstance().readResourceCategories(cms,"index.html");
  assertEquals(1,cats.size());
  assertEquals(catA,cats.get(0));
  List resources=CmsCategoryService.getInstance().readCategoryResources(cms,catA.getPath(),true,"index.html");
  assertEquals(1,resources.size());
  assertEquals(cms.readResource("index.html"),resources.get(0));
  assertTrue(CmsCategoryService.getInstance().readCategoryResources(cms,catAA.getPath(),true,"index.html").isEmpty());
  assertTrue(CmsCategoryService.getInstance().readCategoryResources(cms,catC.getPath(),true,"index.html").isEmpty());
  CmsCategoryService.getInstance().addResourceToCategory(cms,"index.html",catC.getPath());
  cats=CmsCategoryService.getInstance().readResourceCategories(cms,"index.html");
  assertEquals(2,cats.size());
  assertEquals(catA,cats.get(0));
  assertEquals(catC,cats.get(1));
  resources=CmsCategoryService.getInstance().readCategoryResources(cms,catA.getPath(),true,"index.html");
  assertEquals(1,resources.size());
  assertEquals(cms.readResource("index.html"),resources.get(0));
  assertTrue(CmsCategoryService.getInstance().readCategoryResources(cms,catAA.getPath(),true,"index.html").isEmpty());
  resources=CmsCategoryService.getInstance().readCategoryResources(cms,catC.getPath(),true,"index.html");
  assertEquals(1,resources.size());
  assertEquals(cms.readResource("index.html"),resources.get(0));
  CmsCategoryService.getInstance().removeResourceFromCategory(cms,"index.html",catC.getPath());
  cats=CmsCategoryService.getInstance().readResourceCategories(cms,"index.html");
  assertEquals(1,cats.size());
  assertEquals(catA,cats.get(0));
  resources=CmsCategoryService.getInstance().readCategoryResources(cms,catA.getPath(),true,"index.html");
  assertEquals(1,resources.size());
  assertEquals(cms.readResource("index.html"),resources.get(0));
  assertTrue(CmsCategoryService.getInstance().readCategoryResources(cms,catAA.getPath(),true,"index.html").isEmpty());
  assertTrue(CmsCategoryService.getInstance().readCategoryResources(cms,catC.getPath(),true,"index.html").isEmpty());
  cms.writePropertyObject(CmsCategoryService.CENTRALIZED_REPOSITORY,new CmsProperty(CmsPropertyDefinition.PROPERTY_DEFAULT_FILE,CmsCategoryService.REPOSITORY_BASE_FOLDER,null));
  CmsCategory catB=CmsCategoryService.getInstance().getCategory(cms,cms.readResource(CmsCategoryService.REPOSITORY_BASE_FOLDER + "b"));
  cats=CmsCategoryService.getInstance().readCategories(cms,null,true,"index.html");
  assertEquals(3,cats.size());
  assertEquals(catA,cats.get(0));
  assertEquals(catAA,cats.get(1));
  assertEquals(catB,cats.get(2));
}
