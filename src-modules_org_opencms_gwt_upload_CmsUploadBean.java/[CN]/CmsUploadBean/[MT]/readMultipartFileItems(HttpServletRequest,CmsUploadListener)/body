{
  if (!ServletFileUpload.isMultipartContent(request)) {
    return null;
  }
  DiskFileItemFactory factory=new DiskFileItemFactory();
  factory.setSizeThreshold(4096);
  factory.setRepository(new File(OpenCms.getSystemInfo().getPackagesRfsPath()));
  ServletFileUpload fu=new ServletFileUpload(factory);
  fu.setHeaderEncoding(request.getCharacterEncoding());
  fu.setProgressListener(listener);
  List<FileItem> result=new ArrayList<FileItem>();
  try {
    List<FileItem> items=CmsCollectionsGenericWrapper.list(fu.parseRequest(request));
    if (items != null) {
      result=items;
    }
  }
 catch (  SizeLimitExceededException e) {
    int actualSize=(int)(e.getActualSize() / 1024);
    int maxSize=(int)(e.getPermittedSize() / 1024);
    CmsUploadException ex=new CmsUploadException("Size limit reached - actual size: " + actualSize + " maximum size: "+ maxSize);
    listener.setException(ex);
    throw ex;
  }
catch (  CmsUploadException e) {
    listener.setException(e);
    throw e;
  }
catch (  Exception e) {
    LOG.error(e.getMessage(),e);
    CmsUploadException ex=new CmsUploadException("Unexpected upload exception occurred");
    listener.setException(ex);
    throw ex;
  }
  return result;
}
