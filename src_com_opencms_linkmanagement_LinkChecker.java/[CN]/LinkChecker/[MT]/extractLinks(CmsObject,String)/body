{
  CmsResource resource=cms.readFileHeader(page);
  String rootName=resource.getRootName();
  String bodyFileName=null;
  String bodyClassName=null;
  CmsXmlTemplateFile bodyTemplateFile=null;
  boolean isSimplePage=(null != cms.readProperty(page,CmsXmlLauncher.C_XML_CONTROL_TEMPLATE_PROPERTY));
  if (isSimplePage) {
    CmsXmlTemplate bodyClassObject=(CmsXmlTemplate)CmsTemplateClassManager.getClassInstance(cms,"com.opencms.template.CmsXmlTemplate");
    bodyTemplateFile=bodyClassObject.getOwnTemplateFile(cms,page,I_CmsConstants.C_TYPE_BODY_NAME,null,null);
  }
 else {
    CmsXmlControlFile pageControlFile=new CmsXmlControlFile(cms,page);
    if (pageControlFile.isElementTemplateDefined(I_CmsConstants.C_TYPE_BODY_NAME)) {
      bodyFileName=pageControlFile.getElementTemplate(I_CmsConstants.C_TYPE_BODY_NAME);
      bodyFileName=pageControlFile.validateBodyPath(cms,bodyFileName,resource);
    }
    if (pageControlFile.isElementClassDefined(I_CmsConstants.C_TYPE_BODY_NAME)) {
      bodyClassName=pageControlFile.getElementClass(I_CmsConstants.C_TYPE_BODY_NAME);
    }
    CmsXmlTemplate bodyClassObject=(CmsXmlTemplate)CmsTemplateClassManager.getClassInstance(cms,bodyClassName);
    bodyTemplateFile=bodyClassObject.getOwnTemplateFile(cms,bodyFileName,I_CmsConstants.C_TYPE_BODY_NAME,null,null);
  }
  Vector result=bodyTemplateFile.getAllLinkTagValues();
  Vector cleanResult=new Vector(result.size());
  for (int i=0; i < result.size(); i++) {
    String work=(String)result.elementAt(i);
    int paraStart=work.indexOf("?");
    if (paraStart >= 0) {
      work=work.substring(0,paraStart);
    }
    int ankerStart=work.indexOf("#");
    if (ankerStart >= 0) {
      work=work.substring(0,ankerStart);
    }
    if (work.startsWith("///")) {
      work=work.substring(2);
    }
 else {
      work=com.opencms.util.Utils.mergeAbsolutePath(page,work);
      work=rootName + work;
    }
    cleanResult.add(work);
  }
  return new CmsPageLinks(cms.readFileHeader(page).getResourceId(),cleanResult);
}
