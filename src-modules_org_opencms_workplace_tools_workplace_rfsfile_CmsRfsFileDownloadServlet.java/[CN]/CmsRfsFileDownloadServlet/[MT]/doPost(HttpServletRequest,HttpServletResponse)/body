{
  String fileToFind=request.getParameter("filePath");
  if (CmsStringUtil.isEmpty(fileToFind)) {
    throw new ServletException(Messages.get().key(Messages.ERR_DOWNLOAD_SERVLET_FILE_ARG_0));
  }
 else {
    File downloadFile=new File(fileToFind);
    response.setHeader("Content-Disposition",new StringBuffer("attachment; filename=\"").append(downloadFile.getName()).append("\"").toString());
    response.setContentLength((int)downloadFile.length());
    CmsFlexController controller=(CmsFlexController)request.getAttribute(CmsFlexController.ATTRIBUTE_NAME);
    controller.getTopResponse().setContentType("application/download");
    InputStream in=null;
    ServletOutputStream outStream=null;
    outStream=response.getOutputStream();
    in=new BufferedInputStream(new FileInputStream(downloadFile));
    try {
      int bit=in.read();
      while ((bit) >= 0) {
        outStream.write(bit);
        bit=in.read();
      }
    }
 catch (    IOException ioe) {
      ioe.printStackTrace(System.out);
    }
    outStream.flush();
    outStream.close();
    in.close();
  }
}
