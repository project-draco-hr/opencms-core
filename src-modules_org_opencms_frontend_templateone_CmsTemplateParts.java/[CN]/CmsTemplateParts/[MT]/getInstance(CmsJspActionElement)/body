{
  CmsTemplateParts parts=(CmsTemplateParts)OpenCms.getRuntimeProperty(C_RUNTIME_PROPERTY_NAME);
  if (parts == null) {
    parts=new CmsTemplateParts();
    OpenCms.setRuntimeProperty(C_RUNTIME_PROPERTY_NAME,parts);
    if (OpenCms.getLog(CmsTemplateParts.class).isDebugEnabled()) {
      OpenCms.getLog(CmsTemplateParts.class).debug("Instance not found in runtime properties, creating new instance");
    }
  }
 else   if (OpenCms.getLog(CmsTemplateParts.class).isDebugEnabled()) {
    OpenCms.getLog(CmsTemplateParts.class).debug("Instance found in runtime properties");
  }
  if (jsp.getRequestContext().currentProject().isOnlineProject()) {
    parts.setProject(C_PROJECT_ONLINE);
  }
 else {
    parts.setProject(C_PROJECT_OFFLINE);
  }
  parts.setJsp(jsp);
  return parts;
}
