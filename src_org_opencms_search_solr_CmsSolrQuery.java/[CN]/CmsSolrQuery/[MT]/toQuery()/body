{
  if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(m_text)) {
    m_solrQuery.setQuery(createTextQuery());
  }
 else {
    m_solrQuery.setQuery(m_queryString);
  }
  if (m_structureQuery) {
    m_solrQuery.setFields(STRUCTURE_FIELDS);
  }
 else {
    m_solrQuery.setFields(m_fields);
  }
  m_solrQuery.setQueryType(m_queryType);
  m_solrQuery.setRows(m_rows);
  if ((m_sortFields != null) && !m_sortFields.isEmpty()) {
    addSortFields(m_sortFields);
  }
  if ((m_locales != null) && !m_locales.isEmpty()) {
    addLocales(m_locales);
  }
  if ((m_dateRanges != null) && !m_dateRanges.isEmpty()) {
    addDateRanges(m_dateRanges);
  }
  if ((m_categories != null) && !m_categories.isEmpty()) {
    addFilterQuery(I_CmsSearchField.FIELD_CATEGORY + "_exact",true,m_categories);
  }
  if ((m_resourceTypes != null) && !m_resourceTypes.isEmpty()) {
    addFilterQuery(I_CmsSearchField.FIELD_TYPE,false,m_resourceTypes);
  }
  if ((m_searchRoots != null) && !m_searchRoots.isEmpty()) {
    addFilterQuery(I_CmsSearchField.FIELD_PARENT_FOLDERS,false,m_searchRoots);
  }
  if ((m_queryParameters != null) && !m_queryParameters.isEmpty()) {
    for (    Map.Entry<String,String[]> entry : m_queryParameters.entrySet()) {
      if (!entry.getKey().equals(CommonParams.FQ)) {
        m_solrQuery.setParam(entry.getKey(),entry.getValue());
      }
 else {
        replaceFilterQueries(entry.getValue());
      }
    }
  }
  ensureReturnFields();
  return m_solrQuery;
}
