{
  if (length == -1) {
    return getBytesFromStream(in);
  }
  byte[] buffer=new byte[length];
  int numRead, count=0;
  while ((length > 0) && ((numRead=in.read(buffer,count,length)) != -1)) {
    count+=numRead;
    length-=numRead;
  }
  return buffer;
}
