{
  boolean buttonRendered=false;
  if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(widgetOptionsString)) {
    List widgetOptions=CmsStringUtil.splitAsList(widgetOptionsString,CmsHtmlWidgetOption.OPTION_DELIMITER);
    StringBuffer custom=new StringBuffer(512);
    if (showButton(CmsHtmlWidgetOption.OPTION_SOURCE,widgetOptions)) {
      custom.append("\"Source\"");
      buttonRendered=true;
    }
    if (showButton(CmsHtmlWidgetOption.OPTION_FORMATSELECT,widgetOptions)) {
      if (buttonRendered) {
        custom.append(",\"-\",");
      }
      custom.append("\"FontFormat\"");
      buttonRendered=true;
    }
    boolean showLink=false;
    if (showButton(CmsHtmlWidgetOption.OPTION_LINK,widgetOptions)) {
      if (buttonRendered) {
        custom.append(",");
      }
      custom.append("\"oc-link\"");
      buttonRendered=true;
      showLink=true;
    }
    if (showButton(CmsHtmlWidgetOption.OPTION_ANCHOR,widgetOptions)) {
      if (buttonRendered) {
        custom.append(",");
      }
      custom.append("\"Anchor\"");
      buttonRendered=true;
      showLink=true;
    }
    if (showLink) {
      custom.append(", \"Unlink\"");
    }
    Map galleryMap=OpenCms.getWorkplaceManager().getGalleries();
    List galleries=new ArrayList(galleryMap.size());
    Map typeMap=new HashMap(galleryMap.size());
    Iterator i=galleryMap.keySet().iterator();
    while (i.hasNext()) {
      String key=(String)i.next();
      A_CmsGallery currGallery=(A_CmsGallery)galleryMap.get(key);
      galleries.add(currGallery);
      typeMap.put(currGallery,key);
    }
    Collections.sort(galleries);
    StringBuffer galleryResult=new StringBuffer(8);
    boolean showGallery=false;
    for (int k=0; k < galleries.size(); k++) {
      A_CmsGallery currGallery=(A_CmsGallery)galleries.get(k);
      String galleryType=(String)typeMap.get(currGallery);
      if (showButton(galleryType,widgetOptions)) {
        if (galleryResult.length() > 0) {
          galleryResult.append(", ");
        }
        galleryResult.append("\"oc-");
        galleryResult.append(galleryType);
        galleryResult.append("\"");
        showGallery=true;
      }
    }
    if (showGallery) {
      if (buttonRendered) {
        custom.append(", \"-\",");
      }
      custom.append(galleryResult);
      buttonRendered=true;
    }
    if (buttonRendered) {
      custom.insert(0,",[");
      toolbar.append(custom);
    }
  }
  return buttonRendered;
}
