{
  boolean buttonRendered=false;
  if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(widgetOptionsString)) {
    CmsHtmlWidgetOption option=new CmsHtmlWidgetOption(widgetOptionsString);
    StringBuffer custom=new StringBuffer(512);
    if (option.showSourceEditor()) {
      custom.append("\"Source\"");
      buttonRendered=true;
    }
    boolean showFormatSelect=false;
    if (option.showFormatSelect()) {
      if (buttonRendered) {
        custom.append(",\"-\",");
      }
      custom.append("\"FontFormat\"");
      buttonRendered=true;
      showFormatSelect=true;
    }
    if (option.showStylesXml()) {
      if (!showFormatSelect && buttonRendered) {
        custom.append(",\"-\",");
      }
 else       if (buttonRendered) {
        custom.append(",");
      }
      custom.append("\"Style\"");
      buttonRendered=true;
    }
    boolean showLink=false;
    if (option.showLinkDialog()) {
      if (buttonRendered) {
        custom.append(",");
      }
      custom.append("\"oc-link\"");
      buttonRendered=true;
      showLink=true;
    }
    if (option.showAnchorDialog()) {
      if (buttonRendered) {
        custom.append(",");
      }
      custom.append("\"Anchor\"");
      buttonRendered=true;
      showLink=true;
    }
    if (showLink) {
      custom.append(", \"Unlink\"");
    }
    Map galleryMap=OpenCms.getWorkplaceManager().getGalleries();
    List galleries=new ArrayList(galleryMap.size());
    Map typeMap=new HashMap(galleryMap.size());
    Iterator i=galleryMap.entrySet().iterator();
    while (i.hasNext()) {
      Map.Entry entry=(Map.Entry)i.next();
      String key=(String)entry.getKey();
      if (CmsImageGallery.GALLERYTYPE_NAME.equals(key)) {
        continue;
      }
      A_CmsGallery currGallery=(A_CmsGallery)entry.getValue();
      galleries.add(currGallery);
      typeMap.put(currGallery,key);
    }
    Collections.sort(galleries);
    StringBuffer galleryResult=new StringBuffer(8);
    boolean showGallery=false;
    for (int k=0; k < galleries.size(); k++) {
      A_CmsGallery currGallery=(A_CmsGallery)galleries.get(k);
      String galleryType=(String)typeMap.get(currGallery);
      if (option.getDisplayGalleries().contains(galleryType)) {
        if (galleryResult.length() > 0) {
          galleryResult.append(", ");
        }
        galleryResult.append("\"oc-");
        galleryResult.append(galleryType);
        galleryResult.append("\"");
        showGallery=true;
      }
    }
    if (showGallery) {
      if (buttonRendered) {
        custom.append("],[");
      }
      custom.append(galleryResult);
      buttonRendered=true;
    }
    if (option.getDisplayGalleries().contains(CmsImageGallery.GALLERYTYPE_NAME) || option.showImageDialog()) {
      if (buttonRendered) {
        custom.append(",\"-\",");
      }
      custom.append("\"OcmsImageGallery\"");
      buttonRendered=true;
    }
    if (option.showTableDialog()) {
      if (buttonRendered) {
        custom.append(",\"-\",");
      }
      custom.append("\"Table\"");
      buttonRendered=true;
    }
    if (buttonRendered) {
      custom.insert(0,",[");
      toolbar.append(custom);
    }
  }
  return buttonRendered;
}
