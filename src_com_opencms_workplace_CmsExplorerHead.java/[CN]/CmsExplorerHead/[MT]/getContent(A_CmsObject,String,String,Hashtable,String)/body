{
  String viewfile=null;
  String currentFilelist;
  String template="template";
  Hashtable preferences=new Hashtable();
  HttpSession session=((HttpServletRequest)cms.getRequestContext().getRequest().getOriginalRequest()).getSession(true);
  viewfile=(String)parameters.get("VIEWFILE");
  if (viewfile != null) {
    template="viewfile";
  }
  CmsXmlWpTemplateFile xmlTemplateDocument=new CmsXmlWpTemplateFile(cms,templateFile);
  currentFilelist=(String)session.getValue(C_PARA_FILELIST);
  if (currentFilelist == null) {
    currentFilelist=cms.getRequestContext().currentFolder().getAbsolutePath();
  }
  if (!currentFilelist.equals("/")) {
    currentFilelist=currentFilelist.substring(0,currentFilelist.length() - 1);
    int end=currentFilelist.lastIndexOf("/");
    if (end > 0) {
      currentFilelist=currentFilelist.substring(0,end + 1);
      session.putValue(C_PARA_FILELIST,currentFilelist);
    }
  }
  xmlTemplateDocument.setXmlData("FILELIST",currentFilelist);
  if (currentFilelist.equals("/")) {
    xmlTemplateDocument.setXmlData("PARENT",xmlTemplateDocument.getProcessedXmlDataValue("PARENT_DISABLED",this));
  }
 else {
    xmlTemplateDocument.setXmlData("PARENT",xmlTemplateDocument.getProcessedXmlDataValue("PARENT_ENABLED",this));
  }
  return startProcessing(cms,xmlTemplateDocument,"",parameters,template);
}
