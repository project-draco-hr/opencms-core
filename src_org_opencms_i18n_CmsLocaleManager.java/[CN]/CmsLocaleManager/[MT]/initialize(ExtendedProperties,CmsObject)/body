{
  I_CmsLocaleHandler localeHandler=null;
  String localeHandlerClass=null;
  try {
    localeHandlerClass=(String)OpenCms.getRegistry().getLocaleHandler().get(0);
    localeHandler=(I_CmsLocaleHandler)Class.forName(localeHandlerClass).newInstance();
    localeHandler.initHandler(cms);
    if (OpenCms.getLog(CmsLog.CHANNEL_INIT).isInfoEnabled()) {
      OpenCms.getLog(CmsLog.CHANNEL_INIT).info(". Locale handler class : " + localeHandlerClass + " instanciated");
    }
  }
 catch (  Exception e) {
    if (OpenCms.getLog(CmsLog.CHANNEL_INIT).isInfoEnabled()) {
      OpenCms.getLog(CmsLog.CHANNEL_INIT).info(". Locale handler class : error initializing locale handler class '" + localeHandlerClass + "' (using default locale handler instead)");
    }
    localeHandler=new CmsDefaultLocaleHandler();
    localeHandler.initHandler(cms);
  }
  String[] localeNames;
  localeNames=configuration.getStringArray("locale.available");
  if ((localeNames == null) || (localeNames.length == 0)) {
    localeNames=new String[]{"en","de"};
  }
  List availableLocales=getLocales(localeNames);
  localeNames=configuration.getStringArray("locale.default");
  if ((localeNames == null) || (localeNames.length == 0)) {
    localeNames=new String[]{"en","de"};
  }
  List defaultLocales=getLocales(localeNames);
  if (OpenCms.getLog(CmsLog.CHANNEL_INIT).isInfoEnabled()) {
    StringBuffer buf=new StringBuffer();
    for (int i=0; i < availableLocales.size(); i++) {
      if (i > 0) {
        buf.append(", ");
      }
      buf.append(availableLocales.get(i));
    }
    OpenCms.getLog(CmsLog.CHANNEL_INIT).info(". Available locales    : " + buf.toString());
    buf=new StringBuffer();
    for (int i=0; i < defaultLocales.size(); i++) {
      if (i > 0) {
        buf.append(", ");
      }
      buf.append(defaultLocales.get(i));
    }
    OpenCms.getLog(CmsLog.CHANNEL_INIT).info(". Default locales      : " + buf.toString());
  }
  return new CmsLocaleManager(localeHandler,availableLocales,defaultLocales);
}
