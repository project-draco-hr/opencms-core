{
  CmsLock lock=resourceUtil[0].getLock();
  if (lock.isNullLock() || (lock.isExclusiveOwnedInProjectBy(cms.getRequestContext().currentUser(),cms.getRequestContext().currentProject()))) {
    try {
      if (cms.hasPermissions(resourceUtil[0].getResource(),CmsPermissionSet.ACCESS_DIRECT_PUBLISH)) {
        if (resourceUtil[0].getResource().isFolder() || !resourceUtil[0].getResource().getState().isUnchanged()) {
          CmsResource parent=cms.readFolder(CmsResource.getParentFolder(cms.getSitePath(resourceUtil[0].getResource())));
          if (parent.getState().isNew()) {
            return CmsMenuItemVisibilityMode.VISIBILITY_INACTIVE.addMessageKey(Messages.GUI_CONTEXTMENU_TITLE_INACTIVE_PUBLISH_PARENTFOLDER_0);
          }
          return CmsMenuItemVisibilityMode.VISIBILITY_ACTIVE;
        }
 else         if (!resourceUtil[0].getResource().isFolder() && resourceUtil[0].getResource().getState().isUnchanged()) {
          return CmsMenuItemVisibilityMode.VISIBILITY_INACTIVE.addMessageKey(Messages.GUI_CONTEXTMENU_TITLE_INACTIVE_PUBLISH_UNCHANGED_0);
        }
      }
    }
 catch (    CmsException e) {
      if (LOG.isErrorEnabled()) {
        LOG.error(e.getLocalizedMessage(),e);
      }
    }
  }
  return CmsMenuItemVisibilityMode.VISIBILITY_INVISIBLE;
}
