{
  super.servletInitialized();
  getService().addSessionInitListener(new SessionInitListener(){
    private static final long serialVersionUID=-3191245142912338247L;
    public void sessionInit(    final SessionInitEvent event){
      final Locale wpLocale=OpenCms.getWorkplaceManager().getWorkplaceLocale(((CmsUIServlet)getCurrent()).getCmsObject());
      event.getSession().setLocale(wpLocale);
      event.getSession().addUIProvider(loginUiProvider);
      event.getSession().addBootstrapListener(new BootstrapListener(){
        private static final long serialVersionUID=-6249561809984101044L;
        public void modifyBootstrapFragment(        BootstrapFragmentResponse response){
        }
        public void modifyBootstrapPage(        BootstrapPageResponse response){
          CmsCoreService svc=new CmsCoreService();
          HttpServletRequest request=(HttpServletRequest)VaadinService.getCurrentRequest();
          svc.setRequest(request);
          CmsObject cms=((CmsUIServlet)getCurrent()).getCmsObject();
          svc.setCms(cms);
          Document doc=response.getDocument();
          if (shouldShowLogin()) {
            try {
              String html=CmsLoginUI.generateLoginHtmlFragment(cms,response.getRequest());
              Element el=new Element(Tag.valueOf("div"),"").html(html);
              doc.body().appendChild(el);
            }
 catch (            IOException e) {
              LOG.error(e.getLocalizedMessage(),e);
            }
          }
          try {
            doc.head().append(CmsGwtActionElement.exportCommon(cms,svc.prefetch(),""));
            doc.head().append(org.opencms.ade.publish.ClientMessages.get().export(wpLocale,true));
          }
 catch (          Exception e) {
            LOG.error(e.getLocalizedMessage(),e);
          }
        }
      }
);
    }
  }
);
}
