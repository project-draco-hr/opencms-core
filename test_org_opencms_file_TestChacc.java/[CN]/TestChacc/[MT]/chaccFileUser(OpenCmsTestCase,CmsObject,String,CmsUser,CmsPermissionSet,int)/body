{
  tc.storeResources(cms,resource1);
  cms.lockResource(resource1);
  cms.chacc(resource1,I_CmsPrincipal.C_PRINCIPAL_USER,user.getName(),permissions.getAllowedPermissions(),permissions.getDeniedPermissions(),flags);
  cms.unlockResource(resource1);
  tc.assertFilter(cms,resource1,OpenCmsTestResourceFilter.FILTER_CHACC);
  CmsResource res=cms.readResource(resource1,CmsResourceFilter.ALL);
  CmsAccessControlEntry ace=new CmsAccessControlEntry(res.getResourceId(),user.getId(),permissions.getAllowedPermissions(),permissions.getDeniedPermissions(),flags + I_CmsConstants.C_ACCESSFLAGS_USER);
  tc.assertAce(cms,resource1,ace);
  int denied=permissions.getDeniedPermissions();
  if (flags == I_CmsConstants.C_ACCESSFLAGS_OVERWRITE) {
    denied=0;
  }
  CmsPermissionSet permission=new CmsPermissionSet(permissions.getAllowedPermissions(),denied);
  tc.assertAcl(cms,resource1,user.getId(),permission);
}
