{
  echo("Testing adding and removing ACEs on files and folders");
  CmsObject cms=getCmsObject();
  cms.createGroup("Testgroup","A test group",0,null);
  CmsGroup testGroup=cms.readGroup("Testgroup");
  cms.addUser("testuser","test",testGroup.getName(),"A test user",null);
  CmsUser testUser=cms.readUser("testuser");
  CmsProject offline=cms.readProject("Offline");
  String resName="/folder2/";
  cms.lockResource(resName);
  cms.chacc(resName,I_CmsPrincipal.C_PRINCIPAL_GROUP,testGroup.getName(),"+r+v+i");
  cms.chacc(resName,I_CmsPrincipal.C_PRINCIPAL_USER,testUser.getName(),"+r+w+v+i");
  cms.unlockResource(resName);
  cms.publishProject();
  CmsPermissionSet permissions=new CmsPermissionSet(CmsPermissionSet.PERMISSION_READ | CmsPermissionSet.PERMISSION_VIEW | CmsPermissionSet.PERMISSION_WRITE,0);
  cms.loginUser("testuser","test");
  cms.getRequestContext().setCurrentProject(offline);
  cms.lockResource(resName);
  assertTrue(cms.hasPermissions(cms.readResource(resName),permissions));
  assertTrue(cms.hasPermissions(cms.readResource("/folder2/index.html"),permissions));
  boolean success=false;
  try {
    assertFalse(cms.hasPermissions(cms.readResource("/folder1/"),permissions));
  }
 catch (  CmsException e) {
    success=true;
  }
  if (!success) {
    throw new Exception("Test user has permissions +r+v+w set on /folder1/");
  }
  cms.unlockResource(resName);
  cms.loginUser("Admin","admin");
  cms.getRequestContext().setCurrentProject(offline);
  cms.lockResource(resName);
  cms.rmacc(resName,I_CmsPrincipal.C_PRINCIPAL_USER,testUser.getName());
  cms.unlockResource(resName);
  cms.publishProject();
  cms.loginUser("testuser","test");
  cms.getRequestContext().setCurrentProject(offline);
  assertFalse(cms.hasPermissions(cms.readResource(resName),CmsPermissionSet.ACCESS_WRITE));
  cms.loginUser("Admin","admin");
  cms.getRequestContext().setCurrentProject(offline);
  cms.lockResource(resName);
  cms.rmacc(resName,I_CmsPrincipal.C_PRINCIPAL_GROUP,testGroup.getName());
  cms.unlockResource(resName);
  cms.publishProject();
  cms.loginUser("testuser","test");
  success=false;
  try {
    assertFalse(cms.hasPermissions(cms.readResource(resName),permissions));
  }
 catch (  CmsException e) {
    success=true;
  }
  if (!success) {
    throw new Exception("Test user has permissions +r+v set on /folder2/ after removal of ACE");
  }
}
