{
  if (LOG.isDebugEnabled()) {
    LOG.debug(Messages.get().getBundle().key(Messages.LOG_SCRUBBING_EXPORT_FOLDERS_1,publishHistoryId));
  }
  Set scrubbedFolders=new HashSet();
  Set scrubbedFiles=new HashSet();
  CmsObject cms;
  try {
    cms=OpenCms.initCmsObject(OpenCms.getDefaultUsers().getUserExport());
  }
 catch (  CmsException e) {
    LOG.error(Messages.get().getBundle().key(Messages.LOG_INIT_FAILED_0),e);
    return Collections.EMPTY_LIST;
  }
  List publishedResources;
  try {
    publishedResources=cms.readPublishedResources(publishHistoryId);
  }
 catch (  CmsException e) {
    LOG.error(Messages.get().getBundle().key(Messages.LOG_READING_CHANGED_RESOURCES_FAILED_1,publishHistoryId),e);
    return Collections.EMPTY_LIST;
  }
  publishedResources=addMovedLinkSources(cms,publishedResources);
  Iterator itPubRes=publishedResources.iterator();
  while (itPubRes.hasNext()) {
    CmsPublishedResource res=(CmsPublishedResource)itPubRes.next();
    if (res.getState().isUnchanged()) {
      continue;
    }
    scrubResource(cms,res,scrubbedFolders,scrubbedFiles);
  }
  return publishedResources;
}
