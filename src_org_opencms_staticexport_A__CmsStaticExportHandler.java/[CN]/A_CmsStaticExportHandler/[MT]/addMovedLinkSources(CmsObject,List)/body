{
  publishedResources=new ArrayList(publishedResources);
  Set pubResources=new HashSet(publishedResources.size());
  Iterator itPubRes=publishedResources.iterator();
  while (itPubRes.hasNext()) {
    CmsPublishedResource pubRes=(CmsPublishedResource)itPubRes.next();
    pubResources.add(pubRes.getRootPath());
  }
  boolean modified=true;
  while (modified) {
    modified=false;
    Iterator itPrePubRes=new ArrayList(publishedResources).iterator();
    while (itPrePubRes.hasNext()) {
      CmsPublishedResource res=(CmsPublishedResource)itPrePubRes.next();
      if (!res.isVfsResource() || res.getMovedState() != CmsPublishedResource.STATE_MOVED_DESTINATION) {
        continue;
      }
      List relations=null;
      try {
        relations=cms.getRelationsForResource(cms.getRequestContext().removeSiteRoot(res.getRootPath()),CmsRelationFilter.SOURCES);
      }
 catch (      CmsException e) {
        if (LOG.isErrorEnabled()) {
          LOG.error(e.getLocalizedMessage(),e);
        }
      }
      if (relations == null || relations.isEmpty()) {
        continue;
      }
      Iterator itRelations=relations.iterator();
      while (itRelations.hasNext()) {
        CmsRelation relation=(CmsRelation)itRelations.next();
        CmsPublishedResource source=null;
        try {
          source=new CmsPublishedResource(relation.getSource(cms,CmsResourceFilter.ALL));
        }
 catch (        CmsException e) {
          if (LOG.isWarnEnabled()) {
            LOG.warn(e.getLocalizedMessage());
          }
        }
        if (source == null || pubResources.contains(source.getRootPath())) {
          continue;
        }
        modified=true;
        pubResources.add(source.getRootPath());
        publishedResources.add(source);
      }
    }
  }
  return publishedResources;
}
