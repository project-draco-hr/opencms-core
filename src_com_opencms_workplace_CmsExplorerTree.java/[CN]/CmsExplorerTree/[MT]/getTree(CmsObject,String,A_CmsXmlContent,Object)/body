{
  StringBuffer output=new StringBuffer();
  I_CmsSession session=CmsXmlTemplateLoader.getSession(cms.getRequestContext(),true);
  String foldername=null;
  String filelist=null;
  String currentFolder;
  String currentFilelist;
  String rootFolder;
  foldername=CmsXmlTemplateLoader.getRequest(cms.getRequestContext()).getParameter(C_PARA_FOLDER);
  if (foldername != null) {
    session.putValue(C_PARA_FOLDER,foldername);
  }
  currentFolder=(String)session.getValue(C_PARA_FOLDER);
  if (currentFolder == null) {
    currentFolder=cms.readAbsolutePath(cms.rootFolder());
  }
  filelist=CmsXmlTemplateLoader.getRequest(cms.getRequestContext()).getParameter(C_PARA_FILELIST);
  if (filelist != null) {
    CmsWorkplaceAction.setCurrentFolder(filelist,CmsXmlTemplateLoader.getRequest(cms.getRequestContext()).getOriginalRequest());
  }
  currentFilelist=CmsWorkplaceAction.getCurrentFolder(CmsXmlTemplateLoader.getRequest(cms.getRequestContext()).getOriginalRequest());
  if (currentFilelist == null) {
    currentFilelist=cms.readAbsolutePath(cms.rootFolder());
  }
  rootFolder=cms.readAbsolutePath(cms.rootFolder());
  CmsXmlWpTemplateFile template=(CmsXmlWpTemplateFile)doc;
  if (filelist != null) {
    template.setData("PREVIOUS",filelist);
  }
 else {
    template.setData("PREVIOUS",currentFilelist);
  }
  String tab=template.getProcessedDataValue(C_TREEIMG_EMPTY0,this);
  showTree(cms,rootFolder,currentFolder,currentFilelist,template,output,tab);
  return output.toString();
}
