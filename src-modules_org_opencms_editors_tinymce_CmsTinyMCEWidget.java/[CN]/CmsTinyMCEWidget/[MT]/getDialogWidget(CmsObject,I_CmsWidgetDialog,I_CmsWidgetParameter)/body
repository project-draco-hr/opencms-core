{
  String id=param.getId();
  String value=param.getStringValue(cms);
  StringBuilder result=new StringBuilder();
  result.append("<td class=\"cmsTinyMCE xmlTd\">");
  result.append("<textarea class=\"xmlInput maxwidth\" name=\"ta_");
  result.append(id);
  result.append("\" id=\"ta_");
  result.append(id);
  result.append("\" style=\"height: ");
  result.append(getHtmlWidgetOption().getEditorHeight());
  result.append(";\" rows=\"20\" cols=\"60\">");
  result.append(CmsEncoder.escapeXml(value));
  result.append("</textarea>");
  result.append("<input type=\"hidden\" name=\"");
  result.append(id);
  result.append("\" id=\"");
  result.append(id);
  result.append("\" value=\"");
  result.append(CmsEncoder.encode(value));
  result.append("\">");
  result.append("<script type=\"text/javascript\">\n");
  CmsEditorDisplayOptions options=OpenCms.getWorkplaceManager().getEditorDisplayOptions();
  Properties displayOptions=options.getDisplayOptions(cms);
  result.append("tinyMCE.init({\n");
  result.append("	// General options\n");
  result.append("relative_urls: false,\n");
  result.append("skin_variant: 'ocms',\n");
  result.append("	mode : \"exact\",\n");
  result.append("	elements : \"ta_" + id + "\",\n");
  result.append("	theme : \"advanced\",\n");
  result.append(" file_browser_callback : 'cmsTinyMceFileBrowser',\n");
  result.append("setup : function(editor) { setupTinyMCE(editor); },\n");
  if (options.showElement("gallery.enhancedoptions",displayOptions)) {
    result.append("cmsGalleryEnhancedOptions: true,\n");
  }
  if (options.showElement("gallery.usethickbox",displayOptions)) {
    result.append("cmsGalleryUseThickbox: true,\n");
  }
  result.append("	plugins : \"autolink,lists,pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template,wordcount,advlist,-opencms");
  if (getHtmlWidgetOption().isFullPage()) {
    result.append(",fullpage");
  }
  result.append("\",\n");
  result.append("	// Theme options\n");
  result.append(getToolbar());
  result.append("	theme_advanced_toolbar_location : \"top\",\n");
  result.append("	theme_advanced_toolbar_align : \"left\",\n");
  result.append("	theme_advanced_statusbar_location : \"bottom\",\n");
  result.append("width: '100%',");
  result.append("language: '" + OpenCms.getWorkplaceManager().getWorkplaceLocale(cms).getLanguage() + "',\n");
  boolean cssConfigured=false;
  String cssPath="";
  if (getHtmlWidgetOption().useCss()) {
    cssPath=getHtmlWidgetOption().getCssPath();
    getHtmlWidgetOption().setCssPath(null);
    cssConfigured=true;
  }
 else   if (OpenCms.getWorkplaceManager().getEditorCssHandlers().size() > 0) {
    Iterator<I_CmsEditorCssHandler> i=OpenCms.getWorkplaceManager().getEditorCssHandlers().iterator();
    try {
      I_CmsXmlContentValue contentValue=(I_CmsXmlContentValue)param;
      CmsFile editedResource=contentValue.getDocument().getFile();
      String editedResourceSitePath=editedResource == null ? null : cms.getSitePath(editedResource);
      while (i.hasNext()) {
        I_CmsEditorCssHandler handler=i.next();
        if (handler.matches(cms,editedResourceSitePath)) {
          cssPath=handler.getUriStyleSheet(cms,editedResourceSitePath);
          if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(cssPath)) {
            cssConfigured=true;
          }
          break;
        }
      }
    }
 catch (    Exception e) {
    }
  }
  if (cssConfigured) {
    result.append("content_css : \"");
    result.append(OpenCms.getLinkManager().substituteLink(cms,cssPath));
    result.append("\",\n");
  }
  if (getHtmlWidgetOption().showStylesFormat()) {
    try {
      CmsFile file=cms.readFile(getHtmlWidgetOption().getStylesFormatPath());
      String characterEncoding=OpenCms.getSystemInfo().getDefaultEncoding();
      String formatSelect="style_formats : " + new String(file.getContents(),characterEncoding) + ",\n";
      result.append(formatSelect);
    }
 catch (    CmsException cmsException) {
      LOG.error("Can not open file:" + getHtmlWidgetOption().getStylesFormatPath(),cmsException);
    }
catch (    UnsupportedEncodingException ex) {
      LOG.error(ex);
    }
  }
  String formatSelectOptions=getHtmlWidgetOption().getFormatSelectOptions();
  if (!CmsStringUtil.isEmpty(formatSelectOptions) && !getHtmlWidgetOption().isButtonHidden(CmsHtmlWidgetOption.OPTION_FORMATSELECT)) {
    formatSelectOptions=StringUtils.replace(formatSelectOptions,";",",");
    result.append("theme_advanced_blockformats : \"" + formatSelectOptions + "\",\n");
  }
  result.append("theme_advanced_resizing : false,\n");
  result.append("theme_advanced_resizing_use_cookie : false");
  result.append("});\n");
  result.append("contentFields[contentFields.length] = document.getElementById(\"").append(id).append("\");\n");
  result.append("</script>\n");
  result.append("</td>");
  return result.toString();
}
