{
  JSONObject result=new JSONObject();
  List<String> barItems=getHtmlWidgetOption().getButtonBarShownItems();
  List<List<String>> blocks=new ArrayList<List<String>>();
  blocks.add(new ArrayList<String>());
  String lastItem=null;
  List<String> processedItems=new ArrayList<String>();
  for (  String barItem : barItems) {
    if (BUTTON_TRANSLATION_MAP.containsKey(barItem)) {
      barItem=BUTTON_TRANSLATION_MAP.get(barItem);
    }
    if (barItem.equals("[") || barItem.equals("]") || barItem.equals("-")) {
      barItem="|";
      if ("|".equals(lastItem)) {
        continue;
      }
    }
    if (barItem.indexOf(",") > -1) {
      for (      String subItem : barItem.split(",")) {
        processedItems.add(subItem);
      }
    }
 else {
      processedItems.add(barItem);
    }
    lastItem=barItem;
  }
  if ((processedItems.size() > 0) && processedItems.get(0).equals("|")) {
    processedItems.remove(0);
  }
  if ((processedItems.size() > 0) && processedItems.get(processedItems.size() - 1).equals("|")) {
    processedItems.remove(processedItems.size() - 1);
  }
  for (  String processedItem : processedItems) {
    blocks.get(blocks.size() - 1).add(processedItem);
    if ("|".equals(processedItem)) {
      blocks.add(new ArrayList<String>());
    }
  }
  String toolbar="";
  for (  List<String> block : blocks) {
    toolbar+=CmsStringUtil.listAsString(block," ") + " ";
  }
  result.put("toolbar",toolbar);
  return result;
}
