{
  byte[] result;
  Object cacheKey=templateClass.getKey(cms,masterTemplate.getAbsolutePath(),parameters,null);
  boolean cacheable=templateClass.isCacheable(cms,masterTemplate.getAbsolutePath(),C_ROOT_TEMPLATE_NAME,parameters,null);
  if (cacheable && cache.has(cacheKey) && !templateClass.shouldReload(cms,masterTemplate.getAbsolutePath(),C_ROOT_TEMPLATE_NAME,parameters,null)) {
    result=cache.get(cacheKey);
  }
 else {
    try {
      result=templateClass.getContent(cms,masterTemplate.getAbsolutePath(),C_ROOT_TEMPLATE_NAME,parameters);
    }
 catch (    CmsException e) {
      cache.clearCache(cacheKey);
      if (A_OpenCms.isLogging()) {
        A_OpenCms.log(C_OPENCMS_INFO,"[CmsRootTemplate] Could not get contents of master template " + masterTemplate.getName());
      }
      throw e;
    }
    if (cacheable) {
      cache.put(cacheKey,result);
    }
  }
  I_CmsResponse resp=cms.getRequestContext().getResponse();
  HttpServletResponse orgResp=(HttpServletResponse)resp.getOriginalResponse();
  if (cacheable) {
    cms.getRequestContext().getResponse().setHeader("Cache-Control","max-age=300, must-revalidate");
  }
 else {
    cms.getRequestContext().getResponse().setHeader("Cache-Control","no-cache");
  }
  return result;
}
