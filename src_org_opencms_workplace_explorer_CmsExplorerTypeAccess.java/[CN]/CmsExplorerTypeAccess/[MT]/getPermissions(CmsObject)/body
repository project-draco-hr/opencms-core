{
  CmsAccessControlList acl=(CmsAccessControlList)m_accessControlList.clone();
  CmsUser user=cms.getRequestContext().currentUser();
  List groups=null;
  try {
    groups=cms.getGroupsOfUser(user.getName());
  }
 catch (  CmsException e) {
    LOG.error(Messages.get().getBundle().key(Messages.LOG_READ_GROUPS_OF_USER_FAILED_1,user.getName()));
  }
  String defaultPermissions=(String)m_accessControl.get(PRINCIPAL_DEFAULT);
  if ((defaultPermissions != null) && !user.isGuestUser()) {
    boolean found=false;
    if (acl.getPermissions(user) != null) {
      found=true;
    }
    if (!found && (groups != null)) {
      Iterator i=groups.iterator();
      while (i.hasNext()) {
        I_CmsPrincipal principal=(I_CmsPrincipal)i.next();
        if (acl.getPermissions(principal) != null) {
          found=true;
          break;
        }
      }
    }
    if (!found) {
      CmsAccessControlEntry entry=new CmsAccessControlEntry(null,user.getId(),defaultPermissions);
      acl.add(entry);
    }
  }
  return acl.getPermissions(user,groups);
}
