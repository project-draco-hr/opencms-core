{
  String mode=(String)parameters.get("mode") != null ? (String)parameters.get("mode") : "";
  String submode=(String)parameters.get("submode") != null ? (String)parameters.get("submode") : "";
  if ("projectview".equals(mode)) {
    I_CmsSession session=cms.getRequestContext().getSession(true);
    if ("search".equals(submode)) {
      Vector resources=new Vector();
      String currentFilter=(String)session.getValue("ocms_search.currentfilter");
      CmsSearchFormObject searchForm=null;
      if (currentFilter != null) {
        searchForm=(CmsSearchFormObject)((Hashtable)session.getValue("ocms_search.allfilter")).get(currentFilter);
        if ((currentFilter != null) && (searchForm != null)) {
          I_CmsRegistry registry=cms.getRegistry();
          boolean luceneEnabled="on".equals(registry.getSystemValue("searchbylucene"));
          if ("property".equals(currentFilter)) {
            String definition=searchForm.getValue02();
            String value=searchForm.getValue03();
            int type=Integer.parseInt(searchForm.getValue01());
            resources=cms.getVisibleResourcesWithProperty(definition,value,type);
          }
 else           if ("filename".equals(currentFilter)) {
            String filename=searchForm.getValue01();
            if (luceneEnabled) {
            }
 else {
              resources=cms.readResourcesLikeName(filename);
            }
          }
 else           if ("content".equals(currentFilter)) {
            searchForm.getValue01();
          }
        }
      }
      for (int i=0; i < resources.size(); i++) {
        CmsResource curRes=(CmsResource)resources.elementAt(i);
        if (curRes.getResourceName().startsWith(VFS_FOLDER_COS)) {
          resources.remove(i);
        }
      }
      return resources;
    }
 else {
      String filter=new String();
      filter=(String)session.getValue("filter");
      String projectId=(String)session.getValue("projectid");
      int currentProjectId;
      if (projectId == null || "".equals(projectId)) {
        currentProjectId=cms.getRequestContext().currentProject().getId();
      }
 else {
        currentProjectId=Integer.parseInt(projectId);
      }
      session.removeValue("filter");
      return cms.readProjectView(currentProjectId,filter);
    }
  }
 else   if ("vfslink".equals(mode)) {
    String file=(String)parameters.get("file");
    List list=cms.getAllVfsLinks(file);
    return new Vector(list);
  }
 else {
    return cms.getResourcesInFolder(param);
  }
}
