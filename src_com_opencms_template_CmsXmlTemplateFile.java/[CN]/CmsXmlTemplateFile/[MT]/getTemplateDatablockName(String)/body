{
  String templateDatablockName=null;
  if (templateSelector != null && !"".equals(templateSelector)) {
    if (hasData("template." + templateSelector)) {
      templateDatablockName="template." + templateSelector;
    }
 else {
      if (OpenCms.getLog(CmsLog.CHANNEL_TEMPLATE_XML).isDebugEnabled() && (!"script".equals(templateSelector))) {
        OpenCms.getLog(CmsLog.CHANNEL_TEMPLATE_XML).debug("Cannot load selected template file section " + templateSelector + " in template file "+ getFilename()+ ", fallback to default section");
      }
    }
  }
  if (templateDatablockName == null && (!"script".equals(templateSelector))) {
    if (hasData("TEMPLATE")) {
      templateDatablockName="TEMPLATE";
    }
 else {
      if (hasData("TEMPLATE.default")) {
        templateDatablockName="TEMPLATE.default";
      }
 else {
        if (OpenCms.getLog(CmsLog.CHANNEL_TEMPLATE_XML).isErrorEnabled()) {
          OpenCms.getLog(CmsLog.CHANNEL_TEMPLATE_XML).error("Template definition file " + getAbsoluteFilename() + " is corrupt, cannot find default section");
        }
        throw new CmsException("Corrupt template file " + getAbsoluteFilename() + ", cannot find default section",CmsException.C_XML_TAG_MISSING);
      }
    }
  }
  return templateDatablockName;
}
