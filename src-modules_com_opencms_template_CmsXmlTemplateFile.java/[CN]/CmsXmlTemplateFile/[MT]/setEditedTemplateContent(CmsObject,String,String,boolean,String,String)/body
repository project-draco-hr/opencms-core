{
  String editDatablockName=getEditTemplateDatablockName(templateSelector);
  String copyOfContent=content;
  if (html) {
    int startIndex=content.indexOf("<body");
    if (startIndex < 0)     startIndex=content.indexOf("<BODY");
    startIndex=content.indexOf(">",startIndex + 1) + 1;
    int endIndex=content.lastIndexOf("</body>");
    if (endIndex < 0)     endIndex=content.lastIndexOf("</BODY>");
    if (startIndex > 0) {
      content=content.substring(startIndex,endIndex);
    }
  }
  content=CmsStringUtil.substituteContextPath(content,OpenCms.getSystemInfo().getOpenCmsContext() + "/");
  StringBuffer tempXmlString=new StringBuffer();
  tempXmlString.append("<?xml version=\"1.0\"?>\n");
  tempXmlString.append("<" + getXmlDocumentTagName() + ">");
  tempXmlString.append("<" + C_EDIT_TEMPLATE + ">\n");
  if (html) {
    tempXmlString.append("<![CDATA[");
    content=replace(content,"[","]]><");
    tempXmlString.append(content.trim());
    tempXmlString.append("]]>");
  }
 else {
    tempXmlString.append(content);
  }
  tempXmlString.append("</" + C_EDIT_TEMPLATE + ">\n");
  tempXmlString.append("</" + getXmlDocumentTagName() + ">\n");
  I_CmsXmlParser parser=getXmlParser();
  StringReader parserReader=new StringReader(tempXmlString.toString());
  Document tempDoc=null;
  try {
    tempDoc=parser.parse(parserReader);
  }
 catch (  Exception e) {
    throwException("PARSING ERROR!",CmsLegacyException.C_XML_PARSING_ERROR);
  }
  Element templateNode=(Element)tempDoc.getDocumentElement().getFirstChild();
  setData(editDatablockName,templateNode);
  String datablockName=this.getTemplateDatablockName(templateSelector);
  if (!html) {
    copyOfContent="<HTML><HEAD></HEAD><body>" + copyOfContent.substring(9,copyOfContent.lastIndexOf("]]>")) + "</body></HTML>";
  }
 else {
    copyOfContent=replace(copyOfContent,"","");
  }
  try {
    copyOfContent=CmsXmlTemplateLinkConverter.convertFromEditor(cms,copyOfContent,filePath,relativeRoot);
  }
 catch (  CmsException e) {
    throw new CmsException("[" + this.getClass().getName() + "] cant parse the content:",e);
  }
  int startIndex=copyOfContent.indexOf("<body");
  startIndex=copyOfContent.indexOf(">",startIndex + 1) + 1;
  int endIndex=copyOfContent.lastIndexOf("</body>");
  if (startIndex > 0) {
    copyOfContent=copyOfContent.substring(startIndex,endIndex);
  }
  tempXmlString=new StringBuffer();
  tempXmlString.append("<?xml version=\"1.0\"?>\n");
  tempXmlString.append("<" + getXmlDocumentTagName() + ">");
  tempXmlString.append("<template>\n");
  tempXmlString.append("<![CDATA[");
  tempXmlString.append(copyOfContent.trim());
  tempXmlString.append("]]>");
  tempXmlString.append("</template>\n");
  tempXmlString.append("</" + getXmlDocumentTagName() + ">\n");
  I_CmsXmlParser parser2=getXmlParser();
  StringReader parserReader2=new StringReader(tempXmlString.toString());
  Document tempDoc2=null;
  try {
    tempDoc2=parser2.parse(parserReader2);
  }
 catch (  Exception e) {
    throwException("PARSING ERROR!",CmsLegacyException.C_XML_PARSING_ERROR);
  }
  Element templateNode2=(Element)tempDoc2.getDocumentElement().getFirstChild();
  setData(datablockName,templateNode2);
}
