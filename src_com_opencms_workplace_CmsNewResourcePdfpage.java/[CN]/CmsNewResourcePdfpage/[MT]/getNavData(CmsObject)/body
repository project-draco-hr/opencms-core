{
  HttpSession session=((HttpServletRequest)cms.getRequestContext().getRequest().getOriginalRequest()).getSession(true);
  CmsXmlLanguageFile lang=new CmsXmlLanguageFile(cms);
  String[] filenames;
  String[] nicenames;
  String[] positions;
  Hashtable storage=new Hashtable();
  CmsFolder folder=null;
  CmsFile file=null;
  String nicename=null;
  String currentFilelist=null;
  int count=1;
  float max=0;
  currentFilelist=(String)session.getValue(C_PARA_FILELIST);
  if (currentFilelist == null) {
    currentFilelist=cms.rootFolder().getAbsolutePath();
  }
  Vector files=cms.getFilesInFolder(currentFilelist);
  Vector folders=cms.getSubFolders(currentFilelist);
  Vector filefolders=new Vector();
  Enumeration enum=folders.elements();
  while (enum.hasMoreElements()) {
    folder=(CmsFolder)enum.nextElement();
    filefolders.addElement(folder);
  }
  enum=files.elements();
  while (enum.hasMoreElements()) {
    file=(CmsFile)enum.nextElement();
    filefolders.addElement(file);
  }
  if (filefolders.size() > 0) {
    filenames=new String[filefolders.size() + 2];
    nicenames=new String[filefolders.size() + 2];
    positions=new String[filefolders.size() + 2];
    enum=filefolders.elements();
    while (enum.hasMoreElements()) {
      CmsResource res=(CmsResource)enum.nextElement();
      if (res.getState() != C_STATE_DELETED) {
        String navpos=cms.readProperty(res.getAbsolutePath(),C_PROPERTY_NAVPOS);
        if (navpos != null) {
          nicename=cms.readProperty(res.getAbsolutePath(),C_PROPERTY_NAVTEXT);
          if (nicename == null) {
            nicename=res.getName();
          }
          filenames[count]=res.getAbsolutePath();
          nicenames[count]=nicename;
          positions[count]=navpos;
          if (new Float(navpos).floatValue() > max) {
            max=new Float(navpos).floatValue();
          }
          count++;
        }
      }
    }
  }
 else {
    filenames=new String[2];
    nicenames=new String[2];
    positions=new String[2];
  }
  filenames[0]="FIRSTENTRY";
  nicenames[0]=lang.getDataValue("input.firstelement");
  positions[0]="0";
  filenames[count]="LASTENTRY";
  nicenames[count]=lang.getDataValue("input.lastelement");
  positions[count]=new Float(max + 1).toString();
  sort(cms,filenames,nicenames,positions,count);
  storage.put("FILENAMES",filenames);
  storage.put("NICENAMES",nicenames);
  storage.put("POSITIONS",positions);
  storage.put("COUNT",new Integer(count));
  return storage;
}
