{
  byte[] result=null;
  long timer1=0;
  if (DEBUG > 0) {
    timer1=System.currentTimeMillis();
    System.err.println("========== JspLoader (Template) loading: " + file.getAbsolutePath());
  }
  if (cms.getRequestContext().getRequest() instanceof com.opencms.core.CmsExportRequest) {
    if (DEBUG > 1)     System.err.println("FlexJspLoader.loadTemplate(): Export requested for " + file.getAbsolutePath());
    result=exportJsp(cms,file);
  }
 else {
    HttpServletRequest req=(HttpServletRequest)cms.getRequestContext().getRequest().getOriginalRequest();
    HttpServletResponse res=(HttpServletResponse)cms.getRequestContext().getResponse().getOriginalResponse();
    CmsFlexRequest w_req;
    CmsFlexResponse w_res;
    if (req instanceof CmsFlexRequest) {
      w_req=(CmsFlexRequest)req;
    }
 else {
      w_req=new CmsFlexRequest(req,file,m_cache,cms);
    }
    if (res instanceof CmsFlexResponse) {
      w_res=(CmsFlexResponse)res;
    }
 else {
      w_res=new CmsFlexResponse(res,false);
    }
    try {
      w_req.getCmsRequestDispatcher(file.getAbsolutePath()).include(w_req,w_res);
    }
 catch (    java.net.SocketException e) {
      if (DEBUG > 1)       System.err.println("JspLoader.loadTemplate() ignoring SocketException " + e);
    }
catch (    Exception e) {
      System.err.println("Error in CmsJspLoader.loadTemplate() while loading: " + e.toString());
      if (DEBUG > 0)       System.err.println(com.opencms.util.Utils.getStackTrace(e));
      throw new CmsException("Error in CmsJspLoader.loadTemplate() while loading " + file.getAbsolutePath() + "\n"+ e,CmsException.C_LAUNCH_ERROR,e);
    }
    if (!w_res.isSuspended()) {
      try {
        if ((res == null) || (!res.isCommitted())) {
          result=w_res.getWriterBytes();
        }
      }
 catch (      IllegalStateException e) {
        if (DEBUG > 1)         System.err.println("JspLoader.loadTemplate() ignoring IllegalStateException " + e);
      }
catch (      Exception e) {
        System.err.println("Error in CmsJspLoader.loadTemplate() while writing buffer to final stream: " + e.toString());
        if (DEBUG > 0)         System.err.println(com.opencms.util.Utils.getStackTrace(e));
        throw new CmsException("Error in CmsJspLoader.loadTemplate() while writing buffer to final stream for " + file.getAbsolutePath() + "\n"+ e,CmsException.C_LAUNCH_ERROR,e);
      }
    }
  }
  if (DEBUG > 0) {
    long timer2=System.currentTimeMillis() - timer1;
    System.err.println("========== JspLoader (Template) time delivering JSP for " + file.getAbsolutePath() + ": "+ timer2+ "ms");
  }
  return result;
}
