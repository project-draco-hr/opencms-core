{
  String file=(String)parameters.get(C_PARA_FILE);
  String content=(String)parameters.get(C_PARA_CONTENT);
  String action=(String)parameters.get(C_PARA_ACTION);
  String jsfile=(String)parameters.get(C_ROOT_TEMPLATE_NAME + "." + C_PARA_JSFILE);
  boolean checkit=false;
  boolean existsFileParam=((file != null) && (!"".equals(file)));
  boolean saveRequested=((action != null) && (C_EDIT_ACTION_SAVE.equals(action) || C_EDIT_ACTION_SAVEEXIT.equals(action)));
  boolean exitRequested=((action != null) && (C_EDIT_ACTION_EXIT.equals(action) || C_EDIT_ACTION_SAVEEXIT.equals(action)));
  I_CmsRegistry registry=cms.getRegistry();
  boolean extendedNavigation="on".equals(registry.getSystemValue("extendedNavigation"));
  Encoder enc=new Encoder();
  CmsFile editFile=null;
  if (existsFileParam && (content == null || saveRequested)) {
    editFile=readFile(cms,file);
    checkit=true;
    if (content == null) {
      content=new String(editFile.getContents());
      content=enc.escapeWBlanks(content);
      parameters.put(C_PARA_CONTENT,content);
    }
    if (saveRequested) {
      String decodedContent=enc.unescape(content);
      editFile.setContents(decodedContent.getBytes());
      cms.writeFile(editFile);
    }
  }
  if (exitRequested) {
    try {
      cms.getRequestContext().getResponse().sendCmsRedirect("/system/workplace/action/index.html");
    }
 catch (    IOException e) {
      throwException("Could not send redirect to workplace main screen.",e);
    }
    return null;
  }
  CmsXmlWpTemplateFile xmlTemplateDocument=(CmsXmlWpTemplateFile)getOwnTemplateFile(cms,templateFile,elementName,parameters,templateSelector);
  String sectionName=getBrowserSpecificSection(cms,xmlTemplateDocument);
  if (templateFile.equalsIgnoreCase(xmlTemplateDocument.C_TEMPLATEPATH + "edit_html_main")) {
    if (extendedNavigation) {
      xmlTemplateDocument.setData("linklist",xmlTemplateDocument.getProcessedDataValue("linklist_enabled",this));
    }
 else {
      xmlTemplateDocument.setData("linklist",xmlTemplateDocument.getProcessedDataValue("linklist_disabled",this));
    }
  }
  xmlTemplateDocument.setData(C_PARA_FILE,file);
  xmlTemplateDocument.setData(C_PARA_JSFILE,jsfile);
  xmlTemplateDocument.setData("editorframe",(String)parameters.get("root.editorframe"));
  if (checkit == true) {
    xmlTemplateDocument.setData("fileName",(String)editFile.getName());
    xmlTemplateDocument.setData("pathName",(String)editFile.getPath());
  }
  return startProcessing(cms,xmlTemplateDocument,elementName,parameters,sectionName);
}
