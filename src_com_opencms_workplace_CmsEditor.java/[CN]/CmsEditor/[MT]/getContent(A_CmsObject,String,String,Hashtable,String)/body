{
  String content=(String)parameters.get(C_PARA_CONTENT);
  String file=(String)parameters.get(C_PARA_FILE);
  String action=(String)parameters.get(C_PARA_ACTION);
  String jsfile=(String)parameters.get(C_ROOT_TEMPLATE_NAME + "." + C_PARA_JSFILE);
  boolean existsFileParam=((file != null) && (!"".equals(file)));
  boolean saveRequested=((action != null) && (C_EDIT_ACTION_SAVE.equals(action) || C_EDIT_ACTION_SAVEEXIT.equals(action)));
  boolean exitRequested=((action != null) && (C_EDIT_ACTION_EXIT.equals(action) || C_EDIT_ACTION_SAVEEXIT.equals(action)));
  Encoder enc=new Encoder();
  CmsFile editFile=null;
  if (existsFileParam && (content == null || saveRequested)) {
    editFile=readFile(cms,file);
    if (content == null) {
      content=new String(editFile.getContents());
      content=enc.escape(content);
      parameters.put(C_PARA_CONTENT,content);
    }
    if (saveRequested) {
      String decodedContent=enc.unescape(content);
      editFile.setContents(decodedContent.getBytes());
      cms.writeFile(editFile);
    }
  }
  if (exitRequested) {
    try {
      cms.getRequestContext().getResponse().sendCmsRedirect(getConfigFile(cms).getWorkplaceMainPath());
    }
 catch (    IOException e) {
      throwException("Could not send redirect to workplace main screen.",e);
    }
    return "".getBytes();
  }
  CmsXmlWpTemplateFile xmlTemplateDocument=(CmsXmlWpTemplateFile)getOwnTemplateFile(cms,templateFile,elementName,parameters,templateSelector);
  String sectionName=getBrowserSpecificSection(cms,xmlTemplateDocument);
  xmlTemplateDocument.setXmlData(C_PARA_FILE,file);
  xmlTemplateDocument.setXmlData(C_PARA_JSFILE,jsfile);
  return startProcessing(cms,xmlTemplateDocument,elementName,parameters,sectionName);
}
