{
  if (isFolder && !DIALOG_WAIT.equals(getParamAction())) {
    return false;
  }
  int copyMode=I_CmsConstants.C_COPY_PRESERVE_SIBLING;
  try {
    copyMode=Integer.parseInt(getParamCopymode());
  }
 catch (  Exception e) {
  }
  String target=getParamTarget();
  if (target == null) {
    target="";
  }
  boolean restoreSiteRoot=false;
  try {
    String sitePrefix="";
    if (CmsSiteManager.getSiteRoot(target) != null) {
      String siteRootFolder=getCms().getRequestContext().getSiteRoot();
      if (siteRootFolder.endsWith("/")) {
        siteRootFolder=siteRootFolder.substring(0,siteRootFolder.length() - 1);
      }
      sitePrefix=siteRootFolder;
      getCms().getRequestContext().saveSiteRoot();
      getCms().getRequestContext().setSiteRoot("/");
      restoreSiteRoot=true;
    }
    target=CmsLinkManager.getAbsoluteUri(target,CmsResource.getParentFolder(getParamResource()));
    if (target.equals(getParamResource())) {
      throw new CmsException("Can't copy resource onto itself.",CmsException.C_FILESYSTEM_ERROR);
    }
    try {
      CmsResource res=getCms().readResource(target,CmsResourceFilter.ALL);
      if (res.isFolder()) {
        if (!target.endsWith("/")) {
          target+="/";
        }
        target=target + CmsResource.getName(getParamResource());
      }
    }
 catch (    CmsException exc) {
    }
    setParamTarget(target);
    if (DIALOG_CONFIRMED.equals(getParamAction())) {
      getCms().deleteResource(target,I_CmsConstants.C_DELETE_OPTION_IGNORE_SIBLINGS);
    }
    getCms().copyResource(sitePrefix + getParamResource(),target,copyMode);
  }
  finally {
    if (restoreSiteRoot) {
      getCms().getRequestContext().restoreSiteRoot();
    }
  }
  return true;
}
