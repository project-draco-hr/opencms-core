{
  CmsObject cms=getCmsObject();
  echo("Testing to import an existing resource as sibling");
  CmsProperty prop1=new CmsProperty(CmsPropertyDefinition.PROPERTY_TITLE,"The title",null);
  CmsProperty prop2=new CmsProperty(CmsPropertyDefinition.PROPERTY_DESCRIPTION,"The description",null);
  CmsProperty prop3=new CmsProperty(CmsPropertyDefinition.PROPERTY_KEYWORDS,"The keywords",null);
  List properties=new ArrayList();
  properties.add(prop1);
  String siblingname="/folder1/test1.html";
  cms.lockResource(siblingname);
  cms.writePropertyObjects(siblingname,properties);
  cms.unlockResource(siblingname);
  long timestamp=System.currentTimeMillis() - 12345678;
  String resourcename1="/folder2/test1_sib1.html";
  String resourcename2="/folder1/subfolder11/test1_sib2.html";
  CmsFile file=cms.readFile(siblingname);
  byte[] content=file.getContents();
  assertTrue(file.getLength() > 0);
  assertTrue(content.length > 0);
  System.err.println(OpenCms.getSiteManager().getCurrentSite(cms).getSiteRoot());
  storeResources(cms,siblingname);
  System.err.println(OpenCms.getSiteManager().getCurrentSite(cms).getSiteRoot());
  CmsResource resource;
  resource=new CmsResource(CmsUUID.getNullUUID(),file.getResourceId(),resourcename2,CmsResourceTypePlain.getStaticTypeId(),false,0,cms.getRequestContext().currentProject().getUuid(),CmsResource.STATE_NEW,timestamp,cms.getRequestContext().currentUser().getId(),timestamp,cms.getRequestContext().currentUser().getId(),CmsResource.DATE_RELEASED_DEFAULT,CmsResource.DATE_EXPIRED_DEFAULT,1,content.length,0,0);
  properties.add(prop2);
  cms.importResource(resourcename2,resource,null,properties);
  System.err.println(OpenCms.getSiteManager().getCurrentSite(cms).getSiteRoot());
  assertProject(cms,resourcename2,cms.getRequestContext().currentProject());
  assertResourceType(cms,resourcename2,CmsResourceTypePlain.getStaticTypeId());
  assertResourceType(cms,siblingname,CmsResourceTypePlain.getStaticTypeId());
  assertState(cms,resourcename2,CmsResource.STATE_NEW);
  assertState(cms,siblingname,CmsResource.STATE_CHANGED);
  assertDateLastModified(cms,resourcename2,file.getDateLastModified());
  assertDateLastModified(cms,siblingname,file.getDateLastModified());
  assertUserLastModified(cms,resourcename2,cms.getRequestContext().currentUser());
  assertUserLastModified(cms,siblingname,cms.getRequestContext().currentUser());
  assertContent(cms,resourcename2,content);
  assertContent(cms,siblingname,content);
  assertSiblingCountIncremented(cms,siblingname,1);
  OpenCmsTestResourceConfigurableFilter filter=new OpenCmsTestResourceConfigurableFilter(OpenCmsTestResourceFilter.FILTER_CREATE_RESOURCE);
  filter.disableSiblingCountTest();
  assertFilter(cms,siblingname,filter);
  String contentStr="Hello this is my NEW AND CHANGED sibling content";
  content=contentStr.getBytes();
  resource=new CmsResource(new CmsUUID(),file.getResourceId(),resourcename1,CmsResourceTypePlain.getStaticTypeId(),false,0,cms.getRequestContext().currentProject().getUuid(),CmsResource.STATE_NEW,timestamp,cms.getRequestContext().currentUser().getId(),timestamp,cms.getRequestContext().currentUser().getId(),CmsResource.DATE_RELEASED_DEFAULT,CmsResource.DATE_EXPIRED_DEFAULT,1,content.length,timestamp,0);
  properties.add(prop3);
  cms.importResource(resourcename1,resource,content,properties);
  assertProject(cms,resourcename1,cms.getRequestContext().currentProject());
  assertProject(cms,resourcename2,cms.getRequestContext().currentProject());
  assertResourceType(cms,resourcename1,CmsResourceTypePlain.getStaticTypeId());
  assertResourceType(cms,resourcename2,CmsResourceTypePlain.getStaticTypeId());
  assertResourceType(cms,siblingname,CmsResourceTypePlain.getStaticTypeId());
  assertState(cms,resourcename1,CmsResource.STATE_NEW);
  assertState(cms,resourcename2,CmsResource.STATE_NEW);
  assertState(cms,siblingname,CmsResource.STATE_CHANGED);
  assertDateLastModified(cms,resourcename1,timestamp);
  assertDateLastModified(cms,resourcename2,timestamp);
  assertDateLastModified(cms,siblingname,timestamp);
  assertUserLastModified(cms,resourcename1,cms.getRequestContext().currentUser());
  assertUserLastModified(cms,resourcename2,cms.getRequestContext().currentUser());
  assertUserLastModified(cms,siblingname,cms.getRequestContext().currentUser());
  assertContent(cms,resourcename1,content);
  assertContent(cms,resourcename2,content);
  assertContent(cms,siblingname,content);
  assertSiblingCountIncremented(cms,siblingname,2);
  assertFilter(cms,siblingname,filter);
  OpenCms.getPublishManager().publishProject(cms);
  OpenCms.getPublishManager().waitWhileRunning();
  assertState(cms,resourcename1,CmsResource.STATE_UNCHANGED);
  assertState(cms,resourcename2,CmsResource.STATE_UNCHANGED);
}
