{
  List allFolders=new ArrayList();
  List allFiles=new ArrayList();
  CmsFolder currentFolder=cms.readFolder(resource);
  CmsFile currentFile;
  if (!cms.hasPermissions(currentFolder,I_CmsConstants.C_WRITE_ACCESS)) {
    return;
  }
  if (recursive) {
    getAllResources(cms,resource,allFiles,allFolders);
  }
  allFolders.add(currentFolder);
  Iterator undoFolders=allFolders.iterator();
  while (undoFolders.hasNext()) {
    currentFolder=(CmsFolder)undoFolders.next();
    if (DEBUG > 0) {
      System.err.println("undo changes: " + cms.readAbsolutePath(currentFolder));
    }
    cms.doUndoChanges(cms.readAbsolutePath(currentFolder));
    if (C_BODY_MIRROR) {
      String bodyFolder=I_CmsWpConstants.C_VFS_PATH_BODIES.substring(0,I_CmsWpConstants.C_VFS_PATH_BODIES.lastIndexOf("/")) + cms.readAbsolutePath(currentFolder);
      try {
        cms.readFolder(bodyFolder);
        cms.doUndoChanges(bodyFolder);
      }
 catch (      CmsException e) {
      }
    }
  }
  Iterator undoFiles=allFiles.iterator();
  while (undoFiles.hasNext()) {
    currentFile=(CmsFile)undoFiles.next();
    if (DEBUG > 0) {
      System.err.println("undo changes: " + cms.readAbsolutePath(currentFile));
    }
    if (currentFile.getState() != I_CmsConstants.C_STATE_DELETED) {
      cms.doUndoChanges(cms.readAbsolutePath(currentFile));
    }
  }
}
