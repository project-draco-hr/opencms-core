{
  CmsResource res=readFileHeader(currentUser,currentProject,resource);
  if (!accessRead(currentUser,currentProject,res)) {
    throw new CmsException("[" + this.getClass().getName() + "] "+ resource,CmsException.C_NO_ACCESS);
  }
  search=search && (siteRoot != null);
  Map value=null;
  String cacheKey=getCacheKey("properties_" + search,null,new CmsProject(currentProject.getId(),-1),res.getResourceName());
  value=(Map)m_propertyCache.get(cacheKey);
  if (value == null) {
    if (search) {
      String cacheKey2=getCacheKey("properties_" + false,null,new CmsProject(currentProject.getId(),-1),res.getResourceName());
      value=(Map)m_propertyCache.get(cacheKey2);
      if (value == null) {
        boolean cont;
        siteRoot+="/";
        value=new HashMap();
        Map parentValue;
        do {
          parentValue=readProperties(currentUser,currentProject,resource,siteRoot,false);
          parentValue.putAll(value);
          value.clear();
          value=parentValue;
          resource=CmsResource.getParent(resource);
          cont=(!siteRoot.equals(resource));
        }
 while (cont);
      }
    }
 else {
      value=m_dbAccess.readProperties(currentProject.getId(),res,res.getType());
    }
    m_propertyCache.put(cacheKey,value);
  }
  return value;
}
