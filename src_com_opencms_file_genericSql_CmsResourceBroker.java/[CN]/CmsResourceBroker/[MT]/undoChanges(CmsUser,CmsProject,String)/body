{
  CmsProject onlineProject=readProject(currentUser,currentProject,C_PROJECT_ONLINE_ID);
  CmsFile onlineFile=readFile(currentUser,onlineProject,resourceName);
  CmsFile offlineFile=readFile(currentUser,currentProject,resourceName);
  CmsFile restoredFile=new CmsFile(offlineFile.getResourceId(),offlineFile.getParentId(),offlineFile.getFileId(),offlineFile.getAbsolutePath(),onlineFile.getType(),onlineFile.getFlags(),onlineFile.getOwnerId(),onlineFile.getGroupId(),currentProject.getId(),onlineFile.getAccessFlags(),C_STATE_UNCHANGED,offlineFile.isLockedBy(),onlineFile.getLauncherType(),onlineFile.getLauncherClassname(),offlineFile.getDateCreated(),offlineFile.getDateLastModified(),currentUser.getId(),onlineFile.getContents(),onlineFile.getLength());
  if (accessWrite(currentUser,currentProject,(CmsResource)restoredFile)) {
    m_dbAccess.writeFile(currentProject,onlineProject(currentUser,currentProject),restoredFile,false);
    m_resourceCache.put(C_FILE + currentProject.getId() + restoredFile.getAbsolutePath(),restoredFile);
    m_subresCache.clear();
    m_accessCache.clear();
    fileSystemChanged(false);
  }
 else {
    throw new CmsException("[" + this.getClass().getName() + "] "+ restoredFile.getAbsolutePath(),CmsException.C_NO_ACCESS);
  }
  deleteAllProperties(currentUser,currentProject,resourceName);
  Hashtable propertyInfos=readAllProperties(currentUser,onlineProject,resourceName);
  writeProperties(currentUser,currentProject,resourceName,propertyInfos);
}
