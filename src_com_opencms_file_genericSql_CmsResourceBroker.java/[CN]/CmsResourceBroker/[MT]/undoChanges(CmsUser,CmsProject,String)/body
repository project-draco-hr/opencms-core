{
  CmsProject onlineProject=readProject(currentUser,currentProject,C_PROJECT_ONLINE_ID);
  if (resourceName.endsWith("/")) {
    CmsFolder onlineFolder=readFolder(currentUser,onlineProject,resourceName);
    CmsFolder offlineFolder=readFolder(currentUser,currentProject,resourceName);
    CmsFolder restoredFolder=new CmsFolder(offlineFolder.getResourceId(),offlineFolder.getParentId(),offlineFolder.getFileId(),offlineFolder.getResourceName(),onlineFolder.getType(),onlineFolder.getFlags(),onlineFolder.getOwnerId(),onlineFolder.getGroupId(),currentProject.getId(),onlineFolder.getAccessFlags(),C_STATE_UNCHANGED,offlineFolder.isLockedBy(),offlineFolder.getDateCreated(),offlineFolder.getDateLastModified(),currentUser.getId(),currentProject.getId());
    if (accessWrite(currentUser,currentProject,(CmsResource)restoredFolder)) {
      restoredFolder.setDateLastModified(onlineFolder.getDateLastModified());
      m_dbAccess.writeFolder(currentProject,restoredFolder,false,currentUser.getId());
      m_dbAccess.deleteAllProperties(currentProject.getId(),restoredFolder);
      Map propertyInfos=m_dbAccess.readProperties(onlineProject.getId(),onlineFolder,onlineFolder.getType());
      m_dbAccess.writeProperties(propertyInfos,currentProject.getId(),restoredFolder,restoredFolder.getType());
      m_propertyCache.clear();
      this.clearResourceCache(restoredFolder.getResourceName(),currentProject);
      m_accessCache.clear();
      fileSystemChanged(false);
    }
 else {
      throw new CmsException("[" + this.getClass().getName() + "] "+ restoredFolder.getAbsolutePath(),CmsException.C_NO_ACCESS);
    }
  }
 else {
    CmsFile onlineFile=readFile(currentUser,onlineProject,resourceName);
    CmsFile offlineFile=readFile(currentUser,currentProject,resourceName);
    CmsFile restoredFile=new CmsFile(offlineFile.getResourceId(),offlineFile.getParentId(),offlineFile.getFileId(),offlineFile.getResourceName(),onlineFile.getType(),onlineFile.getFlags(),onlineFile.getOwnerId(),onlineFile.getGroupId(),currentProject.getId(),onlineFile.getAccessFlags(),C_STATE_UNCHANGED,offlineFile.isLockedBy(),onlineFile.getLauncherType(),onlineFile.getLauncherClassname(),offlineFile.getDateCreated(),offlineFile.getDateLastModified(),currentUser.getId(),onlineFile.getContents(),onlineFile.getLength(),currentProject.getId());
    if (accessWrite(currentUser,currentProject,(CmsResource)restoredFile)) {
      restoredFile.setDateLastModified(onlineFile.getDateLastModified());
      m_dbAccess.writeFile(currentProject,onlineProject(currentUser,currentProject),restoredFile,false);
      m_dbAccess.deleteAllProperties(currentProject.getId(),restoredFile);
      Map propertyInfos=m_dbAccess.readProperties(onlineProject.getId(),onlineFile,onlineFile.getType());
      m_dbAccess.writeProperties(propertyInfos,currentProject.getId(),restoredFile,restoredFile.getType());
      m_propertyCache.clear();
      this.clearResourceCache(restoredFile.getResourceName(),currentProject);
      m_accessCache.clear();
      fileSystemChanged(false);
    }
 else {
      throw new CmsException("[" + this.getClass().getName() + "] "+ restoredFile.getAbsolutePath(),CmsException.C_NO_ACCESS);
    }
  }
}
