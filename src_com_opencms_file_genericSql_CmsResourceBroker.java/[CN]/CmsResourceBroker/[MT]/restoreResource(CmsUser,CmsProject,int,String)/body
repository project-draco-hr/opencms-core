{
  CmsBackupResource backupFile=null;
  CmsFile offlineFile=null;
  backupFile=readFileForHist(currentUser,currentProject,versionId,filename);
  int ownerId=currentUser.getId();
  int groupId=currentUser.getDefaultGroupId();
  try {
    ownerId=readUser(currentUser,currentProject,backupFile.getOwnerName()).getId();
  }
 catch (  CmsException exc) {
  }
  try {
    groupId=readGroup(currentUser,currentProject,backupFile.getGroupName()).getId();
  }
 catch (  CmsException exc) {
  }
  offlineFile=readFile(currentUser,currentProject,filename);
  if (backupFile != null && offlineFile != null) {
    CmsFile newFile=new CmsFile(offlineFile.getResourceId(),offlineFile.getParentId(),offlineFile.getFileId(),offlineFile.getResourceName(),backupFile.getType(),backupFile.getFlags(),ownerId,groupId,currentProject.getId(),backupFile.getAccessFlags(),C_STATE_CHANGED,offlineFile.isLockedBy(),backupFile.getLauncherType(),backupFile.getLauncherClassname(),offlineFile.getDateCreated(),offlineFile.getDateLastModified(),currentUser.getId(),backupFile.getContents(),backupFile.getLength(),currentProject.getId());
    writeFile(currentUser,currentProject,newFile);
  }
}
