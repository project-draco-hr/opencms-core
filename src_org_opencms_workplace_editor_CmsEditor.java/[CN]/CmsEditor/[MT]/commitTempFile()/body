{
  int curProject=getSettings().getProject();
  int tempProject=0;
  try {
    tempProject=Integer.parseInt(getCms().getRegistry().getSystemValue("tempfileproject"));
  }
 catch (  Exception e) {
    throw new CmsException("Can not read projectId of tempfileproject for creating temporary file for editing! " + e.toString());
  }
  getCms().getRequestContext().setCurrentProject(getCms().readProject(tempProject));
  CmsFile tempFile=null;
  Map properties=null;
  try {
    tempFile=getCms().readFile(getParamTempfile());
    properties=getCms().readProperties(getParamTempfile());
  }
 catch (  CmsException e) {
    getCms().getRequestContext().setCurrentProject(getCms().readProject(curProject));
    throw e;
  }
  getCms().getRequestContext().setCurrentProject(getCms().readProject(curProject));
  CmsFile orgFile=getCms().readFile(getParamResource());
  orgFile.setContents(tempFile.getContents());
  getCms().writeFile(orgFile);
  Iterator keys=properties.keySet().iterator();
  while (keys.hasNext()) {
    String keyName=(String)keys.next();
    getCms().writeProperty(getParamResource(),keyName,(String)properties.get(keyName));
  }
}
