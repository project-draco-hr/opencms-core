{
  byte[] content=null;
  CmsResource res=null;
  try {
    if (source != null) {
      content=getFileBytes(source);
    }
    int size=0;
    if (content != null) {
      size=content.length;
    }
    CmsUUID newUserlastmodified;
    CmsUUID newUsercreated;
    try {
      newUserlastmodified=m_cms.readUser(userlastmodified).getId();
    }
 catch (    CmsException e) {
      newUserlastmodified=m_cms.getRequestContext().currentUser().getId();
    }
    try {
      newUsercreated=m_cms.readUser(usercreated).getId();
    }
 catch (    CmsException e) {
      newUsercreated=m_cms.getRequestContext().currentUser().getId();
    }
    CmsUUID newUuidresource;
    if ((uuidresource != null) && (resType != CmsResourceTypeFolder.C_RESOURCE_TYPE_ID)) {
      newUuidresource=new CmsUUID(uuidresource);
    }
 else {
      newUuidresource=new CmsUUID();
    }
    CmsUUID newUuidcontent;
    if (uuidcontent != null) {
      newUuidcontent=new CmsUUID(uuidcontent);
    }
 else {
      newUuidcontent=new CmsUUID();
    }
    String resname=destination;
    if (resname.endsWith("/")) {
      resname=resname.substring(0,resname.length() - 1);
    }
    if (resname.lastIndexOf("/") > 0) {
      resname=resname.substring(resname.lastIndexOf("/") + 1,resname.length());
    }
    if (m_convertToXmlPage && (resType == CmsResourceTypePage.C_RESOURCE_TYPE_ID || resType == CmsResourceTypeNewPage.C_RESOURCE_TYPE_ID)) {
      String language=OpenCms.getLocaleManager().getLocale(m_cms,CmsResource.getParentFolder(resname)).toString();
      CmsXmlPage xmlPage=CmsXmlPageConverter.convertToXmlPage(m_cms,new String(content),"body",language);
      ByteArrayOutputStream pageContent=new ByteArrayOutputStream();
      xmlPage.write(pageContent,OpenCms.getDefaultEncoding());
      content=pageContent.toByteArray();
      resType=CmsResourceTypeXmlPage.C_RESOURCE_TYPE_ID;
    }
    CmsResource resource=new CmsResource(new CmsUUID(),newUuidresource,CmsUUID.getNullUUID(),newUuidcontent,resname,resType,new Integer(flags).intValue(),m_cms.getRequestContext().currentProject().getId(),I_CmsConstants.C_STATE_NEW,m_cms.getResourceType(resType).getLoaderId(),datecreated,newUsercreated,datelastmodified,newUserlastmodified,size,1);
    if (resType == CmsResourceTypeLink.C_RESOURCE_TYPE_ID) {
      m_report.print(m_report.key("report.storing_link"),I_CmsReport.C_FORMAT_NOTE);
      m_linkStorage.put(m_importPath + destination,new String(content));
      m_linkPropertyStorage.put(m_importPath + destination,properties);
      res=resource;
    }
 else {
      res=m_cms.importResource(resource,content,properties,m_importPath + destination);
    }
    if (res != null) {
      if (CmsResourceTypePage.C_RESOURCE_TYPE_ID == resType) {
        m_importedPages.add(I_CmsConstants.C_FOLDER_SEPARATOR + destination);
      }
      m_report.println(m_report.key("report.ok"),I_CmsReport.C_FORMAT_OK);
    }
  }
 catch (  Exception exc) {
    m_report.println(exc);
    try {
      Thread.sleep(1000);
    }
 catch (    Exception e) {
    }
  }
  return res;
}
