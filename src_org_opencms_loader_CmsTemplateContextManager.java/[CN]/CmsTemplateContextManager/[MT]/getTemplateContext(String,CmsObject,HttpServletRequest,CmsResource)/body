{
  I_CmsTemplateContextProvider provider=getTemplateContextProvider(providerName);
  if (provider == null) {
    return null;
  }
  String cookieName=provider.getOverrideCookieName();
  if (cookieName != null) {
    String cookieValue=CmsRequestUtil.getCookieValue(request.getCookies(),cookieName);
    if (cookieValue != null) {
      Map<String,CmsTemplateContext> contextMap=provider.getAllContexts();
      if (contextMap.containsKey(cookieValue)) {
        CmsTemplateContext contextBean=contextMap.get(cookieValue);
        return new CmsTemplateContext(contextBean.getKey(),contextBean.getTemplatePath(),contextBean.getMessageContainer(),contextBean.getProvider(),true);
      }
    }
  }
  return provider.getTemplateContext(cms,request,resource);
}
