{
  ElementState state;
  state=content();
  if (state != null && _format.isCDataElement(state.tagName))   cdata=true;
 else   if (state != null && _format.isNonEscapingElement(state.tagName))   unescaped=true;
  if (cdata) {
    StringBuffer buffer;
    int index;
    int saveIndent;
    buffer=new StringBuffer(text.length());
    index=text.indexOf("]]>");
    while (index >= 0) {
      buffer.append("<![CDATA[").append(text.substring(0,index + 2)).append("]]>");
      text=text.substring(index + 2);
      index=text.indexOf("]]>");
    }
    buffer.append("<![CDATA[").append(text).append("]]>");
    saveIndent=_nextIndent;
    _nextIndent=0;
    printText(buffer,true);
    _nextIndent=saveIndent;
  }
 else {
    int saveIndent;
    if (unescaped) {
      saveIndent=_nextIndent;
      _nextIndent=0;
      printText(text,true);
      _nextIndent=saveIndent;
    }
 else     if (state != null && state.preserveSpace) {
      saveIndent=_nextIndent;
      _nextIndent=0;
      printText(escape(text),true);
      _nextIndent=saveIndent;
    }
 else {
      printText(escape(text),false);
    }
  }
}
