{
  HashMap targetProperties=null;
  Vector linkPropertyDefs=null;
  CmsResource res=cms.doCreateFile(newResourceName,contents,C_TYPE_RESOURCE_NAME,properties);
  cms.lockResource(newResourceName);
  if (parameter != null) {
    targetProperties=(HashMap)parameter;
    Vector propertyDefs=cms.readAllPropertydefinitions(CmsResourceTypeLink.C_TYPE_RESOURCE_NAME);
    Enumeration allPropertyDefs=propertyDefs.elements();
    linkPropertyDefs=new Vector(propertyDefs.size());
    while (allPropertyDefs.hasMoreElements()) {
      CmsPropertydefinition currentPropertyDefinition=(CmsPropertydefinition)allPropertyDefs.nextElement();
      linkPropertyDefs.add((String)currentPropertyDefinition.getName());
    }
    Iterator i=targetProperties.keySet().iterator();
    while (i.hasNext()) {
      String currentProperty=(String)i.next();
      if (!linkPropertyDefs.contains((String)currentProperty)) {
        if (DEBUG > 0)         System.out.println("adding property definition " + currentProperty + " for resource type "+ CmsResourceTypeLink.C_TYPE_RESOURCE_NAME);
        CmsPropertydefinition newPropertyDef=cms.createPropertydefinition(currentProperty,CmsResourceTypeLink.C_TYPE_RESOURCE_NAME);
      }
      if (DEBUG > 0)       System.out.println("writing property " + currentProperty + " with value "+ (String)targetProperties.get(currentProperty));
      cms.writeProperty(newResourceName,currentProperty,(String)targetProperties.get(currentProperty));
    }
  }
  return res;
}
