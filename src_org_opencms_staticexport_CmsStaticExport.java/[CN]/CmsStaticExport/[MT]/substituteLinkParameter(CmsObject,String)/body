{
  int paraStartPos=link.indexOf('?');
  if (paraStartPos < 0) {
    return link;
  }
  if (!A_OpenCms.getStaticExportProperties().isStaticExportEnabled()) {
    return link;
  }
  String returnValue=link.substring(0,paraStartPos);
  try {
    CmsStaticExportLink linkObject=cms.readExportLinkHeader(link);
    if (linkObject == null) {
      linkObject=new CmsStaticExportLink(link,0,null);
      cms.writeExportLink(linkObject);
    }
    int id=linkObject.getId();
    int pointId=returnValue.lastIndexOf('.');
    if (pointId < 0) {
      return returnValue + "_" + id;
    }
    returnValue=returnValue.substring(0,pointId) + "_" + id+ returnValue.substring(pointId);
  }
 catch (  CmsException e) {
    if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
      A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_STATICEXPORT,"[CmsStaticExport] cant substitute the htmlparameter for link: " + link + "  "+ e.toString());
    }
    return link;
  }
  return returnValue;
}
