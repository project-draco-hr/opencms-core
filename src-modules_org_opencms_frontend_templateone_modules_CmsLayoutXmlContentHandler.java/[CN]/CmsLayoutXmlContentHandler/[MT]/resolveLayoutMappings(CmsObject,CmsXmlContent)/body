{
  CmsFile file=content.getFile();
  if (file == null) {
    throw new CmsXmlException(Messages.get().container(Messages.ERR_XMLCONTENT_RESOLVE_FILE_NOT_FOUND_0));
  }
  String rootPath=content.getFile().getRootPath();
  String siteRoot=cms.getRequestContext().getSiteRoot();
  try {
    cms.getRequestContext().saveSiteRoot();
    cms.getRequestContext().setSiteRoot("/");
    List siblings=cms.readSiblings(rootPath,CmsResourceFilter.IGNORE_EXPIRATION);
    for (int i=(siblings.size() - 1); i >= 0; i--) {
      String filename=((CmsResource)siblings.get(i)).getRootPath();
      Locale locale=OpenCms.getLocaleManager().getDefaultLocale(cms,filename);
      if (!content.hasLocale(locale)) {
        continue;
      }
      List nestedItems=content.getValues(ELEMENT_LAYOUT,locale);
      List properties=new ArrayList(nestedItems.size() * 4);
      for (int k=0; k < nestedItems.size(); k++) {
        I_CmsXmlContentValue layoutConfig=(I_CmsXmlContentValue)nestedItems.get(k);
        String layoutConfigPath=layoutConfig.getPath() + "/";
        CmsMacroResolver resolver=CmsMacroResolver.newInstance();
        resolver.addMacro(CmsTemplateContentListItem.MACRO_LISTINDEX,"" + (layoutConfig.getIndex() + 1));
        String resType=content.getStringValue(cms,layoutConfigPath + ELEMENT_RESOURCETYPE,locale);
        CmsProperty p=new CmsProperty(resolver.resolveMacros(CmsTemplateContentListItem.PROPERTY_LAYOUT_TYPE),resType,null);
        properties.add(p);
        String folder=content.getStringValue(cms,layoutConfigPath + ELEMENT_VFSFOLDER,locale);
        if (CmsStringUtil.isNotEmpty(folder)) {
          if (folder.length() > 1 && folder.startsWith(siteRoot)) {
            folder=folder.substring(siteRoot.length());
          }
        }
 else {
          folder=CmsProperty.DELETE_VALUE;
        }
        p=new CmsProperty(resolver.resolveMacros(CmsTemplateContentListItem.PROPERTY_LAYOUT_FOLDER),folder,null);
        properties.add(p);
        String count=content.getStringValue(cms,layoutConfigPath + ELEMENT_COUNT,locale);
        p=new CmsProperty(resolver.resolveMacros(CmsTemplateContentListItem.PROPERTY_LAYOUT_COUNT),count,null);
        properties.add(p);
        String collector=content.getStringValue(cms,layoutConfigPath + ELEMENT_COLLECTOR,locale);
        p=new CmsProperty(resolver.resolveMacros(CmsTemplateContentListItem.PROPERTY_LAYOUT_COLLECTOR),collector,null);
        properties.add(p);
      }
      cms.writePropertyObjects(filename,properties);
    }
  }
  finally {
    cms.getRequestContext().restoreSiteRoot();
  }
}
