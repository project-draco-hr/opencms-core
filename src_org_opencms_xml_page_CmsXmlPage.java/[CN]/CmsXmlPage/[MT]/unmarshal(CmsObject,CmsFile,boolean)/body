{
  byte[] content=file.getContents();
  String fileName=cms.readAbsolutePath(file);
  boolean allowRelative=false;
  try {
    allowRelative=Boolean.valueOf(cms.readPropertyObject(fileName,C_PROPERTY_ALLOW_RELATIVE,false).getValue()).booleanValue();
  }
 catch (  CmsException e) {
  }
  String encoding=null;
  try {
    encoding=cms.readPropertyObject(fileName,I_CmsConstants.C_PROPERTY_CONTENT_ENCODING,true).getValue();
  }
 catch (  CmsException e) {
  }
  if (encoding == null) {
    encoding=OpenCms.getSystemInfo().getDefaultEncoding();
  }
 else {
    encoding=CmsEncoder.lookupEncoding(encoding,null);
    if (encoding == null) {
      throw new CmsXmlException("Invalid content-encoding property set for xml page '" + fileName + "'");
    }
  }
  CmsXmlPage newPage;
  if (content.length > 0) {
    if (keepEncoding) {
      newPage=unmarshal(content,encoding,new CmsXmlEntityResolver(cms));
    }
 else {
      try {
        String contentStr=new String(content,encoding);
        newPage=unmarshal(contentStr,encoding,new CmsXmlEntityResolver(cms));
      }
 catch (      UnsupportedEncodingException e) {
        throw new CmsXmlException("Invalid content-encoding property set for xml page '" + fileName + "'",e);
      }
    }
  }
 else {
    newPage=new CmsXmlPage(encoding);
  }
  newPage.m_file=file;
  newPage.m_allowRelativeLinks=allowRelative;
  return newPage;
}
