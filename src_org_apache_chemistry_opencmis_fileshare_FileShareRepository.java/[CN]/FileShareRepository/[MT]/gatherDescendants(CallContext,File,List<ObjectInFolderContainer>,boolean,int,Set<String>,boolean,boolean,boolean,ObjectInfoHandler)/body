{
  for (  File child : folder.listFiles()) {
    if (child.isHidden() || child.getName().equals(SHADOW_FOLDER) || child.getPath().endsWith(SHADOW_EXT)) {
      continue;
    }
    if (foldersOnly && !child.isDirectory()) {
      continue;
    }
    ObjectInFolderDataImpl objectInFolder=new ObjectInFolderDataImpl();
    objectInFolder.setObject(compileObjectType(context,child,filter,includeAllowableActions,false,userReadOnly,objectInfos));
    if (includePathSegments) {
      objectInFolder.setPathSegment(child.getName());
    }
    ObjectInFolderContainerImpl container=new ObjectInFolderContainerImpl();
    container.setObject(objectInFolder);
    list.add(container);
    if ((depth != 1) && child.isDirectory()) {
      container.setChildren(new ArrayList<ObjectInFolderContainer>());
      gatherDescendants(context,child,container.getChildren(),foldersOnly,depth - 1,filter,includeAllowableActions,includePathSegments,userReadOnly,objectInfos);
    }
  }
}
