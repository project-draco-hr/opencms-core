{
  debug("createFolder");
  checkUser(context,true);
  if ((properties == null) || (properties.getProperties() == null)) {
    throw new CmisInvalidArgumentException("Properties must be set!");
  }
  String typeId=getTypeId(properties);
  TypeDefinition type=types.getType(typeId);
  if (type == null) {
    throw new CmisObjectNotFoundException("Type '" + typeId + "' is unknown!");
  }
  Properties props=compileProperties(typeId,context.getUsername(),millisToCalendar(System.currentTimeMillis()),context.getUsername(),properties);
  String name=getStringProperty(properties,PropertyIds.NAME);
  if (!isValidName(name)) {
    throw new CmisNameConstraintViolationException("Name is not valid.");
  }
  File parent=getFile(folderId);
  if (!parent.isDirectory()) {
    throw new CmisObjectNotFoundException("Parent is not a folder!");
  }
  File newFolder=new File(parent,name);
  if (!newFolder.mkdir()) {
    throw new CmisStorageException("Could not create folder!");
  }
  writePropertiesFile(newFolder,props);
  return getId(newFolder);
}
