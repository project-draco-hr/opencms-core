{
  boolean success=true;
  for (  File file : folder.listFiles()) {
    if (file.isDirectory()) {
      if (!deleteFolder(file,continueOnFailure,ftd)) {
        if (!continueOnFailure) {
          return false;
        }
        success=false;
      }
    }
 else {
      if (!file.delete()) {
        ftd.getIds().add(getId(file));
        if (!continueOnFailure) {
          return false;
        }
        success=false;
      }
    }
  }
  if (!folder.delete()) {
    ftd.getIds().add(getId(folder));
    success=false;
  }
  return success;
}
