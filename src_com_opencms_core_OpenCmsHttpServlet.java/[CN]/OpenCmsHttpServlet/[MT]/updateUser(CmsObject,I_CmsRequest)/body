{
  if (!cms.getRequestContext().isUpdateSessionEnabled()) {
    return;
  }
  HttpServletRequest req=(HttpServletRequest)cmsReq.getOriginalRequest();
  HttpSession session=req.getSession(false);
  if ((session != null)) {
    if (!cms.getRequestContext().currentUser().getName().equals(C_USER_GUEST)) {
      Hashtable sessionData=new Hashtable(4);
      sessionData.put(C_SESSION_USERNAME,cms.getRequestContext().currentUser().getName());
      sessionData.put(C_SESSION_CURRENTGROUP,cms.getRequestContext().currentGroup().getName());
      sessionData.put(C_SESSION_PROJECT,new Integer(cms.getRequestContext().currentProject().getId()));
      sessionData.put(C_SESSION_CURRENTSITE,cms.getRequestContext().getSiteRoot());
      Hashtable oldData=(Hashtable)session.getAttribute(C_SESSION_DATA);
      if (oldData == null)       oldData=new Hashtable();
      sessionData.put(C_SESSION_DATA,oldData);
      m_sessionStorage.putUser(session.getId(),sessionData);
      OpenCmsServletNotify notify=null;
      Object sessionValue=session.getAttribute("NOTIFY");
      if (sessionValue instanceof OpenCmsServletNotify) {
        notify=(OpenCmsServletNotify)sessionValue;
      }
      if (notify == null) {
        notify=new OpenCmsServletNotify(session.getId(),m_sessionStorage);
        session.setAttribute("NOTIFY",notify);
      }
    }
  }
}
