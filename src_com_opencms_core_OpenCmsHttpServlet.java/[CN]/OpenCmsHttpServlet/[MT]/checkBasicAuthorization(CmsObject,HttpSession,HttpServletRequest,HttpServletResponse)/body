{
  String auth=req.getHeader("Authorization");
  if (auth != null) {
    if (auth.toUpperCase().startsWith("BASIC ")) {
      String userpassEncoded=auth.substring(6);
      sun.misc.BASE64Decoder dec=new sun.misc.BASE64Decoder();
      String userstr=new String(dec.decodeBuffer(userpassEncoded));
      String username=null;
      String password=null;
      StringTokenizer st=new StringTokenizer(userstr,":");
      if (st.hasMoreTokens()) {
        username=st.nextToken();
      }
      if (st.hasMoreTokens()) {
        password=st.nextToken();
      }
      try {
        try {
          cms.loginUser(username,password);
        }
 catch (        CmsException exc) {
          cms.loginWebUser(username,password);
        }
        session=req.getSession(true);
      }
 catch (      CmsException e) {
        if (e.getType() == CmsException.C_NO_ACCESS) {
          requestAuthorization(req,res);
        }
 else {
          throw e;
        }
      }
    }
  }
}
