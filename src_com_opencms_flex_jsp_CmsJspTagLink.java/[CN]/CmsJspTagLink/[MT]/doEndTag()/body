{
  javax.servlet.ServletRequest req=pageContext.getRequest();
  if (req instanceof com.opencms.flex.cache.CmsFlexRequest) {
    com.opencms.flex.cache.CmsFlexRequest c_req=(com.opencms.flex.cache.CmsFlexRequest)req;
    try {
      com.opencms.file.CmsObject cms=c_req.getCmsObject();
      javax.servlet.jsp.tagext.BodyContent body=this.getBodyContent();
      String link=body.getString();
      java.util.Hashtable substitutions=null;
      Object o=pageContext.getAttribute(this.C_JSP_ATTR_TAGLINK);
      if (o == null) {
        substitutions=new java.util.Hashtable();
      }
 else {
        substitutions=(java.util.Hashtable)o;
      }
      String newlink=null;
      boolean changed=false;
      if (substitutions.containsKey(link)) {
        newlink=(String)substitutions.get(link);
        if (DEBUG)         System.err.println("Reused link substitution for :" + link);
      }
 else {
        if (link.indexOf(':') >= 0) {
          newlink=m_substitutor.getLinkSubstitution(cms,link);
        }
 else {
          newlink=m_substitutor.getLinkSubstitution(cms,c_req.toAbsolute(link));
        }
        substitutions.put(link,newlink);
        changed=true;
        if (DEBUG)         System.err.println("Stored new link substitution for :" + link);
      }
      this.getBodyContent().clear();
      this.getBodyContent().print(newlink);
      this.getBodyContent().writeOut(pageContext.getOut());
      if (changed) {
        pageContext.setAttribute(this.C_JSP_ATTR_TAGLINK,substitutions);
      }
    }
 catch (    Exception ex) {
      System.err.println("Error in Jsp 'link' tag processing: " + ex);
      System.err.println(com.opencms.util.Utils.getStackTrace(ex));
      throw new javax.servlet.jsp.JspException(ex);
    }
  }
  return EVAL_PAGE;
}
