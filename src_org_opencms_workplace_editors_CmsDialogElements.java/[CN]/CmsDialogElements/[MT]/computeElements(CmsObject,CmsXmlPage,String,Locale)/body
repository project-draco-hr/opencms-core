{
  List result=new ArrayList();
  if (xmlPage != null) {
    List elementNames=xmlPage.getNames(locale);
    Iterator i=elementNames.iterator();
    while (i.hasNext()) {
      String name=(String)i.next();
      CmsDialogElement element=new CmsDialogElement(name,null,false,false,true);
      result.add(element);
    }
  }
  String currentTemplate=null;
  try {
    currentTemplate=cms.readPropertyObject(xmlPageUri,I_CmsConstants.C_PROPERTY_TEMPLATE,true).getValue();
  }
 catch (  CmsException e) {
    if (OpenCms.getLog(CmsDialogElements.class.getName()).isWarnEnabled()) {
      OpenCms.getLog(CmsDialogElements.class.getName()).warn("Error reading property '" + I_CmsConstants.C_PROPERTY_TEMPLATE + "' on resource "+ xmlPageUri,e);
    }
  }
  if (currentTemplate != null && currentTemplate.length() > 0) {
    String elements=null;
    try {
      elements=cms.readPropertyObject(currentTemplate,I_CmsConstants.C_PROPERTY_TEMPLATE_ELEMENTS,false).getValue(null);
    }
 catch (    CmsException e) {
      if (OpenCms.getLog(CmsDialogElements.class.getName()).isWarnEnabled()) {
        OpenCms.getLog(CmsDialogElements.class.getName()).warn("Error reading property '" + I_CmsConstants.C_PROPERTY_TEMPLATE_ELEMENTS + "' on resource "+ currentTemplate,e);
      }
    }
    if (elements != null) {
      StringTokenizer T=new StringTokenizer(elements,",");
      while (T.hasMoreTokens()) {
        String currentElement=T.nextToken();
        String niceName=null;
        boolean mandatory=false;
        int sepIndex=currentElement.indexOf("|");
        if (sepIndex != -1) {
          niceName=currentElement.substring(sepIndex + 1);
          currentElement=currentElement.substring(0,sepIndex);
        }
        if (currentElement.endsWith("*")) {
          mandatory=true;
          currentElement=currentElement.substring(0,currentElement.length() - 1);
        }
        if (currentElement.indexOf("[") == -1) {
          currentElement+="[0]";
        }
        CmsDialogElement element=new CmsDialogElement(currentElement,niceName,mandatory,true,false);
        if (result.contains(element)) {
          element.setExisting(true);
          result.remove(element);
        }
        result.add(element);
      }
    }
  }
  Collections.sort(result);
  return result;
}
