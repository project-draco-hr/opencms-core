{
  echo("Tests issue with resource state and siblings");
  CmsObject cms=getCmsObject();
  String resource1="/folder1/page1.html";
  String sibling1="/folder1/sibling1.html";
  cms.copyResource(resource1,sibling1,CmsResource.COPY_AS_SIBLING);
  assertState(cms,resource1,CmsResource.STATE_UNCHANGED);
  assertState(cms,sibling1,CmsResource.STATE_NEW);
  cms.chflags(sibling1,1024);
  cms.chtype(sibling1,CmsResourceTypeBinary.getStaticTypeId());
  assertState(cms,resource1,CmsResource.STATE_CHANGED);
  assertState(cms,sibling1,CmsResource.STATE_NEW);
  String copy1="/folder1/copy1.html";
  sibling1="/folder1/siblingofcopy1.html";
  cms.copyResource(resource1,copy1,CmsResource.COPY_AS_NEW);
  cms.copyResource(copy1,sibling1,CmsResource.COPY_AS_SIBLING);
  assertState(cms,copy1,CmsResource.STATE_NEW);
  assertState(cms,sibling1,CmsResource.STATE_NEW);
  cms.chflags(sibling1,1024);
  cms.chtype(sibling1,CmsResourceTypeBinary.getStaticTypeId());
  assertState(cms,copy1,CmsResource.STATE_NEW);
  assertState(cms,sibling1,CmsResource.STATE_NEW);
  resource1="/folder1/page2.html";
  sibling1="/folder1/sibling2.html";
  cms.copyResource(resource1,sibling1,CmsResource.COPY_AS_SIBLING);
  assertState(cms,resource1,CmsResource.STATE_UNCHANGED);
  assertState(cms,sibling1,CmsResource.STATE_NEW);
  cms.setDateExpired(sibling1,System.currentTimeMillis() + 1000,false);
  cms.setDateReleased(sibling1,System.currentTimeMillis() - 1000,false);
  assertState(cms,resource1,CmsResource.STATE_UNCHANGED);
  assertState(cms,sibling1,CmsResource.STATE_NEW);
  cms.setDateLastModified(sibling1,System.currentTimeMillis(),false);
  assertState(cms,resource1,CmsResource.STATE_CHANGED);
  assertState(cms,sibling1,CmsResource.STATE_NEW);
  copy1="/folder1/copy2.html";
  sibling1="/folder1/siblingofcopy2.html";
  cms.copyResource(resource1,copy1,CmsResource.COPY_AS_NEW);
  cms.copyResource(copy1,sibling1,CmsResource.COPY_AS_SIBLING);
  assertState(cms,copy1,CmsResource.STATE_NEW);
  assertState(cms,sibling1,CmsResource.STATE_NEW);
  cms.setDateLastModified(sibling1,System.currentTimeMillis(),false);
  assertState(cms,copy1,CmsResource.STATE_NEW);
  assertState(cms,sibling1,CmsResource.STATE_NEW);
  cms.setDateExpired(sibling1,System.currentTimeMillis() + 1000,false);
  cms.setDateReleased(sibling1,System.currentTimeMillis() - 1000,false);
  assertState(cms,copy1,CmsResource.STATE_NEW);
  assertState(cms,sibling1,CmsResource.STATE_NEW);
}
