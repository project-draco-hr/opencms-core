{
  CmsObject cms=getCmsObject();
  echo("Testing the 'project last modified' state of siblings across different projects");
  String source="/folder1/image1.gif";
  String target="/folder2/image1_sibling2.gif";
  createSibling(this,cms,source,target);
  OpenCms.getPublishManager().publishResource(cms,target,true,new CmsShellReport(Locale.ENGLISH));
  OpenCms.getPublishManager().waitWhileRunning();
  assertState(cms,source,CmsResourceState.STATE_UNCHANGED);
  assertState(cms,target,CmsResourceState.STATE_UNCHANGED);
  assertLock(cms,source,CmsLockType.UNLOCKED);
  assertLock(cms,target,CmsLockType.UNLOCKED);
  CmsOrganizationalUnit ou=OpenCms.getOrgUnitManager().createOrganizationalUnit(cms,"/test","test",0,"/folder1");
  cms.createUser("/test/myuser","myuser","blah-blah",null);
  cms.addUserToGroup("/test/myuser",ou.getName() + OpenCms.getDefaultUsers().getGroupUsers());
  cms.lockResource("/folder2/");
  cms.chacc("/folder2/",I_CmsPrincipal.PRINCIPAL_USER,"/test/myuser","-w");
  OpenCms.getPublishManager().publishResource(cms,"/folder2/");
  OpenCms.getPublishManager().waitWhileRunning();
  CmsProject prj=cms.readProject(ou.getProjectId());
  cms.loginUser("/test/myuser","myuser");
  cms.getRequestContext().setCurrentProject(prj);
  assertTrue(cms.hasPermissions(cms.readResource(source,CmsResourceFilter.ALL),CmsPermissionSet.ACCESS_WRITE,false,CmsResourceFilter.ALL));
  assertFalse(cms.hasPermissions(cms.readResource(target,CmsResourceFilter.ALL),CmsPermissionSet.ACCESS_WRITE,false,CmsResourceFilter.ALL));
  cms.lockResource(source);
  cms.setDateLastModified(source,System.currentTimeMillis(),false);
  assertProject(cms,source,prj);
  assertProject(cms,target,prj);
  CmsPublishList pl=OpenCms.getPublishManager().getPublishList(cms,cms.readResource(source),true);
  assertEquals(2,pl.size());
  assertTrue(pl.getFileList().contains(cms.readResource(source)));
  assertTrue(pl.getFileList().contains(cms.readResource("/folder1/image1_sibling.gif")));
  OpenCms.getPublishManager().publishResource(cms,source,true,new CmsShellReport(Locale.ENGLISH));
  OpenCms.getPublishManager().waitWhileRunning();
  assertState(cms,source,CmsResourceState.STATE_UNCHANGED);
  assertState(cms,target,CmsResourceState.STATE_UNCHANGED);
  cms.lockResource(source);
  cms.writePropertyObject(source,new CmsProperty(CmsPropertyDefinition.PROPERTY_DESCRIPTION,"desc",null));
  assertProject(cms,source,prj);
  assertProject(cms,target,prj);
  assertState(cms,target,CmsResourceState.STATE_UNCHANGED);
  pl=OpenCms.getPublishManager().getPublishList(cms,cms.readResource(source),true);
  assertEquals(1,pl.size());
  assertTrue(pl.getFileList().contains(cms.readResource(source)));
  OpenCms.getPublishManager().publishResource(cms,source,true,new CmsShellReport(Locale.ENGLISH));
  OpenCms.getPublishManager().waitWhileRunning();
  assertState(cms,source,CmsResourceState.STATE_UNCHANGED);
  assertState(cms,target,CmsResourceState.STATE_UNCHANGED);
  cms.lockResource(source);
  cms.deleteResource(source,CmsResource.DELETE_REMOVE_SIBLINGS);
  assertState(cms,source,CmsResourceState.STATE_DELETED);
  assertState(cms,target,CmsResourceState.STATE_UNCHANGED);
  pl=OpenCms.getPublishManager().getPublishList(cms,cms.readResource(source,CmsResourceFilter.ALL),true);
  assertEquals(2,pl.size());
  assertTrue(pl.getFileList().contains(cms.readResource(source,CmsResourceFilter.ALL)));
  assertTrue(pl.getFileList().contains(cms.readResource("/folder1/image1_sibling.gif",CmsResourceFilter.ALL)));
  OpenCms.getPublishManager().publishResource(cms,source,true,new CmsShellReport(Locale.ENGLISH));
  OpenCms.getPublishManager().waitWhileRunning();
  assertFalse(cms.existsResource(source));
  assertTrue(cms.existsResource(target));
  assertState(cms,target,CmsResourceState.STATE_UNCHANGED);
  assertSiblingCount(cms,target,1);
}
