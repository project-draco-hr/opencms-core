{
  CmsFile newFile=null;
  CmsFile offlineFile=null;
  try {
    if (!offlineFileHeader.getFileId().isNullUUID() && !publishedContentIds.contains(offlineFileHeader.getFileId())) {
      offlineFile=m_driverManager.getVfsDriver().readFile(context.currentProject().getId(),false,offlineFileHeader.getStructureId());
      offlineFile.setFullResourceName(offlineFileHeader.getRootPath());
      newFile=(CmsFile)offlineFile.clone();
      newFile.setState(I_CmsConstants.C_STATE_UNCHANGED);
      newFile.setFullResourceName(offlineFileHeader.getRootPath());
      m_driverManager.getVfsDriver().createFile(onlineProject,newFile,context.currentUser().getId(),newFile.getParentStructureId(),newFile.getName());
      m_driverManager.getVfsDriver().writeResource(newFile,offlineFile,false);
      publishedContentIds.add(offlineFileHeader.getFileId());
    }
 else {
      m_driverManager.getVfsDriver().createSibling(onlineProject,offlineFileHeader,offlineFileHeader.getUserCreated(),offlineFileHeader.getParentStructureId(),offlineFileHeader.getName());
      newFile=m_driverManager.getVfsDriver().readFile(onlineProject.getId(),false,offlineFileHeader.getStructureId());
      newFile.setFullResourceName(offlineFileHeader.getRootPath());
    }
  }
 catch (  Exception e) {
    if (OpenCms.getLog(this).isErrorEnabled()) {
      OpenCms.getLog(this).error("Error creating file content " + offlineFileHeader.toString(),e);
    }
    throw e;
  }
  return newFile;
}
