{
  CmsFile newFile=null;
  CmsFile offlineFile=null;
  try {
    if (!publishedResourceIds.contains(offlineResource.getResourceId())) {
      offlineFile=m_driverManager.getVfsDriver().readFile(dbc,offlineProject.getId(),false,offlineResource.getStructureId());
      newFile=(CmsFile)offlineFile.clone();
      newFile.setState(I_CmsConstants.C_STATE_UNCHANGED);
      m_driverManager.getVfsDriver().createResource(dbc,onlineProject,newFile,newFile.getContents());
      m_driverManager.getVfsDriver().publishResource(dbc,onlineProject,newFile,offlineFile,false);
      publishedResourceIds.add(offlineFile.getResourceId());
    }
 else {
      m_driverManager.getVfsDriver().createSibling(dbc,onlineProject,offlineResource);
      newFile=m_driverManager.getVfsDriver().readFile(dbc,onlineProject.getId(),false,offlineResource.getStructureId());
    }
  }
 catch (  CmsDataAccessException e) {
    if (LOG.isErrorEnabled()) {
      LOG.error(Messages.get().key(Messages.ERR_PUBLISHING_FILE_CONTENT_1,offlineResource.toString()),e);
    }
    throw e;
  }
  return newFile;
}
