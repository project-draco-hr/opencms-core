{
  CmsFile newFile=null;
  CmsFile offlineFile=null;
  try {
    if (!publishedResourceIds.contains(offlineFileHeader.getResourceId())) {
      offlineFile=m_driverManager.getVfsDriver().readFile(runtimeInfo,offlineProject.getId(),false,offlineFileHeader.getStructureId());
      newFile=(CmsFile)offlineFile.clone();
      newFile.setState(I_CmsConstants.C_STATE_UNCHANGED);
      m_driverManager.getVfsDriver().createResource(runtimeInfo,onlineProject,newFile,newFile.getContents());
      m_driverManager.getVfsDriver().publishResource(runtimeInfo,onlineProject,newFile,offlineFile,false);
      publishedResourceIds.add(offlineFile.getResourceId());
    }
 else {
      m_driverManager.getVfsDriver().createSibling(runtimeInfo,onlineProject,offlineFileHeader,offlineFileHeader.getName());
      newFile=m_driverManager.getVfsDriver().readFile(runtimeInfo,onlineProject.getId(),false,offlineFileHeader.getStructureId());
    }
  }
 catch (  Exception e) {
    if (OpenCms.getLog(this).isErrorEnabled()) {
      OpenCms.getLog(this).error("Error creating file content " + offlineFileHeader.toString(),e);
    }
    throw e;
  }
  return newFile;
}
