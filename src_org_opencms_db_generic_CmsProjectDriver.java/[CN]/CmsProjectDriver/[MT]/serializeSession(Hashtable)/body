{
  byte[] value;
  Hashtable sessionData=(Hashtable)data.remove(I_CmsConstants.C_SESSION_DATA);
  StringBuffer notSerializable=new StringBuffer();
  ByteArrayOutputStream bout=new ByteArrayOutputStream();
  ObjectOutputStream oout=new ObjectOutputStream(bout);
  oout.writeObject(data);
  if (sessionData != null) {
    Enumeration keys=sessionData.keys();
    while (keys.hasMoreElements()) {
      Object key=keys.nextElement();
      Object sessionValue=sessionData.get(key);
      if (sessionValue instanceof Serializable) {
        oout.writeObject(key);
        oout.writeObject(sessionValue);
      }
 else {
        notSerializable.append(key);
        notSerializable.append("; ");
      }
    }
  }
  oout.close();
  value=bout.toByteArray();
  if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging() && (notSerializable.length() > 0)) {
    A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_INFO,"[" + this.getClass().getName() + "] warning, following entrys are not serializeable in the session: "+ notSerializable.toString()+ ".");
  }
  return value;
}
