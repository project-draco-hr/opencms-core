{
  byte[] content;
  content=(byte[])m_cacheTemporary.get(systemId);
  if (content != null) {
    return new InputSource(new ByteArrayInputStream(content));
  }
  content=(byte[])m_cachePermanent.get(systemId);
  if (content != null) {
    return new InputSource(new ByteArrayInputStream(content));
  }
  if (systemId.equals(CmsXmlPage.C_XMLPAGE_DTD_SYSTEM_ID) || systemId.endsWith(C_XMLPAGE_DTD_OLD_SYSTEM_ID)) {
    try {
      return new InputSource(getClass().getClassLoader().getResourceAsStream(C_XMLPAGE_DTD_LOCATION));
    }
 catch (    Throwable t) {
      OpenCms.getLog(this).error("Did not find CmsXmlPage DTD at " + C_XMLPAGE_DTD_LOCATION);
    }
  }
 else   if (systemId.startsWith(C_OPENCMS_SCHEME)) {
    String uri=systemId.substring(C_OPENCMS_SCHEME.length() - 1);
    try {
      CmsFile file=m_cms.readFile(uri);
      content=file.getContents();
      cacheSystemId(systemId,content,false);
      return new InputSource(new ByteArrayInputStream(content));
    }
 catch (    Throwable t) {
      OpenCms.getLog(this).error("Could not resolve OpenCms xml entity reference '" + systemId + "'",t);
    }
  }
  return null;
}
