{
  List errors=new ArrayList();
  try {
    if (CmsStringUtil.isNotEmpty(m_pwdInfo.getNewPwd())) {
      m_pwdInfo.setConfirmation(m_pwdInfo.getConfirmation());
    }
    if (m_user.getId() == null) {
      CmsUser newUser=createUser(m_user.getName(),m_pwdInfo.getNewPwd(),m_user.getDescription(),m_user.getAdditionalInfo());
      newUser.setFirstname(m_user.getFirstname());
      newUser.setLastname(m_user.getLastname());
      newUser.setEmail(m_user.getEmail());
      newUser.setAddress(m_user.getAddress());
      m_user=newUser;
    }
 else     if (CmsStringUtil.isNotEmpty(m_pwdInfo.getNewPwd())) {
      if (!m_pwdInfo.getNewPwd().equals(m_pwdInfo.getConfirmation())) {
        m_pwdInfo.setConfirmation(null);
      }
      getCms().setPassword(m_user.getName(),m_pwdInfo.getNewPwd());
    }
    writeUser(m_user);
    Map objects=(Map)getSettings().getListObject();
    if (objects != null) {
      objects.remove(getListClass());
    }
  }
 catch (  Throwable t) {
    errors.add(t);
  }
  if (errors.isEmpty() && isNewUser()) {
    if (getParamCloseLink() != null && getParamCloseLink().indexOf("path=" + getListRootPath()) > -1) {
      Map argMap=new HashMap();
      argMap.put("userid",m_user.getId());
      argMap.put("username",m_user.getName());
      setParamCloseLink(CmsToolManager.linkForToolPath(getJsp(),getListRootPath() + "/edit",argMap));
    }
  }
  setCommitErrors(errors);
}
