{
  getJsp().getRequest().setAttribute(C_SESSION_WORKPLACE_CLASS,this);
  try {
    String resName=getParamResource();
    CmsResource res=getCms().readFileHeader(resName,CmsResourceFilter.ALL);
    if (res.isFolder() && !resName.endsWith("/")) {
      resName+="/";
    }
switch (getDialogAction(getCms())) {
case TYPE_LOCK:
      getCms().lockResource(getParamResource());
    break;
case TYPE_LOCKCHANGE:
  getCms().changeLock(resName);
break;
case TYPE_UNLOCK:
default :
getCms().unlockResource(resName,false);
}
actionCloseDialog();
}
 catch (CmsException e) {
setParamErrorstack(e.getStackTraceAsString());
if (e instanceof CmsSecurityException) {
setParamMessage(key("error.message.accessdenied"));
setParamReasonSuggestion(key("error.reason.accessdenied") + "<br>\n" + key("error.suggestion.accessdenied")+ "\n");
}
 else {
setParamMessage(key("error.message." + getParamDialogtype()));
setParamReasonSuggestion(getErrorSuggestionDefault());
}
getJsp().include(C_FILE_DIALOG_SCREEN_ERROR);
}
}
