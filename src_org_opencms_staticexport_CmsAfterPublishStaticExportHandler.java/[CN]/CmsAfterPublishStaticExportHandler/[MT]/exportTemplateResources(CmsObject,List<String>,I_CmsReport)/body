{
  CmsStaticExportManager manager=OpenCms.getStaticExportManager();
  int size=publishedTemplateResources.size();
  int count=1;
  if (LOG.isDebugEnabled()) {
    LOG.debug(Messages.get().getBundle().key(Messages.LOG_EXPORT_TEMPLATES_1,new Integer(size)));
  }
  report.println(Messages.get().container(Messages.RPT_STATICEXPORT_TEMPLATE_RESOURCES_BEGIN_0),I_CmsReport.FORMAT_HEADLINE);
  StringBuffer cookies=new StringBuffer();
  Iterator<String> i=publishedTemplateResources.iterator();
  while (i.hasNext()) {
    String rfsName=i.next();
    CmsStaticExportData data=manager.getVfsNameInternal(cms,rfsName);
    if (data == null) {
      String rfsBaseName=rfsName;
      int pos=rfsName.lastIndexOf('_');
      if (pos >= 0) {
        rfsBaseName=rfsName.substring(0,pos);
      }
      data=manager.getVfsNameInternal(cms,rfsBaseName);
    }
    if (data != null) {
      data.setRfsName(rfsName);
      report.print(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_SUCCESSION_2,new Integer(count++),new Integer(size)),I_CmsReport.FORMAT_NOTE);
      report.print(Messages.get().container(Messages.RPT_EXPORTING_0),I_CmsReport.FORMAT_NOTE);
      report.print(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_ARGUMENT_1,rfsName));
      report.print(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_DOTS_0));
    }
 else {
      continue;
    }
    try {
      int status=-1;
      CmsResource res=data.getResource();
      try {
        List<String> detailPageUris=CmsDetailPageUtil.getAllDetailPagesWithUrlName(cms,res);
        for (        String detailPageUri : detailPageUris) {
          CmsSitemapEntry detailPageEntry=OpenCms.getSitemapManager().getEntryForUri(cms,detailPageUri);
          status=exportSitemapResource(detailPageEntry,data,cookies);
        }
        CmsSitemapEntry sitemapEntry=OpenCms.getSitemapManager().getEntryForUri(cms,data.getVfsName());
        if (sitemapEntry.isSitemap()) {
          status=exportSitemapResource(sitemapEntry,data,cookies);
        }
 else {
          if (CmsResourceTypeXmlContainerPage.isContainerPage(res)) {
            if (CmsSwitchLinkStrategyHandler.isSitemapInUse(cms,data.getVfsName(),false) || data.getVfsName().startsWith(CmsWorkplace.VFS_PATH_SYSTEM)) {
              List<CmsInternalSitemapEntry> entries=OpenCms.getSitemapManager().getEntriesForStructureId(cms,res.getStructureId());
              for (              CmsSitemapEntry entry : entries) {
                status=exportSitemapResource(entry,data,cookies);
              }
              if (entries.isEmpty()) {
                status=HttpServletResponse.SC_SEE_OTHER;
              }
              if (data.getVfsName().startsWith(CmsWorkplace.VFS_PATH_SYSTEM)) {
                status=exportTemplateResource(data,cookies);
              }
            }
 else {
              status=exportTemplateResource(data,cookies);
            }
          }
 else {
            status=exportTemplateResource(data,cookies);
          }
        }
      }
 catch (      CmsException e) {
        status=HttpServletResponse.SC_NOT_FOUND;
      }
      if (status == HttpServletResponse.SC_OK) {
        report.println(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_OK_0),I_CmsReport.FORMAT_OK);
      }
 else       if (status == HttpServletResponse.SC_NOT_MODIFIED) {
        report.println(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_SKIPPED_0),I_CmsReport.FORMAT_NOTE);
      }
 else       if (status == HttpServletResponse.SC_SEE_OTHER) {
        report.println(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_IGNORED_0),I_CmsReport.FORMAT_NOTE);
      }
 else {
        report.println(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_ARGUMENT_1,new Integer(status)),I_CmsReport.FORMAT_OK);
      }
    }
 catch (    IOException e) {
      report.println(e);
    }
    Thread.yield();
  }
  report.println(Messages.get().container(Messages.RPT_STATICEXPORT_TEMPLATE_RESOURCES_END_0),I_CmsReport.FORMAT_HEADLINE);
}
