{
  m_params.getLocale();
  String directEditPath=CmsLoginHelper.getDirectEditPath(currentCms,settings.getUserSettings());
  String target="";
  if (m_params.getRequestedWorkplaceApp() != null) {
    target=m_params.getRequestedWorkplaceApp() + "#" + UI.getCurrent().getPage().getUriFragment();
  }
 else {
    if (m_params.getRequestedResource() != null) {
      target=m_params.getRequestedResource();
    }
 else     if (directEditPath != null) {
      target=directEditPath;
    }
 else {
      target=CmsFrameset.JSP_WORKPLACE_URI;
    }
    UserAgreementHelper userAgreementHelper=new UserAgreementHelper(currentCms,settings);
    boolean showUserAgreement=userAgreementHelper.isShowUserAgreement();
    if (showUserAgreement) {
      target=userAgreementHelper.getConfigurationVfsPath() + "?" + CmsLoginUserAgreement.PARAM_WPRES+ "="+ target;
    }
    target=OpenCms.getLinkManager().substituteLink(currentCms,target);
  }
  return target;
}
