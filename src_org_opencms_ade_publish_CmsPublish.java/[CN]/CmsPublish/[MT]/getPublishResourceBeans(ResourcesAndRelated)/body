{
  Set<CmsResource> published=getAlreadyPublishedResources(rawPublishResources);
  Set<CmsResource> exclude=new HashSet<CmsResource>(published);
  ResourcesAndRelated permissions=getResourcesWithoutPermissions(rawPublishResources,exclude);
  exclude.addAll(permissions.getResources());
  exclude.addAll(permissions.getRelatedResources());
  ResourcesAndRelated locked=getBlockingLockedResources(rawPublishResources,exclude);
  exclude.clear();
  exclude.addAll(published);
  exclude.addAll(permissions.getResources());
  exclude.addAll(locked.getResources());
  ResourcesAndRelated pubResources=new ResourcesAndRelated();
  pubResources.getResources().addAll(rawPublishResources.getResources());
  pubResources.getResources().removeAll(exclude);
  pubResources.getRelatedResources().addAll(rawPublishResources.getRelatedResources());
  pubResources.getRelatedResources().removeAll(permissions.getRelatedResources());
  pubResources.getRelatedResources().removeAll(locked.getRelatedResources());
  List<CmsResource> resourcesWithoutTempfiles=new ArrayList<CmsResource>();
  for (  CmsResource res : rawPublishResources.getResources()) {
    if (!CmsResource.isTemporaryFileName(res.getRootPath())) {
      resourcesWithoutTempfiles.add(res);
    }
  }
  Set<CmsResource> allPubRes=new HashSet<CmsResource>(pubResources.getRelatedResources());
  allPubRes.addAll(pubResources.getResources());
  List<CmsResource> pubList=new ArrayList<CmsResource>();
  try {
    pubList=OpenCms.getPublishManager().getUsersPubList(m_cms);
  }
 catch (  CmsException e) {
    LOG.error(e.getLocalizedMessage(),e);
  }
  List<CmsPublishResource> publishResources=new ArrayList<CmsPublishResource>();
  for (  CmsResource resource : resourcesWithoutTempfiles) {
    CmsPublishResource pubRes=createPublishResource(resource,pubList,allPubRes,published,permissions,locked);
    publishResources.add(pubRes);
  }
  return publishResources;
}
