{
  m_handler=handler;
  m_handler.m_galleryDialog.setUseFormats(useFormats);
  m_handler.m_galleryDialog.setImageFormats(imageFormats);
  m_handler.m_galleryDialog.setImageFormatNames(imageFormatNames);
  m_eventBus=new SimpleEventBus();
  addValueChangeHandler(m_handler);
  CmsRpcAction<CmsGalleryDataBean> initAction=new CmsRpcAction<CmsGalleryDataBean>(){
    @Override public void execute(){
      getGalleryService().getInitialSettings(galleryMode,referencePath,galleryPath,currentElement,resourceTypes,galleryTypes,this);
    }
    @Override protected void onResponse(    CmsGalleryDataBean result){
      m_dialogBean=result;
      m_dialogMode=m_dialogBean.getMode();
      if (m_dialogBean.getStartTab() == GalleryTabId.cms_tab_results) {
        initialSearch();
      }
 else {
        m_searchObject=new CmsGallerySearchBean();
        m_searchObject.setIgnoreSearchExclude(m_dialogMode != GalleryMode.ade);
        m_searchObject.setLocale(m_dialogBean.getLocale());
        m_searchObject.setScope(m_dialogBean.getScope());
        m_handler.onInitialSearch(m_searchObject,m_dialogBean,CmsGalleryController.this);
      }
    }
  }
;
  initAction.execute();
}
