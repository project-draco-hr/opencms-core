{
  String content=getParamContent();
  String contentLowerCase=content.toLowerCase();
  int indexBodyStart=contentLowerCase.indexOf("<body>");
  boolean isBrowserNS=BROWSER_NS.equals(getBrowserType());
  if ("edit".equals(getParamEditormode()) || isBrowserNS || save) {
    if (indexBodyStart != -1) {
      content=content.substring(indexBodyStart + 6);
      contentLowerCase=contentLowerCase.substring(indexBodyStart + 6);
      content=content.substring(0,contentLowerCase.indexOf("</body>"));
    }
  }
 else {
    String stylesheet=getJsp().property(I_CmsConstants.C_PROPERTY_TEMPLATE,getParamPagetemplate(),"");
    if (indexBodyStart != -1) {
      content=content.substring(indexBodyStart + 6);
      contentLowerCase=contentLowerCase.substring(indexBodyStart + 6);
      content=content.substring(0,contentLowerCase.indexOf("</body>"));
    }
    String server=getJsp().getRequest().getScheme() + "://" + getJsp().getRequest().getServerName()+ ":"+ getJsp().getRequest().getServerPort();
    String head="<html><head>";
    if (!"".equals(stylesheet)) {
      stylesheet=getJsp().link(stylesheet);
      head+="<link href=\"" + server + stylesheet+ "\" rel=\"stylesheet\" type=\"text/css\">";
    }
    head+="<base href=\"" + server + OpenCms.getOpenCmsContext()+ "\"></base></head><body>";
    content=head + content + "</body></html>";
  }
  if (!save) {
    setParamContent(content);
  }
  return content.trim();
}
