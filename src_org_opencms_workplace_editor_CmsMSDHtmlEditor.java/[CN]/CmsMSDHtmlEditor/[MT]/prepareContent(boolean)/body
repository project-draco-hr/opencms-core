{
  String content=getParamContent();
  int indexBodyStart=content.toLowerCase().indexOf("<body>");
  if ("edit".equals(getParamEditormode()) || save) {
    if (indexBodyStart != -1) {
      content=content.substring(indexBodyStart + 6);
      content=content.substring(0,content.toLowerCase().indexOf("</body>"));
    }
    content=filterAnchors(content);
  }
 else {
    String stylesheet=getUriStyleSheet();
    if (indexBodyStart != -1) {
      content=content.substring(indexBodyStart + 6);
      content=content.substring(0,content.toLowerCase().indexOf("</body>"));
    }
    content=filterAnchors(content);
    String server=getJsp().getRequest().getScheme() + "://" + getJsp().getRequest().getServerName()+ ":"+ getJsp().getRequest().getServerPort();
    StringBuffer head=new StringBuffer(content.length() + 1024);
    head.append("<html><head>");
    if (!"".equals(stylesheet)) {
      stylesheet=getJsp().link(stylesheet);
      head.append("<link href=\"" + server + stylesheet+ "\" rel=\"stylesheet\" type=\"text/css\">");
    }
    head.append("<base href=\"" + server + OpenCms.getOpenCmsContext()+ "\"></base></head><body>");
    content=head + content + "</body></html>";
  }
  if (!save) {
    setParamContent(content);
  }
 else {
    content=CmsEncoder.escapeNonAscii(content);
  }
  return content.trim();
}
