{
  CmsSitemapBean sitemap=xmlSitemap.getSitemap(getCmsObject(),getCmsObject().getRequestContext().getLocale());
  JSONObject result=new JSONObject();
  JSONArray siteEntries=new JSONArray();
  for (  CmsSiteEntryBean entry : sitemap.getSiteEntries()) {
    JSONObject siteEntry=jsonifyEntry(entry);
    if (siteEntry != null) {
      siteEntries.put(siteEntry);
    }
  }
  result.put(JsonResponse.SITEMAP.getName(),siteEntries);
  Locale workplaceLocale=getWorkplaceLocale();
  if (xmlSitemap.getFile() instanceof I_CmsHistoryResource) {
    result.put(JsonResponse.NO_EDIT_REASON.getName(),Messages.get().getBundle(workplaceLocale).key(Messages.GUI_NO_EDIT_REASON_HISTORY_0));
  }
 else   if (!getCmsObject().hasPermissions(resource,CmsPermissionSet.ACCESS_WRITE,false,CmsResourceFilter.DEFAULT)) {
    result.put(JsonResponse.NO_EDIT_REASON.getName(),Messages.get().getBundle(workplaceLocale).key(Messages.GUI_NO_EDIT_REASON_PERMISSION_0));
  }
 else {
    CmsLock lock=getCmsObject().getLock(resource);
    if (!lock.isUnlocked() && !lock.isOwnedBy(getCmsObject().getRequestContext().currentUser())) {
      result.put(JsonResponse.NO_EDIT_REASON.getName(),Messages.get().getBundle(workplaceLocale).key(Messages.GUI_NO_EDIT_REASON_LOCK_1,getCmsObject().readUser(lock.getUserId()).getName()));
    }
  }
  JSONArray resFavorites=getFavoriteList();
  result.put(JsonResponse.FAVORITES.getName(),resFavorites);
  JSONArray resRecent=addContents(m_sessionCache.getRecentList());
  result.put(JsonResponse.RECENT.getName(),resRecent);
  return result;
}
