{
  CmsObject cms=getCmsObject();
  CmsSitemapBean sitemap=xmlSitemap.getSitemap(cms,cms.getRequestContext().getLocale());
  JSONObject result=new JSONObject();
  Map<String,CmsXmlContentProperty> propertiesConf=getPropertyConfig(xmlSitemap.getFile());
  JSONArray siteEntries=new JSONArray();
  for (  CmsSitemapEntry entry : sitemap.getSiteEntries()) {
    JSONObject siteEntry=jsonifyEntry(entry,propertiesConf);
    if (siteEntry != null) {
      siteEntries.put(siteEntry);
    }
  }
  CmsXmlSitemap superSitemap=OpenCms.getSitemapManager().getParentSitemap(cms,xmlSitemap);
  if (superSitemap == null) {
    result.put(JsonResponse.superSitemap.name(),"");
    result.put(JsonResponse.sitemap.name(),siteEntries);
  }
 else {
    result.put(JsonResponse.superSitemap.name(),cms.getSitePath(superSitemap.getFile()));
    CmsSitemapEntry parentEntry=OpenCms.getSitemapManager().getEntryForUri(cms,cms.getRequestContext().removeSiteRoot(sitemap.getEntryPoint()));
    Map<String,String> properties=new HashMap<String,String>(parentEntry.getInheritedProperties());
    properties.remove(CmsSitemapManager.Property.sitemap.getName());
    JSONObject jsonParentEntry=jsonifyEntry(new CmsSitemapEntry(parentEntry.getId(),parentEntry.getOriginalUri(),parentEntry.getResourceId(),parentEntry.getName(),parentEntry.getTitle(),properties,null),propertiesConf);
    jsonParentEntry.put(JsonSiteEntry.subentries.name(),siteEntries);
    siteEntries=new JSONArray();
    siteEntries.put(jsonParentEntry);
    result.put(JsonResponse.sitemap.name(),siteEntries);
  }
  result.put(JsonResponse.referencePath.name(),cms.getRequestContext().removeSiteRoot(sitemap.getEntryPoint()));
  result.put(JsonResponse.properties.name(),CmsXmlContentPropertyHelper.getPropertyInfoJSON(cms,xmlSitemap.getFile()));
  return result;
}
