{
  CmsObject cms=getCmsObject();
  CmsResource elementRes=cms.readResource(entry.getResourceId());
  CmsResource formatter=cms.readResource("/system/workplace/editors/sitemap/default-formatter.jsp");
  CmsTemplateLoaderFacade loaderFacade=new CmsTemplateLoaderFacade(OpenCms.getResourceManager().getLoader(formatter),elementRes,formatter);
  CmsResource loaderRes=loaderFacade.getLoaderStartResource();
  HttpServletRequest m_req=getRequest();
  HttpServletResponse m_res=getResponse();
  Object currentElement=m_req.getAttribute(CmsADEManager.ATTR_CURRENT_ELEMENT);
  m_req.setAttribute(CmsADEManager.ATTR_CURRENT_ELEMENT,new CmsSiteEntryBean(entry.getResourceId(),entry.getName(),entry.getTitle(),entry.getProperties(),null));
  try {
    return new String(loaderFacade.getLoader().dump(cms,loaderRes,null,cms.getRequestContext().getLocale(),m_req,m_res),CmsLocaleManager.getResourceEncoding(cms,elementRes));
  }
  finally {
    m_req.setAttribute(CmsADEManager.ATTR_CURRENT_ELEMENT,currentElement);
  }
}
