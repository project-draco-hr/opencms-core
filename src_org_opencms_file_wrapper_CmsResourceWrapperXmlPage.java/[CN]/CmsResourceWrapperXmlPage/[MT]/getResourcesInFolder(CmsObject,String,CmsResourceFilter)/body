{
  CmsResource xmlPage=findXmlPage(cms,resourcename);
  if (xmlPage != null) {
    String path=getSubPath(cms,xmlPage,resourcename);
    String rootPath=cms.getRequestContext().removeSiteRoot(xmlPage.getRootPath());
    ArrayList ret=new ArrayList();
    CmsFile file=CmsFile.upgrade(xmlPage,cms);
    CmsXmlPage xml=CmsXmlPageFactory.unmarshal(cms,file);
    if (CmsStringUtil.isEmptyOrWhitespaceOnly(path)) {
      if (file.getLength() == 0) {
        return ret;
      }
      List locales=xml.getLocales();
      Iterator iter=locales.iterator();
      while (iter.hasNext()) {
        Locale locale=(Locale)iter.next();
        ret.add(getResourceForLocale(xmlPage,locale));
      }
      iter=getVirtualFiles().iterator();
      while (iter.hasNext()) {
        String virtualFileName=(String)iter.next();
        String virtualFilePath=rootPath + "/" + virtualFileName;
        if ((!TMP_FILE_TABLE.containsKey(virtualFilePath)) || (!TMP_FILE_TABLE.get(virtualFilePath).equals(new Integer(0)))) {
          if (virtualFileName.equals(NAME_ELEMENT_CONTROLCODE)) {
            CmsWrappedResource wrap=new CmsWrappedResource(xmlPage);
            wrap.setRootPath(xmlPage.getRootPath() + "/" + NAME_ELEMENT_CONTROLCODE);
            wrap.setTypeId(CmsResourceTypePlain.getStaticTypeId());
            CmsFile tmpFile=wrap.getFile();
            tmpFile.setContents(file.getContents());
            ret.add(tmpFile);
          }
        }
      }
    }
 else {
      Locale locale=new Locale(path);
      List names=xml.getNames(locale);
      Iterator iter=names.iterator();
      while (iter.hasNext()) {
        String name=(String)iter.next();
        String content=xml.getStringValue(cms,name,locale);
        String fullPath=xmlPage.getRootPath() + "/" + path+ "/"+ name+ "."+ EXTENSION_ELEMENT;
        content=prepareContent(content,cms,xmlPage,fullPath);
        ret.add(getResourceForElement(xmlPage,fullPath,content.getBytes().length));
      }
    }
    return ret;
  }
  return null;
}
