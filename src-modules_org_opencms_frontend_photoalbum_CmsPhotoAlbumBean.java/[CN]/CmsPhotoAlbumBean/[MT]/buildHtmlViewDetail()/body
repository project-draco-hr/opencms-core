{
  StringBuffer result=new StringBuffer(4096);
  result.append(buildHtmlAlbumTitle());
  String indexParam=getRequest().getParameter(PARAM_IMAGE);
  int photoIndex=0;
  if (CmsStringUtil.isNotEmpty(indexParam)) {
    photoIndex=Integer.parseInt(indexParam);
    if (photoIndex > (getAlbumPhotos().size() - 1)) {
      photoIndex=getAlbumPhotos().size() - 1;
    }
  }
  CmsResource photo=(CmsResource)getAlbumPhotos().get(photoIndex);
  String resourceName=getCmsObject().getSitePath(photo);
  String title="";
  if (getConfiguration().showResourceNameAsTitle()) {
    title=CmsResource.getName(resourceName);
  }
  title=property(CmsPropertyDefinition.PROPERTY_TITLE,resourceName,title);
  title=CmsEncoder.escapeXml(title);
  result.append("<table border=\"0\"");
  result.append(getStyle().getClassThumbTable());
  result.append(" width=\"");
  result.append(getConfiguration().getDetailImageScaler().getWidth());
  result.append("\">\n");
  result.append(buildHtmlImageNavigation(CmsPhotoAlbumConfiguration.NAVPOS_TOP_ABOVE,photoIndex,photo));
  if (getConfiguration().showDetailTitle() && CmsStringUtil.isNotEmptyOrWhitespaceOnly(title)) {
    result.append("<tr>\n\t<td");
    result.append(getStyle().getClassDetailImageTitle());
    result.append(getConfiguration().getStyleAlignAttribute(getConfiguration().getDetailAlignTitle()));
    result.append(">");
    result.append(title);
    result.append("</td>\n</tr>\n");
  }
  result.append(buildHtmlImageNavigation(CmsPhotoAlbumConfiguration.NAVPOS_TOP_BELOW,photoIndex,photo));
  result.append("<tr>\n\t<td>");
  result.append("<img src=\"");
  StringBuffer link=new StringBuffer(256);
  link.append(resourceName);
  link.append(getConfiguration().getDetailImageScaler().toRequestParam());
  result.append(link(link.toString()));
  result.append("\" border=\"0\" width=\"");
  result.append(getConfiguration().getDetailImageScaler().getWidth());
  result.append("\" height=\"");
  result.append(getConfiguration().getDetailImageScaler().getHeight());
  result.append("\" alt=\"");
  result.append(title);
  result.append("\" title=\"");
  result.append(title);
  result.append("\">");
  result.append("</td>\n</tr>\n");
  result.append(buildHtmlImageNavigation(CmsPhotoAlbumConfiguration.NAVPOS_BOTTOM_ABOVE,photoIndex,photo));
  if (getConfiguration().showDetailDescription()) {
    String description=property(CmsPropertyDefinition.PROPERTY_DESCRIPTION,resourceName,"");
    if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(description)) {
      result.append("<tr>\n\t<td");
      result.append(getStyle().getClassDetailImageDescription());
      result.append(getConfiguration().getStyleAlignAttribute(getConfiguration().getDetailAlignTitle()));
      result.append(">");
      result.append(description);
      result.append("</td>\n</tr>\n");
    }
  }
  result.append(buildHtmlImageNavigation(CmsPhotoAlbumConfiguration.NAVPOS_BOTTOM_BELOW,photoIndex,photo));
  result.append("</table>");
  return result.toString();
}
