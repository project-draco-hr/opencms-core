{
  StringBuffer jsOpener=new StringBuffer(32);
  String galleryType=null;
  try {
    CmsResource res=getCms().readResource(getParamResource());
    if (res != null) {
      String galleryPath=getParamResource();
      if (!galleryPath.endsWith("/")) {
        galleryPath+="/";
      }
      galleryType=OpenCms.getResourceManager().getResourceType(res.getTypeId()).getTypeName();
      String galleryUri=A_CmsGallery.C_PATH_GALLERIES + A_CmsGallery.C_OPEN_URI_SUFFIX + "?"+ A_CmsGallery.PARAM_GALLERY_TYPENAME+ "="+ galleryType;
      jsOpener.append("window.open('");
      jsOpener.append(getJsp().link(galleryUri));
      jsOpener.append("&");
      jsOpener.append(A_CmsGallery.PARAM_DIALOGMODE);
      jsOpener.append("=");
      jsOpener.append(A_CmsGallery.MODE_VIEW);
      jsOpener.append("&");
      jsOpener.append(A_CmsGallery.PARAM_GALLERYPATH);
      jsOpener.append("=");
      jsOpener.append(galleryPath);
      jsOpener.append("', '");
      jsOpener.append(galleryType);
      jsOpener.append("','width=650, height=700, resizable=yes, top=100, left=270, status=yes');");
    }
  }
 catch (  CmsException e) {
    String message="Unable to open gallery for gallery type '" + galleryType + "'";
    OpenCms.getLog(CmsOpenGallery.class).error(message);
    throw new RuntimeException(message,e);
  }
  return jsOpener.toString();
}
