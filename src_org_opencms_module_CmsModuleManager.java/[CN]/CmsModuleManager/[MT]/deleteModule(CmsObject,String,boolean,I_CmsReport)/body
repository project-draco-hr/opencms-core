{
  cms.checkRole(CmsRole.MODULE_MANAGER);
  if (!m_modules.containsKey(moduleName)) {
    throw new CmsConfigurationException(Messages.get().container(Messages.ERR_MODULE_NOT_CONFIGURED_1,moduleName));
  }
  if (LOG.isInfoEnabled()) {
    LOG.info(Messages.get().key(Messages.LOG_DEL_MOD_1,moduleName));
  }
  CmsModule module;
  boolean removeResourceTypes=false;
  if (!replace) {
    module=(CmsModule)m_modules.get(moduleName);
    if (module.getResourceTypes() != Collections.EMPTY_LIST) {
      removeResourceTypes=true;
    }
    if (module.getExplorerTypes() != Collections.EMPTY_LIST) {
      OpenCms.getWorkplaceManager().removeExplorerTypeSettings(module.getExplorerTypes());
    }
    List dependencies=checkDependencies(module,C_DEPENDENCY_MODE_DELETE);
    if (!dependencies.isEmpty()) {
      throw new CmsConfigurationException(Messages.get().container(Messages.ERR_MOD_DEPENDENCIES_0));
    }
    try {
      I_CmsModuleAction moduleAction=(I_CmsModuleAction)m_moduleActionInstances.get(moduleName);
      if (moduleAction != null) {
        moduleAction.moduleUninstall(module);
        m_moduleActionInstances.remove(moduleName);
      }
    }
 catch (    Throwable t) {
      LOG.error(Messages.get().key(Messages.LOG_MOD_UNINSTALL_ERR_1,moduleName),t);
    }
  }
  module=(CmsModule)m_modules.remove(moduleName);
  for (int i=0; i < module.getResources().size(); i++) {
    String currentResource=null;
    try {
      currentResource=(String)module.getResources().get(i);
      if (LOG.isDebugEnabled()) {
        LOG.debug(Messages.get().key(Messages.LOG_DEL_MOD_RESOURCE_1,currentResource));
      }
      cms.lockResource(currentResource);
      cms.deleteResource(currentResource,I_CmsConstants.C_DELETE_OPTION_PRESERVE_SIBLINGS);
      report.print(report.key("report.deleting"),I_CmsReport.C_FORMAT_NOTE);
      report.println(currentResource);
      cms.unlockResource(currentResource);
    }
 catch (    CmsException e) {
      LOG.error(Messages.get().key(Messages.LOG_DEL_MOD_EXC_1,currentResource),e);
      report.println(e);
    }
  }
  initModuleExportPoints();
  updateModuleConfiguration();
  if (removeResourceTypes) {
    OpenCms.getResourceManager().initialize(cms);
  }
}
