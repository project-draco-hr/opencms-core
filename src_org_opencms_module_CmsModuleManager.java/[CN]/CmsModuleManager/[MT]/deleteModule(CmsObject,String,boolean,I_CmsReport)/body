{
  cms.checkRole(CmsRole.MODULE_MANAGER);
  if (!m_modules.containsKey(moduleName)) {
    throw new CmsConfigurationException(CmsConfigurationException.C_CONFIGURATION_ERROR);
  }
  if (OpenCms.getLog(this).isInfoEnabled()) {
    OpenCms.getLog(this).info("Deleting module '" + moduleName + "'");
  }
  CmsModule module;
  boolean removeResourceTypes=false;
  if (!replace) {
    module=(CmsModule)m_modules.get(moduleName);
    if (module.getResourceTypes() != Collections.EMPTY_LIST) {
      removeResourceTypes=true;
    }
    if (module.getExplorerTypes() != Collections.EMPTY_LIST) {
      OpenCms.getWorkplaceManager().removeExplorerTypeSettings(module.getExplorerTypes());
    }
    List dependencies=checkDependencies(module,C_DEPENDENCY_MODE_DELETE);
    if (!dependencies.isEmpty()) {
      throw new CmsConfigurationException(CmsConfigurationException.C_CONFIGURATION_MODULE_DEPENDENCIES);
    }
    try {
      I_CmsModuleAction moduleAction=(I_CmsModuleAction)m_moduleActionInstances.get(moduleName);
      if (moduleAction != null) {
        moduleAction.moduleUninstall(module);
        m_moduleActionInstances.remove(moduleName);
      }
    }
 catch (    Throwable t) {
      OpenCms.getLog(this).error("Error during module action instance uninstall for module '" + moduleName + "'",t);
    }
  }
  module=(CmsModule)m_modules.remove(moduleName);
  for (int i=0; i < module.getResources().size(); i++) {
    String currentResource=null;
    try {
      currentResource=(String)module.getResources().get(i);
      if (OpenCms.getLog(this).isDebugEnabled()) {
        OpenCms.getLog(this).debug("Deleting module resource '" + currentResource + "'");
      }
      cms.lockResource(currentResource);
      cms.deleteResource(currentResource,I_CmsConstants.C_DELETE_OPTION_PRESERVE_SIBLINGS);
      report.print(report.key("report.deleting"),I_CmsReport.C_FORMAT_NOTE);
      report.println(currentResource);
      cms.unlockResource(currentResource);
    }
 catch (    CmsException e) {
      OpenCms.getLog(this).error("Exception deleting module resource '" + currentResource + "'",e);
      report.println(e);
    }
  }
  initModuleExportPoints();
  updateModuleConfiguration();
  if (removeResourceTypes) {
    OpenCms.getResourceManager().initialize(cms);
  }
}
