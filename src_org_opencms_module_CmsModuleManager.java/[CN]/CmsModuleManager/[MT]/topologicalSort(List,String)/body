{
  List modules=new ArrayList(moduleNames);
  List retList=new ArrayList();
  Map moduleDependencies=buildDepsForModulelist(moduleNames,rfsAbsPath,true);
  boolean finished=false;
  while (!finished) {
    finished=true;
    Iterator itMods=modules.iterator();
    while (itMods.hasNext()) {
      String moduleName=(String)itMods.next();
      if (((List)moduleDependencies.get(moduleName)).isEmpty()) {
        retList.add(moduleName);
        Iterator itDeps=moduleDependencies.values().iterator();
        while (itDeps.hasNext()) {
          List dependencies=(List)itDeps.next();
          dependencies.remove(moduleName);
        }
        finished=false;
        itMods.remove();
      }
    }
  }
  if (!modules.isEmpty()) {
    throw new CmsIllegalStateException(Messages.get().container(Messages.ERR_MODULE_DEPENDENCY_CYCLE_1,modules.toString()));
  }
  Collections.reverse(retList);
  return retList;
}
