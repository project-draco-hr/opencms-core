{
  Map ret=new HashMap();
  List modules;
  if (rfsAbsPath == null) {
    modules=OpenCms.getModuleManager().getAllInstalledModules();
  }
 else {
    modules=new ArrayList(getAllModulesFromPath(rfsAbsPath).keySet());
  }
  Iterator itMods=modules.iterator();
  while (itMods.hasNext()) {
    CmsModule module=(CmsModule)itMods.next();
    Iterator itDeps=module.getDependencies().iterator();
    while (itDeps.hasNext()) {
      CmsModuleDependency dependency=(CmsModuleDependency)itDeps.next();
      String moduleDependencyName=dependency.getName();
      if (mode) {
        List moduleDependencies=(List)ret.get(moduleDependencyName);
        if (moduleDependencies == null) {
          moduleDependencies=new ArrayList();
          ret.put(moduleDependencyName,moduleDependencies);
        }
        moduleDependencies.add(module.getName());
      }
 else {
        List moduleDependencies=(List)ret.get(module.getName());
        if (moduleDependencies == null) {
          moduleDependencies=new ArrayList();
          ret.put(module.getName(),moduleDependencies);
        }
        moduleDependencies.add(dependency.getName());
      }
    }
  }
  itMods=modules.iterator();
  while (itMods.hasNext()) {
    CmsModule module=(CmsModule)itMods.next();
    if (ret.get(module.getName()) == null) {
      ret.put(module.getName(),new ArrayList());
    }
  }
  return ret;
}
