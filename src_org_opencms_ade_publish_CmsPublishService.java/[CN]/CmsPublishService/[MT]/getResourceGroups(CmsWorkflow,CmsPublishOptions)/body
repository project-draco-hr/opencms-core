{
  List<CmsPublishGroup> results=null;
  CmsObject cms=getCmsObject();
  try {
    Locale locale=OpenCms.getWorkplaceManager().getWorkplaceLocale(cms);
    List<CmsPublishResource> publishResources=OpenCms.getWorkflowManager().getWorkflowPublishResources(cms,workflow,options);
    for (    CmsPublishResource publishResource : publishResources) {
      checkPreview(publishResource);
    }
    A_CmsPublishGroupHelper<CmsPublishResource,CmsPublishGroup> groupHelper;
    if ((options.getProjectId() == null) || options.getProjectId().isNullUUID()) {
      groupHelper=new CmsDefaultPublishGroupHelper(locale);
    }
 else {
      I_CmsVirtualProject virtualProject=CmsPublish.getVirtualProject(options.getProjectId());
      String title="";
      if (virtualProject != null) {
        CmsProjectBean projectBean=virtualProject.getProjectBean(cms,options.getParameters());
        title=projectBean.getDefaultGroupName();
        if (title == null) {
          title="";
        }
      }
 else {
        try {
          CmsProject project=cms.readProject(options.getProjectId());
          title=project.getName();
        }
 catch (        CmsException e) {
          title="";
        }
      }
      groupHelper=new CmsSinglePublishGroupHelper(locale,title);
    }
    results=groupHelper.getGroups(publishResources);
    setCachedOptions(options);
  }
 catch (  Throwable e) {
    error(e);
  }
  return results;
}
