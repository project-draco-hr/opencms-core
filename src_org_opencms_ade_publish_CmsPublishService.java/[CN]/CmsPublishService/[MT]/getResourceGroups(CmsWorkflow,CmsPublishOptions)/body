{
  List<CmsPublishGroup> results=null;
  CmsObject cms=getCmsObject();
  try {
    Locale locale=OpenCms.getWorkplaceManager().getWorkplaceLocale(cms);
    List<CmsPublishResource> publishResources=OpenCms.getWorkflowManager().getWorkflowPublishResources(cms,workflow,options);
    for (    CmsPublishResource publishResource : publishResources) {
      checkPreview(publishResource);
    }
    A_CmsPublishGroupHelper<CmsPublishResource,CmsPublishGroup> groupHelper;
    if ((options.getProjectId() == null) || options.getProjectId().isNullUUID()) {
      groupHelper=new CmsDefaultPublishGroupHelper(locale);
    }
 else {
      groupHelper=new CmsSinglePublishGroupHelper(locale);
    }
    results=groupHelper.getGroups(publishResources);
    setCachedOptions(options);
  }
 catch (  Throwable e) {
    error(e);
  }
  return results;
}
