{
  String statement=null;
  String moduleMaster="CMS_MODULE_MASTER";
  String channelRel="CMS_MODULE_CHANNEL_REL";
  String media="CMS_MODULE_MEDIA";
  String statementStr=(String)m_queries.get(queryKey);
  if (statementStr == null) {
    statementStr="";
  }
  statement=statementStr;
  if (cms.getRequestContext().currentProject().isOnlineProject()) {
    moduleMaster="CMS_MODULE_ONLINE_MASTER";
    channelRel="CMS_MODULE_ONLINE_CHANNEL_REL";
    media="CMS_MODULE_ONLINE_MEDIA";
  }
  statement=CmsStringUtil.substitute(statement,"$CMS_MODULE_MASTER",moduleMaster);
  statement=CmsStringUtil.substitute(statement,"$CMS_MODULE_CHANNEL_REL",channelRel);
  statement=CmsStringUtil.substitute(statement,"$CMS_MODULE_MEDIA",media);
  if (optionalSqlTokens != null) {
    Iterator optionalSqlKeys=optionalSqlTokens.keySet().iterator();
    while (optionalSqlKeys.hasNext()) {
      String currentKey=(String)optionalSqlKeys.next();
      String currentValue=(String)optionalSqlTokens.get(currentKey);
      statement=CmsStringUtil.substitute(statement,currentKey,currentValue);
    }
  }
  return conn.prepareStatement(statement);
}
