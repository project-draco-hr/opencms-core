{
  String moduleName=getParamModule();
  CmsModule module=OpenCms.getModuleManager().getModule(moduleName);
  List<String> resList=module.getResources();
  List<String> resListCopy=new ArrayList<String>();
  CmsObject resourceCheckCms=getCms();
  try {
    resourceCheckCms=OpenCms.initCmsObject(resourceCheckCms);
    String importSite=module.getImportSite();
    if (!CmsStringUtil.isEmptyOrWhitespaceOnly(importSite)) {
      resourceCheckCms.getRequestContext().setSiteRoot(importSite);
    }
  }
 catch (  CmsException e) {
    LOG.error(e.getLocalizedMessage(),e);
  }
  for (  String res : resList) {
    try {
      if (res != null) {
        resourceCheckCms.readResource(res);
        resListCopy.add(res);
      }
    }
 catch (    CmsException e) {
      if (LOG.isInfoEnabled()) {
        LOG.warn(Messages.get().getBundle().key(Messages.ERR_READ_RESOURCE_1,res),e);
      }
    }
  }
  resListCopy=CmsFileUtil.removeRedundancies(resListCopy);
  String[] resources=new String[resListCopy.size()];
  for (int i=0; i < resListCopy.size(); i++) {
    resources[i]=resListCopy.get(i);
  }
  String filename=OpenCms.getSystemInfo().getAbsoluteRfsPathRelativeToWebInf(OpenCms.getSystemInfo().getPackagesRfsPath() + CmsSystemInfo.FOLDER_MODULES + moduleName+ "_"+ module.getVersion().toString());
  CmsModuleImportExportHandler moduleExportHandler=new CmsModuleImportExportHandler();
  moduleExportHandler.setFileName(filename);
  moduleExportHandler.setModuleName(moduleName.replace('\\','/'));
  moduleExportHandler.setAdditionalResources(resources);
  moduleExportHandler.setDescription(Messages.get().getBundle(getLocale()).key(Messages.GUI_MODULES_LIST_EXPORT_REPORT_HANDLER_NAME_1,moduleExportHandler.getModuleName()));
  return moduleExportHandler;
}
