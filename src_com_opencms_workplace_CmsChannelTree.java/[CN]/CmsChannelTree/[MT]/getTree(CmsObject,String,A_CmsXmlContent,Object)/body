{
  StringBuffer output=new StringBuffer();
  I_CmsSession session=CmsXmlTemplateLoader.getSession(cms.getRequestContext(),true);
  CmsXmlWpConfigFile configFile=this.getConfigFile(cms);
  String foldername=null;
  String filelist=null;
  String currentFolder;
  String currentFilelist;
  String rootFolder;
  String files=null;
  boolean displayFiles=false;
  boolean enableOnlineFiles=false;
  foldername=CmsXmlTemplateLoader.getRequest(cms.getRequestContext()).getParameter(C_PARA_FOLDERTREE);
  if (foldername != null) {
    session.putValue(C_PARA_FOLDERTREE,foldername);
  }
  currentFolder=(String)session.getValue(C_PARA_FOLDERTREE);
  if (currentFolder == null) {
    currentFolder=cms.readAbsolutePath(cms.rootFolder());
  }
  currentFilelist=CmsWorkplaceAction.getCurrentFolder(CmsXmlTemplateLoader.getRequest(cms.getRequestContext()).getOriginalRequest());
  if (currentFilelist == null) {
    currentFilelist=cms.readAbsolutePath(cms.rootFolder());
  }
  files=(String)session.getValue(C_PARA_VIEWFILE);
  if (files != null) {
    displayFiles=true;
  }
  String offselect=(String)session.getValue("onlineselect_in_foldertree");
  if (offselect != null) {
    enableOnlineFiles=true;
  }
  rootFolder=cms.readAbsolutePath(cms.rootFolder());
  CmsXmlWpTemplateFile template=(CmsXmlWpTemplateFile)doc;
  if (filelist != null) {
    template.setData("PREVIOUS",filelist);
  }
 else {
    template.setData("PREVIOUS",currentFilelist);
  }
  String tab=template.getProcessedDataValue(C_TREEIMG_EMPTY0,this);
  showTree(cms,rootFolder,currentFolder,currentFilelist,template,output,tab,displayFiles,enableOnlineFiles,configFile);
  return output.toString();
}
