{
  this.initTemplate(cms,parameters,templateFile);
  this.readInput(cms,parameters);
  if ("1".equals(m_NextStep)) {
    m_TemplateSection="step1";
  }
 else   if ("2".equals(m_NextStep)) {
    if (OpenCms.getWorkplaceManager().autoLockResources()) {
      if (cms.getLock(m_OldResourceName).isNullLock()) {
        cms.lockResource(m_OldResourceName);
      }
    }
    int type=OpenCms.getLoaderManager().getResourceType(m_UploadResourceType).getTypeId();
    cms.replaceResource(m_OldResourceName,type,m_UploadResourceContent,null);
    this.clearSessionValues(CmsXmlTemplateLoader.getSession(cms.getRequestContext(),true));
    try {
      CmsXmlTemplateLoader.getResponse(cms.getRequestContext()).sendCmsRedirect(getConfigFile(cms).getWorkplaceActionPath() + CmsWorkplaceAction.getExplorerFileUri(CmsXmlTemplateLoader.getRequest(cms.getRequestContext()).getOriginalRequest()));
    }
 catch (    Exception ex) {
      throw new CmsException("Redirect failed: " + getConfigFile(cms).getWorkplaceActionPath() + CmsWorkplaceAction.getExplorerFileUri(CmsXmlTemplateLoader.getRequest(cms.getRequestContext()).getOriginalRequest()),CmsException.C_UNKNOWN_EXCEPTION,ex);
    }
  }
  return startProcessing(cms,m_XmlTemplateDocument,"",parameters,m_TemplateSection);
}
