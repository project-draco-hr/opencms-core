{
  String newtab=new String();
  String folderimg=new String();
  String treeswitch=new String();
  CmsFolder lastFolder=null;
  Vector subfolders;
  Vector list=cms.getSubFolders(curfolder);
  Enumeration enum=list.elements();
  if (list.size() > 0) {
    lastFolder=(CmsFolder)list.lastElement();
  }
 else {
    lastFolder=null;
  }
  while (enum.hasMoreElements()) {
    CmsFolder folder=(CmsFolder)enum.nextElement();
    subfolders=cms.getSubFolders(folder.getAbsolutePath());
    if (folder.getAbsolutePath().equals(endfolder)) {
      folderimg=template.getProcessedXmlDataValue("TREEIMG_FOLDEROPEN",this);
    }
 else {
      folderimg=template.getProcessedXmlDataValue("TREEIMG_FOLDERCLOSE",this);
    }
    if (folder.getAbsolutePath().equals(lastFolder.getAbsolutePath())) {
      if (subfolders.size() > 0) {
        if (endfolder.startsWith(folder.getAbsolutePath())) {
          template.setXmlData("TREELINK",C_WP_EXPLORER_TREE + "?" + C_PARA_FOLDER+ "="+ curfolder);
          treeswitch=template.getProcessedXmlDataValue("TREEIMG_MEND",this);
        }
 else {
          template.setXmlData("TREELINK",C_WP_EXPLORER_TREE + "?" + C_PARA_FOLDER+ "="+ folder.getAbsolutePath());
          treeswitch=template.getProcessedXmlDataValue("TREEIMG_PEND",this);
        }
      }
 else {
        treeswitch=template.getProcessedXmlDataValue("TREEIMG_END",this);
      }
    }
 else {
      if (subfolders.size() > 0) {
        if (endfolder.startsWith(folder.getAbsolutePath())) {
          template.setXmlData("TREELINK",C_WP_EXPLORER_TREE + "?" + C_PARA_FOLDER+ "="+ curfolder);
          treeswitch=template.getProcessedXmlDataValue("TREEIMG_MCROSS",this);
        }
 else {
          template.setXmlData("TREELINK",C_WP_EXPLORER_TREE + "?" + C_PARA_FOLDER+ "="+ folder.getAbsolutePath());
          treeswitch=template.getProcessedXmlDataValue("TREEIMG_PCROSS",this);
        }
      }
 else {
        treeswitch=template.getProcessedXmlDataValue("TREEIMG_CROSS",this);
      }
    }
    if (folder.getAbsolutePath().equals(lastFolder.getAbsolutePath())) {
      newtab=tab + template.getProcessedXmlDataValue("TREEIMG_EMPTY",this);
    }
 else {
      newtab=tab + template.getProcessedXmlDataValue("TREEIMG_VERT",this);
    }
    template.setXmlData("TREESTYLE","treefolder");
    template.setXmlData("TREEENTRY",folder.getName());
    template.setXmlData("TREETAB",tab);
    template.setXmlData("TREEFOLDER",folderimg);
    template.setXmlData("TREESWITCH",treeswitch);
    output.append(template.getProcessedXmlDataValue("TREELINE",this));
    if (endfolder.startsWith(folder.getAbsolutePath())) {
      showTree(cms,folder.getAbsolutePath(),endfolder,template,output,newtab);
    }
  }
}
