{
  String newtab=new String();
  String folderimg=new String();
  String treeswitch=new String();
  CmsFolder lastFolder=null;
  Vector subfolders;
  if (endfolder.getAbsolutePath().equals("/")) {
    Vector list=cms.getSubFolders(endfolder.getAbsolutePath());
    Enumeration enum=list.elements();
    while (enum.hasMoreElements()) {
      CmsFolder folder=(CmsFolder)enum.nextElement();
      template.setXmlData("TREEENTRY",folder.getName());
      template.setXmlData("TREETAB",tab);
      output.append(template.getProcessedXmlDataValue("TREELINE"));
    }
  }
 else {
    Vector list=cms.getSubFolders(curfolder.getAbsolutePath());
    Enumeration enum=list.elements();
    if (list.size() > 0) {
      lastFolder=(CmsFolder)list.lastElement();
    }
 else {
      lastFolder=null;
    }
    while (enum.hasMoreElements()) {
      CmsFolder folder=(CmsFolder)enum.nextElement();
      subfolders=cms.getSubFolders(folder.getAbsolutePath());
      if (folder.getAbsolutePath().equals(endfolder.getAbsolutePath())) {
        folderimg=template.getProcessedXmlDataValue("TREEIMG_FOLDEROPEN");
      }
 else {
        folderimg=template.getProcessedXmlDataValue("TREEIMG_FOLDERCLOSE");
      }
      if (folder.getAbsolutePath().equals(lastFolder.getAbsolutePath())) {
        if (subfolders.size() > 0) {
          if (endfolder.getAbsolutePath().startsWith(folder.getAbsolutePath())) {
            treeswitch=template.getProcessedXmlDataValue("TREEIMG_MEND");
          }
 else {
            treeswitch=template.getProcessedXmlDataValue("TREEIMG_PEND");
          }
        }
 else {
          treeswitch=template.getProcessedXmlDataValue("TREEIMG_END");
        }
      }
 else {
        if (subfolders.size() > 0) {
          if (endfolder.getAbsolutePath().startsWith(folder.getAbsolutePath())) {
            treeswitch=template.getProcessedXmlDataValue("TREEIMG_MCROSS");
          }
 else {
            treeswitch=template.getProcessedXmlDataValue("TREEIMG_PCROSS");
          }
        }
 else {
          treeswitch=template.getProcessedXmlDataValue("TREEIMG_CROSS");
        }
      }
      if (folder.getAbsolutePath().equals(lastFolder.getAbsolutePath())) {
        newtab=tab + template.getProcessedXmlDataValue("TREEIMG_EMPTY");
      }
 else {
        newtab=tab + template.getProcessedXmlDataValue("TREEIMG_VERT");
      }
      template.setXmlData("TREEENTRY",folder.getName());
      template.setXmlData("TREETAB",tab);
      template.setXmlData("TREEFOLDER",folderimg);
      template.setXmlData("TREESWITCH",treeswitch);
      output.append(template.getProcessedXmlDataValue("TREELINE"));
      if (endfolder.getAbsolutePath().startsWith(folder.getAbsolutePath())) {
        showTree(cms,folder,endfolder,template,output,newtab);
      }
    }
  }
}
