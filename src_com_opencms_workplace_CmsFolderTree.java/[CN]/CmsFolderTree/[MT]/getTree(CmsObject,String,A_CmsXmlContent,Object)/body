{
  StringBuffer output=new StringBuffer();
  CmsSession session=cms.getRequestContext().getSession(true);
  CmsXmlWpConfigFile configFile=this.getConfigFile(cms);
  String foldername=null;
  String filelist=null;
  String currentFolder;
  String oldFolder;
  String currentFilelist;
  String rootFolder;
  String files=null;
  boolean displayFiles=false;
  foldername=cms.getRequestContext().getRequest().getParameter(C_PARA_FOLDERTREE);
  if (foldername != null) {
    session.putValue(C_PARA_FOLDERTREE,foldername);
  }
  currentFolder=(String)session.getValue(C_PARA_FOLDERTREE);
  if (currentFolder == null) {
    currentFolder=cms.rootFolder().getAbsolutePath();
  }
  currentFilelist=(String)session.getValue(C_PARA_FILELIST);
  if (currentFilelist == null) {
    currentFilelist=cms.rootFolder().getAbsolutePath();
  }
  files=(String)session.getValue(C_PARA_VIEWFILE);
  if (files != null) {
    displayFiles=true;
  }
  rootFolder=cms.rootFolder().getAbsolutePath();
  CmsXmlWpTemplateFile template=(CmsXmlWpTemplateFile)doc;
  if (filelist != null) {
    template.setData("PREVIOUS",filelist);
  }
 else {
    template.setData("PREVIOUS",currentFilelist);
  }
  String tab=template.getProcessedDataValue(C_TREEIMG_EMPTY0,this);
  showTree(cms,rootFolder,currentFolder,currentFilelist,template,output,tab,displayFiles,configFile);
  return output.toString();
}
