{
  Map config=adminCms.getConfigurations();
  String dbName=config.get(CmsDbPool.C_KEY_DATABASE_NAME).toString().toLowerCase();
  String poolUrl=config.get("db.cos.pool").toString();
  CmsDbAccess dbAccess=new CmsDbAccess(poolUrl);
  boolean masterAvailable=dbAccess.checkTables();
  if (OpenCms.getLog(this).isDebugEnabled()) {
    OpenCms.getLog(this).debug("Checking master module tables for " + dbName + " - "+ ((masterAvailable) ? "found" : "not found"));
  }
  if (!masterAvailable) {
    if (OpenCms.getLog(this).isDebugEnabled()) {
      OpenCms.getLog(this).debug("Calling master module table setup script for " + dbName);
    }
    String modulePath[]=(String[])module.getResources().toArray(new String[1]);
    String scriptPath;
    if (dbName.toLowerCase().startsWith("mysql")) {
      scriptPath=modulePath[0] + "setup/mysql.sql";
    }
 else {
      scriptPath=modulePath[0] + "setup/" + dbName+ ".sql";
    }
    try {
      String updateScript=new String(adminCms.readFile(scriptPath).getContents());
      HashMap replacers=new HashMap();
      for (Iterator i=module.getParameters().keySet().iterator(); i.hasNext(); ) {
        String param=(String)i.next(), value=null;
        if (param.startsWith("$")) {
          value=(String)module.getParameters().get(param);
          replacers.put(param,value);
        }
      }
      dbAccess.updateDatabase(updateScript,replacers);
    }
 catch (    CmsException exc) {
      if (OpenCms.getLog(this).isErrorEnabled()) {
        OpenCms.getLog(this).error("Error while creating master module tables",exc);
      }
    }
    if (OpenCms.getLog(this).isInfoEnabled()) {
      OpenCms.getLog(this).info(". Legacy initialization: Created master module tables");
    }
  }
}
