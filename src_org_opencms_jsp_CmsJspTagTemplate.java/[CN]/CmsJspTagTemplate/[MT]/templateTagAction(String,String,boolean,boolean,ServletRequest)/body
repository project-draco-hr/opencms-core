{
  if (elementlist != null) {
    CmsFlexController controller=(CmsFlexController)req.getAttribute(CmsFlexController.ATTRIBUTE_NAME);
    String filename=controller.getCmsObject().getRequestContext().getUri();
    CmsXmlPage page=(CmsXmlPage)req.getAttribute(filename);
    if (page == null) {
      CmsResource resource=controller.getCmsResource();
      if (resource.getType() == CmsResourceTypeXmlPage.C_RESOURCE_TYPE_ID) {
        try {
          page=CmsXmlPage.read(controller.getCmsObject(),CmsFile.upgrade(resource,controller.getCmsObject()));
          req.setAttribute(filename,page);
        }
 catch (        CmsException e) {
          OpenCms.getLog(CmsJspTagTemplate.class).error("Error checking for XML page",e);
        }
      }
    }
    if (page != null) {
      String absolutePath=controller.getCmsObject().readAbsolutePath(page.getFile());
      Locale locale=OpenCms.getLocaleManager().getBestMatchingLocale(controller.getCmsObject().getRequestContext().getLocale(),OpenCms.getLocaleManager().getDefaultLocales(controller.getCmsObject(),absolutePath),page.getLocales());
      String elements[]=CmsStringSubstitution.split(elementlist,",");
      boolean found=false;
      for (int i=0; i < elements.length; i++) {
        String el=elements[i].trim();
        if (page.hasElement(el,locale) && page.isEnabled(el,locale)) {
          found=true;
          if (!checkall) {
            break;
          }
        }
 else {
          if (checkall) {
            return false;
          }
        }
      }
      if (!found && !checknone) {
        return false;
      }
 else       if (found && checknone) {
        return false;
      }
    }
  }
  String param=req.getParameter(I_CmsResourceLoader.C_TEMPLATE_ELEMENT);
  return ((element == null) || (param == null) || (param.equals(element)));
}
