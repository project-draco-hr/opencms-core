{
  String jdbcDriver=configuration.getString(C_KEY_DATABASE_POOL + "." + key+ "."+ C_KEY_JDBC_DRIVER);
  String jdbcUrl=configuration.getString(C_KEY_DATABASE_POOL + "." + key+ "."+ C_KEY_JDBC_URL);
  int maxActive=configuration.getInteger(C_KEY_DATABASE_POOL + "." + key+ "."+ C_KEY_MAX_ACTIVE,10);
  int maxWait=configuration.getInteger(C_KEY_DATABASE_POOL + "." + key+ "."+ C_KEY_MAX_WAIT,2000);
  int maxIdle=configuration.getInteger(C_KEY_DATABASE_POOL + "." + key+ "."+ C_KEY_MAX_IDLE,5);
  String testQuery=configuration.getString(C_KEY_DATABASE_POOL + "." + key+ "."+ C_KEY_TEST_QUERY);
  String username=configuration.getString(C_KEY_DATABASE_POOL + "." + key+ "."+ C_KEY_USERNAME);
  String password=configuration.getString(C_KEY_DATABASE_POOL + "." + key+ "."+ C_KEY_PASSWORD);
  String poolUrl=configuration.getString(C_KEY_DATABASE_POOL + "." + key+ "."+ C_KEY_POOL_URL);
  String whenExhaustedActionValue=configuration.getString(C_KEY_DATABASE_POOL + "." + key+ "."+ C_KEY_WHEN_EXHAUSTED_ACTION).trim();
  byte whenExhaustedAction=0;
  boolean testOnBorrow="true".equalsIgnoreCase(configuration.getString(C_KEY_DATABASE_POOL + "." + key+ "."+ C_KEY_TEST_ON_BORROW).trim());
  if ("block".equalsIgnoreCase(whenExhaustedActionValue)) {
    whenExhaustedAction=GenericObjectPool.WHEN_EXHAUSTED_BLOCK;
  }
 else   if ("fail".equalsIgnoreCase(whenExhaustedActionValue)) {
    whenExhaustedAction=GenericObjectPool.WHEN_EXHAUSTED_FAIL;
  }
 else   if ("grow".equalsIgnoreCase(whenExhaustedActionValue)) {
    whenExhaustedAction=GenericObjectPool.WHEN_EXHAUSTED_GROW;
  }
 else {
    whenExhaustedAction=GenericObjectPool.DEFAULT_WHEN_EXHAUSTED_ACTION;
  }
  if ("".equals(testQuery)) {
    testQuery=null;
  }
  if (username == null) {
    username="";
  }
  if (password == null) {
    password="";
  }
  boolean poolingStmts="true".equalsIgnoreCase(configuration.getString(C_KEY_DATABASE_STATEMENTS + "." + key+ "."+ C_KEY_POOLING,"true").trim());
  int maxActiveStmts=configuration.getInteger(C_KEY_DATABASE_STATEMENTS + "." + key+ "."+ C_KEY_MAX_ACTIVE,25);
  int maxWaitStmts=configuration.getInteger(C_KEY_DATABASE_STATEMENTS + "." + key+ "."+ C_KEY_MAX_WAIT,250);
  int maxIdleStmts=configuration.getInteger(C_KEY_DATABASE_STATEMENTS + "." + key+ "."+ C_KEY_MAX_IDLE,15);
  String whenStmtsExhaustedActionValue=configuration.getString(C_KEY_DATABASE_STATEMENTS + "." + key+ "."+ C_KEY_WHEN_EXHAUSTED_ACTION);
  byte whenStmtsExhaustedAction=GenericKeyedObjectPool.WHEN_EXHAUSTED_GROW;
  if (whenStmtsExhaustedActionValue != null) {
    whenStmtsExhaustedActionValue=whenStmtsExhaustedActionValue.trim();
    whenStmtsExhaustedAction=("block".equalsIgnoreCase(whenStmtsExhaustedActionValue)) ? GenericKeyedObjectPool.WHEN_EXHAUSTED_BLOCK : ("fail".equalsIgnoreCase(whenStmtsExhaustedActionValue)) ? GenericKeyedObjectPool.WHEN_EXHAUSTED_FAIL : GenericKeyedObjectPool.WHEN_EXHAUSTED_GROW;
  }
  Class.forName(jdbcDriver).newInstance();
  GenericObjectPool connectionPool=new GenericObjectPool(null);
  connectionPool.setMaxActive(maxActive);
  connectionPool.setMaxIdle(maxIdle);
  connectionPool.setMaxWait(maxWait);
  connectionPool.setWhenExhaustedAction(whenExhaustedAction);
  connectionPool.setTestOnBorrow(testOnBorrow && (testQuery != null));
  connectionPool.setTestWhileIdle(true);
  connectionPool.setTimeBetweenEvictionRunsMillis(10000);
  connectionPool.setNumTestsPerEvictionRun(5);
  connectionPool.setMinEvictableIdleTimeMillis(5000);
  ConnectionFactory connectionFactory=new DriverManagerConnectionFactory(jdbcUrl,username,password);
  GenericKeyedObjectPoolFactory statementFactory;
  if (poolingStmts) {
    statementFactory=new GenericKeyedObjectPoolFactory(null,maxActiveStmts,whenStmtsExhaustedAction,maxWaitStmts,maxIdleStmts,false,false,10000,5,5000,true);
  }
 else {
    statementFactory=null;
  }
  PoolableConnectionFactory factory=new PoolableConnectionFactory(connectionFactory,connectionPool,statementFactory,testQuery,false,true);
  factory.setDefaultAutoCommit(true);
  PoolingDriver driver=new PoolingDriver();
  driver.registerPool(poolUrl,connectionPool);
  if (OpenCms.getLog(CmsLog.CHANNEL_INIT).isInfoEnabled()) {
    OpenCms.getLog(CmsLog.CHANNEL_INIT).info(". Init. JDBC pool      : " + poolUrl + " ("+ jdbcUrl+ ")");
  }
  return poolUrl;
}
