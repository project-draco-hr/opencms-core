{
  CmsObject cms=getCmsObject();
  echo("Testing searching with optimized limiting to time ranges");
  String query="q=+text_en:OpenCms";
  CmsSolrIndex index=OpenCms.getSearchManager().getIndexSolr(AllSolrTests.SOLR_OFFLINE);
  List<CmsSearchResource> results=index.search(getCmsObject(),query);
  int orgCount=results.size();
  Date stamp=new Date();
  String date=DateField.formatExternal(new Date(stamp.getTime() - 20000));
  query="q=+text_en:OpenCms +created:[" + date + " TO NOW]";
  results=index.search(getCmsObject(),query);
  assertEquals(1,results.size());
  String resName="search_new_2.txt";
  cms.createResource(resName,CmsResourceTypePlain.getStaticTypeId(),"OpenCms".getBytes(),null);
  I_CmsReport report=new CmsShellReport(cms.getRequestContext().getLocale());
  OpenCms.getSearchManager().rebuildIndex(AllSolrTests.SOLR_OFFLINE,report);
  results=index.search(getCmsObject(),query);
  assertEquals(2,results.size());
  String maxDate=DateField.formatExternal(new Date(stamp.getTime() - (1000 * 60 * 60* 24)));
  query="q=+text_en:OpenCms +created:[* TO " + maxDate + "]";
  results=index.search(getCmsObject(),query);
  assertEquals(orgCount - 1,results.size());
  maxDate=DateField.formatExternal(new Date());
  query="q=+text_en:OpenCms +created:[* TO " + maxDate + "]";
  results=index.search(getCmsObject(),query);
  assertEquals(orgCount + 1,results.size());
  Date newStamp=new Date();
  date=DateField.formatExternal(newStamp);
  String minDate=DateField.formatExternal(new Date(newStamp.getTime() + (1000 * 60 * 60* 24)));
  query="q=+text_en:OpenCms +lastmodified:[ " + minDate + " TO NOW]";
  results=index.search(getCmsObject(),query);
  assertEquals(0,results.size());
  CmsFile file=cms.readFile(resName);
  file.setContents("OpenCms ist toll".getBytes());
  cms.writeFile(file);
  report=new CmsShellReport(cms.getRequestContext().getLocale());
  OpenCms.getSearchManager().rebuildIndex(AllSolrTests.SOLR_OFFLINE,report);
  query="q=+text_en:OpenCms +lastmodified:[" + date + " TO NOW]";
  results=index.search(getCmsObject(),query);
  assertEquals(1,results.size());
  maxDate=DateField.formatExternal(new Date(newStamp.getTime() - (1000 * 60 * 60* 24)));
  query="q=+text_en:OpenCms +lastmodified:[* TO " + maxDate + "]";
  results=index.search(getCmsObject(),query);
  assertEquals(orgCount - 1,results.size());
  query="q=+text_en:OpenCms +lastmodified:[* TO NOW]";
  results=index.search(getCmsObject(),query);
  assertEquals(orgCount + 1,results.size());
}
