{
  DateFormat DF=new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss'Z'");
  DF.setTimeZone(DateUtil.UTC);
  CmsObject cms=getCmsObject();
  echo("Testing searching with optimized limiting to time ranges");
  String query="?rows=50&q=+text:OpenCms";
  CmsSolrIndex index=OpenCms.getSearchManager().getIndexSolr(AllTests.SOLR_ONLINE);
  CmsSolrResultList results=index.search(getCmsObject(),query);
  int orgCount=results.size();
  Date stamp=new Date();
  String date=DF.format(new Date(stamp.getTime() - 20000));
  query="?rows=50&q=+text:OpenCms +created:[" + date + " TO NOW]";
  results=index.search(getCmsObject(),query);
  assertEquals(1,results.size());
  String resName="search_new_2.txt";
  cms.createResource(resName,CmsResourceTypePlain.getStaticTypeId(),"OpenCms".getBytes(),null);
  I_CmsReport report=new CmsShellReport(cms.getRequestContext().getLocale());
  OpenCms.getPublishManager().publishProject(cms,report);
  OpenCms.getPublishManager().waitWhileRunning();
  results=index.search(getCmsObject(),query);
  assertEquals(2,results.size());
  String maxDate=DF.format(new Date(stamp.getTime() - (1000 * 60 * 60* 24)));
  query="?rows=50&q=+text:OpenCms +created:[* TO " + maxDate + "]";
  results=index.search(getCmsObject(),query);
  assertEquals(orgCount - 1,results.size());
  maxDate=DF.format(new Date());
  query="?rows=50&q=+text:OpenCms +created:[* TO " + maxDate + "]";
  results=index.search(getCmsObject(),query);
  assertEquals(orgCount + 1,results.size());
  Thread.sleep(1000);
  Date newStamp=new Date();
  date=DF.format(newStamp);
  String minDate=DF.format(new Date(newStamp.getTime() + (1000 * 60 * 60* 24)));
  query="?rows=50&q=+text:OpenCms +lastmodified:[ " + minDate + " TO NOW]";
  results=index.search(getCmsObject(),query);
  assertEquals(0,results.size());
  CmsFile file=cms.readFile(resName);
  file.setContents("OpenCms ist toll".getBytes());
  cms.lockResource(file);
  cms.writeFile(file);
  report=new CmsShellReport(cms.getRequestContext().getLocale());
  OpenCms.getPublishManager().publishProject(cms,report);
  OpenCms.getPublishManager().waitWhileRunning();
  query="?rows=50&q=+text:OpenCms +lastmodified:[" + date + " TO NOW]";
  results=index.search(getCmsObject(),query);
  AllTests.printResults(getCmsObject(),results,false);
  assertEquals(1,results.size());
  maxDate=DF.format(new Date(newStamp.getTime() - (1000 * 60 * 60* 24)));
  query="?rows=50&q=+text:OpenCms +lastmodified:[* TO " + maxDate + "]";
  results=index.search(getCmsObject(),query);
  assertEquals(orgCount - 1,results.size());
  query="?rows=50&q=+text:OpenCms +lastmodified:[* TO NOW]";
  results=index.search(getCmsObject(),query);
  assertEquals(orgCount + 1,results.size());
}
