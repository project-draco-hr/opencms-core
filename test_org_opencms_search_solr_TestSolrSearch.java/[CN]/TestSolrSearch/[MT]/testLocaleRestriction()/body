{
  CmsSolrIndex index=OpenCms.getSearchManager().getIndexSolr(AllTests.SOLR_ONLINE);
  index.setLanguageDetection(false);
  String queryText="Language Detection Document";
  String folderName="/folder1/subfolder12/subsubfolder121/";
  String refsSource="org/opencms/search/solr/lang-detect-doc.pdf";
  CmsObject cms=OpenCms.initCmsObject(getCmsObject());
  CmsResource master=importTestResource(cms,refsSource,folderName + "master.pdf",CmsResourceTypeBinary.getStaticTypeId(),Collections.<CmsProperty>emptyList());
  CmsResource de=importTestResource(cms,refsSource,folderName + "master_de.pdf",CmsResourceTypeBinary.getStaticTypeId(),Collections.<CmsProperty>emptyList());
  CmsResource en=importTestResource(cms,refsSource,folderName + "master_en.pdf",CmsResourceTypeBinary.getStaticTypeId(),Collections.<CmsProperty>emptyList());
  CmsResource fr=importTestResource(cms,refsSource,folderName + "master_fr.pdf",CmsResourceTypeBinary.getStaticTypeId(),Collections.<CmsProperty>emptyList());
  OpenCms.getPublishManager().publishProject(cms,null);
  OpenCms.getPublishManager().waitWhileRunning();
  cms.getRequestContext().setLocale(Locale.GERMAN);
  CmsSolrQuery query=new CmsSolrQuery(cms,null);
  query.setText(queryText);
  CmsSolrResultList result=index.search(cms,query);
  assertTrue(result.contains(master));
  assertTrue(!result.contains(en));
  assertTrue(result.contains(de));
  assertTrue(!result.contains(fr));
  query=new CmsSolrQuery();
  query.setLocales(Collections.singletonList(Locale.GERMAN));
  query.setText(queryText);
  result=index.search(cms,query);
  assertTrue(result.contains(master));
  assertTrue(!result.contains(en));
  assertTrue(result.contains(de));
  assertTrue(!result.contains(fr));
  query=new CmsSolrQuery();
  query.setLocales(Collections.singletonList(Locale.FRENCH));
  query.setText(queryText);
  result=index.search(cms,query);
  assertTrue(result.contains(master));
  assertTrue(!result.contains(en));
  assertTrue(!result.contains(de));
  assertTrue(result.contains(fr));
  query=new CmsSolrQuery();
  query.setLocales(Collections.singletonList(Locale.ENGLISH));
  query.setText(queryText);
  result=index.search(cms,query);
  assertTrue(result.contains(master));
  assertTrue(result.contains(en));
  assertTrue(!result.contains(de));
  assertTrue(!result.contains(fr));
  query=new CmsSolrQuery();
  List<Locale> l=Collections.emptyList();
  query.setLocales(l);
  query.setText(queryText);
  result=index.search(cms,query);
  assertTrue(result.contains(master));
  assertTrue(result.contains(en));
  assertTrue(result.contains(de));
  assertTrue(result.contains(fr));
  index.setLanguageDetection(true);
}
