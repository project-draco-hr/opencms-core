{
  String template=null;
  CmsXmlWpTemplateFile xmlTemplateDocument=new CmsXmlWpTemplateFile(cms,templateFile);
  String oldpwd=(String)parameters.get(C_PARA_OLDPWD);
  String newpwd=(String)parameters.get(C_PARA_NEWPWD);
  String newpwdrepeat=(String)parameters.get(C_PARA_NEWPWDREPEAT);
  if ((oldpwd != null) && (newpwd != null) && (newpwdrepeat != null)) {
    if (newpwd.equals(newpwdrepeat)) {
      try {
        cms.setPassword(cms.getRequestContext().currentUser().getName(),oldpwd,newpwd);
        try {
          cms.getRequestContext().getResponse().sendCmsRedirect(getConfigFile(cms).getWorkplaceActionPath() + C_WP_EXPLORER_PREFERENCES);
        }
 catch (        Exception e) {
          throw new CmsException("Redirect fails :" + getConfigFile(cms).getWorkplaceActionPath() + C_WP_EXPLORER_PREFERENCES,CmsException.C_UNKNOWN_EXCEPTION,e);
        }
      }
 catch (      CmsException exp) {
        if (exp.getType() == 1) {
          xmlTemplateDocument.setData("details",Utils.getStackTrace(exp));
          template="error2";
        }
 else {
          throw exp;
        }
      }
    }
 else {
      xmlTemplateDocument.setData("details","The new passwords do not match.");
      template="error";
    }
  }
  return startProcessing(cms,xmlTemplateDocument,"",parameters,template);
}
