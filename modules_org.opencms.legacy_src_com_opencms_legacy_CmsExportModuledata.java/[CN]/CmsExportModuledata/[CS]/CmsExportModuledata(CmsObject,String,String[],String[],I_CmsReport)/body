{
  setCms(cms);
  setReport(report);
  setExportFileName(exportFile);
  setExportedChannelIds(new HashSet());
  getCms().getRequestContext().saveSiteRoot();
  Element exportNode;
  try {
    exportNode=openExportFile();
    getReport().println(getReport().key("report.export_channels_begin"),I_CmsReport.C_FORMAT_HEADLINE);
    getCms().getRequestContext().setSiteRoot(I_CmsConstants.VFS_FOLDER_CHANNELS);
    exportAllResources(exportNode,resourcesToExport);
    getReport().println(getReport().key("report.export_channels_end"),I_CmsReport.C_FORMAT_HEADLINE);
    Vector modules=new Vector();
    Vector moduleNames=new Vector();
    for (int i=0; i < modulesToExport.length; i++) {
      String modName=modulesToExport[i];
      if (modName != null && !"".equals(modName)) {
        moduleNames.addElement(modulesToExport[i]);
      }
    }
    List moduleExportables=CmsLegacyModuleAction.getLegacyModulePublishClasses();
    if (moduleNames.size() == 0) {
      if (resourcesToExport.length > 0) {
        Iterator modElements=moduleExportables.iterator();
        while (modElements.hasNext()) {
          modules.add(modElements.next());
        }
      }
    }
 else {
      modules=moduleNames;
    }
    Enumeration enumModules=modules.elements();
    while (enumModules.hasMoreElements()) {
      String classname=(String)enumModules.nextElement();
      exportCos(exportNode,classname,getExportedChannelIds());
    }
    closeExportFile(exportNode);
  }
 catch (  CmsException e) {
    getReport().println(e);
    CmsMessageContainer message=Messages.get().container(Messages.ERR_COS_IMPORTEXPORT_ERROR_EXPORTING_TO_FILE_1,getExportFileName());
    if (LOG.isDebugEnabled()) {
      LOG.debug(message,e);
    }
    throw new CmsImportExportException(message,e);
  }
catch (  SAXException se) {
    getReport().println(se);
    CmsMessageContainer message=Messages.get().container(Messages.ERR_COS_IMPORTEXPORT_ERROR_EXPORTING_TO_FILE_1,getExportFileName());
    if (LOG.isDebugEnabled()) {
      LOG.debug(message,se);
    }
    throw new CmsImportExportException(message,se);
  }
catch (  IOException ioe) {
    getReport().println(ioe);
    CmsMessageContainer message=Messages.get().container(Messages.ERR_COS_IMPORTEXPORT_ERROR_EXPORTING_TO_FILE_1,getExportFileName());
    if (LOG.isDebugEnabled()) {
      LOG.debug(message,ioe);
    }
    throw new CmsImportExportException(message,ioe);
  }
 finally {
    getCms().getRequestContext().restoreSiteRoot();
  }
}
