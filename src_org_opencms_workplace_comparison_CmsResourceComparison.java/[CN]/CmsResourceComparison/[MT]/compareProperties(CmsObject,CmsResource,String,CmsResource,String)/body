{
  List properties1;
  if (resource1 instanceof I_CmsHistoryResource) {
    properties1=cms.readHistoryPropertyObjects((I_CmsHistoryResource)resource1);
  }
 else {
    if (Integer.parseInt(version1) < 0) {
      CmsProject prj=cms.getRequestContext().getCurrentProject();
      try {
        cms.getRequestContext().setCurrentProject(cms.readProject(CmsProject.ONLINE_PROJECT_ID));
        properties1=cms.readPropertyObjects(resource1,false);
      }
  finally {
        cms.getRequestContext().setCurrentProject(prj);
      }
    }
 else {
      properties1=cms.readPropertyObjects(resource1,false);
    }
  }
  List properties2;
  if (resource2 instanceof I_CmsHistoryResource) {
    properties2=cms.readHistoryPropertyObjects((I_CmsHistoryResource)resource2);
  }
 else {
    if (Integer.parseInt(version2) < 0) {
      CmsProject prj=cms.getRequestContext().getCurrentProject();
      try {
        cms.getRequestContext().setCurrentProject(cms.readProject(CmsProject.ONLINE_PROJECT_ID));
        properties2=cms.readPropertyObjects(resource2,false);
      }
  finally {
        cms.getRequestContext().setCurrentProject(prj);
      }
    }
 else {
      properties2=cms.readPropertyObjects(resource2,false);
    }
  }
  List comparedProperties=new ArrayList();
  List removedProperties=new ArrayList(properties1);
  removedProperties.removeAll(properties2);
  List addedProperties=new ArrayList(properties2);
  addedProperties.removeAll(properties1);
  List retainedProperties=new ArrayList(properties2);
  retainedProperties.retainAll(properties1);
  CmsProperty prop;
  Iterator i=addedProperties.iterator();
  while (i.hasNext()) {
    prop=(CmsProperty)i.next();
    comparedProperties.add(new CmsAttributeComparison(prop.getName(),"",prop.getValue(),CmsResourceComparison.TYPE_ADDED));
  }
  i=removedProperties.iterator();
  while (i.hasNext()) {
    prop=(CmsProperty)i.next();
    comparedProperties.add(new CmsAttributeComparison(prop.getName(),prop.getValue(),"",CmsResourceComparison.TYPE_REMOVED));
  }
  i=retainedProperties.iterator();
  while (i.hasNext()) {
    prop=(CmsProperty)i.next();
    String value1=((CmsProperty)properties1.get(properties1.indexOf(prop))).getValue();
    String value2=((CmsProperty)properties2.get(properties2.indexOf(prop))).getValue();
    if (value1.equals(value2)) {
      comparedProperties.add(new CmsAttributeComparison(prop.getName(),value1,value2,CmsResourceComparison.TYPE_UNCHANGED));
    }
 else {
      comparedProperties.add(new CmsAttributeComparison(prop.getName(),value1,value2,CmsResourceComparison.TYPE_CHANGED));
    }
  }
  return comparedProperties;
}
