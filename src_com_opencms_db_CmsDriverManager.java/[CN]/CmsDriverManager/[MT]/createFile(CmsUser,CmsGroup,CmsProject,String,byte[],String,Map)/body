{
  String folderName=newFileName.substring(0,newFileName.lastIndexOf(C_FOLDER_SEPARATOR,newFileName.length()) + 1);
  String resourceName=newFileName.substring(folderName.length(),newFileName.length());
  validFilename(resourceName);
  CmsFolder cmsFolder=readFolder(currentUser,currentProject,folderName);
  if (accessCreate(currentUser,currentProject,(CmsResource)cmsFolder)) {
    CmsFile file=m_vfsDriver.createFile(currentUser,currentProject,newFileName,0,cmsFolder.getResourceId(),contents,getResourceType(currentUser,currentProject,type));
    Hashtable startSettings=null;
    Integer accessFlags=null;
    startSettings=(Hashtable)currentUser.getAdditionalInfo(C_ADDITIONAL_INFO_STARTSETTINGS);
    if (startSettings != null) {
      accessFlags=(Integer)startSettings.get(C_START_ACCESSFLAGS);
      if (accessFlags != null) {
        file.setAccessFlags(accessFlags.intValue());
        m_userDriver.createAccessControlEntry(file.getResourceId(),currentUser.getId(),accessFlags.intValue() & C_ACCESS_OWNER,0,0);
      }
    }
    if (currentGroup != null) {
      file.setGroupId(currentGroup.getId());
      m_userDriver.createAccessControlEntry(file.getResourceId(),currentGroup.getId(),accessFlags.intValue() & C_ACCESS_GROUP,0,0);
    }
    m_vfsDriver.writeFileHeader(currentProject,file,false);
    this.clearResourceCache(newFileName,currentProject,currentUser);
    m_vfsDriver.writeProperties(propertyinfos,currentProject.getId(),file,file.getType());
    fileSystemChanged(false);
    return file;
  }
 else {
    throw new CmsException("[" + this.getClass().getName() + "] "+ newFileName,CmsException.C_NO_ACCESS);
  }
}
