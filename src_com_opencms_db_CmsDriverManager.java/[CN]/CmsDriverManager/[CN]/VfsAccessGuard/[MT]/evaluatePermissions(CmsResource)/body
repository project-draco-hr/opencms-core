{
  CmsPermissionSet permissions;
  int allowed=0, denied=0;
  if (this.getProject().isOnlineProject())   denied|=C_PERMISSION_WRITE;
  I_CmsResourceType resType=getResourceType(getUser(),getProject(),resource.getType());
  if (("XMLTemplate".equals(resType.getResourceTypeName()) || "jsp".equals(resType.getResourceTypeName())) && !isAdmin(getUser(),getProject()))   denied|=C_PERMISSION_WRITE;
  if (resource.isLocked()) {
    if (!this.getUser().getId().equals(resource.isLockedBy()))     denied|=C_PERMISSION_WRITE | C_PERMISSION_READ;
    if ((this.getProject().getId() != resource.getLockedInProject()) && !isTempfileProject(readProject(resource.getLockedInProject()))) {
      if (isTempfileProject(this.getProject())) {
        denied|=C_PERMISSION_WRITE;
      }
 else {
        denied|=C_PERMISSION_WRITE | C_PERMISSION_READ;
      }
    }
  }
  if (isAdmin(getUser(),getProject())) {
    permissions=new CmsPermissionSet(~0);
  }
 else {
    CmsAccessControlList acl=getAccessControlList(getUser(),getProject(),resource);
    permissions=acl.getPermissions(getUser(),getGroupsOfUser(getUser(),getUser().getName()));
  }
  permissions.denyPermissions(denied);
  return permissions;
}
