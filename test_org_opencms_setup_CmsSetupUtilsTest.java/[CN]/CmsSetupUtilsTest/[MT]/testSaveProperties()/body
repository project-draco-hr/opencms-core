{
  CmsSetupUtils utils=new CmsSetupUtils("");
  utils.setConfigPath("");
  String inputFile=System.getProperty("user.dir") + PROPERTIES;
  String outputFile=System.getProperty("java.io.tmpdir") + "output.properties";
  System.err.println("Reading properties from " + inputFile);
  ExtendedProperties oldProperties=CmsSetupUtils.loadProperties(inputFile);
  System.err.println("Writing properties to " + outputFile);
  utils.copyFile(inputFile,outputFile);
  utils.saveProperties(oldProperties,outputFile,false);
  System.err.println("Checking properties from " + outputFile);
  ExtendedProperties newProperties=CmsSetupUtils.loadProperties(outputFile);
  for (Iterator i=oldProperties.keySet().iterator(); i.hasNext(); ) {
    String key=(String)i.next();
    String oldValue="", newValue="";
    Object obj=oldProperties.get(key);
    if (obj instanceof Vector) {
      StringBuffer buf;
      buf=new StringBuffer();
      for (Iterator j=((Vector)obj).iterator(); j.hasNext(); ) {
        buf.append("[" + (String)j.next() + "]");
      }
      oldValue=buf.toString();
      buf=new StringBuffer();
      for (Iterator j=((Vector)newProperties.get(key)).iterator(); j.hasNext(); ) {
        buf.append("[" + (String)j.next() + "]");
      }
      newValue=buf.toString();
    }
 else {
      oldValue=(String)obj;
      newValue=(String)newProperties.get(key);
    }
    System.err.println(key);
    System.err.println(oldValue);
    System.err.println(newValue);
    System.err.println("---");
    assertEquals(oldValue,newValue);
  }
}
