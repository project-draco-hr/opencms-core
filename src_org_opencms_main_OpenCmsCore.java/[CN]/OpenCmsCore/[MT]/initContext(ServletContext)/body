{
  String servletMapping=context.getInitParameter("OpenCmsServlet");
  if (servletMapping == null) {
    m_instance=null;
    throw new CmsInitException("OpenCms servlet mapping not configured in 'web.xml', please set the 'OpenCmsServlet' parameter.");
  }
  String base=context.getInitParameter("opencms.home");
  if (base == null || "".equals(base)) {
    base=searchWebInfFolder(context.getRealPath("/"));
    if (base == null || "".equals(base)) {
      throwInitException(new CmsInitException(C_ERRORMSG + "OpenCms base folder could not be guessed. Please define init parameter \"opencms.home\" in servlet engine configuration.\n\n"));
    }
  }
  String defaultWebApplication=context.getInitParameter("DefaultWebApplication");
  if (defaultWebApplication == null) {
    defaultWebApplication="ROOT";
  }
  getSystemInfo().init(base,servletMapping,defaultWebApplication);
  ExtendedProperties configuration=null;
  try {
    configuration=CmsPropertyUtils.loadProperties(getSystemInfo().getConfigurationFileRfsPath());
  }
 catch (  Exception e) {
    throwInitException(new CmsInitException(C_ERRORMSG + "Trouble reading property file " + getSystemInfo().getConfigurationFileRfsPath()+ ".\n\n",e));
  }
  if (configuration.getBoolean("wizard.enabled",true)) {
    m_instance=null;
    throw new CmsInitException("OpenCms setup wizard is enabled, unable to start OpenCms",CmsInitException.C_INIT_WIZARD_ENABLED);
  }
  String logfile=(String)configuration.get("log.file");
  if (logfile != null) {
    logfile=getSystemInfo().getAbsoluteRfsPathRelativeToWebInf(logfile);
    configuration.put("log.file",logfile);
  }
  getSystemInfo().setLogFileRfsPath(logfile);
  m_log.init(configuration,getSystemInfo().getConfigurationFileRfsPath());
  System.err.println("\n\nStarting OpenCms, version " + OpenCms.getSystemInfo().getVersionName() + " in web application '"+ getSystemInfo().getWebApplicationName()+ "'");
  for (int i=0; i < I_CmsConstants.C_COPYRIGHT.length; i++) {
    System.err.println(I_CmsConstants.C_COPYRIGHT[i]);
  }
  System.err.println();
  if (getLog(CmsLog.CHANNEL_INIT).isInfoEnabled()) {
    getLog(CmsLog.CHANNEL_INIT).info(".");
    getLog(CmsLog.CHANNEL_INIT).info(".");
    getLog(CmsLog.CHANNEL_INIT).info(".");
    getLog(CmsLog.CHANNEL_INIT).info(".");
    getLog(CmsLog.CHANNEL_INIT).info(". OpenCms version " + OpenCms.getSystemInfo().getVersionName());
    for (int i=0; i < I_CmsConstants.C_COPYRIGHT.length; i++) {
      getLog(CmsLog.CHANNEL_INIT).info(". " + I_CmsConstants.C_COPYRIGHT[i]);
    }
    getLog(CmsLog.CHANNEL_INIT).info(".                      ...............................................................");
    getLog(CmsLog.CHANNEL_INIT).info(". Startup time         : " + (new Date(System.currentTimeMillis())));
    getLog(CmsLog.CHANNEL_INIT).info(". Servlet container    : " + context.getServerInfo());
    getLog(CmsLog.CHANNEL_INIT).info(". OpenCms version      : " + getSystemInfo().getVersionName());
    getLog(CmsLog.CHANNEL_INIT).info(". OpenCms webapp name  : " + getSystemInfo().getWebApplicationName());
    getLog(CmsLog.CHANNEL_INIT).info(". OpenCms servlet path : " + getSystemInfo().getServletPath());
    getLog(CmsLog.CHANNEL_INIT).info(". OpenCms context      : " + getSystemInfo().getOpenCmsContext());
    getLog(CmsLog.CHANNEL_INIT).info(". OpenCms WEB-INF path : " + getSystemInfo().getWebInfRfsPath());
    getLog(CmsLog.CHANNEL_INIT).info(". OpenCms property file: " + getSystemInfo().getConfigurationFileRfsPath());
    getLog(CmsLog.CHANNEL_INIT).info(". OpenCms log file     : " + getSystemInfo().getLogFileRfsPath());
  }
  try {
    initConfiguration(configuration);
  }
 catch (  CmsException cmsex) {
    if (cmsex.getType() == CmsException.C_RB_INIT_ERROR) {
      throwInitException(new CmsInitException(C_ERRORMSG + "Could not connect to the database. Is the database up and running?\n\n",cmsex));
    }
  }
catch (  Exception exc) {
    throwInitException(new CmsInitException(C_ERRORMSG + "Trouble creating the com.opencms.core.CmsObject. Please check the root cause for more information.\n\n",exc));
  }
  m_staticExportManager=CmsStaticExportManager.initialize(configuration,null);
  m_sessionInfoManager=new CmsSessionInfoManager();
  if (getLog(CmsLog.CHANNEL_INIT).isInfoEnabled()) {
    getLog(CmsLog.CHANNEL_INIT).info(". Session storage      : initialized");
  }
  try {
    List resourceHandlers=OpenCms.getRegistry().getSystemSubNodes("requesthandler");
    Iterator i=resourceHandlers.iterator();
    while (i.hasNext()) {
      String currentClass=(String)i.next();
      try {
        I_CmsRequestHandler handler=(I_CmsRequestHandler)Class.forName(currentClass).newInstance();
        addRequestHandler(handler);
        if (getLog(CmsLog.CHANNEL_INIT).isInfoEnabled()) {
          getLog(CmsLog.CHANNEL_INIT).info(". Request handler class: " + currentClass + " instanciated");
        }
      }
 catch (      Exception e1) {
        if (getLog(CmsLog.CHANNEL_INIT).isWarnEnabled()) {
          getLog(CmsLog.CHANNEL_INIT).warn(". Request handler class: non-critical error " + e1.toString());
        }
      }
    }
  }
 catch (  Exception e2) {
    if (getLog(CmsLog.CHANNEL_INIT).isWarnEnabled()) {
      getLog(CmsLog.CHANNEL_INIT).warn(". Request handler class: non-critical error " + e2.toString());
    }
  }
  m_useBasicAuthentication=configuration.getBoolean("auth.basic",true);
  m_authenticationFormURI=configuration.getString("auth.form_uri",I_CmsWpConstants.C_VFS_PATH_WORKPLACE + "action/authenticate.html");
  if (m_sessionManager != null) {
    if (getLog(CmsLog.CHANNEL_INIT).isInfoEnabled()) {
      getLog(CmsLog.CHANNEL_INIT).info(". Session manager      : initialized");
    }
  }
 else {
    getLog(CmsLog.CHANNEL_INIT).error(". Session manager     : NOT initialized");
  }
  try {
    Hashtable startupNode=OpenCms.getRegistry().getSystemValues("startup");
    if (startupNode != null) {
      for (int i=1; i <= startupNode.size(); i++) {
        String currentClass=(String)startupNode.get("class" + i);
        try {
          Class.forName(currentClass).newInstance();
          if (getLog(CmsLog.CHANNEL_INIT).isInfoEnabled()) {
            getLog(CmsLog.CHANNEL_INIT).info(". Startup class init   : " + currentClass + " instanciated");
          }
        }
 catch (        Exception e1) {
          if (getLog(CmsLog.CHANNEL_INIT).isWarnEnabled()) {
            getLog(CmsLog.CHANNEL_INIT).warn(". Startup class init   : non-critical error " + e1.toString());
          }
        }
      }
    }
  }
 catch (  Exception e2) {
    if (getLog(CmsLog.CHANNEL_INIT).isWarnEnabled()) {
      getLog(CmsLog.CHANNEL_INIT).warn(". Startup class init   : non-critical error " + e2.toString());
    }
  }
  if (getLog(CmsLog.CHANNEL_INIT).isInfoEnabled()) {
    getLog(CmsLog.CHANNEL_INIT).info(". Startup class init   : finished");
  }
}
