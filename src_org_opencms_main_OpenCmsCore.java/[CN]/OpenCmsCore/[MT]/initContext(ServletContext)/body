{
  initVersion(this);
  String base=context.getInitParameter("opencms.home");
  if (base == null || "".equals(base)) {
    base=CmsMain.searchBaseFolder(context.getRealPath("/"));
    if (base == null || "".equals(base)) {
      throwInitException(new CmsInitException(C_ERRORMSG + "OpenCms base folder could not be guessed. Please define init parameter \"opencms.home\" in servlet engine configuration.\n\n"));
    }
  }
  base=setBasePath(base);
  ExtendedProperties configuration=null;
  try {
    configuration=CmsSetupUtils.loadProperties(CmsBase.getPropertiesPath(true));
  }
 catch (  Exception e) {
    throwInitException(new CmsInitException(C_ERRORMSG + "Trouble reading property file " + CmsBase.getPropertiesPath(true)+ ".\n\n",e));
  }
  m_logfile=(String)configuration.get("log.file");
  if (m_logfile != null) {
    m_logfile=CmsBase.getAbsolutePath(m_logfile);
    configuration.put("log.file",m_logfile);
  }
  String servletMapping=context.getInitParameter("OpenCmsServlet");
  if (servletMapping == null) {
    m_instance=null;
    throw new CmsInitException("OpenCms servlet mapping not configured in 'web.xml'");
  }
  if (servletMapping.endsWith("/*")) {
    servletMapping=servletMapping.substring(0,servletMapping.length() - 2);
  }
  configuration.put("servlet.mapping",servletMapping);
  if (configuration.getBoolean("wizard.enabled",true)) {
    m_instance=null;
    throw new CmsInitException("OpenCms setup wizard is enabled, unable to start OpenCms context",CmsInitException.C_INIT_WIZARD_ENABLED);
  }
  initLogging(configuration);
  if (getLog(CmsLog.CHANNEL_INIT).isInfoEnabled()) {
    getLog(CmsLog.CHANNEL_INIT).info(".");
    getLog(CmsLog.CHANNEL_INIT).info(".");
    getLog(CmsLog.CHANNEL_INIT).info(".");
    getLog(CmsLog.CHANNEL_INIT).info(".");
    printCopyrightInformation();
    getLog(CmsLog.CHANNEL_INIT).info(".                      ...............................................................");
    getLog(CmsLog.CHANNEL_INIT).info(". Startup time         : " + (new Date(System.currentTimeMillis())));
    getLog(CmsLog.CHANNEL_INIT).info(". OpenCms version      : " + OpenCms.getVersionName());
    getLog(CmsLog.CHANNEL_INIT).info(". OpenCms context path : /" + CmsBase.getWebAppName());
    getLog(CmsLog.CHANNEL_INIT).info(". OpenCms servlet path : " + servletMapping);
    getLog(CmsLog.CHANNEL_INIT).info(". OpenCms base path    : " + getBasePath());
    getLog(CmsLog.CHANNEL_INIT).info(". OpenCms property file: " + CmsBase.getPropertiesPath(true));
    getLog(CmsLog.CHANNEL_INIT).info(". OpenCms logfile      : " + m_logfile);
    getLog(CmsLog.CHANNEL_INIT).info(". Servlet container    : " + context.getServerInfo());
  }
  try {
    initConfiguration(configuration);
  }
 catch (  CmsException cmsex) {
    if (cmsex.getType() == CmsException.C_RB_INIT_ERROR) {
      throwInitException(new CmsInitException(C_ERRORMSG + "Could not connect to the database. Is the database up and running?\n\n",cmsex));
    }
  }
catch (  Exception exc) {
    throwInitException(new CmsInitException(C_ERRORMSG + "Trouble creating the com.opencms.core.CmsObject. Please check the root cause for more information.\n\n",exc));
  }
  m_exportProperties=new CmsStaticExportManager();
  m_exportProperties.setStaticExportEnabled("true".equalsIgnoreCase(configuration.getString("staticexport.enabled","false")));
  m_exportProperties.setExportPropertyDefault("true".equalsIgnoreCase(configuration.getString("staticexport.export_default","false")));
  String[] exportSuffixes=configuration.getStringArray("staticexport.export_suffixes");
  if (exportSuffixes == null) {
    exportSuffixes=new String[0];
  }
  m_exportProperties.setExportSuffixes(exportSuffixes);
  m_exportProperties.setExportPath(com.opencms.boot.CmsBase.getAbsoluteWebPath(CmsBase.getAbsoluteWebPath(configuration.getString("staticexport.export_path"))));
  String servletName=configuration.getString("servlet.mapping");
  String contextName="/" + CmsBase.getWebAppName();
  if ("/ROOT".equals(contextName)) {
    contextName="";
  }
  configuration.setProperty("CONTEXT_NAME",contextName);
  configuration.setProperty("SERVLET_NAME",servletName);
  String rfsPrefix=configuration.getString("staticexport.prefix_rfs",contextName + "/export");
  String vfsPrefix=configuration.getString("staticexport.prefix_vfs",contextName + servletName);
  m_exportProperties.setRfsPrefix(rfsPrefix);
  m_exportProperties.setVfsPrefix(vfsPrefix);
  m_exportProperties.setExportRelativeLinks(configuration.getBoolean("staticexport.relative_links",false));
  m_exportProperties.setExportnames();
  if (getLog(CmsLog.CHANNEL_INIT).isInfoEnabled()) {
    getLog(CmsLog.CHANNEL_INIT).info(". Static export        : " + (m_exportProperties.isStaticExportEnabled() ? "enabled" : "disabled"));
    if (m_exportProperties.isStaticExportEnabled()) {
      getLog(CmsLog.CHANNEL_INIT).info(". Export default       : " + m_exportProperties.getExportPropertyDefault());
      getLog(CmsLog.CHANNEL_INIT).info(". Export path          : " + m_exportProperties.getExportPath());
      getLog(CmsLog.CHANNEL_INIT).info(". Export rfs prefix    : " + m_exportProperties.getRfsPrefix());
      getLog(CmsLog.CHANNEL_INIT).info(". Export vfs prefix    : " + m_exportProperties.getVfsPrefix());
      getLog(CmsLog.CHANNEL_INIT).info(". Export link style    : " + (m_exportProperties.relativLinksInExport() ? "relative" : "absolute"));
    }
  }
  m_sessionStorage=new CmsCoreSession();
  if (getLog(CmsLog.CHANNEL_INIT).isInfoEnabled()) {
    getLog(CmsLog.CHANNEL_INIT).info(". Session storage      : initialized");
  }
  try {
    List resourceHandlers=OpenCms.getRegistry().getSystemSubNodes("requesthandler");
    Iterator i=resourceHandlers.iterator();
    while (i.hasNext()) {
      String currentClass=(String)i.next();
      try {
        I_CmsRequestHandler handler=(I_CmsRequestHandler)Class.forName(currentClass).newInstance();
        addRequestHandler(handler);
        if (getLog(CmsLog.CHANNEL_INIT).isInfoEnabled()) {
          getLog(CmsLog.CHANNEL_INIT).info(". Request handler class: " + currentClass + " instanciated");
        }
      }
 catch (      Exception e1) {
        if (getLog(CmsLog.CHANNEL_INIT).isWarnEnabled()) {
          getLog(CmsLog.CHANNEL_INIT).warn(". Request handler class: non-critical error " + e1.toString());
        }
      }
    }
  }
 catch (  Exception e2) {
    if (getLog(CmsLog.CHANNEL_INIT).isWarnEnabled()) {
      getLog(CmsLog.CHANNEL_INIT).warn(". Request handler class: non-critical error " + e2.toString());
    }
  }
  m_useBasicAuthentication=configuration.getBoolean("auth.basic",true);
  m_authenticationFormURI=configuration.getString("auth.form_uri",I_CmsWpConstants.C_VFS_PATH_WORKPLACE + "action/authenticate.html");
}
