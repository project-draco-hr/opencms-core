{
  CmsException tmpException=null;
  CmsResource resource;
  try {
    resource=cms.readDefaultFile(resourceName);
  }
 catch (  CmsException e) {
    tmpException=e;
    resource=null;
  }
  if (resource != null) {
    cms.getRequestContext().setUri(cms.getSitePath(resource));
    if (resource.isInternal()) {
      throw new CmsException(Messages.get().container(Messages.ERR_READ_INTERNAL_RESOURCE_1,cms.getRequestContext().getUri()));
    }
    if (cms.getRequestContext().getCurrentProject().isOnlineProject()) {
      boolean secure=Boolean.valueOf(cms.readPropertyObject(cms.getSitePath(resource),CmsPropertyDefinition.PROPERTY_SECURE,true).getValue()).booleanValue();
      if (secure) {
        CmsSite site=OpenCms.getSiteManager().getCurrentSite(cms);
        String secureUrl=null;
        try {
          secureUrl=site.getSecureUrl();
        }
 catch (        Exception e) {
          LOG.error(Messages.get().getBundle().key(Messages.ERR_SECURE_SITE_NOT_CONFIGURED_1,resourceName),e);
          throw new CmsException(Messages.get().container(Messages.ERR_SECURE_SITE_NOT_CONFIGURED_1,resourceName),e);
        }
        boolean usingSec=true;
        if (req != null) {
          usingSec=req.getRequestURL().toString().toUpperCase().startsWith(secureUrl.toUpperCase());
        }
        if (site.isExclusiveUrl() && !usingSec) {
          resource=null;
          if (site.isExclusiveError()) {
            throw new CmsVfsResourceNotFoundException(Messages.get().container(Messages.ERR_REQUEST_SECURE_RESOURCE_0));
          }
 else {
            String target=OpenCms.getLinkManager().getOnlineLink(cms,cms.getRequestContext().getUri());
            try {
              res.sendRedirect(target);
            }
 catch (            Exception e) {
            }
          }
        }
      }
    }
  }
  boolean clearErrors=false;
  for (  I_CmsResourceInit handler : m_resourceInitHandlers) {
    try {
      resource=handler.initResource(resource,cms,req,res);
    }
 catch (    CmsResourceInitException e) {
      if (e.isClearErrors()) {
        tmpException=null;
        clearErrors=true;
      }
      break;
    }
catch (    CmsSecurityException e) {
      tmpException=e;
      break;
    }
  }
  if (resource == null) {
    if (tmpException != null) {
      throw tmpException;
    }
 else     if (!clearErrors) {
      throw new CmsVfsResourceNotFoundException(org.opencms.main.Messages.get().container(org.opencms.main.Messages.ERR_PATH_NOT_FOUND_1,resourceName));
    }
  }
  return resource;
}
