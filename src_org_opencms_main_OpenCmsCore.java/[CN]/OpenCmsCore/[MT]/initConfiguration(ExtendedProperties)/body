{
  String setEncoding=configuration.getString("defaultContentEncoding",OpenCms.getSystemInfo().getDefaultEncoding());
  String defaultEncoding=CmsEncoder.lookupEncoding(setEncoding,null);
  if (defaultEncoding == null) {
    String msg="OpenCms startup failure: Configured encoding '" + setEncoding + "' not supported by the Java VM";
    getLog(this).fatal(OpenCmsCore.C_MSG_CRITICAL_ERROR + "1: " + msg);
    throw new Exception(msg);
  }
  if (getLog(CmsLog.CHANNEL_INIT).isInfoEnabled()) {
    getLog(CmsLog.CHANNEL_INIT).info(". OpenCms encoding     : " + defaultEncoding);
  }
  String systemEncoding=null;
  try {
    systemEncoding=System.getProperty("file.encoding");
  }
 catch (  SecurityException se) {
  }
  if (getLog(CmsLog.CHANNEL_INIT).isInfoEnabled()) {
    getLog(CmsLog.CHANNEL_INIT).info(". System file.encoding : " + systemEncoding);
  }
  getSystemInfo().setDefaultEncoding(defaultEncoding);
  String ethernetAddress=configuration.getString("server.ethernet.address",CmsUUID.getDummyEthernetAddress());
  if (getLog(CmsLog.CHANNEL_INIT).isInfoEnabled()) {
    getLog(CmsLog.CHANNEL_INIT).info(". Ethernet address used: " + ethernetAddress);
  }
  CmsUUID.init(ethernetAddress);
  String serverName=configuration.getString("server.name","OpenCmsServer");
  getSystemInfo().setServerName(serverName);
  m_lockManager=CmsLockManager.getInstance();
  m_memoryMonitor=CmsMemoryMonitor.initialize(configuration);
  try {
    if (getLog(CmsLog.CHANNEL_INIT).isInfoEnabled()) {
      String jdkinfo=System.getProperty("java.vm.name") + " ";
      jdkinfo+=System.getProperty("java.vm.version") + " ";
      jdkinfo+=System.getProperty("java.vm.info") + " ";
      jdkinfo+=System.getProperty("java.vm.vendor") + " ";
      getLog(CmsLog.CHANNEL_INIT).info(". Java VM in use       : " + jdkinfo);
      String osinfo=System.getProperty("os.name") + " ";
      osinfo+=System.getProperty("os.version") + " ";
      osinfo+=System.getProperty("os.arch") + " ";
      getLog(CmsLog.CHANNEL_INIT).info(". Operating sytem      : " + osinfo);
    }
  }
 catch (  Exception e) {
    if (getLog(this).isErrorEnabled()) {
      getLog(this).error(OpenCmsCore.C_MSG_CRITICAL_ERROR + "2",e);
    }
    throw e;
  }
  m_defaultUsers=CmsDefaultUsers.initialize(configuration);
  try {
    if (getLog(CmsLog.CHANNEL_INIT).isInfoEnabled()) {
      getLog(CmsLog.CHANNEL_INIT).info(". Flex cache init      : starting");
    }
    new CmsFlexCache(configuration);
    if (getLog(CmsLog.CHANNEL_INIT).isInfoEnabled()) {
      getLog(CmsLog.CHANNEL_INIT).info(". Flex cache init      : finished");
    }
  }
 catch (  Exception e) {
    if (getLog(CmsLog.CHANNEL_INIT).isWarnEnabled()) {
      getLog(CmsLog.CHANNEL_INIT).warn(". Flex cache init      : non-critical error " + e.toString());
    }
  }
  m_configurationManager=new CmsConfigurationManager(getSystemInfo().getAbsoluteRfsPathRelativeToWebInf("config/"));
  m_configurationManager.loadXmlConfiguration();
  m_configurationManager.setConfiguration(configuration);
  CmsSystemConfiguration systemConfiguration=(CmsSystemConfiguration)m_configurationManager.getConfiguration(CmsSystemConfiguration.class);
  getSystemInfo().setVersionHistorySettings(systemConfiguration.isVersionHistoryEnabled(),systemConfiguration.getVersionHistoryMaxCount());
  getSystemInfo().setMailSettings(systemConfiguration.getMailSettings());
  getSystemInfo().setSynchronizeSettings(new CmsSynchronizeSettings());
  m_scheduleManager=systemConfiguration.getScheduleManager();
  m_resourceInitHandlers=systemConfiguration.getResourceInitHandlers();
  Iterator it=systemConfiguration.getRequestHandlers().iterator();
  while (it.hasNext()) {
    I_CmsRequestHandler handler=(I_CmsRequestHandler)it.next();
    addRequestHandler(handler);
    if (getLog(CmsLog.CHANNEL_INIT).isInfoEnabled()) {
      getLog(CmsLog.CHANNEL_INIT).warn(". Request handler class: " + handler.getClass().getName() + " activated");
    }
  }
  m_siteManager=systemConfiguration.getSiteManager();
  CmsVfsConfiguration vfsConfiguation=(CmsVfsConfiguration)m_configurationManager.getConfiguration(CmsVfsConfiguration.class);
  m_resourceManager=vfsConfiguation.getResourceManager();
  m_xmlContentTypeManager=vfsConfiguation.getXmlContentTypeManager();
  m_defaultFiles=vfsConfiguation.getDefaultFiles();
  CmsImportExportConfiguration importExportConfiguration=(CmsImportExportConfiguration)m_configurationManager.getConfiguration(CmsImportExportConfiguration.class);
  m_importExportManager=importExportConfiguration.getImportExportManager();
  m_staticExportManager=importExportConfiguration.getStaticExportManager();
  CmsSearchConfiguration searchConfiguration=(CmsSearchConfiguration)m_configurationManager.getConfiguration(CmsSearchConfiguration.class);
  m_searchManager=searchConfiguration.getSearchManager();
  CmsWorkplaceConfiguration workplaceConfiguration=(CmsWorkplaceConfiguration)m_configurationManager.getConfiguration(CmsWorkplaceConfiguration.class);
  m_workplaceManager=workplaceConfiguration.getWorkplaceManager();
  addExportPoints(m_workplaceManager.getExportPoints());
  CmsModuleConfiguration moduleConfiguration=(CmsModuleConfiguration)m_configurationManager.getConfiguration(CmsModuleConfiguration.class);
  m_moduleManager=moduleConfiguration.getModuleManager();
  m_passwordHandler=systemConfiguration.getPasswordHandler();
  try {
    m_securityManager=CmsSecurityManager.newInstance(m_configurationManager,systemConfiguration.getRuntimeInfoFactory());
  }
 catch (  Exception e) {
    if (getLog(this).isErrorEnabled()) {
      getLog(this).error(OpenCmsCore.C_MSG_CRITICAL_ERROR + "3",e);
    }
    throw new CmsException("Database init failed",CmsException.C_RB_INIT_ERROR,e);
  }
  m_threadStore=new CmsThreadStore();
  m_linkManager=new CmsLinkManager();
  m_directoryTranslator=vfsConfiguation.getFolderTranslator();
  m_fileTranslator=vfsConfiguation.getFileTranslator();
  if (m_runtimeProperties == null) {
    m_runtimeProperties=Collections.synchronizedMap(new HashMap());
  }
  m_runtimeProperties.putAll(systemConfiguration.getRuntimeProperties());
  CmsObject adminCms=initCmsObject(null,null,getDefaultUsers().getUserAdmin(),null);
  m_scheduleManager.initialize(adminCms);
  m_workplaceManager.initialize(adminCms);
  m_localeManager=systemConfiguration.getLocaleManager();
  m_localeManager.initialize(adminCms);
  m_siteManager.initialize(adminCms);
  m_searchManager.initialize(adminCms);
  m_staticExportManager.initialize(adminCms);
  m_xmlContentTypeManager.initialize(adminCms);
  m_moduleManager.initialize(adminCms,m_configurationManager);
  m_resourceManager.initialize(adminCms);
}
