{
  String systemEncoding=null;
  try {
    systemEncoding=System.getProperty("file.encoding");
  }
 catch (  SecurityException se) {
  }
  if (CmsLog.LOG.isInfoEnabled()) {
    CmsLog.LOG.info(". System file.encoding : " + systemEncoding);
  }
  String ethernetAddress=configuration.getString("server.ethernet.address",CmsUUID.getDummyEthernetAddress());
  if (CmsLog.LOG.isInfoEnabled()) {
    CmsLog.LOG.info(". Ethernet address used: " + ethernetAddress);
  }
  try {
    CmsUUID.init(ethernetAddress);
  }
 catch (  CmsException e) {
    throw new CmsInitException(Messages.get().container(Messages.ERR_CRITICAL_INIT_GENERIC_1,e.getMessage()),e);
  }
  String serverName=configuration.getString("server.name","OpenCmsServer");
  getSystemInfo().setServerName(serverName);
  m_lockManager=CmsLockManager.getInstance();
  try {
    if (CmsLog.LOG.isInfoEnabled()) {
      String jdkinfo=System.getProperty("java.vm.name") + " ";
      jdkinfo+=System.getProperty("java.vm.version") + " ";
      jdkinfo+=System.getProperty("java.vm.info") + " ";
      jdkinfo+=System.getProperty("java.vm.vendor") + " ";
      CmsLog.LOG.info(". Java VM in use       : " + jdkinfo);
      String osinfo=System.getProperty("os.name") + " ";
      osinfo+=System.getProperty("os.version") + " ";
      osinfo+=System.getProperty("os.arch") + " ";
      CmsLog.LOG.info(". Operating sytem      : " + osinfo);
    }
  }
 catch (  Exception e) {
    throw new CmsInitException(Messages.get().container(Messages.ERR_CRITICAL_INIT_PROP_0),e);
  }
  m_memoryMonitor=new CmsMemoryMonitor();
  m_configurationManager=new CmsConfigurationManager(getSystemInfo().getAbsoluteRfsPathRelativeToWebInf("config/"));
  try {
    m_configurationManager.loadXmlConfiguration();
  }
 catch (  Exception e) {
    throw new CmsInitException(Messages.get().container(Messages.ERR_CRITICAL_INIT_XML_0),e);
  }
  m_configurationManager.setConfiguration(configuration);
  CmsSystemConfiguration systemConfiguration=(CmsSystemConfiguration)m_configurationManager.getConfiguration(CmsSystemConfiguration.class);
  String setEncoding=systemConfiguration.getDefaultContentEncoding();
  String defaultEncoding=CmsEncoder.lookupEncoding(setEncoding,null);
  if (defaultEncoding == null) {
    throw new CmsInitException(Messages.get().container(Messages.ERR_CRITICAL_INIT_ENCODING_1,setEncoding));
  }
  if (CmsLog.LOG.isInfoEnabled()) {
    CmsLog.LOG.info(". OpenCms encoding     : " + defaultEncoding);
  }
  getSystemInfo().setDefaultEncoding(defaultEncoding);
  CmsMemoryMonitorConfiguration memoryMonitorConfiguration=systemConfiguration.getCmsMemoryMonitorConfiguration();
  m_memoryMonitor.initialize(memoryMonitorConfiguration);
  getSystemInfo().setVersionHistorySettings(systemConfiguration.isVersionHistoryEnabled(),systemConfiguration.getVersionHistoryMaxCount());
  getSystemInfo().setMailSettings(systemConfiguration.getMailSettings());
  getSystemInfo().setSynchronizeSettings(new CmsSynchronizeSettings());
  m_scheduleManager=systemConfiguration.getScheduleManager();
  m_resourceInitHandlers=systemConfiguration.getResourceInitHandlers();
  Iterator it=systemConfiguration.getRequestHandlers().iterator();
  while (it.hasNext()) {
    I_CmsRequestHandler handler=(I_CmsRequestHandler)it.next();
    addRequestHandler(handler);
    if (CmsLog.LOG.isInfoEnabled()) {
      CmsLog.LOG.warn(". Request handler class: " + handler.getClass().getName() + " activated");
    }
  }
  m_defaultUsers=systemConfiguration.getCmsDefaultUsers();
  m_siteManager=systemConfiguration.getSiteManager();
  CmsVfsConfiguration vfsConfiguation=(CmsVfsConfiguration)m_configurationManager.getConfiguration(CmsVfsConfiguration.class);
  m_resourceManager=vfsConfiguation.getResourceManager();
  m_xmlContentTypeManager=vfsConfiguation.getXmlContentTypeManager();
  m_defaultFiles=vfsConfiguation.getDefaultFiles();
  m_resourceManager.setTranslators(vfsConfiguation.getFolderTranslator(),vfsConfiguation.getFileTranslator());
  CmsFlexCache flexCache=null;
  try {
    if (CmsLog.LOG.isInfoEnabled()) {
      CmsLog.LOG.info(". Flex cache init      : starting");
    }
    CmsFlexCacheConfiguration flexCacheConfiguration=systemConfiguration.getCmsFlexCacheConfiguration();
    flexCache=new CmsFlexCache(flexCacheConfiguration);
    if (CmsLog.LOG.isInfoEnabled()) {
      CmsLog.LOG.info(". Flex cache init      : finished");
    }
  }
 catch (  Exception e) {
    if (CmsLog.LOG.isWarnEnabled()) {
      CmsLog.LOG.warn(". Flex cache init      : non-critical error " + e.toString());
    }
  }
  if (flexCache != null) {
    Iterator i=m_resourceManager.getLoaders().iterator();
    while (i.hasNext()) {
      Object o=i.next();
      if (o instanceof I_CmsFlexCacheEnabledLoader) {
        ((I_CmsFlexCacheEnabledLoader)o).setFlexCache(flexCache);
      }
    }
  }
  CmsImportExportConfiguration importExportConfiguration=(CmsImportExportConfiguration)m_configurationManager.getConfiguration(CmsImportExportConfiguration.class);
  m_importExportManager=importExportConfiguration.getImportExportManager();
  m_staticExportManager=importExportConfiguration.getStaticExportManager();
  CmsSearchConfiguration searchConfiguration=(CmsSearchConfiguration)m_configurationManager.getConfiguration(CmsSearchConfiguration.class);
  m_searchManager=searchConfiguration.getSearchManager();
  CmsWorkplaceConfiguration workplaceConfiguration=(CmsWorkplaceConfiguration)m_configurationManager.getConfiguration(CmsWorkplaceConfiguration.class);
  m_workplaceManager=workplaceConfiguration.getWorkplaceManager();
  addExportPoints(m_workplaceManager.getExportPoints());
  CmsModuleConfiguration moduleConfiguration=(CmsModuleConfiguration)m_configurationManager.getConfiguration(CmsModuleConfiguration.class);
  m_moduleManager=moduleConfiguration.getModuleManager();
  m_passwordHandler=systemConfiguration.getPasswordHandler();
  try {
    m_securityManager=CmsSecurityManager.newInstance(m_configurationManager,systemConfiguration.getRuntimeInfoFactory());
  }
 catch (  CmsException e) {
    throw new CmsInitException(Messages.get().container(Messages.ERR_CRITICAL_INIT_DATABASE_0),e);
  }
  m_threadStore=new CmsThreadStore();
  m_linkManager=new CmsLinkManager();
  if (m_runtimeProperties == null) {
    m_runtimeProperties=Collections.synchronizedMap(new HashMap());
  }
  m_runtimeProperties.putAll(systemConfiguration.getRuntimeProperties());
  CmsObject adminCms;
  try {
    adminCms=initCmsObject(null,null,getDefaultUsers().getUserAdmin(),null);
  }
 catch (  CmsException e) {
    throw new CmsInitException(Messages.get().container(Messages.ERR_CRITICAL_INIT_ADMINCMS_0),e);
  }
  try {
    m_scheduleManager.initialize(adminCms);
    m_workplaceManager.initialize(adminCms);
    m_localeManager=systemConfiguration.getLocaleManager();
    m_localeManager.initialize(adminCms);
    m_siteManager.initialize(adminCms);
    m_staticExportManager.initialize(adminCms);
    m_xmlContentTypeManager.initialize(adminCms);
    m_moduleManager.initialize(adminCms,m_configurationManager);
    m_resourceManager.initialize(adminCms);
    m_searchManager.initialize(adminCms);
  }
 catch (  CmsException e) {
    throw new CmsInitException(Messages.get().container(Messages.ERR_CRITICAL_INIT_MANAGERS_0),e);
  }
}
