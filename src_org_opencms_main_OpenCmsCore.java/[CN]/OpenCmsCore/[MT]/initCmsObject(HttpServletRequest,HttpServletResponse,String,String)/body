{
  String siteroot=null;
  if ((req != null) && (res != null)) {
    siteroot=OpenCms.getSiteManager().matchRequest(req).getSiteRoot();
  }
  if (user == null) {
    user=getDefaultUsers().getUserGuest();
  }
  if (siteroot == null) {
    siteroot="/";
  }
  CmsObject cms=initCmsObject(req,user,siteroot,CmsProject.ONLINE_PROJECT_ID);
  if ((password != null) && !getDefaultUsers().getUserGuest().equals(user)) {
    cms.loginUser(user,password,CmsContextInfo.LOCALHOST);
  }
  return cms;
}
