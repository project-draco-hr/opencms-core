{
  CmsRequestHttpServlet cmsReq=null;
  CmsResponseHttpServlet cmsRes=null;
  String siteroot=null;
  if ((req != null) && (res != null)) {
    try {
      initStartupClasses(req,res);
      cmsReq=new CmsRequestHttpServlet(req,getFileTranslator());
      cmsRes=new CmsResponseHttpServlet(req,res);
      siteroot=OpenCms.getSiteManager().matchRequest(req).getSiteRoot();
    }
 catch (    IOException e) {
      throw new CmsException("Exception initializing CmsObject for user " + user,CmsException.C_UNKNOWN_EXCEPTION,e);
    }
  }
  if (user == null) {
    user=getDefaultUsers().getUserGuest();
  }
  if (siteroot == null) {
    siteroot="/";
  }
  CmsObject cms=initCmsObject(cmsReq,cmsRes,user,siteroot,I_CmsConstants.C_PROJECT_ONLINE_ID,null);
  if ((password != null) && !getDefaultUsers().getUserGuest().equals(user)) {
    cms.loginUser(user,password,I_CmsConstants.C_IP_LOCALHOST);
  }
  return cms;
}
