{
  CmsObject adminCms;
  try {
    adminCms=initCmsObject(req,res,getDefaultUsers().getUserAdmin(),null);
  }
 catch (  CmsException e) {
    throw new IOException(Messages.get().key(Messages.ERR_INVALID_INIT_USER_2,getDefaultUsers().getUserAdmin(),null));
  }
  String path=adminCms.getRequestContext().getUri();
  CmsProperty propertyLoginForm=null;
  String redirectURL=null;
  try {
    propertyLoginForm=adminCms.readPropertyObject(path,I_CmsConstants.C_PROPERTY_LOGIN_FORM,true);
  }
 catch (  Throwable t) {
    if (LOG.isWarnEnabled()) {
      LOG.warn(Messages.get().key(Messages.LOG_ERROR_READING_AUTH_PROP_2,I_CmsConstants.C_PROPERTY_LOGIN_FORM,path),t);
    }
  }
  if (propertyLoginForm != null && propertyLoginForm != CmsProperty.getNullProperty() && CmsStringUtil.isNotEmpty(propertyLoginForm.getValue())) {
    redirectURL=propertyLoginForm.getValue() + "?__loginform=true&requestedResource=" + path;
  }
 else   if (!m_useBasicAuthentication && CmsStringUtil.isNotEmpty(m_authenticationFormURI)) {
    redirectURL=m_authenticationFormURI + "?requestedResource=" + path;
  }
  if (redirectURL == null) {
    res.setHeader(I_CmsConstants.C_HEADER_WWW_AUTHENTICATE,"BASIC realm=\"" + getSystemInfo().getOpenCmsContext() + "\"");
    res.setStatus(HttpServletResponse.SC_UNAUTHORIZED);
  }
 else {
    redirectURL=m_linkManager.substituteLink(adminCms,redirectURL);
    if (LOG.isDebugEnabled()) {
      Messages.get().key(Messages.LOG_AUTHENTICATE_PROPERTY_2,redirectURL,path);
    }
    res.sendRedirect(redirectURL);
  }
}
