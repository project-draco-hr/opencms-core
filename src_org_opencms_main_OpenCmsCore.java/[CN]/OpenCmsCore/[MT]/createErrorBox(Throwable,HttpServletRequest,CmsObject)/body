{
  StringBuffer result=new StringBuffer(8192);
  Properties htmlProps=new Properties();
  try {
    htmlProps.load(getClass().getClassLoader().getResourceAsStream(C_FILE_HTML_MESSAGES));
  }
 catch (  Throwable thr) {
    if (getLog(this).isErrorEnabled()) {
      getLog(this).error("Could not load " + C_FILE_HTML_MESSAGES,thr);
    }
  }
  CmsAcceptLanguageHeaderParser headerParser=new CmsAcceptLanguageHeaderParser(request);
  List locales=headerParser.getAcceptedLocales();
  Locale locale;
  if (locales != null && locales.size() > 0) {
    locale=(Locale)locales.get(0);
  }
 else {
    locale=Locale.ENGLISH;
  }
  CmsMessages messages=new CmsMessages(CmsWorkplaceMessages.C_BUNDLE_NAME,locale);
  result.append(htmlProps.getProperty("C_HTML_START"));
  result.append(messages.key("error.system.message"));
  result.append(htmlProps.getProperty("C_HEAD_START"));
  result.append(htmlProps.getProperty("C_STYLES"));
  result.append(htmlProps.getProperty("C_JAVASCRIPT_ERROR"));
  result.append(htmlProps.getProperty("C_HEAD_END"));
  result.append(messages.key("error.system.message"));
  result.append(htmlProps.getProperty("C_CONTENT_START"));
  result.append(htmlProps.getProperty("C_ERRORPART_1"));
  result.append(CmsWorkplace.getSkinUri(cms) + "explorer/report_error.gif");
  result.append(htmlProps.getProperty("C_ERRORPART_2"));
  if (t.getLocalizedMessage() != null) {
    result.append("<p><b>" + CmsStringSubstitution.substitute(t.getLocalizedMessage(),"\n","\n<br>") + "</b></p>");
  }
  result.append("<p>" + messages.key("error.system.resource") + ":<b> "+ cms.getRequestContext().getRequest().getRequestedResource()+ "</b><br>");
  result.append(messages.key("error.system.version") + ":<b> " + this.getSystemInfo().getVersionName()+ "</b><br>");
  result.append(messages.key("error.system.context") + ":<b> " + this.getSystemInfo().getOpenCmsContext()+ "</b></p>");
  result.append(htmlProps.getProperty("C_ERRORPART_3"));
  result.append(messages.key("button.detail"));
  result.append(htmlProps.getProperty("C_ERRORPART_4"));
  result.append(CmsStringSubstitution.substitute(CmsException.getStackTraceAsString(t),"\n","\n<br>"));
  result.append(htmlProps.getProperty("C_ERRORPART_5"));
  result.append(messages.key("button.close"));
  result.append(htmlProps.getProperty("C_ERRORPART_6"));
  result.append(htmlProps.getProperty("C_CONTENT_END"));
  result.append(htmlProps.getProperty("C_HTML_END"));
  return result.toString();
}
