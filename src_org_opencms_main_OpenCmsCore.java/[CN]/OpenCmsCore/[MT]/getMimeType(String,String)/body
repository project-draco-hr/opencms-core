{
  String mimetype=null;
  int lastDot=filename.lastIndexOf(".");
  if ((lastDot > 0) && (lastDot < (filename.length() - 1))) {
    String ext=filename.substring(lastDot + 1);
    mimetype=(String)m_mimeTypes.get(ext);
    if (mimetype == null) {
      mimetype=C_DEFAULT_MIMETYPE;
    }
  }
 else {
    mimetype=C_DEFAULT_MIMETYPE;
  }
  mimetype=mimetype.toLowerCase();
  if ((encoding != null) && mimetype.startsWith("text") && (mimetype.indexOf("charset") == -1)) {
    mimetype+="; charset=" + encoding;
  }
  return mimetype;
}
