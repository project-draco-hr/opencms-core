{
  m_action=m_actionOutputUpload;
  repaint();
  PostMethod post=new PostMethod(m_targetUrl);
  try {
    Part[] parts=new Part[4];
    parts[0]=new FilePart(uploadFile.getName(),uploadFile);
    parts[1]=new StringPart("action","submitform");
    parts[2]=new StringPart("unzipfile","true");
    parts[3]=new StringPart("uploadfolder",m_uploadFolder);
    HttpMethodParams methodParams=post.getParams();
    methodParams.setCookiePolicy(CookiePolicy.BROWSER_COMPATIBILITY);
    MultipartRequestEntity request=new MultipartRequestEntity(parts,methodParams);
    post.setRequestEntity(request);
    String sessionId=getParameter("sessionId");
    String query=";" + C_JSESSIONID.toLowerCase() + "="+ sessionId;
    post.setQueryString(query);
    post.addRequestHeader(C_JSESSIONID,sessionId);
    HttpClient client=new HttpClient();
    HttpConnectionParams connectionParams=client.getHttpConnectionManager().getParams();
    connectionParams.setConnectionTimeout(5000);
    client.getState();
    client.getHostConfiguration().getHost();
    HttpState initialState=new HttpState();
    URI uri=new URI(m_targetUrl,false);
    Cookie sessionCookie=new Cookie(uri.getHost(),C_JSESSIONID,sessionId,"/",null,false);
    initialState.addCookie(sessionCookie);
    client.setState(initialState);
    int status=client.executeMethod(post);
    if (status == HttpStatus.SC_OK) {
      getAppletContext().showDocument(new URL(m_redirectUrl),m_redirectTargetFrame);
    }
 else {
      if (status == HttpStatus.SC_MOVED_PERMANENTLY || status == HttpStatus.SC_MOVED_TEMPORARILY) {
        Header locationHeader=post.getResponseHeader("location");
        if (locationHeader != null) {
          String redirectLocation=locationHeader.getValue();
          post.setURI(new URI(redirectLocation,false));
          status=client.executeMethod(post);
          String error=m_errorLine1 + "\n" + post.getStatusLine();
          getAppletContext().showDocument(new URL(m_errorUrl + "?action=showerror&uploaderror=" + error),"explorer_files");
        }
      }
 else {
        String error=m_errorLine1 + "\n" + post.getStatusLine();
        getAppletContext().showDocument(new URL(m_errorUrl + "?action=showerror&uploaderror=" + error),"explorer_files");
      }
    }
  }
 catch (  RuntimeException e) {
    e.printStackTrace();
  }
catch (  Exception e) {
    e.printStackTrace();
  }
 finally {
    post.releaseConnection();
    uploadFile.delete();
  }
}
