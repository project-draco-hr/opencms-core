{
  m_action=m_actionOutputUpload;
  repaint();
  MultipartPostMethod filePost=new MultipartPostMethod(m_targetUrl);
  try {
    filePost.addParameter(uploadFile.getName(),uploadFile);
    filePost.addParameter("action","submitform");
    filePost.addParameter("unzipfile","true");
    filePost.addParameter("uploadfolder",m_uploadFolder);
    String sessionId=getParameter("sessionId");
    String query=";" + C_JSESSIONID.toLowerCase() + "="+ sessionId;
    filePost.setQueryString(query);
    HttpClient client=new HttpClient();
    client.setConnectionTimeout(5000);
    HttpState initialState=new HttpState();
    Cookie sessionCookie=new Cookie(filePost.getHostConfiguration().getHost(),C_JSESSIONID,sessionId,"/",null,false);
    initialState.addCookie(sessionCookie);
    initialState.setCookiePolicy(CookiePolicy.COMPATIBILITY);
    client.setState(initialState);
    int status=client.executeMethod(filePost);
    if (status == HttpStatus.SC_OK) {
      getAppletContext().showDocument(new URL(m_redirectUrl),m_redirectTargetFrame);
    }
 else {
      String error=m_errorLine1 + "\n" + filePost.getStatusLine();
      getAppletContext().showDocument(new URL(m_errorUrl + "?action=showerror&uploaderror=" + error),"explorer_files");
    }
  }
 catch (  Exception ex) {
    ex.printStackTrace();
  }
 finally {
    filePost.releaseConnection();
    uploadFile.delete();
  }
}
