{
  File targetFile=null;
  m_action=m_actionOutputCreate;
  try {
    String zipFileName=".opencms_upload.zip";
    String userHome=System.getProperty("user.home");
    if (userHome != null) {
      if (!userHome.endsWith(File.separator)) {
        userHome=userHome + File.separator;
      }
      zipFileName=userHome + zipFileName;
    }
    ZipOutputStream zipStream=new ZipOutputStream(new FileOutputStream(zipFileName));
    for (int i=0; i < files.length; i++) {
      if (files[i].isFile()) {
        addFileToZip(zipStream,files[i],files[i].getName());
      }
 else {
        addFolderToZip(zipStream,files[i],"");
      }
      repaint();
      files[i]=null;
    }
    zipStream.close();
    targetFile=new File(zipFileName);
  }
 catch (  Exception e) {
    System.err.println("Error creating zipfile " + e);
  }
  return targetFile;
}
