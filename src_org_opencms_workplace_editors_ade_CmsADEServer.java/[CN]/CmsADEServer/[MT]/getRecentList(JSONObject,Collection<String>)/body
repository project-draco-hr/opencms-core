{
  JSONArray result=new JSONArray();
  CmsObject cms=getCmsObject();
  CmsElementUtil elemUtil=new CmsElementUtil(cms,getRequest().getParameter(ReqParam.uri.toString()),getRequest(),getResponse());
  List<CmsContainerElementBean> recentList=m_sessionCache.getRecentList();
  for (  CmsContainerElementBean element : recentList) {
    if (cms.existsResource(element.getElementId(),CmsResourceFilter.ONLY_VISIBLE_NO_DELETED)) {
      String id=element.getClientId();
      if ((resElements != null) && !resElements.has(id)) {
        try {
          JSONObject elemData=elemUtil.getElementData(element,types);
          resElements.put(id,elemData);
          if (elemData.has(CmsElementUtil.JsonElement.SUBITEMS.getName())) {
            CmsResource elementRes=cms.readResource(element.getElementId());
            CmsXmlSubContainer xmlSubContainer=CmsXmlSubContainerFactory.unmarshal(cms,elementRes,getRequest());
            CmsSubContainerBean subContainer=xmlSubContainer.getSubContainer(cms,cms.getRequestContext().getLocale());
            for (            CmsContainerElementBean subElement : subContainer.getElements()) {
              String subId=subElement.getClientId();
              if (!resElements.has(subId)) {
                JSONObject subItemData=elemUtil.getElementData(subElement,types);
                resElements.put(subId,subItemData);
                m_sessionCache.setCacheContainerElement(subId,subElement);
              }
            }
          }
          result.put(id);
        }
 catch (        Exception e) {
          if (!LOG.isDebugEnabled()) {
            LOG.warn(e.getLocalizedMessage());
          }
          LOG.debug(e.getLocalizedMessage(),e);
        }
      }
 else {
        result.put(id);
      }
    }
  }
  return result;
}
