{
  CmsFlexController controller=CmsFlexController.getController(getRequest());
  controller.getTopResponse().setContentType(MIMETYPE_APPLICATION_JSON);
  JSONObject result=new JSONObject();
  try {
    String action=getRequest().getPathInfo();
    if (action.equals(RequestURI.GET.getName())) {
      result=executeActionGet();
    }
 else     if (action.equals(RequestURI.SET.getName())) {
      result=executeActionSet();
    }
 else {
      result.put(JsonResponse.ERROR.getName(),Messages.get().getBundle().key(Messages.ERR_JSON_INVALID_ACTION_URL_1,action));
    }
  }
 catch (  Exception e) {
    result.put(JsonResponse.ERROR.getName(),e.getLocalizedMessage() == null ? "NPE" : e.getLocalizedMessage());
    LOG.error(Messages.get().getBundle().key(Messages.ERR_SERVER_EXCEPTION_1,CmsRequestUtil.appendParameters(getRequest().getRequestURL().toString(),CmsRequestUtil.createParameterMap(getRequest().getQueryString()),false)),e);
  }
  if (result.has(JsonResponse.ERROR.getName())) {
    result.put(JsonResponse.STATE.getName(),JsonState.ERROR.getName());
  }
 else   if (!result.has(JsonResponse.STATE.getName())) {
    result.put(JsonResponse.STATE.getName(),JsonState.OK.getName());
  }
  result.write(getResponse().getWriter());
}
