{
  CmsObject cms=getCmsObject();
  CmsElementUtil elemUtil=new CmsElementUtil(cms,uriParam,request,getResponse());
  JSONObject resElements=new JSONObject();
  Set<String> ids=new HashSet<String>();
  for (int i=0; i < elements.length(); i++) {
    String elemId=elements.getString(i);
    if (ids.contains(elemId)) {
      continue;
    }
    CmsContainerElementBean element=getCachedElement(elemId);
    JSONObject elementData=elemUtil.getElementData(element,types);
    resElements.put(element.getClientId(),elementData);
    if (elementData.has(CmsElementUtil.JsonElement.subItems.name())) {
      CmsResource elementRes=cms.readResource(element.getElementId());
      CmsXmlSubContainer xmlSubContainer=CmsXmlSubContainerFactory.unmarshal(cms,elementRes,getRequest());
      CmsSubContainerBean subContainer=xmlSubContainer.getSubContainer(cms,cms.getRequestContext().getLocale());
      for (      CmsContainerElementBean subElement : subContainer.getElements()) {
        if (!ids.contains(subElement.getElementId())) {
          String subId=subElement.getClientId();
          if (ids.contains(subId)) {
            continue;
          }
          JSONObject subItemData=elemUtil.getElementData(subElement,types);
          ids.add(subId);
          resElements.put(subId,subItemData);
        }
      }
    }
    ids.add(elemId);
  }
  return resElements;
}
