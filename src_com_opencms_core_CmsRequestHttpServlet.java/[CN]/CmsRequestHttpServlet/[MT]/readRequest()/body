{
  String type=m_req.getContentType();
  if (type == null || !type.toLowerCase().startsWith("multipart/form-data")) {
    throw new IOException(C_REQUEST_NOMULTIPART);
  }
  int length=m_req.getContentLength();
  if (length > m_maxSize) {
    throw new IOException("Posted content length of " + length + " exceeds limit of "+ m_maxSize);
  }
  String boundary=extractBoundary(type);
  if (boundary == null) {
    throw new IOException(C_REQUEST_NOBOUNDARY);
  }
  CmsMultipartInputStreamHandler in=new CmsMultipartInputStreamHandler(m_req.getInputStream(),boundary,length);
  String line=in.readLine();
  if (line == null) {
    throw new IOException(C_REQUEST_PROMATUREEND);
  }
  if (!line.startsWith(boundary)) {
    throw new IOException(C_REQUEST_NOBOUNDARY);
  }
  boolean done=false;
  while (!done) {
    done=readNextPart(in,boundary);
  }
  StringTokenizer st=new StringTokenizer(m_req.getQueryString(),"&");
  while (st.hasMoreTokens()) {
    String currToken=st.nextToken();
    if (currToken != null && !"".equals(currToken)) {
      int idx=currToken.indexOf("=");
      if (idx > -1) {
        String key=currToken.substring(0,idx);
        String value=(idx < (currToken.length() - 1)) ? currToken.substring(idx + 1) : "";
        m_parameters.put(key,value);
      }
    }
  }
}
