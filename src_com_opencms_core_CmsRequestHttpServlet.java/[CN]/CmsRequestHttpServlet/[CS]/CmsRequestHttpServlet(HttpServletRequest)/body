{
  m_req=req;
  try {
    m_webAppUrl=m_req.getContextPath();
  }
 catch (  NoSuchMethodError err) {
  }
  m_serverName=m_req.getServerName();
  m_scheme=m_req.getScheme();
  m_serverPort=m_req.getServerPort();
  m_servletUrl=m_webAppUrl + m_req.getServletPath();
  String type=req.getHeader("content-type");
  if ((type != null) && type.startsWith("multipart/form-data") && (req.getContentLength() > -1)) {
    readRequest();
  }
 else {
    String encoding=req.getCharacterEncoding();
    if (encoding == null) {
      HttpSession httpSession=req.getSession(false);
      I_CmsSession session=(httpSession != null) ? new CmsSession(httpSession) : null;
      if (session != null) {
        encoding=(String)session.getValue(I_CmsConstants.C_SESSION_CONTENT_ENCODING);
      }
      if (encoding == null) {
        encoding=OpenCms.getDefaultEncoding();
      }
      req.setCharacterEncoding(encoding);
    }
    A_OpenCms.log(C_OPENCMS_DEBUG,"Request character encoding is: '" + req.getCharacterEncoding() + "'");
  }
}
