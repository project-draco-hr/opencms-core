{
  m_req=req;
  try {
    m_webAppUrl=m_req.getContextPath();
  }
 catch (  NoSuchMethodError err) {
  }
  m_serverName=m_req.getServerName();
  m_scheme=m_req.getScheme();
  m_serverPort=m_req.getServerPort();
  m_servletUrl=m_webAppUrl + m_req.getServletPath();
  String type=req.getHeader("content-type");
  if ((type != null) && type.startsWith("multipart/form-data") && (req.getContentLength() > -1)) {
    readRequest();
  }
 else {
    String encoding=req.getCharacterEncoding();
    if (encoding == null) {
      HttpSession httpSession=req.getSession(false);
      I_CmsSession session=(httpSession != null) ? new CmsSession(httpSession) : null;
      if (session != null) {
        encoding=(String)session.getValue(I_CmsConstants.C_SESSION_CONTENT_ENCODING);
      }
      if (encoding == null) {
        encoding=OpenCms.getDefaultEncoding();
      }
      req.setCharacterEncoding(encoding);
    }
    A_OpenCms.log(C_OPENCMS_DEBUG,"Request character encoding is: '" + req.getCharacterEncoding() + "'");
  }
  if (m_req.getPathInfo().indexOf("?") != -1) {
    if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging() && m_req.getQueryString() != null && m_req.getQueryString().indexOf("/") != -1) {
      A_OpenCms.log(C_OPENCMS_CRITICAL,"WARNING: URL parameters were not extracted properly.");
      A_OpenCms.log(C_OPENCMS_CRITICAL,"This may be caused by a bug in your servlet environment with handling \"/\" characters. ");
      A_OpenCms.log(C_OPENCMS_CRITICAL,"Please make sure you are escaping all special chars (including \"/\") in your HTML forms.");
      A_OpenCms.log(C_OPENCMS_CRITICAL,m_req.getPathInfo());
    }
    throw new IOException("URL parameters not extracted properly by servlet environment. " + m_req.getPathInfo());
  }
}
