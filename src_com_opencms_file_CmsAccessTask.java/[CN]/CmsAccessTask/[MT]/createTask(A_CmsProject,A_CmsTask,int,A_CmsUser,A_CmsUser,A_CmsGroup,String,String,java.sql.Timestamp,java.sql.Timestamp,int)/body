{
  int id=C_UNKNOWN_ID;
  A_CmsTask task=null;
  try {
    PreparedStatement statementCreateTask=m_Con.prepareStatement(C_TASK_TYPE_COPY);
    statementCreateTask.setInt(1,tasktype);
    statementCreateTask.executeUpdate();
    id=this.getLastInsertId();
    task=this.readTask(id);
    task.setRoot(project.getTaskId());
    task.setParent(parent.getId());
    task.setName(taskname);
    task.setTaskType(tasktype);
    task.setRole(role.getId());
    if (agent != null) {
      task.setAgentUser(agent.getId());
    }
 else {
      agent=findAgent(role);
      if (agent != null) {
        task.setAgentUser(agent.getId());
      }
 else {
        task.setAgentUser(C_UNKNOWN_ID);
      }
    }
    task.setOriginalUser(agent.getId());
    task.setWakeupTime(wakeuptime);
    task.setTimeOut(timeout);
    task.setPriority(priority);
    task.setPercentage(0);
    task.setState(C_TASK_STATE_STARTED);
    task.setInitiatorUser(owner.getId());
    task.setStartTime(new java.sql.Timestamp(System.currentTimeMillis()));
    task.setMilestone(0);
    task=this.writeTask(task);
    writeTaskLog(task,owner,taskcomment);
  }
 catch (  SQLException exc) {
    throw new CmsException(exc.getMessage(),CmsException.C_SQL_ERROR,exc);
  }
  return task;
}
