{
  String elName=element.getName();
  if (parentPath != null) {
    Element first=element.getParent().element(elName);
    int elIndex=element.getParent().indexOf(element) - first.getParent().indexOf(first) + 1;
    elName=parentPath + (parentPath.length() > 0 ? "/" : "") + elName.concat("[" + elIndex + "]");
  }
  if (parentPath == null || copyElements.contains(elName)) {
    Element copy=element.createCopy();
    if (parentPath != null) {
      parent.add(copy);
    }
    boolean copyNested=(parentPath == null);
    for (Iterator i=copyElements.iterator(); !copyNested && i.hasNext(); ) {
      String path=(String)i.next();
      copyNested=!elName.equals(path) && path.startsWith(elName);
    }
    if (copyNested) {
      copy.clearContent();
      for (Iterator i=element.elementIterator(); i.hasNext(); ) {
        Element el=(Element)i.next();
        createDeepElementCopyInternal((parentPath == null) ? "" : elName,copy,el,copyElements);
      }
    }
    return copy;
  }
 else {
    return null;
  }
}
