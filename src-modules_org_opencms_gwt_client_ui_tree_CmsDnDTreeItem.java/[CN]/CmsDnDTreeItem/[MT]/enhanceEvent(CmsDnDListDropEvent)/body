{
  CmsDnDListItem destItem=dropEvent.getDestList().getItem(dropEvent.getDestPath());
  if (!(destItem instanceof CmsDnDTreeItem)) {
    return dropEvent;
  }
  String destPath=getPath() + dropEvent.getDestPath() + "/";
  CmsDnDListItem srcItem=dropEvent.getSrcList().getItem(DRAGGED_PLACEHOLDER_ID);
  if (!(srcItem instanceof CmsDnDTreeItem)) {
    return new CmsDnDListDropEvent(dropEvent.getSrcList(),dropEvent.getSrcPath(),dropEvent.getDestList(),destPath);
  }
  CmsDnDTreeItem srcTreeItem=(CmsDnDTreeItem)srcItem;
  String srcPath=srcTreeItem.getPath();
  if (!dropEvent.getSrcPath().equals(dropEvent.getDestPath()) && srcPath.endsWith(dropEvent.getDestPath() + "/")) {
    srcPath=srcPath.substring(0,srcPath.length() - dropEvent.getDestPath().length() - 1);
    srcPath+=dropEvent.getSrcPath() + "/";
  }
  if (srcPath.endsWith(DRAGGED_PLACEHOLDER_ID + "/")) {
    srcPath=srcPath.substring(0,srcPath.length() - DRAGGED_PLACEHOLDER_ID.length() - 1);
    srcPath+=dropEvent.getSrcPath() + "/";
  }
  return new CmsDnDListDropEvent(dropEvent.getSrcList(),srcPath,dropEvent.getDestList(),destPath);
}
