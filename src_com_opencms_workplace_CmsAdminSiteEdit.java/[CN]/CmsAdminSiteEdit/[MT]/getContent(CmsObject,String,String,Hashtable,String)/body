{
  if (C_DEBUG && A_OpenCms.isLogging()) {
    A_OpenCms.log(C_OPENCMS_DEBUG,this.getClassName() + "getting content of element " + ((elementName == null) ? "<root>" : elementName));
    A_OpenCms.log(C_OPENCMS_DEBUG,this.getClassName() + "template file is: " + templateFile);
    A_OpenCms.log(C_OPENCMS_DEBUG,this.getClassName() + "selected template section is: " + ((templateSelector == null) ? "<default>" : templateSelector));
  }
  I_CmsSession session=cms.getRequestContext().getSession(true);
  String name=(String)parameters.get("NAME");
  if (name == null)   name=(String)session.getValue("SITE_NAME");
  String domainname=(String)parameters.get("DOMAINNAME");
  if (domainname == null)   domainname=(String)session.getValue("SITE_DOMAINNAME");
  String description=(String)parameters.get("DESCRIPTION");
  if (description == null)   description=(String)session.getValue("SITE_DESCRIPTION");
  String categoryId=(String)parameters.get("CATEGORY");
  if (categoryId == null)   categoryId=(String)session.getValue("SITE_CATEGORY");
  String languageId=(String)parameters.get("LANGUAGE");
  if (languageId == null)   languageId=(String)session.getValue("SITE_LANGUAGE");
  String domainId=(String)parameters.get("DOMAIN");
  if (domainId == null)   domainId=(String)session.getValue("SITE_DOMAIN");
  String siteId=(String)session.getValue("SITE_ID");
  String initial=(String)parameters.get(C_PARA_INITIAL);
  if (initial != null) {
    session.removeValue("SITE_NAME");
    session.removeValue("SITE_DOMAINNAME");
    session.removeValue("SITE_DESCRIPTION");
    session.removeValue("SITE_CATEGORY");
    session.removeValue("SITE_LANGUAGE");
    session.removeValue("SITE_DOMAIN");
    session.removeValue("SITE_ID");
    CmsSite site=cms.getSite((String)parameters.get("sitename"));
    name=site.getName();
    description=site.getDescription();
    Vector siteUrls=cms.getSiteUrls(site.getId());
    for (int i=0; i < siteUrls.size(); i++)     if (((CmsSiteUrls)siteUrls.elementAt(i)).getUrlId() == ((CmsSiteUrls)siteUrls.elementAt(i)).getPrimaryUrl())     domainname=((CmsSiteUrls)siteUrls.elementAt(0)).getUrl();
    siteId="" + site.getId();
    categoryId="" + site.getCategoryId();
    languageId="" + site.getLanguageId();
    domainId="" + site.getCountryId();
    session.putValue("SITE_ID",siteId);
  }
  session.putValue("SITE_NAME",name);
  session.putValue("SITE_DOMAINNAME",domainname);
  session.putValue("SITE_DESCRIPTION",description);
  session.putValue("SITE_CATEGORY",categoryId);
  session.putValue("SITE_LANGUAGE",languageId);
  session.putValue("SITE_DOMAIN",domainId);
  String action=(String)parameters.get("action");
  CmsXmlTemplateFile xmlTemplateDocument=getOwnTemplateFile(cms,templateFile,elementName,parameters,templateSelector);
  if (parameters.get("submitform") != null) {
    if (name.equals("") || domainname.equals("") || description.equals("")) {
      templateSelector="datamissing";
    }
 else {
      session.removeValue("SITE_NAME");
      session.removeValue("SITE_DOMAINNAME");
      session.removeValue("SITE_DESCRIPTION");
      session.removeValue("SITE_CATEGORY");
      session.removeValue("SITE_LANGUAGE");
      session.removeValue("SITE_DOMAIN");
      session.putValue("SITE_NAME",parameters.get("NAME"));
      session.putValue("SITE_DOMAINNAME",parameters.get("DOMAINNAME"));
      session.putValue("SITE_DESCRIPTION",parameters.get("DESCRIPTION"));
      session.putValue("SITE_CATEGORY",parameters.get("CATEGORY"));
      session.putValue("SITE_LANGUAGE",parameters.get("LANGUAGE"));
      session.putValue("SITE_DOMAIN",parameters.get("DOMAIN"));
      templateSelector="wait";
    }
  }
  if ("start".equals(action)) {
    try {
      cms.updateSite(Integer.parseInt((String)session.getValue("SITE_ID")),(String)session.getValue("SITE_NAME"),(String)session.getValue("SITE_DESCRIPTION"),Integer.parseInt((String)session.getValue("SITE_CATEGORY")),Integer.parseInt((String)session.getValue("SITE_LANGUAGE")),Integer.parseInt((String)session.getValue("SITE_DOMAIN")),(String)session.getValue("SITE_DOMAINNAME"));
      templateSelector="done";
      session.removeValue("SITE_NAME");
      session.removeValue("SITE_DOMAINNAME");
      session.removeValue("SITE_DESCRIPTION");
      session.removeValue("SITE_CATEGORY");
      session.removeValue("SITE_LANGUAGE");
      session.removeValue("SITE_DOMAIN");
      session.removeValue("SITE_ID");
    }
 catch (    CmsException exc) {
      xmlTemplateDocument.setData("details",Utils.getStackTrace(exc));
      templateSelector="erroreditsite";
    }
  }
  xmlTemplateDocument.setData("edit_site_name",name);
  xmlTemplateDocument.setData("edit_site_domainname",domainname);
  xmlTemplateDocument.setData("edit_site_description",description);
  return startProcessing(cms,xmlTemplateDocument,elementName,parameters,templateSelector);
}
