{
  Vector changedResources=new Vector();
  Vector changedModuleData=new Vector();
  int versionId=0;
  long publishDate=System.currentTimeMillis();
  boolean historyEnabled=OpenCms.getSystemInfo().isVersionHistoryEnabled();
  CmsUUID publishHistoryId=new CmsUUID();
  try {
    if (historyEnabled) {
      versionId=cms.getBackupTagId();
      cms.backupProject(versionId,publishDate);
    }
    getDbAccessObject(getSubId()).publishResource(cms,publishHistoryId,m_dataSet,getSubId(),this.getClass().getName(),historyEnabled,versionId,publishDate,changedResources,changedModuleData);
    if (CmsXmlTemplateLoader.isElementCacheEnabled()) {
      CmsXmlTemplateLoader.getOnlineElementCache().cleanupCache(changedResources,changedModuleData);
    }
  }
  finally {
    Map eventData=new HashMap();
    eventData.put(I_CmsEventListener.KEY_PUBLISHID,publishHistoryId.toString());
    eventData.put(I_CmsEventListener.KEY_PROJECTID,new Integer(cms.getRequestContext().currentProject().getId()));
    OpenCms.fireCmsEvent(new CmsEvent(I_CmsEventListener.EVENT_PUBLISH_PROJECT,eventData));
  }
}
