{
  CmsLocaleManager localeManager=OpenCms.getLocaleManager();
  if (localeManager != null) {
    String locale;
    if ((m_req != null) && ((locale=m_req.getParameter(C_PARAMETER_LOCALE)) != null)) {
      m_locale=CmsLocaleManager.getLocale(locale);
    }
 else     if (getUri().startsWith(I_CmsWpConstants.C_VFS_PATH_WORKPLACE) || getUri().startsWith(I_CmsWpConstants.C_VFS_PATH_LOGIN)) {
      m_locale=OpenCms.getWorkplaceManager().getLocale(this,m_req.getOriginalRequest());
    }
 else {
      m_locale=localeManager.getLocaleHandler().getLocale(this,m_req.getOriginalRequest());
    }
    if (m_locale == null) {
      m_locale=OpenCms.getLocaleManager().getDefaultLocale();
      if (OpenCms.getLog(this).isDebugEnabled()) {
        OpenCms.getLog(this).debug("No locale found - using default: " + m_locale);
      }
    }
  }
 else {
    m_locale=Locale.ENGLISH;
  }
}
