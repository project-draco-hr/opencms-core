{
  byte[] result=null;
  CmsElementDefinitionCollection mergedElDefs=new CmsElementDefinitionCollection(elDefs,m_elementDefinitions);
  I_CmsTemplate templateClass=null;
  try {
    templateClass=getTemplateClass(cms,m_className);
  }
 catch (  Throwable e) {
    if (CmsBase.isLogging()) {
      CmsBase.log(C_OPENCMS_CRITICAL,toString() + " Could not load my template class \"" + m_className+ "\". ");
      CmsBase.log(C_OPENCMS_CRITICAL,e.toString());
      return e.getMessage().getBytes();
    }
  }
  CmsCacheDirectives cd=getCacheDirectives();
  boolean streamable=false;
  CmsElementVariant variant=null;
  if (cd.isInternalCacheable()) {
    variant=getVariant(cd.getCacheKey(cms,parameters));
    if (variant != null) {
      result=resolveVariant(cms,variant,staging,mergedElDefs,parameters);
    }
  }
  if (variant == null) {
    try {
      if (cd.isInternalCacheable()) {
        System.err.println(toString() + " ### Variant not in cache. Must be generated.");
      }
 else {
        System.err.println(toString() + " ### Element not cacheable. Generating variant temporarily.");
      }
      result=templateClass.getContent(cms,m_templateName,m_elementName,parameters);
      variant=getVariant(cd.getCacheKey(cms,parameters));
      if (variant != null) {
        result=resolveVariant(cms,variant,staging,mergedElDefs,parameters);
      }
    }
 catch (    CmsException e) {
      throw e;
    }
    if (streamable) {
      result=null;
    }
  }
  return result;
}
