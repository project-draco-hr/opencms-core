{
  byte[] processResult=null;
  I_CmsSession session=(CmsSession)cms.getRequestContext().getSession(true);
  Class cdClass=getContentDefinitionClass();
  String id=(String)parameters.get("id");
  if (id == null) {
    id="";
  }
  String action=(String)parameters.get("action");
  if (action == null || action.equals("")) {
    if (id != "") {
      Object o=getContentDefinition(cms,cdClass,new CmsUUID(id));
      String curOwner=readSaveUserName(cms,((I_CmsExtendedContentDefinition)o).getOwner());
      String curGroup=readSaveGroupName(cms,((I_CmsExtendedContentDefinition)o).getGroupId());
      templateSelector="copy";
      template.setData("username",curOwner);
      template.setData("groupname",curGroup);
      template.setData("id",id);
      template.setData("setaction","default");
    }
  }
 else {
    templateSelector="done";
    session.removeValue("idcopy");
    CmsUUID contentId=new CmsUUID(id);
    Object o=getContentDefinition(cms,cdClass,contentId);
    try {
      ((I_CmsExtendedContentDefinition)o).copy(cms);
    }
 catch (    Exception e) {
      templateSelector="copyerror";
      template.setData("copyerror",e.getMessage());
    }
  }
  processResult=startProcessing(cms,template,elementName,parameters,templateSelector);
  return processResult;
}
