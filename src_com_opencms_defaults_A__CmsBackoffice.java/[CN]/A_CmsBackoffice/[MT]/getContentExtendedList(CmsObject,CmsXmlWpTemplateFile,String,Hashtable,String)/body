{
  byte[] processResult=null;
  I_CmsSession session=(CmsSession)cms.getRequestContext().getSession(true);
  Class cdClass=getContentDefinitionClass();
  String action=(String)parameters.get("action");
  String filterMethodName=(String)session.getValue("filter");
  if (filterMethodName == null) {
    filterMethodName="0";
  }
  String uri=cms.getRequestContext().getUri();
  String sessionFilterParam=uri + filterMethodName + "filterparameter";
  String filterParam=(String)session.getValue(sessionFilterParam);
  if (filterParam == "") {
    filterParam=null;
  }
  templateSelector="list";
  String tableHead="";
  String singleRow="";
  String allEntrys="";
  String entry="";
  String url="";
  int columns=0;
  String style=">";
  Vector columnsVector=new Vector();
  String fieldNamesMethod="getFieldNames";
  Class paramClasses[]={CmsObject.class};
  Object params[]={cms};
  columnsVector=(Vector)getContentMethodObject(cms,cdClass,fieldNamesMethod,paramClasses,params);
  columns=columnsVector.size();
  String moduleName="";
  moduleName=(String)getClass().toString();
  moduleName=moduleName.substring(5);
  moduleName=moduleName.trim();
  moduleName=moduleName.replace('.','_');
  CmsXmlLanguageFile lang=new CmsXmlLanguageFile(cms);
  for (int i=0; i < columns; i++) {
    tableHead+=(template.getDataValue("tabledatabegin")) + style + lang.getLanguageValue(moduleName + ".label." + columnsVector.elementAt(i).toString().toLowerCase().trim())+ (template.getDataValue("tabledataend"));
  }
  template.setData("tableheadline",tableHead);
  Vector tableContent=new Vector();
  try {
    Vector filterMethods=(Vector)cdClass.getMethod("getFilterMethods",new Class[]{CmsObject.class}).invoke(null,new Object[]{cms});
    CmsFilterMethod filterMethod=null;
    CmsFilterMethod filterName=(CmsFilterMethod)filterMethods.elementAt(Integer.parseInt(filterMethodName));
    filterMethodName=filterName.getFilterName();
    for (int i=0; i < filterMethods.size(); i++) {
      CmsFilterMethod currentFilter=(CmsFilterMethod)filterMethods.elementAt(i);
      if (currentFilter.getFilterName().equals(filterMethodName)) {
        filterMethod=currentFilter;
        break;
      }
    }
    if (filterMethod == null) {
      filterMethod=(CmsFilterMethod)filterMethods.firstElement();
    }
    tableContent=(Vector)cdClass.getMethod("applyFilter",new Class[]{CmsObject.class,CmsFilterMethod.class,String.class}).invoke(null,new Object[]{cms,filterMethod,filterParam});
  }
 catch (  InvocationTargetException ite) {
    if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
      A_OpenCms.log(C_OPENCMS_INFO,getClassName() + ": Backoffice: apply filter throwed an InvocationTargetException!");
    }
    templateSelector="error";
    template.setData("filtername",filterMethodName);
    while (ite.getTargetException() instanceof InvocationTargetException) {
      ite=((InvocationTargetException)ite.getTargetException());
    }
    template.setData("filtererror",ite.getTargetException().getMessage());
    session.removeValue(sessionFilterParam);
  }
catch (  NoSuchMethodException nsm) {
    if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
      A_OpenCms.log(C_OPENCMS_INFO,getClassName() + ": Backoffice: apply filter method was not found!");
    }
    templateSelector="error";
    template.setData("filtername",filterMethodName);
    template.setData("filtererror",nsm.getMessage());
    session.removeValue(sessionFilterParam);
  }
catch (  Exception e) {
    if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
      A_OpenCms.log(C_OPENCMS_INFO,getClassName() + ": Backoffice: apply filter: Other Exception! " + e);
    }
    templateSelector="error";
    template.setData("filtername",filterMethodName);
    template.setData("filtererror",e.getMessage());
    session.removeValue(sessionFilterParam);
  }
  int rows=tableContent.size();
  Vector fieldMethods=new Vector();
  try {
    fieldMethods=(Vector)cdClass.getMethod("getFieldMethods",new Class[]{CmsObject.class}).invoke(null,new Object[]{cms});
  }
 catch (  Exception exc) {
    if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
      A_OpenCms.log(C_OPENCMS_INFO,getClassName() + ": Backoffice getContentList: getFieldMethods throwed an exception");
    }
    templateSelector="error";
    template.setData("filtername",filterMethodName);
    template.setData("filtererror",exc.getMessage());
  }
  String fieldEntry="";
  String id="";
  for (int i=0; i < rows; i++) {
    entry="";
    singleRow="";
    Object entryObject=new Object();
    entryObject=tableContent.elementAt(i);
    style=this.getStyle(cms,template,entryObject) + ">";
    for (int j=0; j < columns; j++) {
      fieldEntry="+++ NO VALUE FOUND +++";
      Method getMethod=null;
      try {
        getMethod=(Method)fieldMethods.elementAt(j);
      }
 catch (      Exception e) {
        if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
          A_OpenCms.log(C_OPENCMS_INFO,getClassName() + ": Could not get field method for " + (String)columnsVector.elementAt(j)+ " - check for correct spelling!");
        }
      }
      try {
        Object fieldEntryObject=null;
        fieldEntryObject=getMethod.invoke(entryObject,new Object[0]);
        if (fieldEntryObject != null) {
          fieldEntry=fieldEntryObject.toString();
        }
 else {
          fieldEntry=null;
        }
      }
 catch (      InvocationTargetException ite) {
        if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
          A_OpenCms.log(C_OPENCMS_INFO,getClassName() + ": Backoffice content definition object throwed an InvocationTargetException!");
        }
      }
catch (      Exception e) {
        if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
          A_OpenCms.log(C_OPENCMS_INFO,getClassName() + ": Backoffice content definition object: Other exception! " + e);
        }
      }
      try {
        id=((A_CmsContentDefinition)entryObject).getUniqueId(cms);
      }
 catch (      Exception e) {
        if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
          A_OpenCms.log(C_OPENCMS_INFO,getClassName() + ": Backoffice: getUniqueId throwed an Exception!");
        }
      }
      if (id != null) {
        template.setData("uniqueid",id);
      }
      if (fieldEntry != null) {
        try {
          Vector v=new Vector();
          v.addElement(new Integer(id));
          v.addElement(template);
          url=getUrl(cms,null,null,v);
        }
 catch (        Exception e) {
          url="";
        }
        if (!url.equals("")) {
          entry+=(template.getDataValue("tabledatabegin")) + style + (template.getProcessedDataValue("url",this,parameters))+ fieldEntry+ (template.getDataValue("tabledataend"));
        }
 else {
          entry+=(template.getDataValue("tabledatabegin")) + style + fieldEntry+ (template.getDataValue("tabledataend"));
        }
      }
 else {
        entry+=(template.getDataValue("tabledatabegin")) + "" + (template.getDataValue("tabledataend"));
      }
    }
    try {
      id=((A_CmsContentDefinition)entryObject).getUniqueId(cms);
    }
 catch (    Exception e) {
      if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
        A_OpenCms.log(C_OPENCMS_INFO,getClassName() + ": Backoffice: getUniqueId throwed an Exception!");
      }
    }
    if (id != null) {
      template.setData("uniqueid",id);
    }
    setLockstates(cms,template,cdClass,entryObject,parameters);
    setProjectFlag(cms,template,cdClass,entryObject,parameters);
    setContextMenu(cms,template,entryObject);
    template.setData("entry",entry);
    singleRow=template.getProcessedDataValue("singlerow",this,parameters);
    allEntrys+=(template.getDataValue("tablerowbegin")) + singleRow + (template.getDataValue("tablerowend"));
  }
  template.setData("tablecontent","" + allEntrys);
  session.putValue("selectbox",filterMethodName);
  processResult=startProcessing(cms,template,elementName,parameters,templateSelector);
  return processResult;
}
