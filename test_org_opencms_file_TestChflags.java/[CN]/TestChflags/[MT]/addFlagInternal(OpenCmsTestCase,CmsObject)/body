{
  String resource1="/index.html";
  CmsResource resource=cms.readResource(resource1,CmsResourceFilter.ALL);
  tc.storeResources(cms,resource1);
  int existingFlags=resource.getFlags();
  int flags=existingFlags;
  long timestamp=System.currentTimeMillis();
  assertEquals((existingFlags & I_CmsConstants.C_ACCESS_INTERNAL_READ),0);
  if ((flags & I_CmsConstants.C_ACCESS_INTERNAL_READ) == 0) {
    flags+=I_CmsConstants.C_ACCESS_INTERNAL_READ;
  }
 else {
    fail("Resource " + resource1 + " has the \"internal\" flag already set!");
  }
  cms.lockResource(resource1);
  cms.chflags(resource1,flags);
  cms.unlockResource(resource1);
  tc.assertFilter(cms,resource1,OpenCmsTestResourceFilter.FILTER_CHFLAGS);
  tc.assertDateLastModifiedAfter(cms,resource1,timestamp);
  tc.assertState(cms,resource1,I_CmsConstants.C_STATE_CHANGED);
  tc.assertUserLastModified(cms,resource1,cms.getRequestContext().currentUser());
  tc.assertFlags(cms,resource1,I_CmsConstants.C_ACCESS_INTERNAL_READ);
  tc.assertProject(cms,resource1,cms.getRequestContext().currentProject());
}
