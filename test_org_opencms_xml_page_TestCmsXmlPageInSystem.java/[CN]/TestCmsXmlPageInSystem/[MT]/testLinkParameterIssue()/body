{
  CmsObject cms=getCmsObject();
  echo("Testing XML page link parameter issue");
  String filename="/folder1/subfolder11/test_param_1.html";
  String content=CmsXmlPageFactory.createDocument(Locale.ENGLISH,UTF8);
  List<CmsProperty> properties=new ArrayList<CmsProperty>();
  properties.add(new CmsProperty(CmsPropertyDefinition.PROPERTY_CONTENT_ENCODING,UTF8,null));
  properties.add(new CmsProperty(CmsPropertyDefinition.PROPERTY_LOCALE,Locale.ENGLISH.toString(),null));
  properties.add(new CmsProperty(CmsXmlPage.PROPERTY_ALLOW_RELATIVE,CmsStringUtil.FALSE,null));
  cms.createResource(filename,CmsResourceTypeXmlPage.getStaticTypeId(),content.getBytes(UTF8),properties);
  CmsFile file=cms.readFile(filename);
  CmsXmlPage page=CmsXmlPageFactory.unmarshal(cms,file);
  String element="test";
  page.addValue(element,Locale.ENGLISH);
  String text;
  page.setStringValue(cms,element,Locale.ENGLISH,"<a href=\"index.html?a=b&someparam=de\">link</a>");
  text=page.getStringValue(cms,element,Locale.ENGLISH);
  assertEquals("<a href=\"" + getVfsPrefix() + "/folder1/subfolder11/index.html?a=b&amp;someparam=de\">link</a>",text);
  page.setStringValue(cms,element,Locale.ENGLISH,"<a href=\"index.html?language=de\">link</a>");
  text=page.getStringValue(cms,element,Locale.ENGLISH);
  assertEquals("<a href=\"" + getVfsPrefix() + "/folder1/subfolder11/index.html?language=de\">link</a>",text);
  page.setStringValue(cms,element,Locale.ENGLISH,"<a href=\"index.html?a=b&language=de\">link</a>");
  text=page.getStringValue(cms,element,Locale.ENGLISH);
  assertEquals("<a href=\"" + getVfsPrefix() + "/folder1/subfolder11/index.html?a=b&amp;language=de\">link</a>",text);
  page.setStringValue(cms,element,Locale.ENGLISH,"<a href=\"index_noexist.html?a=b&language=de\">link</a>");
  text=page.getStringValue(cms,element,Locale.ENGLISH);
  assertEquals("<a href=\"" + getVfsPrefix() + "/folder1/subfolder11/index_noexist.html?a=b&amp;language=de\">link</a>",text);
  page.setStringValue(cms,element,Locale.ENGLISH,"<a href=\"index_noexist.html?a=b&product=somthing\">link</a>");
  text=page.getStringValue(cms,element,Locale.ENGLISH);
  assertEquals("<a href=\"" + getVfsPrefix() + "/folder1/subfolder11/index_noexist.html?a=b&amp;product=somthing\">link</a>",text);
}
