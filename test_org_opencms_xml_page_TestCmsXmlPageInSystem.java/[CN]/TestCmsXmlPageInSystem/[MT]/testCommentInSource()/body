{
  CmsObject cms=getCmsObject();
  echo("Testing XML page comment handling");
  String filename="/folder1/subfolder11/test2.html";
  List properties=new ArrayList();
  properties.add(new CmsProperty(I_CmsConstants.C_PROPERTY_CONTENT_ENCODING,UTF8,null));
  properties.add(new CmsProperty(I_CmsConstants.C_PROPERTY_LOCALE,Locale.ENGLISH.toString(),null));
  String content=CmsXmlPageFactory.createDocument(Locale.ENGLISH,UTF8);
  cms.createResource(filename,CmsResourceTypeXmlPage.getStaticTypeId(),content.getBytes(UTF8),properties);
  CmsFile file=cms.readFile(filename);
  CmsXmlPage page=CmsXmlPageFactory.unmarshal(cms,file);
  String element="test";
  page.addValue(element,Locale.ENGLISH);
  String result;
  content="<h1>Comment Test 1</h1>\n<!-- This is a comment -->\nSome text here...";
  page.setStringValue(cms,element,Locale.ENGLISH,content);
  result=page.getStringValue(cms,element,Locale.ENGLISH);
  assertEquals(content,result);
  content="<!-- First comment --><h1>Comment Test 2</h1>\n<!-- This is a comment -->\nSome text here...<!-- Another comment -->";
  page.setStringValue(cms,element,Locale.ENGLISH,content);
  result=page.getStringValue(cms,element,Locale.ENGLISH);
  assertEquals(content,result);
  content="<!-- First comment --><img src=\"/data/opencms/image.gif\" alt=\"an image\" />\n<!-- This is a comment -->\n<a href=\"/data/opencms/index.html\">Link</a><!-- Another comment -->";
  page.setStringValue(cms,element,Locale.ENGLISH,content);
  result=page.getStringValue(cms,element,Locale.ENGLISH);
  assertEquals(content,result);
  content="<!-- <img src=\"/data/opencms/image.gif\" alt=\"an image\" />\n<h1>some text</h1>--><!-- This is a comment -->\n<a href=\"/data/opencms/index.html\">Link</a><!-- Another comment -->";
  page.setStringValue(cms,element,Locale.ENGLISH,content);
  result=page.getStringValue(cms,element,Locale.ENGLISH);
  assertEquals(content,result);
  content="<!-- Start of comment <!-- img src=\"/data/opencms/image.gif\" alt=\"an image\" / -->\n<h1>some text</h1><!-- This is a comment -->\n End of comment! --> <a href=\"/data/opencms/index.html\">Link</a><!-- Another comment -->";
  page.setStringValue(cms,element,Locale.ENGLISH,content);
  result=page.getStringValue(cms,element,Locale.ENGLISH);
  assertEquals(content,result);
}
