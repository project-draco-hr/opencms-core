{
  CmsResource newChannel=null;
  cms.setContextToCos();
  try {
    if ((I_CmsConstants.C_UNKNOWN_ID + "").equals(m_channelId)) {
      setNewChannelId();
      newChannel=cms.createResource(m_parentchannel,m_channelname,I_CmsConstants.C_TYPE_FOLDER_NAME,m_properties);
      cms.lockResource(cms.readAbsolutePath(newChannel),true);
    }
 else {
      if (!"".equals(m_channel.getResourceName())) {
        newChannel=cms.readFolder(cms.readAbsolutePath(m_channel));
      }
      if (newChannel != null && !cms.readAbsolutePath(newChannel).equals(m_parentchannel + m_channelname + "/")) {
        if (!newChannel.getParent().equals(m_parentchannel)) {
          cms.moveResource(cms.readAbsolutePath(newChannel),m_parentchannel + m_channelname);
        }
 else         if (!newChannel.getName().equals(m_channelname)) {
          cms.renameResource(cms.readAbsolutePath(newChannel),m_channelname);
        }
      }
      newChannel=cms.readFolder(m_parentchannel + m_channelname + "/");
      String propTitle=cms.readProperty(cms.readAbsolutePath(newChannel),I_CmsConstants.C_PROPERTY_TITLE);
      if (propTitle == null) {
        propTitle="";
      }
      if (!propTitle.equals(this.getTitle())) {
        cms.writeProperty(cms.readAbsolutePath(newChannel),I_CmsConstants.C_PROPERTY_TITLE,this.getTitle());
      }
      if (!newChannel.isLockedBy().equals(this.getLockstate()) || newChannel.getLockedInProject() != cms.getRequestContext().currentProject().getId()) {
        if (this.getLockstate().isNullUUID()) {
          cms.unlockResource(cms.readAbsolutePath(newChannel),false);
        }
 else {
          cms.lockResource(cms.readAbsolutePath(newChannel),true);
        }
      }
    }
    if (!newChannel.getOwnerId().equals(this.getOwner())) {
      cms.chown(cms.readAbsolutePath(newChannel),this.getOwnerName());
    }
    if (!newChannel.getGroupId().equals(this.getGroupId())) {
      cms.chgrp(cms.readAbsolutePath(newChannel),this.getGroup());
    }
    if (newChannel.getAccessFlags() != this.getAccessFlags()) {
      cms.chmod(cms.readAbsolutePath(newChannel),this.getAccessFlags());
    }
    m_channel=cms.readFolder(cms.readAbsolutePath(newChannel));
  }
 catch (  CmsException exc) {
    throw exc;
  }
 finally {
    cms.setContextToVfs();
  }
}
