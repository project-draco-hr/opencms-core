{
  CmsObject cms=getCmsObject();
  echo("Testing search with large result set");
  URL inputSourceUrl=ClassLoader.getSystemResource("org/opencms/search/pdf-test-112.pdf");
  File file=new File(inputSourceUrl.getFile());
  byte[] buffer=null;
  FileInputStream fileStream=null;
  int charsRead;
  int size;
  try {
    fileStream=new FileInputStream(file);
    charsRead=0;
    size=new Long(file.length()).intValue();
    buffer=new byte[size];
    while (charsRead < size) {
      charsRead+=fileStream.read(buffer,charsRead,size - charsRead);
    }
  }
 catch (  IOException e) {
    throw new CmsException(e.getMessage());
  }
 finally {
    try {
      if (fileStream != null) {
        fileStream.close();
      }
    }
 catch (    IOException e) {
      e.printStackTrace();
    }
  }
  cms.createResource("/test/",CmsResourceTypeFolder.C_RESOURCE_TYPE_ID,null,null);
  cms.unlockResource("/test/");
  cms.createResource("/test/master.pdf",CmsResourceTypeBinary.getStaticTypeId(),buffer,null);
  cms.unlockResource("/test/master.pdf");
  cms.copyResource("/test/master.pdf","/test/copy.pdf");
  cms.chacc("/test/copy.pdf","group","Users","-r");
  for (int i=0; i < 100; i++) {
    cms.createSibling("/test/master.pdf","/test/sibling" + i + ".pdf",null);
  }
  I_CmsReport report=new CmsShellReport();
  OpenCms.getSearchManager().updateIndex(C_TEST_INDEX,report);
  CmsSearch cmsSearchBean=new CmsSearch();
  cmsSearchBean.init(cms);
  cmsSearchBean.setIndex(C_TEST_INDEX);
  List results;
  cms.addUser("test","test","Users","",null);
  cms.loginUser("test","test");
  cms.getRequestContext().setCurrentProject(cms.readProject("Offline"));
  cmsSearchBean.setQuery("pdf");
  echo("With Permission check, with excerpt");
  OpenCms.getSearchManager().getIndex(C_TEST_INDEX).addConfigurationParameter(CmsSearchIndex.C_PERMISSIONS,"true");
  OpenCms.getSearchManager().getIndex(C_TEST_INDEX).addConfigurationParameter(CmsSearchIndex.C_EXCERPT,"true");
  cmsSearchBean.setPage(1);
  long duration=-System.currentTimeMillis();
  results=cmsSearchBean.getSearchResult();
  duration+=System.currentTimeMillis();
  echo("Search1: " + cmsSearchBean.getSearchResultCount() + " results found, total duration: "+ duration+ " ms");
  for (Iterator i=results.iterator(); i.hasNext(); ) {
    CmsSearchResult res=(CmsSearchResult)i.next();
    echo(res.getPath() + res.getExcerpt());
  }
  cmsSearchBean.setPage(2);
  duration=-System.currentTimeMillis();
  results=cmsSearchBean.getSearchResult();
  duration+=System.currentTimeMillis();
  echo("Search2: " + cmsSearchBean.getSearchResultCount() + " results found, total duration: "+ duration+ " ms");
  for (Iterator i=results.iterator(); i.hasNext(); ) {
    CmsSearchResult res=(CmsSearchResult)i.next();
    echo(res.getPath() + res.getExcerpt());
  }
  echo("With Permission check, without excerpt");
  OpenCms.getSearchManager().getIndex(C_TEST_INDEX).addConfigurationParameter(CmsSearchIndex.C_PERMISSIONS,"true");
  OpenCms.getSearchManager().getIndex(C_TEST_INDEX).addConfigurationParameter(CmsSearchIndex.C_EXCERPT,"false");
  cmsSearchBean.setPage(1);
  duration=-System.currentTimeMillis();
  results=cmsSearchBean.getSearchResult();
  duration+=System.currentTimeMillis();
  echo("Search1: " + cmsSearchBean.getSearchResultCount() + " results found, total duration: "+ duration+ " ms");
  cmsSearchBean.setPage(2);
  duration=-System.currentTimeMillis();
  results=cmsSearchBean.getSearchResult();
  duration+=System.currentTimeMillis();
  echo("Search2: " + cmsSearchBean.getSearchResultCount() + " results found, total duration: "+ duration+ " ms");
  echo("Without Permission check, with excerpt");
  OpenCms.getSearchManager().getIndex(C_TEST_INDEX).addConfigurationParameter(CmsSearchIndex.C_PERMISSIONS,"false");
  OpenCms.getSearchManager().getIndex(C_TEST_INDEX).addConfigurationParameter(CmsSearchIndex.C_EXCERPT,"true");
  cmsSearchBean.setPage(1);
  duration=-System.currentTimeMillis();
  results=cmsSearchBean.getSearchResult();
  duration+=System.currentTimeMillis();
  echo("Search1: " + cmsSearchBean.getSearchResultCount() + " results found, total duration: "+ duration+ " ms");
  cmsSearchBean.setPage(2);
  duration=-System.currentTimeMillis();
  results=cmsSearchBean.getSearchResult();
  duration+=System.currentTimeMillis();
  echo("Search2: " + cmsSearchBean.getSearchResultCount() + " results found, total duration: "+ duration+ " ms");
  echo("Without Permission check, without excerpt");
  OpenCms.getSearchManager().getIndex(C_TEST_INDEX).addConfigurationParameter(CmsSearchIndex.C_PERMISSIONS,"false");
  OpenCms.getSearchManager().getIndex(C_TEST_INDEX).addConfigurationParameter(CmsSearchIndex.C_EXCERPT,"false");
  cmsSearchBean.setPage(1);
  duration=-System.currentTimeMillis();
  results=cmsSearchBean.getSearchResult();
  duration+=System.currentTimeMillis();
  echo("Search1: " + cmsSearchBean.getSearchResultCount() + " results found, total duration: "+ duration+ " ms");
  cmsSearchBean.setPage(2);
  duration=-System.currentTimeMillis();
  results=cmsSearchBean.getSearchResult();
  duration+=System.currentTimeMillis();
  echo("Search2: " + cmsSearchBean.getSearchResultCount() + " results found, total duration: "+ duration+ " ms");
}
