{
  HttpSession session=null;
  m_loginException=null;
  try {
    getCmsObject().loginUser(username,password,getRequestContext().getRemoteAddress(),I_CmsConstants.C_USER_TYPE_SYSTEMUSER);
    session=getRequest().getSession(false);
    if (session != null) {
      session.invalidate();
    }
    session=getRequest().getSession(true);
    if (login_project != null) {
      getCmsObject().getRequestContext().setCurrentProject(getCmsObject().readProject(login_project));
    }
  }
 catch (  CmsException e) {
    m_loginException=e;
  }
  if (m_loginException == null) {
    if (LOG.isInfoEnabled()) {
      LOG.info(Messages.get().key(Messages.LOG_LOGIN_SUCCESSFUL_2,username,getRequestContext().addSiteRoot(getRequestContext().getUri())));
    }
  }
 else {
    if (session != null) {
      session.invalidate();
    }
    if (m_loginException instanceof CmsAuthentificationException) {
      if (org.opencms.db.Messages.ERR_LOGIN_USER_DISABLED_1 == m_loginException.getMessageContainer().getKey()) {
        LOG.info(Messages.get().key(Messages.LOG_LOGIN_FAILED_DISABLED_3,username,getRequestContext().addSiteRoot(getRequestContext().getUri()),getRequestContext().getRemoteAddress()));
      }
 else {
        boolean userExists=true;
        try {
          getCmsObject().readUser(username);
        }
 catch (        CmsException e) {
          userExists=false;
        }
        if (userExists) {
          CmsMessageContainer message=Messages.get().container(Messages.LOG_LOGIN_FAILED_3,username,getRequestContext().addSiteRoot(getRequestContext().getUri()),getRequestContext().getRemoteAddress());
          if (username.equalsIgnoreCase(OpenCms.getDefaultUsers().getUserAdmin())) {
            LOG.error(message.key());
          }
 else {
            LOG.info(message.key());
          }
        }
 else {
          LOG.info(Messages.get().key(Messages.LOG_LOGIN_FAILED_NO_USER_3,username,getRequestContext().addSiteRoot(getRequestContext().getUri()),getRequestContext().getRemoteAddress()));
        }
      }
    }
 else {
      LOG.error(Messages.get().key(Messages.LOG_LOGIN_FAILED_DB_REASON_3,username,getRequestContext().addSiteRoot(getRequestContext().getUri()),getRequestContext().getRemoteAddress()),m_loginException);
    }
  }
}
