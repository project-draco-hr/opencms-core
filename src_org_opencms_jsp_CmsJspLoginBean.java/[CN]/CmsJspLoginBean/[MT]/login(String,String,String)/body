{
  HttpSession session=null;
  m_loginException=null;
  try {
    getCmsObject().loginUser(userName,password,getRequestContext().getRemoteAddress(),I_CmsConstants.C_USER_TYPE_SYSTEMUSER);
    session=getRequest().getSession(false);
    if (session != null) {
      session.invalidate();
    }
    session=getRequest().getSession(true);
    if (projectName != null) {
      getCmsObject().getRequestContext().setCurrentProject(getCmsObject().readProject(projectName));
    }
  }
 catch (  CmsException e) {
    m_loginException=e;
  }
  if (m_loginException == null) {
    if (LOG.isInfoEnabled()) {
      LOG.info(Messages.get().key(Messages.LOG_LOGIN_SUCCESSFUL_3,userName,getRequestContext().addSiteRoot(getRequestContext().getUri()),getRequestContext().getRemoteAddress()));
    }
  }
 else {
    if (session != null) {
      session.invalidate();
    }
    if (m_loginException instanceof CmsAuthentificationException) {
      if (org.opencms.security.Messages.ERR_LOGIN_FAILED_DISABLED_3 == m_loginException.getMessageContainer().getKey()) {
        LOG.warn(Messages.get().key(Messages.LOG_LOGIN_FAILED_DISABLED_3,userName,getRequestContext().addSiteRoot(getRequestContext().getUri()),getRequestContext().getRemoteAddress()));
      }
 else       if (org.opencms.security.Messages.ERR_LOGIN_FAILED_NO_USER_3 == m_loginException.getMessageContainer().getKey()) {
        LOG.warn(Messages.get().key(Messages.LOG_LOGIN_FAILED_NO_USER_3,userName,getRequestContext().addSiteRoot(getRequestContext().getUri()),getRequestContext().getRemoteAddress()));
      }
 else {
        CmsMessageContainer message=Messages.get().container(Messages.LOG_LOGIN_FAILED_3,userName,getRequestContext().addSiteRoot(getRequestContext().getUri()),getRequestContext().getRemoteAddress());
        if (userName.equalsIgnoreCase(OpenCms.getDefaultUsers().getUserAdmin())) {
          LOG.error(message.key());
        }
 else {
          LOG.warn(message.key());
        }
      }
    }
 else {
      LOG.error(Messages.get().key(Messages.LOG_LOGIN_FAILED_DB_REASON_3,userName,getRequestContext().addSiteRoot(getRequestContext().getUri()),getRequestContext().getRemoteAddress()),m_loginException);
    }
  }
}
