{
  HttpSession session=null;
  m_loginException=null;
  try {
    CmsUser user=getCmsObject().readUser(userName);
    OpenCms.getSessionManager().checkCreateSessionForUser(user);
    getCmsObject().loginUser(userName,password,getRequestContext().getRemoteAddress());
    session=getRequest().getSession(false);
    if (session != null) {
      session.invalidate();
    }
    session=getRequest().getSession(true);
    if (projectName != null) {
      getCmsObject().getRequestContext().setCurrentProject(getCmsObject().readProject(projectName));
    }
  }
 catch (  CmsException e) {
    m_loginException=e;
  }
  if (m_loginException == null) {
    if (LOG.isInfoEnabled()) {
      LOG.info(Messages.get().getBundle().key(Messages.LOG_LOGIN_SUCCESSFUL_3,userName,getRequestContext().addSiteRoot(getRequestContext().getUri()),getRequestContext().getRemoteAddress()));
    }
  }
 else {
    if (session != null) {
      session.invalidate();
    }
    if (m_loginException instanceof CmsAuthentificationException) {
      if (org.opencms.security.Messages.ERR_LOGIN_FAILED_DISABLED_2 == m_loginException.getMessageContainer().getKey()) {
        LOG.warn(Messages.get().getBundle().key(Messages.LOG_LOGIN_FAILED_DISABLED_3,userName,getRequestContext().addSiteRoot(getRequestContext().getUri()),getRequestContext().getRemoteAddress()));
      }
 else       if (org.opencms.security.Messages.ERR_LOGIN_FAILED_TEMP_DISABLED_4 == m_loginException.getMessageContainer().getKey()) {
        LOG.warn(Messages.get().getBundle().key(Messages.LOG_LOGIN_FAILED_TEMP_DISABLED_5,new Object[]{userName,getRequestContext().addSiteRoot(getRequestContext().getUri()),getRequestContext().getRemoteAddress(),m_loginException.getMessageContainer().getArgs()[2],m_loginException.getMessageContainer().getArgs()[3]}));
      }
 else       if (org.opencms.security.Messages.ERR_LOGIN_FAILED_NO_USER_2 == m_loginException.getMessageContainer().getKey()) {
        LOG.warn(Messages.get().getBundle().key(Messages.LOG_LOGIN_FAILED_NO_USER_3,userName,getRequestContext().addSiteRoot(getRequestContext().getUri()),getRequestContext().getRemoteAddress()));
      }
 else       if (org.opencms.security.Messages.ERR_LOGIN_FAILED_WITH_MESSAGE_1 == m_loginException.getMessageContainer().getKey()) {
        long endTime=CmsLoginMessage.DEFAULT_TIME_END;
        if (OpenCms.getLoginManager().getLoginMessage() != null) {
          endTime=OpenCms.getLoginManager().getLoginMessage().getTimeEnd();
        }
        LOG.info(Messages.get().getBundle().key(Messages.LOG_LOGIN_FAILED_WITH_MESSAGE_4,new Object[]{userName,getRequestContext().addSiteRoot(getRequestContext().getUri()),getRequestContext().getRemoteAddress(),new Date(endTime)}));
      }
 else {
        CmsMessageContainer message=Messages.get().container(Messages.LOG_LOGIN_FAILED_3,userName,getRequestContext().addSiteRoot(getRequestContext().getUri()),getRequestContext().getRemoteAddress());
        if (OpenCms.getDefaultUsers().isUserAdmin(userName)) {
          LOG.error(message.key());
        }
 else {
          LOG.warn(message.key());
        }
      }
    }
 else {
      LOG.error(Messages.get().getBundle().key(Messages.LOG_LOGIN_FAILED_DB_REASON_3,userName,getRequestContext().addSiteRoot(getRequestContext().getUri()),getRequestContext().getRemoteAddress()),m_loginException);
    }
  }
}
