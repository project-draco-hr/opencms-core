{
  HttpSession session=null;
  m_loginException=null;
  try {
    getCmsObject().loginUser(username,password,getRequestContext().getRemoteAddress(),I_CmsConstants.C_USER_TYPE_SYSTEMUSER);
    session=getRequest().getSession(false);
    if (session != null) {
      session.invalidate();
    }
    session=getRequest().getSession(true);
    if (login_project != null) {
      getCmsObject().getRequestContext().setCurrentProject(getCmsObject().readProject(login_project));
    }
  }
 catch (  CmsException e) {
    m_loginException=e;
    if (session != null) {
      session.invalidate();
    }
  }
  if (m_loginException == null) {
    if (LOG.isInfoEnabled()) {
      LOG.info(Messages.get().key(Messages.LOG_LOGIN_SUCCESSFUL_2,username,getRequestContext().addSiteRoot(getRequestContext().getUri())));
    }
    if (login_redirect != null) {
      getResponse().sendRedirect(link(login_redirect));
    }
 else {
      getResponse().sendRedirect(getFormLink());
    }
  }
 else {
    if (LOG.isWarnEnabled()) {
      LOG.warn(Messages.get().key(Messages.LOG_LOGIN_FAILED_2,username,getRequestContext().addSiteRoot(getRequestContext().getUri())));
    }
  }
}
