{
  String baseUri=req.getParameter("baseUri");
  if (CmsStringUtil.isEmptyOrWhitespaceOnly(baseUri)) {
    String referer=req.getHeader("referer");
    CmsSite site=OpenCms.getSiteManager().getSiteForSiteRoot(cms.getRequestContext().getSiteRoot());
    String prefix=site.getServerPrefix(cms,"/") + OpenCms.getSystemInfo().getOpenCmsContext();
    if (referer != null && referer.startsWith(prefix)) {
      baseUri=referer.substring(prefix.length());
    }
  }
  return baseUri;
}
