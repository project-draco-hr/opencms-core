{
  String containerType=getType();
  int containerWidth=getContainerWidth();
  ServletRequest req=pageContext.getRequest();
  CmsUUID detailId=null;
  boolean isOnline=cms.getRequestContext().currentProject().isOnlineProject();
  CmsSitemapEntry sitemap=OpenCms.getSitemapManager().getRuntimeInfo(req);
  if (sitemap != null) {
    detailId=sitemap.getContentId();
  }
  if (detailId != null) {
    CmsResource resUri=cms.readResource(detailId);
    String elementFormatter=OpenCms.getADEManager().getFormatterForContainerTypeAndWidth(cms,resUri,containerType,containerWidth);
    if (CmsStringUtil.isEmptyOrWhitespaceOnly(elementFormatter)) {
      if (!isOnline) {
        throw new CmsIllegalStateException(Messages.get().container(Messages.ERR_XSD_NO_TEMPLATE_FORMATTER_3,cms.getSitePath(resUri),OpenCms.getResourceManager().getResourceType(resUri).getTypeName(),containerType));
      }
    }
 else {
      CmsContainerElementBean element=new CmsContainerElementBean(resUri.getStructureId(),cms.readResource(elementFormatter).getStructureId(),null);
      allElems.add(0,element);
    }
  }
}
