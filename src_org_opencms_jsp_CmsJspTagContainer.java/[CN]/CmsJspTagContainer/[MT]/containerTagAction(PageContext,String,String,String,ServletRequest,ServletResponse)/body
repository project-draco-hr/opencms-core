{
  CmsFlexController controller=CmsFlexController.getController(req);
  CmsObject cms=controller.getCmsObject();
  CmsResource containerPage=cms.readResource(cms.getRequestContext().getUri());
  CmsContainerPageBean cntPage=CmsContainerPageCache.getInstance().getCache(cms,containerPage,cms.getRequestContext().getLocale());
  Locale locale=cntPage.getLocale();
  if (!cntPage.getContainers().containsKey(containerName)) {
    LOG.warn(Messages.get().container(Messages.LOG_CONTAINER_NOT_FOUND_3,cms.getSitePath(containerPage),locale,containerName).key());
    return;
  }
  CmsContainerBean container=cntPage.getContainers().get(containerName);
  if (!containerType.equals(container.getType())) {
    LOG.warn(Messages.get().container(Messages.LOG_WRONG_CONTAINER_TYPE_4,new Object[]{cms.getSitePath(containerPage),locale,containerName,containerType}).key());
  }
  int maxElements=-1;
  if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(containerMaxElements)) {
    try {
      maxElements=Integer.parseInt(containerMaxElements);
    }
 catch (    NumberFormatException e) {
      LOG.warn(Messages.get().container(Messages.LOG_WRONG_CONTAINER_MAXELEMENTS_4,new Object[]{cms.getSitePath(containerPage),locale,containerName,containerMaxElements}).key());
    }
    container.setMaxElements(maxElements);
  }
  int renderElems=container.getElements().size();
  if ((maxElements > -1) && (renderElems > maxElements)) {
    renderElems=maxElements;
  }
  for (  CmsContainerElementBean element : container.getElements()) {
    if (renderElems < 1) {
      break;
    }
    renderElems--;
    Map<String,String[]> params=Collections.singletonMap(CmsADEServer.PARAMETER_URL,new String[]{cms.getRequestContext().getUri()});
    CmsResource resUri=element.getElement();
    if (resUri.getTypeId() == CmsResourceTypeContainerPage.getStaticTypeId()) {
      CmsContainerPageBean subcntPage=CmsContainerPageCache.getInstance().getCache(cms,resUri,cms.getRequestContext().getLocale());
      CmsContainerBean subcontainer=subcntPage.getContainers().values().iterator().next();
      for (      CmsContainerElementBean subelement : subcontainer.getElements()) {
        String subelementUri=cms.getSitePath(subelement.getElement());
        String subelementFormatter=cms.getSitePath(subelement.getFormatter());
        CmsJspTagInclude.includeTagAction(pageContext,subelementFormatter,subelementUri,false,params,req,res);
      }
    }
 else {
      String elementUri=cms.getSitePath(element.getElement());
      String elementFormatter=cms.getSitePath(element.getFormatter());
      CmsJspTagInclude.includeTagAction(pageContext,elementFormatter,elementUri,false,params,req,res);
    }
  }
}
