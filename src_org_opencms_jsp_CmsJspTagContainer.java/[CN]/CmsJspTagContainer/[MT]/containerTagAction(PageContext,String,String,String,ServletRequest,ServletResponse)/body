{
  CmsFlexController controller=CmsFlexController.getController(req);
  CmsObject cms=controller.getCmsObject();
  CmsResource containerPage=cms.readResource(cms.getRequestContext().getUri());
  JSONObject localeData=LOADER.getCache(cms,containerPage,cms.getRequestContext().getLocale());
  JSONObject cntData=localeData.optJSONObject(CmsContainerPageLoader.N_CONTAINER);
  if (!cntData.has(containerName)) {
    LOG.warn(Messages.get().container(Messages.LOG_CONTAINER_NOT_FOUND_3,cms.getSitePath(containerPage),localeData.optString(CmsContainerPageLoader.N_LOCALE),containerName).key());
    return;
  }
  JSONObject container=cntData.optJSONObject(containerName);
  if (!containerType.equals(container.optString(CmsContainerPageLoader.N_TYPE))) {
    LOG.warn(Messages.get().container(Messages.LOG_WRONG_CONTAINER_TYPE_4,new Object[]{cms.getSitePath(containerPage),localeData.optString(CmsContainerPageLoader.N_LOCALE),containerName,containerType}).key());
  }
  int maxElements=-1;
  if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(containerMaxElements)) {
    try {
      maxElements=Integer.parseInt(containerMaxElements);
    }
 catch (    NumberFormatException e) {
      LOG.warn(Messages.get().container(Messages.LOG_WRONG_CONTAINER_MAXELEMENTS_4,new Object[]{cms.getSitePath(containerPage),localeData.optString(CmsContainerPageLoader.N_LOCALE),containerName,containerMaxElements}).key());
    }
    try {
      container.put(CmsContainerPageLoader.N_MAXELEMENTS,maxElements);
    }
 catch (    JSONException e) {
      LOG.warn(e.getMessage(),e);
    }
  }
  JSONArray elements=container.optJSONArray(CmsContainerPageLoader.N_ELEMENT);
  int renderElems=elements.length();
  if ((maxElements > -1) && (renderElems > maxElements)) {
    renderElems=maxElements;
  }
  for (int i=0; i < renderElems; i++) {
    JSONObject element=elements.optJSONObject(i);
    String elementUri=element.optString(CmsContainerPageLoader.N_URI);
    CmsResource resUri=cms.readResource(elementUri);
    if (resUri.getTypeId() == CmsResourceTypeContainerPage.getStaticTypeId()) {
      JSONObject sublocaleData=LOADER.getCache(cms,resUri,cms.getRequestContext().getLocale());
      JSONObject subcontainers=sublocaleData.optJSONObject(CmsContainerPageLoader.N_CONTAINER);
      JSONObject subcontainer=subcontainers.optJSONObject(subcontainers.names().optString(0));
      JSONArray subelements=subcontainer.optJSONArray(CmsContainerPageLoader.N_ELEMENT);
      for (int j=0; j < subelements.length(); j++) {
        JSONObject subelement=subelements.optJSONObject(j);
        String subelementUri=subelement.optString(CmsContainerPageLoader.N_URI);
        String subelementFormatter=subelement.optString(CmsContainerPageLoader.N_FORMATTER);
        CmsJspTagInclude.includeTagAction(pageContext,subelementFormatter,subelementUri,false,null,req,res);
      }
    }
 else {
      String elementFormatter=element.optString(CmsContainerPageLoader.N_FORMATTER);
      CmsJspTagInclude.includeTagAction(pageContext,elementFormatter,elementUri,false,null,req,res);
    }
  }
}
