{
  ServletRequest req=pageContext.getRequest();
  if (CmsFlexController.isCmsRequest(req)) {
    try {
      CmsFlexController controller=CmsFlexController.getController(req);
      CmsObject cms=controller.getCmsObject();
      String requestUri=cms.getRequestContext().getUri();
      Locale locale=cms.getRequestContext().getLocale();
      CmsJspStandardContextBean standardContext=CmsJspStandardContextBean.getInstance(req);
      CmsContainerPageBean containerPage=standardContext.getPage();
      if (containerPage == null) {
        CmsResource pageResource=(CmsResource)CmsHistoryResourceHandler.getHistoryResource(req);
        if (pageResource == null) {
          pageResource=cms.readResource(requestUri);
        }
        CmsXmlContainerPage xmlContainerPage=CmsXmlContainerPageFactory.unmarshal(cms,pageResource,req);
        containerPage=xmlContainerPage.getContainerPage(cms,locale);
        standardContext.setPage(containerPage);
      }
      boolean createTag=false;
      String tagName=CmsStringUtil.isEmptyOrWhitespaceOnly(getTag()) ? DEFAULT_TAG_NAME : getTag();
      if (!CREATE_NO_TAG.equals(getTag())) {
        createTag=true;
        pageContext.getOut().print(getTagOpen(tagName,getName(),getTagClass()));
      }
      int maxElements=getMaxElements(requestUri);
      CmsContainerBean container=null;
      if (containerPage != null) {
        container=containerPage.getContainers().get(getName());
      }
      boolean isOnline=cms.getRequestContext().getCurrentProject().isOnlineProject();
      boolean isUsedAsDetailView=false;
      CmsResource detailContent=standardContext.getDetailContent();
      if (m_detailView && (detailContent != null)) {
        isUsedAsDetailView=true;
      }
      if (container == null) {
        if (!isUsedAsDetailView) {
          if (LOG.isDebugEnabled()) {
            LOG.debug(Messages.get().getBundle().key(Messages.LOG_CONTAINER_NOT_FOUND_3,requestUri,locale,getName()));
          }
          if (!isOnline) {
            try {
              pageContext.getOut().print(getContainerDataTag(new CmsContainerBean(getName(),getType(),maxElements,null),getWidth(),isUsedAsDetailView));
            }
 catch (            JSONException e) {
              throw new JspException(e);
            }
          }
          if (createTag) {
            pageContext.getOut().print(getTagClose(tagName));
          }
        }
 else {
          container=new CmsContainerBean(getName(),getType(),maxElements,Collections.<CmsContainerElementBean>emptyList());
        }
      }
      if (container != null) {
        standardContext.setContainer(container);
        if (!getType().equals(container.getType())) {
          throw new CmsIllegalStateException(Messages.get().container(Messages.LOG_WRONG_CONTAINER_TYPE_4,new Object[]{requestUri,locale,getName(),getType()}));
        }
        container.setMaxElements(maxElements);
        container.setWidth(getWidth());
        List<CmsContainerElementBean> allElements=new ArrayList<CmsContainerElementBean>();
        CmsContainerElementBean detailElement=null;
        if (isUsedAsDetailView) {
          detailElement=generateDetailViewElement(cms,detailContent);
        }
        if (detailElement != null) {
          allElements.add(detailElement);
        }
 else {
          allElements.addAll(container.getElements());
        }
        if (!isOnline) {
          try {
            CmsContainerBean cntBean=new CmsContainerBean(getName(),getType(),maxElements,allElements);
            cntBean.setAttributes(container.getAttributes());
            pageContext.getOut().print(getContainerDataTag(cntBean,getWidth(),isUsedAsDetailView));
          }
 catch (          JSONException e) {
            throw new JspException(e);
          }
        }
        for (int i=0; (i < maxElements) && (i < allElements.size()); i++) {
          try {
            renderContainerElement(cms,standardContext,allElements.get(i),locale);
          }
 catch (          Exception e) {
            if (LOG.isErrorEnabled()) {
              LOG.error(e.getLocalizedMessage(),e);
            }
          }
        }
        if (createTag) {
          pageContext.getOut().print(getTagClose(tagName));
        }
      }
    }
 catch (    Exception ex) {
      if (LOG.isErrorEnabled()) {
        LOG.error(Messages.get().getBundle().key(Messages.ERR_PROCESS_TAG_1,"container"),ex);
      }
      throw new javax.servlet.jsp.JspException(ex);
    }
  }
  return SKIP_BODY;
}
