{
  ClickHandler clickHandler=new ClickHandler(){
    /** 
 * @see com.google.gwt.event.dom.client.ClickHandler#onClick(com.google.gwt.event.dom.client.ClickEvent)
 */
    public void onClick(    ClickEvent event){
      I_CmsToolbarButton source=(I_CmsToolbarButton)event.getSource();
      source.onToolbarClick();
      if (source instanceof CmsPushButton) {
        ((CmsPushButton)source).clearHoverState();
      }
    }
  }
;
  m_toolbar=new CmsToolbar();
  RootPanel root=RootPanel.get();
  m_toolbarVisibility=new CmsStyleVariable(m_toolbar);
  root.add(m_toolbar);
  CmsPushButton toggleToolbarButton=new CmsPushButton();
  boolean initiallyVisible=CmsCoreProvider.get().isToolbarVisible();
  toggleToolbarButton.setButtonStyle(ButtonStyle.TEXT,null);
  toggleToolbarButton.setSize(Size.small);
  toggleToolbarButton.setImageClass(I_CmsImageBundle.INSTANCE.style().opencmsSymbol());
  toggleToolbarButton.removeStyleName(org.opencms.gwt.client.ui.css.I_CmsLayoutBundle.INSTANCE.generalCss().buttonCornerAll());
  toggleToolbarButton.addStyleName(org.opencms.gwt.client.ui.css.I_CmsLayoutBundle.INSTANCE.generalCss().cornerAll());
  root.add(toggleToolbarButton);
  toggleToolbarButton.addClickHandler(new ClickHandler(){
    /** 
 * @see com.google.gwt.event.dom.client.ClickHandler#onClick(com.google.gwt.event.dom.client.ClickEvent)
 */
    public void onClick(    ClickEvent event){
      toggleToolbar();
    }
  }
);
  if (initiallyVisible) {
    m_toolbarVisibility.setValue(I_CmsLayoutBundle.INSTANCE.toolbarCss().simpleToolbarShow());
  }
 else {
    m_toolbarVisibility.setValue(I_CmsLayoutBundle.INSTANCE.toolbarCss().toolbarHide());
  }
  toggleToolbarButton.addStyleName(org.opencms.gwt.client.ui.css.I_CmsLayoutBundle.INSTANCE.toolbarCss().toolbarToggle());
  CmsDirectEditToolbarHandler handler=new CmsDirectEditToolbarHandler();
  CmsToolbarPublishButton publish=new CmsToolbarPublishButton(handler);
  publish.addClickHandler(clickHandler);
  m_toolbar.addLeft(publish);
  CmsToolbarSelectionButton selection=new CmsToolbarSelectionButton(handler);
  selection.setActive(initiallyVisible);
  selection.addClickHandler(clickHandler);
  m_toolbar.addLeft(selection);
  m_selection=selection;
  CmsToolbarContextButton contextMenuButton=new CmsToolbarContextButton(handler);
  contextMenuButton.setMenuContext(AdeContext.editprovider);
  contextMenuButton.addClickHandler(clickHandler);
  m_toolbar.addRight(contextMenuButton);
  handler.setContextMenuButton(contextMenuButton);
}
