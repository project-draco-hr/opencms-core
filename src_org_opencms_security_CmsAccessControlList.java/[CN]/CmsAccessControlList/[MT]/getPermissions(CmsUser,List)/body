{
  CmsPermissionSetCustom sum=new CmsPermissionSetCustom();
  CmsPermissionSet p=(CmsPermissionSet)m_permissions.get(user.getId());
  if (p != null) {
    sum.addPermissions(p);
  }
  if (groups != null) {
    I_CmsPrincipal principal;
    if (groups instanceof RandomAccess) {
      int size=groups.size();
      for (int i=0; i < size; i++) {
        principal=(I_CmsPrincipal)groups.get(i);
        p=(CmsPermissionSet)m_permissions.get(principal.getId());
        if (p != null) {
          sum.addPermissions(p);
        }
      }
    }
 else {
      Iterator it=groups.iterator();
      while (it.hasNext()) {
        principal=(I_CmsPrincipal)it.next();
        p=(CmsPermissionSet)m_permissions.get(principal.getId());
        if (p != null) {
          sum.addPermissions(p);
        }
      }
    }
  }
  return sum;
}
