{
  if (oldPassword != null) {
    readUser(dbc,userFqn,oldPassword,"");
  }
  String pwd=newPassword;
  if (dbc.getRequestContext().getAttribute(REQ_ATTR_DONT_DIGEST_PASSWORD) == null) {
    pwd=OpenCms.getPasswordHandler().digest(newPassword);
  }
  try {
    Query q=m_sqlManager.createQuery(dbc,C_USERS_SET_PWD_3);
    q.setParameter(1,CmsOrganizationalUnit.getSimpleName(userFqn));
    q.setParameter(2,CmsOrganizationalUnit.SEPARATOR + CmsOrganizationalUnit.getParentFqn(userFqn));
    @SuppressWarnings("unchecked") List<CmsDAOUsers> res=q.getResultList();
    for (    CmsDAOUsers u : res) {
      u.setUserPassword(pwd);
    }
  }
 catch (  PersistenceException e) {
    throw new CmsDataAccessException(Messages.get().container(Messages.ERR_JPA_PERSITENCE,e),e);
  }
}
