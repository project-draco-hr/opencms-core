{
  String folderName=newPageName.substring(0,newPageName.lastIndexOf(C_FOLDER_SEPARATOR,newPageName.length()) + 1);
  String pageName=newPageName.substring(folderName.length(),newPageName.length());
  Vector allMasterTemplates=cms.getFilesInFolder(C_VFS_PATH_DEFAULT_TEMPLATES);
  String masterTemplate="";
  if (allMasterTemplates.size() > 0) {
    masterTemplate=cms.readAbsolutePath((CmsFile)allMasterTemplates.elementAt(0));
  }
  String bodyFolder=(C_VFS_PATH_BODIES.substring(0,C_VFS_PATH_BODIES.lastIndexOf("/"))) + folderName;
  CmsFile file=cms.doCreateFile(newPageName,"".getBytes(),m_resourceTypeName,properties);
  cms.doLockResource(newPageName,true);
  CmsXmlControlFile pageXml=new CmsXmlControlFile(cms,file);
  pageXml.setTemplateClass(C_CLASSNAME);
  pageXml.setMasterTemplate(masterTemplate);
  pageXml.setElementClass("body",C_CLASSNAME);
  pageXml.setElementTemplate("body",bodyFolder + pageName);
  pageXml.write();
  checkFolders(cms,folderName);
  CmsFile bodyFile=cms.doCreateFile(bodyFolder + pageName,(getDefaultBodyStart() + new String(contents) + getDefaultBodyEnd()).getBytes(),I_CmsConstants.C_TYPE_PLAIN_NAME,new Hashtable());
  cms.doLockResource(bodyFolder + pageName,true);
  int flags=bodyFile.getAccessFlags();
  if ((flags & C_ACCESS_INTERNAL_READ) == 0) {
    flags+=C_ACCESS_INTERNAL_READ;
  }
  cms.chmod(cms.readAbsolutePath(bodyFile),flags);
  if (contents.length > 1) {
    CmsPageLinks linkObject=cms.getPageLinks(newPageName);
    cms.createLinkEntrys(linkObject.getResourceId(),linkObject.getLinkTargets());
  }
  return file;
}
