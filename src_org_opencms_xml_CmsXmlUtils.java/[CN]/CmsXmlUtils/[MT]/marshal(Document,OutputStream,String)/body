{
  try {
    OutputFormat format=OutputFormat.createPrettyPrint();
    format.setEncoding(encoding);
    XMLWriter writer=new XMLWriter(out,format);
    writer.setEscapeText(false);
    writer.write(document);
    writer.close();
  }
 catch (  Exception e) {
    throw new CmsXmlException("Marshalling XML document failed",e);
  }
  return out;
}
