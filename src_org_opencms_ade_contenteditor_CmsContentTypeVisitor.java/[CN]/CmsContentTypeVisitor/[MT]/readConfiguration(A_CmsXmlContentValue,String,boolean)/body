{
  AttributeConfiguration result=null;
  String widgetName=null;
  String widgetConfig=null;
  CmsObject cms=getCmsObject();
  DisplayType displayType=DisplayType.wide;
  try {
    I_CmsXmlContentHandler contentHandler=schemaType.getContentDefinition().getContentHandler();
    displayType=contentHandler.getDisplayType(schemaType);
    I_CmsWidget widget=contentHandler.getWidget(schemaType);
    if (widget != null) {
      widgetName=widget.getClass().getName();
      if ((displayType == DisplayType.column) && !(schemaType.isSimpleType() && (schemaType.getMaxOccurs() == 1) && widget.isCompactViewEnabled())) {
        displayType=DisplayType.wide;
      }
      long timer=0;
      if (widget instanceof I_CmsADEWidget) {
        if (!checkWidgetsOnly) {
          if (CmsContentService.LOG.isDebugEnabled()) {
            timer=System.currentTimeMillis();
          }
          I_CmsADEWidget adeWidget=(I_CmsADEWidget)widget;
          widgetName=adeWidget.getWidgetName();
          widgetConfig=adeWidget.getConfiguration(cms,schemaType,m_messages,m_file,m_locale);
          if (!adeWidget.isInternal() && !m_widgetConfigurations.containsKey(widgetName)) {
            CmsExternalWidgetConfiguration externalConfiguration=new CmsExternalWidgetConfiguration(widgetName,adeWidget.getInitCall(),adeWidget.getJavaScriptResourceLinks(cms),adeWidget.getCssResourceLinks(cms));
            m_widgetConfigurations.put(widgetName,externalConfiguration);
          }
          if (CmsContentService.LOG.isDebugEnabled()) {
            CmsContentService.LOG.debug(Messages.get().getBundle().key(Messages.LOG_TAKE_READING_WIDGET_CONFIGURATION_TIME_2,widgetName,"" + (System.currentTimeMillis() - timer)));
          }
        }
      }
      m_widgets.add(widget);
    }
 else     if (contentHandler.getComplexWidget(schemaType) != null) {
      I_CmsComplexWidget complexWidget=contentHandler.getComplexWidget(schemaType);
      CmsComplexWidgetData widgetData=complexWidget.getWidgetData(m_cms);
      CmsExternalWidgetConfiguration externalConfig=widgetData.getExternalWidgetConfiguration();
      if (externalConfig != null) {
        m_widgetConfigurations.put(complexWidget.getName(),externalConfig);
      }
      m_complexWidgets.put(CmsContentService.getAttributeName(schemaType),widgetData);
    }
  }
 catch (  Exception e) {
    CmsContentService.LOG.debug(e.getMessage(),e);
  }
  result=new AttributeConfiguration(getLabel(schemaType),getHelp(schemaType),widgetName,widgetConfig,readDefaultValue(schemaType,path),displayType.name());
  return result;
}
