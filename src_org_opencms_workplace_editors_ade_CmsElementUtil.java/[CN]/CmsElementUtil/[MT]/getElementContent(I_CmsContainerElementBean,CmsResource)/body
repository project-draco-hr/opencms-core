{
  CmsTemplateLoaderFacade loaderFacade=new CmsTemplateLoaderFacade(OpenCms.getResourceManager().getLoader(formatter),element.getElement(),formatter);
  CmsResource loaderRes=loaderFacade.getLoaderStartResource();
  CmsObject cms=CmsFlexController.getController(m_req).getCmsObject();
  String oldUri=cms.getRequestContext().getUri();
  try {
    cms.getRequestContext().setUri(m_cntPageUri);
    I_CmsDirectEditProvider eb=new CmsAdvancedDirectEditProvider();
    eb.init(cms,CmsDirectEditMode.TRUE,m_cms.getSitePath(element.getElement()));
    m_req.setAttribute(I_CmsDirectEditProvider.ATTRIBUTE_DIRECT_EDIT_PROVIDER,eb);
    Object currentElement=m_req.getAttribute(CmsJspTagContainer.ATTR_CURRENT_ELEMENT);
    m_req.setAttribute(CmsJspTagContainer.ATTR_CURRENT_ELEMENT,element);
    try {
      return new String(loaderFacade.getLoader().dump(m_cms,loaderRes,null,m_cms.getRequestContext().getLocale(),m_req,m_res),CmsLocaleManager.getResourceEncoding(cms,element.getElement()));
    }
  finally {
      m_req.setAttribute(CmsJspTagContainer.ATTR_CURRENT_ELEMENT,currentElement);
    }
  }
  finally {
    cms.getRequestContext().setUri(oldUri);
  }
}
