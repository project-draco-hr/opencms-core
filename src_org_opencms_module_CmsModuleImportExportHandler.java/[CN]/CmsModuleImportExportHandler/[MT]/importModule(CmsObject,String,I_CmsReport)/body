{
  cms.checkRole(CmsRole.MODULE_MANAGER);
  CmsModule importedModule=readModuleFromImport(importResource);
  if (OpenCms.getModuleManager().hasModule(importedModule.getName())) {
    throw new CmsConfigurationException(Messages.get().container(Messages.ERR_MOD_ALREADY_INSTALLED_1,importedModule.getName()));
  }
  List dependencies=OpenCms.getModuleManager().checkDependencies(importedModule,CmsModuleManager.DEPENDENCY_MODE_IMPORT);
  if (dependencies.size() > 0) {
    StringBuffer missingModules=new StringBuffer();
    Iterator it=dependencies.iterator();
    while (it.hasNext()) {
      CmsModuleDependency dependency=(CmsModuleDependency)it.next();
      missingModules.append("  ").append(dependency.getName()).append(", Version ").append(dependency.getVersion()).append("\r\n");
    }
    throw new CmsConfigurationException(Messages.get().container(Messages.ERR_MOD_DEPENDENCY_INFO_2,importedModule.getName() + ", Version " + importedModule.getVersion(),missingModules));
  }
  OpenCms.getModuleManager().addModule(cms,importedModule);
  if (importedModule.getResourceTypes() != Collections.EMPTY_LIST) {
    OpenCms.getResourceManager().initialize(cms);
  }
  if (importedModule.getExplorerTypes() != Collections.EMPTY_LIST) {
    OpenCms.getWorkplaceManager().addExplorerTypeSettings(importedModule);
  }
  CmsImport cmsImport=new CmsImport(cms,importResource,"/",report);
  cmsImport.importResources();
}
