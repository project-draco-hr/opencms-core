{
  cms.checkRole(CmsRole.MODULE_MANAGER);
  CmsModule importedModule=readModuleFromImport(importResource);
  if (OpenCms.getModuleManager().hasModule(importedModule.getName())) {
    throw new CmsConfigurationException(Messages.get().container(Messages.ERR_MOD_ALREADY_INSTALLED_1,importedModule.getName()));
  }
  List dependencies=OpenCms.getModuleManager().checkDependencies(importedModule,CmsModuleManager.C_DEPENDENCY_MODE_IMPORT);
  if (dependencies.size() > 0) {
    String missingModules="";
    Iterator it=dependencies.iterator();
    while (it.hasNext()) {
      CmsModuleDependency dependency=(CmsModuleDependency)it.next();
      missingModules+=Messages.get().key(Messages.ERR_MOD_DEPENDENCY_INFO_2,dependency.getName(),dependency.getVersion());
    }
    throw new CmsConfigurationException(Messages.get().container(Messages.ERR_MOD_DEPENDENCY_INFO_2,missingModules));
  }
  OpenCms.getModuleManager().addModule(cms,importedModule);
  if (importedModule.getResourceTypes() != Collections.EMPTY_LIST) {
    OpenCms.getResourceManager().initialize(cms);
  }
  if (importedModule.getExplorerTypes() != Collections.EMPTY_LIST) {
    OpenCms.getWorkplaceManager().addExplorerTypeSettings(importedModule);
  }
  Vector exclusion=new Vector();
  exclusion.add(I_CmsWpConstants.C_VFS_PATH_SYSTEM);
  exclusion.add(I_CmsWpConstants.C_VFS_PATH_MODULES);
  exclusion.add(I_CmsWpConstants.C_VFS_PATH_WORKPLACE);
  exclusion.add(I_CmsWpConstants.C_VFS_PATH_GALLERIES);
  exclusion.add(I_CmsWpConstants.C_VFS_PATH_HELP);
  exclusion.add(I_CmsWpConstants.C_VFS_PATH_LOCALES);
  exclusion.add(I_CmsWpConstants.C_VFS_PATH_SCRIPTS);
  exclusion.add(I_CmsWpConstants.C_VFS_PATH_SYSTEMPICS);
  exclusion.add(I_CmsWpConstants.C_VFS_GALLERY_PICS);
  exclusion.add(I_CmsWpConstants.C_VFS_GALLERY_HTML);
  exclusion.add(I_CmsWpConstants.C_VFS_GALLERY_DOWNLOAD);
  exclusion.add(I_CmsWpConstants.C_VFS_GALLERY_EXTERNALLINKS);
  CmsImport cmsImport=new CmsImport(cms,importResource,"/",report);
  cmsImport.importResources(exclusion);
}
