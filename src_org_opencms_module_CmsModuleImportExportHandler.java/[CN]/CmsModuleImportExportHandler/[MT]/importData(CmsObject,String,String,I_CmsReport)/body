{
  CmsProject previousProject=cms.getRequestContext().currentProject();
  try {
    CmsProject importProject=null;
    try {
      cms.getRequestContext().saveSiteRoot();
      cms.getRequestContext().setSiteRoot("/");
      try {
        importProject=cms.readProject(C_IMPORT_MODULE_PROJECT_NAME);
      }
 catch (      CmsException e) {
        importProject=cms.createProject(C_IMPORT_MODULE_PROJECT_NAME,"A System generated project to import the module " + getModuleName(),OpenCms.getDefaultUsers().getGroupAdministrators(),OpenCms.getDefaultUsers().getGroupAdministrators(),I_CmsConstants.C_PROJECT_TYPE_TEMPORARY);
      }
      cms.getRequestContext().setCurrentProject(importProject);
      cms.copyResourceToProject("/");
    }
  finally {
      cms.getRequestContext().restoreSiteRoot();
    }
    importFile=importFile.replace('\\','/');
    String moduleZipName=importFile.substring(importFile.lastIndexOf('/') + 1);
    String modulePackageName;
    if (moduleZipName.toLowerCase().endsWith(".zip")) {
      modulePackageName=moduleZipName.substring(0,moduleZipName.lastIndexOf('.'));
      int pos=modulePackageName.lastIndexOf('_');
      if (pos > 0) {
        modulePackageName=modulePackageName.substring(0,pos);
      }
    }
 else {
      modulePackageName=moduleZipName;
    }
    report.print(Messages.get().container(Messages.RPT_IMPORT_MODULE_BEGIN_0),I_CmsReport.C_FORMAT_HEADLINE);
    if (report instanceof CmsHtmlReport) {
      report.print(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_ARGUMENT_1,"<i>" + modulePackageName + "</i>"));
    }
 else {
      report.print(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_ARGUMENT_1,modulePackageName));
    }
    report.print(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_DOTS_0));
    importModule(cms,importFile,report);
    report.println(Messages.get().container(Messages.RPT_PUBLISH_PROJECT_BEGIN_0),I_CmsReport.C_FORMAT_HEADLINE);
    cms.unlockProject(importProject.getId());
    cms.publishProject(report);
    report.println(Messages.get().container(Messages.RPT_PUBLISH_PROJECT_END_0),I_CmsReport.C_FORMAT_HEADLINE);
    report.println(Messages.get().container(Messages.RPT_IMPORT_MODULE_END_0),I_CmsReport.C_FORMAT_HEADLINE);
  }
 catch (  CmsXmlException e) {
    throw e;
  }
catch (  CmsImportExportException e) {
    throw e;
  }
catch (  CmsRoleViolationException e) {
    throw e;
  }
catch (  CmsException e) {
    int todo=0;
    CmsMessageContainer message=Messages.get().container(Messages.ERR_MODULE_IMPORTING_MODULE_1,importFile);
    if (LOG.isDebugEnabled()) {
      LOG.debug(message,e);
    }
    throw new CmsImportExportException(message,e);
  }
 finally {
    cms.getRequestContext().setCurrentProject(previousProject);
  }
}
