{
  getJsp().getRequest().setAttribute(SESSION_WORKPLACE_CLASS,this);
switch (getAction()) {
case ACTION_REPORT_END:
    actionCloseDialog();
  break;
case ACTION_REPORT_UPDATE:
setParamAction(REPORT_UPDATE);
getJsp().include(FILE_REPORT_OUTPUT);
break;
case ACTION_REPORT_BEGIN:
case ACTION_CONFIRMED:
default :
try {
List publishResources=null;
boolean directPublish=Boolean.valueOf(getParamDirectpublish()).booleanValue();
if (directPublish) {
publishResources=new ArrayList(getResourceList().size());
Iterator i=getResourceList().iterator();
while (i.hasNext()) {
String resName=(String)i.next();
try {
  CmsResource res=getCms().readResource(resName,CmsResourceFilter.ALL);
  publishResources.add(res);
  CmsLock lock=getCms().getLock(resName);
  if (!lock.isNullLock()) {
    getCms().unlockResource(resName);
  }
}
 catch (CmsException e) {
  addMultiOperationException(e);
}
}
checkMultiOperationException(Messages.get(),Messages.ERR_PUBLISH_MULTI_UNLOCK_0);
}
 else {
if (getCms().getRequestContext().currentProject().getType() == CmsProject.PROJECT_TYPE_TEMPORARY) {
setParamRefreshWorkplace(CmsStringUtil.TRUE);
}
}
if (showUnlockConfirmation()) {
if (directPublish) {
Iterator i=getResourceList().iterator();
while (i.hasNext()) {
  String resName=(String)i.next();
  try {
    CmsResource res=getCms().readResource(resName,CmsResourceFilter.ALL);
    if (res.isFolder()) {
      String folderName=resName;
      if (!folderName.endsWith("/")) {
        folderName+="/";
      }
      getCms().lockResource(folderName);
      getCms().unlockResource(folderName);
    }
  }
 catch (  CmsException e) {
    addMultiOperationException(e);
  }
}
checkMultiOperationException(Messages.get(),Messages.ERR_PUBLISH_MULTI_UNLOCK_0);
}
 else {
getCms().unlockProject(Integer.parseInt(getParamProjectid()));
}
}
CmsPublishList publishList=null;
if (directPublish) {
boolean publishSubResources=Boolean.valueOf(getParamSubresources()).booleanValue();
publishList=getCms().getPublishList(publishResources,Boolean.valueOf(getParamPublishsiblings()).booleanValue(),publishSubResources);
getCms().checkPublishPermissions(publishList);
}
CmsXmlDocumentLinkValidatorThread thread=new CmsXmlDocumentLinkValidatorThread(getCms(),publishList,getSettings());
setParamAction(REPORT_BEGIN);
setParamThread(thread.getUUID().toString());
setParamThreadHasNext(CmsStringUtil.TRUE);
setParamReportContinueKey(Messages.GUI_PUBLISH_CONTINUE_BROKEN_LINKS_0);
getJsp().include(FILE_REPORT_OUTPUT);
}
 catch (Throwable e) {
includeErrorpage(this,e);
}
}
}
