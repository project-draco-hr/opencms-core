{
  int pageAttribCount=0;
  pageAttribCount+=CmsStringUtil.isNotEmpty(m_pageSize) ? 1 : 0;
  pageAttribCount+=CmsStringUtil.isNotEmpty(m_pageIndex) ? 1 : 0;
  if (pageAttribCount > 0 && pageAttribCount < 2) {
    throw new IllegalArgumentException("The 'cms:contentload' tag requires a 'pageIndex' and 'pageSize' attribute, or none of them!");
  }
  if (CmsStringUtil.isEmpty(m_collector)) {
    throw new IllegalArgumentException("The 'cms:contentload' tag requires a 'collector' attribute!");
  }
  if (CmsStringUtil.isEmpty(m_param)) {
    throw new IllegalArgumentException("The 'cms:contentload' tag requires a 'param' attribute!");
  }
  m_controller=(CmsFlexController)pageContext.getRequest().getAttribute(CmsFlexController.ATTRIBUTE_NAME);
  m_cms=m_controller.getCmsObject();
  m_stringMapper=new CmsStringMapper(m_cms,pageContext);
  String collectorName=m_stringMapper.map(getCollector(),this,true);
  m_locale=m_cms.getRequestContext().getLocale();
  String param=m_stringMapper.map(getParam(),this,true);
  I_CmsResourceCollector collector=OpenCms.getResourceManager().getContentCollector(collectorName);
  try {
    m_collectorResult=collector.getResults(m_cms,collectorName,param);
    m_contentInfoBean=new CmsContentInfoBean();
    m_contentInfoBean.setPageSizeAsString(m_stringMapper.map(m_pageSize,this,true));
    m_contentInfoBean.setPageIndexAsString(m_stringMapper.map(m_pageIndex,this,true));
    m_contentInfoBean.setPageNavLengthAsString(m_stringMapper.map(m_pageNavLength,this,true));
    m_contentInfoBean.setResultSize(m_collectorResult.size());
    m_contentInfoBean.initResultIndex();
    m_collectorResult=CmsJspTagContentLoad.limitCollectorResult(m_contentInfoBean,m_collectorResult);
    m_contentInfoBean.initPageNavIndexes();
    String createParam=collector.getCreateParam(m_cms,collectorName,param);
    if (createParam != null) {
      m_directEditCreateLink=CmsEncoder.encode(collectorName + "|" + createParam);
    }
    if (m_collectorResult != null && m_collectorResult.size() > 0) {
      doLoadNextFile();
    }
  }
 catch (  CmsException e) {
    m_controller.setThrowable(e,m_cms.getRequestContext().getUri());
    throw new JspException(e);
  }
  if (m_editable) {
    String directEditOptions;
    if (m_directEditCreateLink != null) {
      directEditOptions=CmsJspTagEditable.createEditOptions(true,true,true);
      m_directEditFollowOptions=CmsJspTagEditable.createEditOptions(true,true,false);
    }
 else {
      directEditOptions=CmsJspTagEditable.createEditOptions(true,false,false);
      m_directEditFollowOptions=directEditOptions;
    }
    m_directEditPermissions=CmsJspTagEditable.includeDirectEditElement(pageContext,I_CmsEditorActionHandler.C_DIRECT_EDIT_AREA_START,m_resourceName,null,directEditOptions,null,m_directEditCreateLink);
  }
  return EVAL_BODY_INCLUDE;
}
