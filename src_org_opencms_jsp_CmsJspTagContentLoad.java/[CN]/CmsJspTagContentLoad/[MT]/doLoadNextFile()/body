{
  CmsResource resource=getNextResource();
  if (resource == null) {
    m_resourceName=null;
    m_content=null;
    return;
  }
  m_resourceName=m_cms.getSitePath(resource);
  CmsFile file=null;
  if (resource instanceof CmsFile) {
    file=(CmsFile)resource;
    if ((file.getContents() == null) || (file.getContents().length <= 0)) {
      file=null;
    }
  }
  if (file == null) {
    file=m_cms.readFile(m_resourceName,CmsResourceFilter.ALL);
  }
  m_content=CmsXmlContentFactory.unmarshal(m_cms,file,pageContext.getRequest());
  m_contentLocale=m_locale;
  if (!m_content.hasLocale(m_contentLocale)) {
    Iterator it=OpenCms.getLocaleManager().getDefaultLocales().iterator();
    while (it.hasNext()) {
      Locale locale=(Locale)it.next();
      if (m_content.hasLocale(locale)) {
        m_contentLocale=locale;
        break;
      }
    }
  }
}
