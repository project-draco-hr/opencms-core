{
  StringBuffer result=new StringBuffer(dialogToggleStart(key(Messages.GUI_PERMISSION_BEQUEATH_SUBFOLDER_0),"inheritedpermissions",getSettings().getUserSettings().getDialogExpandInheritedPermissions() || getShowInheritedPermissions()));
  Map parents=new HashMap();
  String path=CmsResource.getParentFolder(getParamResource());
  List parentResources=new ArrayList();
  try {
    parentResources=getCms().readPath(path,CmsResourceFilter.IGNORE_EXPIRATION);
  }
 catch (  CmsException e) {
    if (LOG.isInfoEnabled()) {
      LOG.info(e.getLocalizedMessage());
    }
  }
  Iterator k=parentResources.iterator();
  while (k.hasNext()) {
    CmsResource curRes=(CmsResource)k.next();
    parents.put(curRes.getResourceId(),curRes.getRootPath());
  }
  ArrayList ownEntries=new ArrayList();
  try {
    Iterator itAces=getCms().getAccessControlEntries(getParamResource(),false).iterator();
    while (itAces.hasNext()) {
      CmsAccessControlEntry curEntry=(CmsAccessControlEntry)itAces.next();
      if (!curEntry.isInherited()) {
        ownEntries.add(curEntry);
      }
    }
  }
 catch (  CmsException e) {
    if (LOG.isInfoEnabled()) {
      LOG.info(e.getLocalizedMessage());
    }
  }
  ArrayList inheritedEntries=new ArrayList();
  try {
    Iterator itAces=getCms().getAccessControlEntries(path,true).iterator();
    while (itAces.hasNext()) {
      CmsAccessControlEntry curEntry=(CmsAccessControlEntry)itAces.next();
      if ("long".equals(getSettings().getPermissionDetailView())) {
        inheritedEntries.add(curEntry);
      }
    }
  }
 catch (  CmsException e) {
    if (LOG.isInfoEnabled()) {
      LOG.info(e.getLocalizedMessage());
    }
  }
  result.append(dialogWhiteBox(HTML_START));
  result.append(buildInheritedList(inheritedEntries,parents));
  result.append(dialogWhiteBox(HTML_END));
  result.append("</div>");
  result.append(buildAddForm());
  result.append(buildResourceList(ownEntries));
  return result.toString();
}
