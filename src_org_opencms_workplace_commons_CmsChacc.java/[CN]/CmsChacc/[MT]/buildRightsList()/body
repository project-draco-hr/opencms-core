{
  StringBuffer result=new StringBuffer(dialogToggleStart(key(Messages.GUI_PERMISSION_BEQUEATH_SUBFOLDER_0),"inheritedpermissions",getSettings().getUserSettings().getDialogExpandInheritedPermissions() || getShowInheritedPermissions()));
  List allEntries=new ArrayList();
  try {
    allEntries=getCms().getAccessControlEntries(getParamResource(),true);
  }
 catch (  CmsException e) {
    if (LOG.isInfoEnabled()) {
      LOG.info(e.getLocalizedMessage());
    }
  }
  Map parents=new HashMap();
  String path=CmsResource.getParentFolder(getParamResource());
  List parentResources=new ArrayList();
  try {
    parentResources=getCms().readPath(path,CmsResourceFilter.IGNORE_EXPIRATION);
  }
 catch (  CmsException e) {
    if (LOG.isInfoEnabled()) {
      LOG.info(e.getLocalizedMessage());
    }
  }
  Iterator k=parentResources.iterator();
  while (k.hasNext()) {
    CmsResource curRes=(CmsResource)k.next();
    parents.put(curRes.getResourceId(),curRes.getRootPath());
  }
  ArrayList ownEntries=new ArrayList(0);
  ArrayList inheritedEntries=new ArrayList(0);
  for (int i=0; i < allEntries.size(); i++) {
    CmsAccessControlEntry curEntry=(CmsAccessControlEntry)allEntries.get(i);
    if (curEntry.isInherited()) {
      if ("long".equals(getSettings().getPermissionDetailView())) {
        inheritedEntries.add(curEntry);
      }
    }
 else {
      ownEntries.add(curEntry);
    }
  }
  result.append(dialogWhiteBox(HTML_START));
  result.append(buildInheritedList(inheritedEntries,parents));
  result.append(dialogWhiteBox(HTML_END));
  result.append("</div>");
  result.append(buildAddForm());
  result.append(buildResourceList(ownEntries));
  return result.toString();
}
