{
  List result=new ArrayList();
  List resources;
  try {
    resources=cms.getResourcesWithProperty(C_PROPERTY_SITE);
  }
 catch (  CmsException e) {
    if (I_CmsLogChannels.C_LOGGING && A_OpenCms.isLogging(I_CmsLogChannels.C_OPENCMS_CRITICAL)) {
      A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_CRITICAL,"CmsSite.getAvailableSites() - Error reading sites: " + e.getMessage());
    }
    resources=new ArrayList();
  }
  Iterator i=resources.iterator();
  String currentRoot=cms.getRequestContext().getSiteRoot();
  try {
    cms.getRequestContext().setSiteRoot("/");
    if (cms.getRequestContext().isAdmin() && includeRoot) {
      CmsResource res=cms.readFileHeader("/");
      result.add(new CmsSite("/",res.getId(),"/ (root site)","*"));
      if (!"".equals(currentRoot)) {
        res=cms.readFileHeader(currentRoot);
        result.add(new CmsSite(currentRoot,res.getId(),currentRoot + " (current site)","*"));
      }
    }
    while (i.hasNext()) {
      CmsResource res=(CmsResource)i.next();
      if (res.isFolder()) {
        String siteRoot=cms.readAbsolutePath(res);
        String property=cms.readProperty(siteRoot,C_PROPERTY_SITE);
        String name;
        String serverPrefix="*";
        if ((property == null) || ("".equals(property.trim()))) {
          name=siteRoot;
        }
 else {
          int pos=property.indexOf('|');
          if (pos < 0) {
            name=property.trim();
          }
 else {
            name=property.substring(0,pos).trim();
            serverPrefix=property.substring(pos + 1).trim();
          }
        }
        result.add(new CmsSite(siteRoot,res.getId(),name,serverPrefix));
      }
    }
  }
 catch (  Throwable t) {
    if (I_CmsLogChannels.C_LOGGING && A_OpenCms.isLogging(I_CmsLogChannels.C_OPENCMS_CRITICAL)) {
      A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_CRITICAL,"CmsSite.getAvailableSites() - Error reading site properties: " + t.getMessage());
    }
  }
 finally {
    cms.getRequestContext().setSiteRoot(currentRoot);
  }
  return result;
}
