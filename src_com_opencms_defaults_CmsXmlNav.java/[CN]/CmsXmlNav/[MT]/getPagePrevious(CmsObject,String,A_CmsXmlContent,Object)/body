{
  String cmsframe=((((Hashtable)userObject).get("cmsframe")).equals("plain") ? "?cmsframe=plain" : "");
  String requestedUri=cms.getRequestContext().getUri();
  String currentFolder=cms.getRequestContext().currentFolder().getAbsolutePath();
  String servletPath=((HttpServletRequest)cms.getRequestContext().getRequest().getOriginalRequest()).getServletPath();
  Vector resources=cms.getSubFolders(currentFolder);
  Vector allFile=cms.getFilesInFolder(currentFolder);
  resources.ensureCapacity(resources.size() + allFile.size());
  Enumeration e=allFile.elements();
  while (e.hasMoreElements()) {
    resources.addElement(e.nextElement());
  }
  int size=resources.size();
  String navLink[]=new String[size];
  String navText[]=new String[size];
  float navPos[]=new float[size];
  int pos=0;
  int max=extractNav(cms,resources,navLink,navText,navPos);
  for (int i=0; i < max; i++) {
    if (navLink[i].equals(currentFolder) || navLink[i].equals(requestedUri)) {
      if ((i - 1) > 0) {
        pos=i - 1;
      }
 else {
        pos=0;
      }
    }
  }
  return (servletPath + navLink[pos] + cmsframe);
}
