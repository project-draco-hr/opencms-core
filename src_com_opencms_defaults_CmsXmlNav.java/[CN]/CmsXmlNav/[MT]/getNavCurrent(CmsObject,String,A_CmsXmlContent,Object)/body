{
  CmsXmlTemplateFile template=(CmsXmlTemplateFile)doc;
  if (!template.hasData("naventry")) {
    return "".getBytes();
  }
  String currentFolder=CmsResource.getFolderPath(cms.getRequestContext().getUri());
  int level=extractLevel(cms,currentFolder) + 1;
  String exact="false";
  if (!tagcontent.equals("")) {
    try {
      if (tagcontent.indexOf(",") != -1) {
        level=Integer.parseInt(tagcontent.substring(0,tagcontent.indexOf(",")));
        exact=tagcontent.substring(tagcontent.indexOf(",") + 1).toLowerCase();
      }
 else {
        level=Integer.parseInt(tagcontent);
      }
    }
 catch (    NumberFormatException e) {
      level=extractLevel(cms,currentFolder) + 1;
      exact=tagcontent.toLowerCase();
      if (!exact.equals("true")) {
        exact="false";
      }
    }
  }
  currentFolder="/";
  StringTokenizer st=new StringTokenizer(CmsResource.getFolderPath(cms.getRequestContext().getUri()),"/");
  int count=st.countTokens() + 1;
  if (exact.equals("true") && level != count) {
    return "".getBytes();
  }
  while (st.hasMoreTokens()) {
    if (level > 1) {
      currentFolder=currentFolder + st.nextToken() + "/";
      level--;
    }
 else {
      break;
    }
  }
  Vector vfsDeps=new Vector();
  vfsDeps.add(cms.readFolder(currentFolder));
  registerVariantDeps(cms,doc.getAbsoluteFilename(),null,null,(Hashtable)userObject,vfsDeps,null,null);
  List resources=cms.getSubFolders(currentFolder);
  List allFile=cms.getFilesInFolder(currentFolder);
  ((ArrayList)resources).ensureCapacity(resources.size() + allFile.size());
  Iterator e=allFile.iterator();
  while (e.hasNext()) {
    resources.add(e.next());
  }
  if (!template.hasData("navcurrent")) {
    template.setData("navcurrent",template.getData("naventry"));
  }
  return buildNav(cms,doc,userObject,resources).getBytes();
}
