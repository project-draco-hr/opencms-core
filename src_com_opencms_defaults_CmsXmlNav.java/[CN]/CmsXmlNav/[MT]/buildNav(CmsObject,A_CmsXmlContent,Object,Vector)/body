{
  String requestedUri=cms.getRequestContext().getUri();
  String currentFolder=cms.getRequestContext().currentFolder().getAbsolutePath();
  String servletPath=cms.getRequestContext().getRequest().getServletUrl();
  CmsXmlTemplateFile template=(CmsXmlTemplateFile)doc;
  StringBuffer result=new StringBuffer();
  int size=resources.size();
  String navLink[]=new String[size];
  String navText[]=new String[size];
  float navPos[]=new float[size];
  int max=extractNav(cms,resources,navLink,navText,navPos);
  for (int i=0; i < max; i++) {
    template.setData("navtext",navText[i]);
    template.setData("navcount",new Integer(i + 1).toString());
    template.setData("navlevel",new Integer(extractLevel(cms,navLink[i])).toString());
    if (navLink[i].endsWith("/")) {
      String navIndex=cms.readProperty(navLink[i],C_PROPERTY_NAVINDEX);
      if (navIndex == null) {
        navIndex=C_NAVINDEX;
      }
      try {
        cms.readFile(navLink[i] + navIndex);
        template.setData("navlink",servletPath + navLink[i] + navIndex);
      }
 catch (      CmsException e) {
        template.setData("navlink",servletPath + requestedUri);
      }
    }
 else {
      try {
        cms.readFile(navLink[i]);
        template.setData("navlink",servletPath + navLink[i]);
      }
 catch (      CmsException e) {
        template.setData("navlink",servletPath + requestedUri);
      }
    }
    if (navLink[i].equals(currentFolder) || navLink[i].equals(requestedUri)) {
      result.append(template.getProcessedDataValue("navcurrent",this,userObject));
    }
 else {
      result.append(template.getProcessedDataValue("naventry",this,userObject));
    }
  }
  return result.toString();
}
