{
  CmsGalleryDataBean data=null;
  try {
    data=new CmsGalleryDataBean();
    data.setMode(GalleryMode.ade);
    data.setGalleryStoragePrefix("");
    data.setLocales(buildLocalesMap());
    data.setLocale(locale);
    data.setVfsRootFolders(getRootEntries());
    data.setScope(getWorkplaceSettings().getLastSearchScope());
    data.setTabIds(GalleryMode.ade.getTabs());
    data.setReferenceSitePath(getCmsObject().getRequestContext().getUri());
    List<CmsResourceTypeBean> types=buildTypesList(resourceTypes,creatableTypes,deactivatedTypes,null);
    data.setTypes(types);
    Map<String,CmsGalleryTypeInfo> adeGalleryTypeInfos=readGalleryInfosByTypeBeans(types);
    data.setGalleries(buildGalleriesList(adeGalleryTypeInfos));
    data.setStartTab(GalleryTabId.cms_tab_types);
    CmsSiteSelectorOptionBuilder optionBuilder=new CmsSiteSelectorOptionBuilder(getCmsObject());
    optionBuilder.addNormalSites(true,getWorkplaceSettings().getUserSettings().getStartFolder());
    optionBuilder.addSharedSite();
    data.setVfsSiteSelectorOptions(optionBuilder.getOptions());
    CmsSiteSelectorOptionBuilder sitemapOptionBuilder=new CmsSiteSelectorOptionBuilder(getCmsObject());
    sitemapOptionBuilder.addNormalSites(false,null);
    if (data.getReferenceSitePath() != null) {
      sitemapOptionBuilder.addCurrentSubsite(getCmsObject().addSiteRoot(data.getReferenceSitePath()));
    }
    data.setSitemapSiteSelectorOptions(sitemapOptionBuilder.getOptions());
    data.setDefaultScope(OpenCms.getWorkplaceManager().getGalleryDefaultScope());
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
  return data;
}
