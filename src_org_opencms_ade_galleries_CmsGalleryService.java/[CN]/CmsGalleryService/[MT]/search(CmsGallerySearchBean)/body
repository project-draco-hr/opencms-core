{
  CmsGallerySearchBean searchObjBean=new CmsGallerySearchBean(searchObj);
  if (searchObj == null) {
    return searchObjBean;
  }
  CmsGallerySearchParameters params=prepareSearchParams(searchObj);
  org.opencms.search.galleries.CmsGallerySearch searchBean=new org.opencms.search.galleries.CmsGallerySearch();
  if (searchObj.isIncludeExpired()) {
    CmsObject searchCms=OpenCms.initCmsObject(getCmsObject());
    searchCms.getRequestContext().setRequestTime(CmsResource.DATE_RELEASED_EXPIRED_IGNORE);
    searchBean.init(searchCms);
  }
 else {
    searchBean.init(getCmsObject());
  }
  searchBean.setIndex(CmsGallerySearchIndex.GALLERY_INDEX_NAME);
  CmsGallerySearchResultList searchResults=searchBean.getResult(params);
  searchObjBean.setSortOrder(params.getSortOrder().name());
  searchObjBean.setScope(params.getScope());
  searchObjBean.setResultCount(searchResults.getHitCount());
  searchObjBean.setPage(params.getResultPage());
  searchObjBean.setLastPage(params.getResultPage());
  searchObjBean.setResults(buildSearchResultList(searchResults,null));
  return searchObjBean;
}
