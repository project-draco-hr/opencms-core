{
  List<I_CmsResourceType> resourceTypes=null;
  Set<String> creatableTypes=null;
switch (galleryMode) {
case editor:
case view:
case adeView:
case widget:
    resourceTypes=convertTypeNamesToTypes(resourceTypesList);
  if (resourceTypes.size() == 0) {
    resourceTypes=Lists.newArrayList(getDefaultTypesForGallery());
  }
creatableTypes=Collections.<String>emptySet();
break;
case ade:
resourceTypes=new ArrayList<I_CmsResourceType>();
creatableTypes=new HashSet<String>();
try {
CmsADEConfigData config=OpenCms.getADEManager().lookupConfiguration(getCmsObject(),getCmsObject().getRequestContext().addSiteRoot(getCmsObject().getRequestContext().getUri()));
CmsUUID elementView=getSessionCache().getElementView();
for (CmsResourceTypeConfig typeConfig : config.getResourceTypes()) {
if (typeConfig.isHiddenFromAddMenu(elementView)) {
continue;
}
if (typeConfig.checkViewable(getCmsObject(),referenceSitePath)) {
String typeName=typeConfig.getTypeName();
resourceTypes.add(getResourceManager().getResourceType(typeName));
}
}
for (CmsResourceTypeConfig typeConfig : config.getCreatableTypes(getCmsObject())) {
if (typeConfig.isHiddenFromAddMenu(elementView)) {
continue;
}
String typeName=typeConfig.getTypeName();
creatableTypes.add(typeName);
}
}
 catch (CmsException e) {
error(e);
}
break;
default :
resourceTypes=Collections.<I_CmsResourceType>emptyList();
creatableTypes=Collections.<String>emptySet();
}
return buildTypesList(resourceTypes,creatableTypes,Collections.<String>emptySet(),typesForTypeTab);
}
