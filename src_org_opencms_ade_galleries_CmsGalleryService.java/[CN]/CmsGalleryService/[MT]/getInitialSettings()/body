{
  CmsGalleryDataBean data=new CmsGalleryDataBean();
  data.setMode(m_galleryMode);
  data.setLocales(buildLocalesMap());
  data.setLocale(getCmsObject().getRequestContext().getLocale().toString());
  data.setVfsRootFolders(getRootEntries());
  data.setScope(getWorkplaceSettings().getLastSearchScope());
  List<CmsResourceTypeBean> types=getResourceTypeBeans();
switch (m_galleryMode) {
case editor:
case view:
case widget:
    String referencePath=getRequest().getParameter(ReqParam.resource.name());
  data.setStartGallery(getRequest().getParameter(ReqParam.gallerypath.name()));
data.setCurrentElement(getRequest().getParameter(ReqParam.currentelement.name()));
if (CmsStringUtil.isEmptyOrWhitespaceOnly(referencePath)) {
referencePath=data.getStartGallery();
}
data.setReferenceSitePath(referencePath);
data.setTypes(types);
data.setGalleries(buildGalleriesList(readGalleryInfosByTypeBeans(types)));
data.setStartTab(GalleryTabId.cms_tab_results);
if (CmsStringUtil.isEmptyOrWhitespaceOnly(data.getStartGallery()) && !types.isEmpty()) {
data.setStartGallery(getWorkplaceSettings().getLastUsedGallery(types.get(0).getTypeId()));
}
if (CmsStringUtil.isEmptyOrWhitespaceOnly(data.getStartGallery()) && CmsStringUtil.isEmptyOrWhitespaceOnly(data.getCurrentElement())) {
data.setStartTab(GalleryTabId.cms_tab_galleries);
}
break;
case ade:
data.setReferenceSitePath(getCmsObject().getRequestContext().getUri());
data.setTypes(types);
data.setStartTab(GalleryTabId.cms_tab_types);
break;
default :
break;
}
return data;
}
