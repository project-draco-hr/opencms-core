{
  CmsProject publishProject=readProject(currentUser,currentProject,id);
  if ((isAdmin(currentUser,currentProject) || isManagerOfProject(currentUser,publishProject)) && (publishProject.getFlags() == C_PROJECT_STATE_UNLOCKED)) {
    com.opencms.file.oracleplsql.CmsDbAccess dbAccess=(com.opencms.file.oracleplsql.CmsDbAccess)m_dbAccess;
    dbAccess.publishProject(currentUser,id,onlineProject(currentUser,currentProject));
    m_subresCache.clear();
    fileSystemChanged();
    CmsProject project=readProject(currentUser,currentProject,id);
    project.setFlags(C_PROJECT_STATE_ARCHIVE);
    project.setPublishingDate(new Date().getTime());
    project.setPublishedBy(currentUser.getId());
    m_dbAccess.writeProject(project);
    m_projectCache.put(project.getId(),project);
    if (m_refresh.length() > 0) {
      try {
        URL url=new URL(m_refresh);
        URLConnection con=url.openConnection();
        con.connect();
        InputStream in=con.getInputStream();
        in.close();
      }
 catch (      Exception ex) {
        throw new CmsException(0,ex);
      }
    }
    deleteProject(currentUser,currentProject,id);
  }
 else {
    throw new CmsException("[" + this.getClass().getName() + "] could not publish project "+ id,CmsException.C_NO_ACCESS);
  }
}
