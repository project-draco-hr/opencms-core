{
  Vector changedResources=null;
  Vector changedModuleMasters=null;
  boolean success=false;
  CmsUUID publishHistoryId=new CmsUUID();
  clearcache();
synchronized (m_driverManager) {
    try {
      List offlineFiles=m_driverManager.filterOfflineFiles(getRequestContext(),directPublishResource,directPublishSiblings,report);
      m_driverManager.getHtmlLinkValidator().validateResources(this,offlineFiles,report);
      m_driverManager.publishProject(this,m_context,report,publishHistoryId,directPublishResource,directPublishSiblings);
      if (CmsXmlTemplateLoader.getOnlineElementCache() != null) {
        CmsXmlTemplateLoader.getOnlineElementCache().cleanupCache(changedResources,changedModuleMasters);
      }
      clearcache();
      success=true;
    }
 catch (    Exception e) {
      String stamp1="[" + this.getClass().getName() + ".publishProject()/1] Project:"+ m_context.currentProject().getId()+ " Time:"+ new Date();
      String stamp2="[" + this.getClass().getName() + ".publishProject()/1] User: "+ m_context.currentUser().toString();
      if (DEBUG > 0) {
        System.err.println("###################################");
        System.err.println(stamp1);
        System.err.println(stamp2);
        e.printStackTrace();
        System.err.println("Vector of changed resources:");
        if (changedResources != null) {
          for (int i=0; i < changedResources.size(); i++) {
            System.err.println("    -- " + i + " -->"+ (String)changedResources.get(i)+ "<--");
          }
        }
      }
      if (OpenCms.getLog(this).isErrorEnabled()) {
        OpenCms.getLog(this).error(stamp1);
        OpenCms.getLog(this).error(stamp2,e);
      }
    }
 finally {
      if (!success) {
        if (CmsXmlTemplateLoader.getOnlineElementCache() != null) {
          CmsXmlTemplateLoader.getOnlineElementCache().clearCache();
        }
      }
      if (m_context.currentProject().getId() == m_context.currentProject().getId() && (m_context.currentProject().getType() == I_CmsConstants.C_PROJECT_TYPE_TEMPORARY)) {
        m_context.setCurrentProject(I_CmsConstants.C_PROJECT_ONLINE_ID);
      }
      Map eventData=(Map)new HashMap();
      eventData.put("report",report);
      eventData.put("publishHistoryId",publishHistoryId.toString());
      eventData.put("context",m_context);
      CmsEvent exportPointEvent=new CmsEvent(this,I_CmsEventListener.EVENT_PUBLISH_PROJECT,eventData,false);
      OpenCms.fireCmsEvent(exportPointEvent);
    }
  }
}
