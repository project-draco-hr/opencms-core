{
  int oldProjectId=m_context.currentProject().getId();
  int retValue=-1;
  CmsResource res=null;
  if (resourcename.endsWith("/")) {
    res=readFolder(resourcename,true);
  }
 else {
    res=readFileHeader(resourcename);
  }
  if (res.isLocked()) {
    throw new CmsException("[CmsObject] cannot publish locked resource",CmsException.C_NO_ACCESS);
  }
  if (res.getState() == I_CmsConstants.C_STATE_NEW) {
    try {
      m_driverManager.readFolder(m_context,res.getParentId(),false);
    }
 catch (    CmsException ex) {
      throw new CmsException("[CmsObject] cannot read parent folder in online project",CmsException.C_NOT_FOUND);
    }
  }
  if (oldProjectId != I_CmsConstants.C_PROJECT_ONLINE_ID) {
    if (isAdmin() || isManagerOfProject()) {
      String projectName=justPrepare ? "Check direct publish" : "Direct publish";
      int newProjectId=m_driverManager.createDirectPublishProject(m_context,projectName,"","Users","Projectmanager",I_CmsConstants.C_PROJECT_TYPE_TEMPORARY).getId();
      retValue=newProjectId;
      getRequestContext().setCurrentProject(newProjectId);
      I_CmsResourceType rt=getResourceType(res.getType());
      rt.copyResourceToProject(this,resourcename);
      rt.changeLockedInProject(this,newProjectId,resourcename);
      if (!justPrepare) {
        publishProject(report);
      }
      getRequestContext().setCurrentProject(oldProjectId);
    }
 else {
      throw new CmsException("[CmsObject] cannot publish resource in current project",CmsException.C_NO_ACCESS);
    }
  }
 else {
    throw new CmsException("[CmsObject] cannot publish resource in online project",CmsException.C_NO_ACCESS);
  }
  this.fireEvent(com.opencms.flex.I_CmsEventListener.EVENT_PUBLISH_RESOURCE,res);
  return retValue;
}
