{
  CmsObject cms=getCmsObject();
  echo("Testing symmetric link / root path substitution with a custom link handler");
  CmsLinkManager lm=OpenCms.getLinkManager();
  I_CmsLinkSubstitutionHandler lh=new CmsTestLinkSubstitutionHandler();
  lm.setLinkSubstitutionHandler(cms,lh);
  cms.createResource("/system/news",CmsResourceTypeFolder.getStaticTypeId());
  cms.createResource("/system/news/text.txt",CmsResourceTypePlain.getStaticTypeId());
  OpenCms.getPublishManager().publishResource(cms,"/system/news");
  CmsResource res=cms.readResource("/system/news/text.txt");
  String link=lm.substituteLinkForRootPath(cms,res.getRootPath());
  String rootPath=lm.getRootPath(cms,link);
  assertEquals(res.getRootPath(),rootPath);
  link=lm.getServerLink(cms,res.getRootPath());
  rootPath=lm.getRootPath(cms,link);
  assertEquals(res.getRootPath(),rootPath);
}
