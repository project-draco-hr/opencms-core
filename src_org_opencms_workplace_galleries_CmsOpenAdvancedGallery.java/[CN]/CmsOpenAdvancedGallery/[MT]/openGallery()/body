{
  StringBuffer jsOpener=new StringBuffer(32);
  String galleryType=null;
  try {
    CmsResource res=getCms().readResource(getParamResource());
    if (res != null) {
      String galleryPath=getParamResource();
      if (!galleryPath.endsWith("/")) {
        galleryPath+="/";
      }
      galleryType=OpenCms.getResourceManager().getResourceType(res.getTypeId()).getTypeName();
      StringBuffer galleryUri=new StringBuffer(256);
      galleryUri.append(CmsGallerySearchServer.ADVANCED_GALLERY_PATH);
      String width="670";
      String height="540";
      galleryUri.append("?");
      galleryUri.append(CmsGallerySearchServer.ReqParam.dialogmode.toString());
      galleryUri.append("=");
      galleryUri.append(CmsGallerySearchServer.GalleryMode.view.toString());
      galleryUri.append("&");
      galleryUri.append(CmsGallerySearchServer.ReqParam.tabs.toString());
      galleryUri.append("=");
      JSONArray tabsConfig=new JSONArray();
      tabsConfig.put(CmsGallerySearchServer.TabId.cms_tab_galleries.toString());
      tabsConfig.put(CmsGallerySearchServer.TabId.cms_tab_categories.toString());
      tabsConfig.put(CmsGallerySearchServer.TabId.cms_tab_search.toString());
      galleryUri.append(tabsConfig.toString());
      galleryUri.append("&");
      galleryUri.append(CmsGallerySearchServer.ReqParam.data.toString());
      galleryUri.append("=");
      JSONObject jsonObj=new JSONObject();
      JSONObject queryObj=new JSONObject();
      JSONArray galleriesArr=new JSONArray();
      try {
        jsonObj.put(CmsGallerySearchServer.QueryKey.types.toString(),new JSONArray());
        galleriesArr.put(galleryPath);
        queryObj.put(CmsGallerySearchServer.ResponseKey.types.toString(),new JSONArray());
        queryObj.put(CmsGallerySearchServer.ResponseKey.galleries.toString(),galleriesArr);
        queryObj.put(CmsGallerySearchServer.ResponseKey.categories.toString(),new JSONArray());
        queryObj.put(CmsGallerySearchServer.QueryKey.matchesperpage.toString(),8);
        queryObj.put(CmsGallerySearchServer.QueryKey.query.toString(),"");
        queryObj.put(CmsGallerySearchServer.QueryKey.tabid.toString(),CmsGallerySearchServer.TabId.cms_tab_results);
        queryObj.put(CmsGallerySearchServer.QueryKey.page.toString(),1);
        jsonObj.put(CmsGallerySearchServer.QueryKey.querydata.toString(),queryObj);
      }
 catch (      JSONException e) {
      }
      galleryUri.append(jsonObj.toString());
      jsOpener.append("window.open('");
      jsOpener.append(getJsp().link(galleryUri.toString()));
      jsOpener.append("', '");
      jsOpener.append(galleryType);
      jsOpener.append("','width=");
      jsOpener.append(width);
      jsOpener.append(", height=");
      jsOpener.append(height);
      jsOpener.append(", resizable=yes, top=100, left=270, status=yes, scrollbars=yes,toolbar=yes');");
    }
  }
 catch (  CmsException e) {
    CmsMessageContainer message=Messages.get().container(Messages.ERR_OPEN_GALLERY_1,galleryType);
    LOG.error(message.key(),e);
    throw new CmsRuntimeException(message,e);
  }
  return jsOpener.toString();
}
