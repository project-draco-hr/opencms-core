{
  CmsGallerySearchObject searchObj=getInfoBean().getSearchObject();
  CmsGallerySearchObject preparedSearchObj=new CmsGallerySearchObject(searchObj);
  if (searchObj.getTypes().isEmpty()) {
    if (getInfoBean().getSearchObject().getGalleries().isEmpty()) {
      if (getInfoBean().getDialogMode().equals(I_CmsGalleryProviderConstants.GalleryMode.widget) || getInfoBean().getDialogMode().equals(I_CmsGalleryProviderConstants.GalleryMode.editor)) {
        ArrayList<String> availableGalleries=new ArrayList<String>();
        for (        String galleryPath : getInfoBean().getDialogInfo().getGalleries().keySet()) {
          availableGalleries.add(galleryPath);
        }
        preparedSearchObj.setGalleries(availableGalleries);
      }
      ArrayList<String> availableTypes=new ArrayList<String>();
      for (      String type : getInfoBean().getDialogInfo().getTypes().keySet()) {
        availableTypes.add(type);
      }
      preparedSearchObj.setTypes(availableTypes);
    }
 else     if (searchObj.getGalleries().size() > 0) {
      HashSet<String> contentTypes=new HashSet<String>();
      for (      Entry<String,CmsGalleriesListInfoBean> gallery : getInfoBean().getDialogInfo().getGalleries().entrySet()) {
        if (searchObj.getGalleries().contains(gallery.getKey())) {
          contentTypes.addAll(gallery.getValue().getContentTypes());
        }
      }
      ArrayList<String> availableTypes=new ArrayList<String>();
      for (      String type : getInfoBean().getDialogInfo().getTypes().keySet()) {
        availableTypes.add(type);
      }
      ArrayList<String> checkedTypes=new ArrayList<String>();
      for (      String type : contentTypes) {
        if (availableTypes.contains(type) && !checkedTypes.contains(type)) {
          checkedTypes.add(type);
        }
      }
      preparedSearchObj.setTypes(checkedTypes);
    }
    return preparedSearchObj;
  }
 else {
    return preparedSearchObj;
  }
}
