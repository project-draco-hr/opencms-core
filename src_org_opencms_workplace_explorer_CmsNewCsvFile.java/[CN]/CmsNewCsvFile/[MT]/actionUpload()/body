{
  String newResname="";
  try {
    if (CmsStringUtil.isNotEmpty(getParamCsvContent())) {
      newResname="csvcontent.html";
      setParamNewResourceName("");
    }
 else {
      setParamCsvContent(new String(getFileContentFromUpload(),CmsEncoder.ENCODING_ISO_8859_1));
      newResname=getCms().getRequestContext().getFileTranslator().translateResource(CmsResource.getName(getParamResource().replace('\\','/')));
      newResname=CmsStringUtil.changeFileNameSuffixTo(newResname,"html");
      setParamNewResourceName(newResname);
    }
    setParamResource(newResname);
    setParamResource(computeFullResourceName());
    int resTypeId=OpenCms.getResourceManager().getDefaultTypeForName(newResname).getTypeId();
    CmsProperty styleProp=CmsProperty.getNullProperty();
    String delimiter=getParamDelimiter();
    if (TABULATOR.equals(delimiter)) {
      delimiter="\t";
    }
 else     if (BEST_DELIMITER.equals(delimiter)) {
      delimiter=getPreferredDelimiter(getParamCsvContent());
    }
    setParamDelimiter(delimiter);
    String xmlContent="";
    try {
      xmlContent=getTableHtml();
    }
 catch (    IOException e) {
      throw new CmsXmlException(Messages.get().container(Messages.ERR_CSV_XML_TRANSFORMATION_FAILED_0));
    }
    if (CmsStringUtil.isNotEmpty(getParamXsltFile())) {
      xmlContent=applyXslTransformation2(getParamXsltFile(),xmlContent);
      styleProp=getCms().readPropertyObject(getParamXsltFile(),CmsPropertyDefinition.PROPERTY_STYLESHEET,true);
    }
    byte[] content=xmlContent.getBytes();
    try {
      getCms().createResource(getParamResource(),resTypeId,content,Collections.EMPTY_LIST);
    }
 catch (    CmsException e) {
      getCms().lockResource(getParamResource());
      getCms().replaceResource(getParamResource(),resTypeId,content,null);
    }
    if (!styleProp.isNullProperty()) {
      getCms().writePropertyObject(getParamResource(),styleProp);
    }
  }
 catch (  Throwable e) {
    setParamMessage(Messages.get().getBundle(getLocale()).key(Messages.ERR_TABLE_IMPORT_FAILED_0));
    includeErrorpage(this,e);
  }
}
