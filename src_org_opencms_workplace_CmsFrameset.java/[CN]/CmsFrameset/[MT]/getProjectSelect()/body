{
  CmsRequestContext reqCont=getCms().getRequestContext();
  Vector allProjects;
  try {
    allProjects=getCms().getAllAccessibleProjects();
  }
 catch (  CmsException e) {
    allProjects=new Vector();
  }
  int currentProjectId=reqCont.currentProject().getId();
  int numProjects=allProjects.size();
  int currentProjectNum=0;
  int currentLength=0;
  int maxPrjNameLen=0;
  int selectedPrjIndex=0;
  List projectIds=new ArrayList();
  List projectNames=new ArrayList();
  for (int i=0; i < numProjects; i++) {
    CmsProject loopProject=(CmsProject)allProjects.elementAt(i);
    String loopProjectName=loopProject.getName();
    String loopProjectId=loopProject.getId() + "";
    projectIds.add(loopProjectId);
    projectNames.add(loopProjectName);
    if (loopProject.getId() == currentProjectId) {
      currentProjectNum=i;
    }
    currentLength=loopProjectName.length();
    if (currentLength > maxPrjNameLen) {
      maxPrjNameLen=currentLength;
    }
  }
  selectedPrjIndex=currentProjectNum;
  if (maxPrjNameLen <= 20) {
    return buildSelect("class=\"textfeld\" name=\"wpProject\" style=\"width:150px\" onchange=\"document.forms.wpProjectSelect.submit()\"",projectNames,projectIds,selectedPrjIndex);
  }
 else {
    return buildSelect("class=\"textfeld\" name=\"wpProject\" onchange=\"document.forms.wpProjectSelect.submit()\"",projectNames,projectIds,selectedPrjIndex);
  }
}
