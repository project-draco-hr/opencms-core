{
  StringBuffer result=new StringBuffer(512);
  String sessionId=getSession().getId();
  CmsObject cms=getCms();
  CmsBroadcastMessageQueue messageQueue=OpenCms.getSessionInfoManager().getBroadcastMessageQueue(sessionId);
  if (messageQueue.hasBroadcastMessagesPending()) {
    result.append("\n<script type=\"text/javascript\">\n<!--\n");
    result.append("setTimeout(\"alert(unescape('");
    while (messageQueue.hasBroadcastMessagesPending()) {
      CmsBroadcastMessage message=messageQueue.getNextBroadcastMessage();
      StringBuffer msg=new StringBuffer(256);
      msg.append('[');
      msg.append(getSettings().getMessages().getDateTime(message.getSendTime()));
      msg.append("] Message from ");
      msg.append(message.getUser().getName());
      msg.append(":\n");
      msg.append(message.getMessage());
      msg.append("\n\n");
      result.append(CmsEncoder.escape(msg.toString(),cms.getRequestContext().getEncoding()));
    }
    result.append("'));\", 2000);");
    result.append("\n//-->\n</script>");
  }
  return result.toString();
}
