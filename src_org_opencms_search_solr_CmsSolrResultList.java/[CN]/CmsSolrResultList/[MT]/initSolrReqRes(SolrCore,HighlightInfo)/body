{
  m_solrQueryResponse=new SolrQueryResponse();
  m_solrQueryResponse.setAllValues(m_queryResponse.getResponse());
  m_solrQueryResponse.setEndTime(m_queryResponse.getQTime());
  int paramsIndex=m_queryResponse.getResponseHeader().indexOf(HEADER_PARAMS_NAME,0);
  NamedList header=null;
  Object o=m_queryResponse.getResponseHeader().getVal(paramsIndex);
  if (o instanceof NamedList) {
    header=(NamedList)o;
    header.setVal(header.indexOf(CommonParams.ROWS,0),m_rows);
    header.setVal(header.indexOf(CommonParams.START,0),getStart());
  }
  m_solrQueryRequest=new LocalSolrQueryRequest(core,m_queryResponse.getResponseHeader());
  m_solrQueryRequest.setParams(m_query);
  if ((header != null) && hli.isHighlighting()) {
    header.add(HighlightParams.HIGHLIGHT,"on");
    header.add(HighlightParams.FIELDS,CmsStringUtil.arrayAsString(hli.getFields(),","));
    header.add(HighlightParams.FRAGSIZE,new Integer(hli.getFragSize()));
    header.add(HighlightParams.FIELD_MATCH,new Boolean(hli.getReqFieldMatch()));
    header.add(HighlightParams.SIMPLE_POST,hli.getSimplePost());
    header.add(HighlightParams.SIMPLE_PRE,hli.getSimplePre());
    header.add(HighlightParams.SNIPPETS,new Integer(hli.getSnippets()));
    SearchComponent highlightComponenet=core.getSearchComponent("highlight");
    ResponseBuilder rb=new ResponseBuilder(m_solrQueryRequest,m_solrQueryResponse,Collections.singletonList(highlightComponenet));
    try {
      rb.doHighlights=true;
      DocListAndSet res=new DocListAndSet();
      res.docList=solrDocumentListToDocList(m_resultDocuments);
      rb.setResults(res);
      rb.setQuery(QParser.getParser(getQuery().getQuery(),null,m_solrQueryRequest).getQuery());
      rb.setQueryString(getQuery().getQuery());
      highlightComponenet.process(rb);
    }
 catch (    Exception e) {
      LOG.error(e);
    }
  }
}
