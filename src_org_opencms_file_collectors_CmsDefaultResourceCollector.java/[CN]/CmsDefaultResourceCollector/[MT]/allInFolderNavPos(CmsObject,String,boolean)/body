{
  CmsCollectorData data=new CmsCollectorData(param);
  String foldername=CmsResource.getFolderPath(data.getFileName());
  CmsResourceFilter filter=CmsResourceFilter.DEFAULT.addRequireType(data.getType()).addExcludeFlags(CmsResource.FLAG_INTERNAL);
  List foundResources=cms.readResources(foldername,filter,readSubTree);
  Map navElementMap=new HashMap();
  for (int i=0, n=foundResources.size(); i < n; i++) {
    CmsResource resource=(CmsResource)foundResources.get(i);
    CmsJspNavElement navElement=CmsJspNavBuilder.getNavigationForResource(cms,cms.getSitePath(resource));
    if (navElement != null && navElement.getNavPosition() != Float.MAX_VALUE) {
      navElementMap.put(navElement,resource);
    }
 else     if (LOG.isInfoEnabled()) {
      LOG.info(Messages.get().key(Messages.LOG_RESOURCE_WITHOUT_NAVPROP_1,navElement.getResourceName()));
    }
  }
  List result=null;
  if (navElementMap.size() == foundResources.size()) {
    List navElementList=new ArrayList(navElementMap.keySet());
    result=new ArrayList();
    Collections.sort(navElementList);
    for (int i=0, n=navElementList.size(); i < n; i++) {
      CmsJspNavElement navElement=(CmsJspNavElement)navElementList.get(i);
      result.add(navElementMap.get(navElement));
    }
  }
 else {
    result=foundResources;
    Collections.sort(result,CmsResource.COMPARE_DATE_RELEASED);
  }
  return shrinkToFit(result,data.getCount());
}
