{
  StringBuffer applet=new StringBuffer();
  String scheme=cms.getRequestContext().getRequest().getScheme();
  String host=cms.getRequestContext().getRequest().getServerName();
  String path=cms.getRequestContext().getRequest().getServletUrl();
  String webapp=cms.getRequestContext().getRequest().getWebAppUrl();
  int port=cms.getRequestContext().getRequest().getServerPort();
  String fileExtensions=new String("");
  Hashtable extensions=cms.readFileExtensions();
  Enumeration keys=extensions.keys();
  while (keys.hasMoreElements()) {
    String key=(String)keys.nextElement();
    String value=(String)extensions.get(key);
    fileExtensions+=key + "=" + value+ ",";
  }
  fileExtensions=fileExtensions.substring(0,fileExtensions.length() - 1);
  int maxFileSize=OpenCms.getWorkplaceManager().getFileMaxUploadSize();
  String colors="bgColor=#C0C0C0,outerBorderRightBottom=#333333,outerBorderLeftTop=#C0C0C0";
  colors+=",innerBorderRightBottom=#777777,innerBorderLeftTop=#F0F0F0";
  colors+=",bgHeadline=#000066,colorHeadline=#FFFFFF";
  colors+=",colorText=#000000,progessBar=#E10050";
  HttpSession session=null;
  HttpServletRequest request=(HttpServletRequest)cms.getRequestContext().getRequest().getOriginalRequest();
  session=request.getSession(false);
  if (session != null) {
    CmsWorkplaceSettings settings=(CmsWorkplaceSettings)session.getAttribute("__CmsWorkplace.WORKPLACE_SETTINGS");
    if (settings != null) {
      CmsWorkplaceMessages messages=settings.getMessages();
      applet.append("<applet code=\"org.opencms.applet.upload.FileUploadApplet.class\" archive=\"");
      applet.append(webapp);
      applet.append("/skins/components/upload/applet/upload.jar\" width=\"500\" height=\"100\">\n");
      applet.append("<param name=\"opencms\" value=\"");
      applet.append(scheme);
      applet.append("://");
      applet.append(host);
      applet.append(":");
      applet.append(port);
      applet.append(getSkinUri(cms));
      applet.append("filetypes/\">\n");
      applet.append("<param name=\"target\" value=\"");
      applet.append(scheme);
      applet.append("://");
      applet.append(host);
      applet.append(":");
      applet.append(port);
      applet.append(path);
      applet.append("/system/workplace/action/explorer_files_new_upload.html\">\n");
      applet.append("<param name=\"redirect\" value=\"");
      applet.append(scheme);
      applet.append("://");
      applet.append(host);
      applet.append(":");
      applet.append(port);
      applet.append(path);
      applet.append("/system/workplace/jsp/explorer_files.html\">\n");
      applet.append("<param name=error value=\"");
      applet.append(scheme);
      applet.append("://");
      applet.append(host);
      applet.append(":");
      applet.append(port);
      applet.append(path);
      applet.append("/system/workplace/action/explorer_files_new_upload.html\">\n");
      applet.append("<param name=\"browserCookie\" value=\"JSESSIONID=");
      applet.append(cms.getRequestContext().getSession(true).getId());
      applet.append("\">\n");
      applet.append("<param name=\"filelist\" value=\"");
      applet.append(currentFolder);
      applet.append("\">\n");
      applet.append("<param name=\"colors\" value=\"");
      applet.append(colors);
      applet.append("\">\n");
      applet.append("<param name=\"fileExtensions\" value=\"");
      applet.append(fileExtensions);
      applet.append("\">\n\n");
      applet.append("<param name=\"maxsize\" value=\"");
      applet.append(maxFileSize);
      applet.append("\">\n");
      applet.append("<param name=\"actionOutputSelect\" value=\"");
      applet.append(messages.key("uploadapplet.action.select"));
      applet.append("\">\n");
      applet.append("<param name=\"actionOutputCount\"value=\"");
      applet.append(messages.key("uploadapplet.action.count"));
      applet.append("\">\n");
      applet.append("<param name=\"actionOutputCreate\" value=\"");
      applet.append(messages.key("uploadapplet.action.create"));
      applet.append("\">\n");
      applet.append("<param name=\"actionOutputUpload\" value=\"");
      applet.append(messages.key("uploadapplet.action.upload"));
      applet.append("\">\n");
      applet.append("<param name=\"messageOutputUpload\" value=\"");
      applet.append(messages.key("uploadapplet.message.upload"));
      applet.append("\">\n");
      applet.append("<param name=\"messageOutputErrorZip\" value=\"");
      applet.append(messages.key("uploadapplet.message.error.zip"));
      applet.append("\">\n");
      applet.append("<param name=\"messageOutputErrorSize\" value=\"");
      applet.append(messages.key("uploadapplet.message.error.size"));
      applet.append("\">\n");
      applet.append("<param name=\"messageNoPreview\" value=\"");
      applet.append(messages.key("uploadapplet.message.nopreview"));
      applet.append("\">\n");
      applet.append("<param name=\"messageOutputAdding\" value=\"");
      applet.append(messages.key("uploadapplet.message.adding"));
      applet.append(" \">\n");
      applet.append("<param name=\"errorTitle\" value=\"");
      applet.append(messages.key("uploadapplet.error.title"));
      applet.append(" \">\n");
      applet.append("<param name=\"errorLine1\" value=\"");
      applet.append(messages.key("uploadapplet.error.line1"));
      applet.append(" \">\n");
      applet.append("</applet>\n");
    }
  }
  return applet.toString();
}
