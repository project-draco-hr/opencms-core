{
  CmsSelectQuery select=new CmsSelectQuery();
  TableAlias users=select.addTable("CMS_USERS","usr");
  if (countOnly) {
    select.addColumn("COUNT(" + users.column("USER_ID") + ")");
  }
 else {
    String[] columns=new String[]{"USER_ID","USER_NAME","USER_PASSWORD","USER_FIRSTNAME","USER_LASTNAME","USER_EMAIL","USER_LASTLOGIN","USER_FLAGS","USER_OU","USER_DATECREATED"};
    for (    String columnName : columns) {
      select.addColumn(users.column(columnName));
    }
  }
  CmsOrganizationalUnit orgUnit=searchParams.getOrganizationalUnit();
  boolean recursive=searchParams.recursiveOrgUnits();
  if (orgUnit != null) {
    addOrgUnitCondition(select,users,orgUnit,recursive);
  }
  if (searchParams.isFilterCore()) {
    select.addCondition(users.column("USER_FLAGS") + " <= " + I_CmsPrincipal.FLAG_CORE_LIMIT);
  }
  addAllowedOuCondition(select,users,searchParams.getAllowedOus());
  addFlagCondition(select,users,searchParams.getFlags());
  if (orgUnit != null) {
    addWebuserCondition(select,orgUnit,users);
  }
  addSearchFilterCondition(select,users,searchParams);
  addGroupCondition(select,users,searchParams);
  if (countOnly) {
    CmsStatementBuilder builder=new CmsStatementBuilder();
    select.visit(builder);
    return CmsPair.create(builder.getQuery(),builder.getParameters());
  }
 else {
    addSorting(select,users,searchParams);
    return makePaged(select,searchParams);
  }
}
