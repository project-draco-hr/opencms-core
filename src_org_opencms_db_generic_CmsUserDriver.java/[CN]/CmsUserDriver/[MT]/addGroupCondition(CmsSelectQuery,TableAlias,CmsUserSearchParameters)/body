{
  CmsGroup group=searchParams.getGroup();
  if (group != null) {
    CmsUUID groupId=group.getId();
    TableAlias groupUsers=select.addTable("CMS_GROUPUSERS","groupusrs");
    select.addCondition(new CmsSimpleQueryFragment(groupUsers.column("GROUP_ID") + " = ? ",groupId.toString()));
    select.addCondition(new CmsSimpleQueryFragment(groupUsers.column("USER_ID") + " = " + users.column("USER_ID")));
    if (searchParams.isFilterByGroupOu()) {
      select.addCondition(new CmsSimpleQueryFragment(users.column("USER_OU") + " = ? ",group.getOuFqn()));
    }
  }
  CmsGroup notGroup=searchParams.getNotGroup();
  if (notGroup != null) {
    CmsSimpleQueryFragment notGroupCondition=new CmsSimpleQueryFragment("NOT EXISTS (SELECT USER_ID FROM CMS_GROUPUSERS GU WHERE GU.USER_ID = " + users.column("USER_ID") + " AND GU.GROUP_ID = ?)",notGroup.getId().toString());
    select.addCondition(notGroupCondition);
  }
  Collection<CmsGroup> anyGroups=searchParams.getAnyGroups();
  if ((anyGroups != null) && !anyGroups.isEmpty()) {
    CmsCompositeQueryFragment groupClause=new CmsCompositeQueryFragment();
    groupClause.setSeparator(" OR ");
    for (    CmsGroup grp : anyGroups) {
      groupClause.add(new CmsSimpleQueryFragment("GU.GROUP_ID = ?",grp.getId().toString()));
    }
    CmsCompositeQueryFragment existsClause=new CmsCompositeQueryFragment();
    existsClause.add(new CmsSimpleQueryFragment("EXISTS (SELECT * FROM CMS_GROUPUSERS GU WHERE GU.USER_ID = " + users.column("USER_ID") + " AND "));
    existsClause.add(groupClause);
    existsClause.add(new CmsSimpleQueryFragment(" ) "));
    select.addCondition(existsClause);
  }
  Collection<CmsGroup> notAnyGroups=searchParams.getNotAnyGroups();
  if ((notAnyGroups != null) && (!notAnyGroups.isEmpty())) {
    CmsCompositeQueryFragment groupClause=new CmsCompositeQueryFragment();
    groupClause.setSeparator(" OR ");
    for (    CmsGroup grp : notAnyGroups) {
      groupClause.add(new CmsSimpleQueryFragment("GU.GROUP_ID = ?",grp.getId().toString()));
    }
    CmsCompositeQueryFragment notExistsClause=new CmsCompositeQueryFragment();
    notExistsClause.add(new CmsSimpleQueryFragment("NOT EXISTS (SELECT * FROM CMS_GROUPUSERS GU WHERE GU.USER_ID = " + users.column("USER_ID") + " AND "));
    notExistsClause.add(groupClause);
    notExistsClause.add(new CmsSimpleQueryFragment(" ) "));
    select.addCondition(notExistsClause);
  }
}
