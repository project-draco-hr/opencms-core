{
  PreparedStatement stmt=null;
  Connection conn=null;
  try {
    conn=m_sqlManager.getConnection();
    stmt=m_sqlManager.getPreparedStatement(conn,"insert_media_offline");
    for (int i=0; i < mediaToAdd.size(); i++) {
      CmsMasterMedia media=(CmsMasterMedia)mediaToAdd.get(i);
      media.setId(CmsDbUtil.nextId(m_poolUrl,"CMS_MODULE_MEDIA"));
      media.setMasterId(masterId);
      sqlFillValues(stmt,media);
      stmt.executeUpdate();
    }
  }
  finally {
    m_sqlManager.closeAll(null,conn,stmt,null);
  }
  stmt=null;
  conn=null;
  try {
    conn=m_sqlManager.getConnection();
    stmt=m_sqlManager.getPreparedStatement(conn,"update_media_offline");
    for (int i=0; i < mediaToUpdate.size(); i++) {
      CmsMasterMedia media=(CmsMasterMedia)mediaToUpdate.get(i);
      media.setMasterId(masterId);
      int rowCounter=sqlFillValues(stmt,media);
      stmt.setInt(rowCounter++,media.getId());
      stmt.setString(rowCounter++,masterId.toString());
      stmt.executeUpdate();
    }
  }
  finally {
    m_sqlManager.closeAll(null,conn,stmt,null);
  }
  stmt=null;
  conn=null;
  try {
    conn=m_sqlManager.getConnection();
    stmt=m_sqlManager.getPreparedStatement(conn,"delete_media_offline");
    for (int i=0; i < mediaToDelete.size(); i++) {
      CmsMasterMedia media=(CmsMasterMedia)mediaToDelete.get(i);
      stmt.setInt(1,media.getId());
      stmt.setString(2,masterId.toString());
      stmt.executeUpdate();
    }
  }
  finally {
    m_sqlManager.closeAll(null,conn,stmt,null);
  }
}
