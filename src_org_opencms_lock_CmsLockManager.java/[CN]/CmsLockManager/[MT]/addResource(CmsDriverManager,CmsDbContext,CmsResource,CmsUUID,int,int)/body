{
  CmsLock lock=getLock(driverManager,dbc,resource);
  String resourceName=resource.getRootPath();
  if (!lock.isNullLock() && !lock.getUserId().equals(dbc.currentUser().getId())) {
    throw new CmsLockException(Messages.get().container(Messages.ERR_RESOURCE_LOCKED_0));
  }
  if (lock.isNullLock()) {
    CmsLock newLock=new CmsLock(resourceName,userId,projectId,CmsLock.C_TYPE_EXCLUSIVE,mode);
    m_exclusiveLocks.put(resourceName,newLock);
  }
  if (CmsResource.isFolder(resourceName)) {
    Iterator i=m_exclusiveLocks.keySet().iterator();
    String lockedPath=null;
    while (i.hasNext()) {
      lockedPath=(String)i.next();
      if (lockedPath.startsWith(resourceName) && !lockedPath.equals(resourceName)) {
        i.remove();
      }
    }
  }
}
