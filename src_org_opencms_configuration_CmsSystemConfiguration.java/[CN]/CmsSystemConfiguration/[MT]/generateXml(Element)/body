{
  Element systemElement=parent.addElement(N_SYSTEM);
  if (OpenCms.getRunLevel() > 1) {
    m_localeManager=OpenCms.getLocaleManager();
    m_mailSettings=OpenCms.getSystemInfo().getMailSettings();
    m_configuredJobs=OpenCms.getScheduleManager().getJobs();
    m_versionHistoryEnabled=OpenCms.getSystemInfo().isVersionHistoryEnabled();
    m_versionHistoryMaxCount=OpenCms.getSystemInfo().getVersionHistoryMaxCount();
    m_siteManager=OpenCms.getSiteManager();
  }
  Element i18nElement=systemElement.addElement(N_I18N);
  i18nElement.addElement(N_LOCALEHANDLER).addAttribute(A_CLASS,m_localeManager.getLocaleHandler().getClass().getName());
  Iterator i;
  Element localesElement;
  localesElement=i18nElement.addElement(N_LOCALESCONFIGURED);
  i=m_localeManager.getAvailableLocales().iterator();
  while (i.hasNext()) {
    Locale locale=(Locale)i.next();
    localesElement.addElement(N_LOCALE).addText(locale.toString());
  }
  localesElement=i18nElement.addElement(N_LOCALESDEFAULT);
  i=m_localeManager.getDefaultLocales().iterator();
  while (i.hasNext()) {
    Locale locale=(Locale)i.next();
    localesElement.addElement(N_LOCALE).setText(locale.toString());
  }
  Element mailElement=systemElement.addElement(N_MAIL);
  mailElement.addElement(N_MAILFROM).setText(m_mailSettings.getMailFromDefault());
  i=m_mailSettings.getMailHosts().iterator();
  while (i.hasNext()) {
    CmsMailHost host=(CmsMailHost)i.next();
    Element hostElement=mailElement.addElement(N_MAILHOST).addAttribute(A_NAME,host.getHostname()).addAttribute(A_ORDER,host.getOrder().toString()).addAttribute(A_PROTOCOL,host.getProtocol());
    if (host.isAuthenticating()) {
      hostElement.addAttribute(A_USER,host.getUsername()).addAttribute(A_PASSWORD,host.getPassword());
    }
  }
  Element schedulerElement=systemElement.addElement(N_SCHEDULER);
  i=m_configuredJobs.iterator();
  while (i.hasNext()) {
    CmsScheduledJobInfo jobInfo=(CmsScheduledJobInfo)i.next();
    Element jobElement=schedulerElement.addElement(N_JOB);
    jobElement.addElement(N_NAME).addText(jobInfo.getJobName());
    jobElement.addElement(N_CLASS).addText(jobInfo.getClassName());
    jobElement.addElement(N_REUSEINSTANCE).addText(String.valueOf(jobInfo.isReuseInstance()));
    jobElement.addElement(N_CRONEXPRESSION).addCDATA(jobInfo.getCronExpression());
    Element contextElement=jobElement.addElement(N_CONTEXT);
    contextElement.addElement(N_USERNAME).setText(jobInfo.getContextInfo().getUserName());
    contextElement.addElement(N_PROJECT).setText(jobInfo.getContextInfo().getProjectName());
    contextElement.addElement(N_SITEROOT).setText(jobInfo.getContextInfo().getSiteRoot());
    contextElement.addElement(N_REQUESTEDURI).setText(jobInfo.getContextInfo().getRequestedUri());
    contextElement.addElement(N_LOCALE).setText(jobInfo.getContextInfo().getLocaleName());
    contextElement.addElement(N_ENCODING).setText(jobInfo.getContextInfo().getEncoding());
    contextElement.addElement(N_REMOTEADDR).setText(jobInfo.getContextInfo().getRemoteAddr());
    Element parameterElement=jobElement.addElement(N_PARAMETERS);
    ExtendedProperties jobParameters=jobInfo.getConfiguration();
    if (jobParameters != null) {
      Iterator it=jobParameters.getKeys();
      while (it.hasNext()) {
        String name=(String)it.next();
        String value=jobParameters.get(name).toString();
        Element paramNode=parameterElement.addElement(N_PARAM);
        paramNode.addAttribute(A_NAME,name);
        paramNode.addText(value);
      }
    }
  }
  systemElement.addElement(N_VERSIONHISTORY).addAttribute(A_ENABLED,new Boolean(m_versionHistoryEnabled).toString()).addAttribute(A_COUNT,new Integer(m_versionHistoryMaxCount).toString());
  Element resourceinitElement=systemElement.addElement(N_RESOURCEINIT);
  i=m_resourceInitHandlers.iterator();
  while (i.hasNext()) {
    I_CmsResourceInit clazz=(I_CmsResourceInit)i.next();
    Element handlerElement=resourceinitElement.addElement(N_RESOURCEINITHANDLER);
    handlerElement.addAttribute(A_CLASS,clazz.getClass().getName());
  }
  Element requesthandlersElement=systemElement.addElement(N_REQUESTHANDLERS);
  i=m_requestHandlers.iterator();
  while (i.hasNext()) {
    I_CmsRequestHandler clazz=(I_CmsRequestHandler)i.next();
    Element handlerElement=requesthandlersElement.addElement(N_REQUESTHANDLER);
    handlerElement.addAttribute(A_CLASS,clazz.getClass().getName());
  }
  Element passwordhandlerElement=systemElement.addElement(N_PASSWORDHANDLER).addAttribute(A_CLASS,m_passwordHandler.getClass().getName());
  passwordhandlerElement.addElement(N_PASSWORDENCODING).addText(m_passwordHandler.getInputEncoding());
  passwordhandlerElement.addElement(N_DIGESTTYPE).addText(m_passwordHandler.getDigestType());
  Element sitesElement=systemElement.addElement(N_SITES);
  sitesElement.addElement(N_WORKPLACE_SERVER).addText(m_siteManager.getWorkplaceServer());
  sitesElement.addElement(N_DEFAULT_URI).addText(m_siteManager.getDefaultUri());
  Iterator siteIterator=m_siteManager.getSites().values().iterator();
  while (siteIterator.hasNext()) {
    CmsSite site=(CmsSite)siteIterator.next();
    sitesElement.addElement(N_SITE).addAttribute(A_SERVER,site.getSiteMatcher().toString()).addAttribute(A_URI,site.getSiteRoot().concat("/"));
  }
  Element runtimepropertiesElement=systemElement.addElement(N_RUNTIMEPROPERTIES);
  if (m_runtimeProperties != null) {
    List sortedRuntimeProperties=new ArrayList(m_runtimeProperties.keySet());
    Collections.sort(sortedRuntimeProperties);
    Iterator it=sortedRuntimeProperties.iterator();
    while (it.hasNext()) {
      String key=(String)it.next();
      runtimepropertiesElement.addElement(N_PARAM).addAttribute(A_NAME,key).addText((String)m_runtimeProperties.get(key));
    }
  }
  Element runtimeinfoElement=systemElement.addElement(N_RUNTIMECLASSES);
  Element runtimeinfofactoryElement=runtimeinfoElement.addElement(N_RUNTIMEINFO);
  runtimeinfofactoryElement.addAttribute(A_CLASS,getRuntimeInfoFactory().getClass().getName());
  Element defaultusersElement=systemElement.addElement(N_DEFAULTUSERS);
  defaultusersElement.addElement(N_USER_ADMIN).addText(m_cmsDefaultUsers.getUserAdmin());
  defaultusersElement.addElement(N_USER_GUEST).addText(m_cmsDefaultUsers.getUserGuest());
  defaultusersElement.addElement(N_USER_EXPORT).addText(m_cmsDefaultUsers.getUserExport());
  defaultusersElement.addElement(N_GROUP_ADMINISTRATORS).addText(m_cmsDefaultUsers.getGroupAdministrators());
  defaultusersElement.addElement(N_GROUP_PROJECTMANAGERS).addText(m_cmsDefaultUsers.getGroupProjectmanagers());
  defaultusersElement.addElement(N_GROUP_USERS).addText(m_cmsDefaultUsers.getGroupUsers());
  defaultusersElement.addElement(N_GROUP_GUESTS).addText(m_cmsDefaultUsers.getGroupGuests());
  systemElement.addElement(N_DEFAULT_CONTENT_ENCODING).addText(getDefaultContentEncoding());
  if (m_cmsMemoryMonitorConfiguration != null) {
    Element memorymonitorElement=systemElement.addElement(N_MEMORYMONITOR);
    if (m_cmsMemoryMonitorConfiguration.getMaxUsagePercent() > 0) {
      memorymonitorElement.addElement(N_MAXUSAGE_PERCENT).addText(String.valueOf(m_cmsMemoryMonitorConfiguration.getMaxUsagePercent()));
    }
    if (m_cmsMemoryMonitorConfiguration.getLogInterval() > 0) {
      memorymonitorElement.addElement(N_LOG_INTERVAL).addText(String.valueOf(m_cmsMemoryMonitorConfiguration.getLogInterval()));
    }
    if (m_cmsMemoryMonitorConfiguration.getEmailInterval() > 0) {
      memorymonitorElement.addElement(N_EMAIL_INTERVAL).addText(String.valueOf(m_cmsMemoryMonitorConfiguration.getEmailInterval()));
    }
    if (m_cmsMemoryMonitorConfiguration.getWarningInterval() > 0) {
      memorymonitorElement.addElement(N_WARNING_INTERVAL).addText(String.valueOf(m_cmsMemoryMonitorConfiguration.getWarningInterval()));
    }
    if (m_cmsMemoryMonitorConfiguration.getEmailSender() != null) {
      memorymonitorElement.addElement(N_EMAIL_SENDER).addText(m_cmsMemoryMonitorConfiguration.getEmailSender());
    }
    List emailReceiver=m_cmsMemoryMonitorConfiguration.getEmailReceiver();
    if (!emailReceiver.isEmpty()) {
      Element emailreceiverElement=memorymonitorElement.addElement(N_EMAIL_RECEIVER);
      Iterator iter=emailReceiver.iterator();
      while (iter.hasNext()) {
        emailreceiverElement.addElement(N_RECEIVER).addText((String)iter.next());
      }
    }
  }
  Element flexcacheElement=systemElement.addElement(N_FLEXCACHE);
  flexcacheElement.addElement(N_CACHE_ENABLED).addText(String.valueOf(m_cmsFlexCacheConfiguration.isCacheEnabled()).toString());
  flexcacheElement.addElement(N_CACHE_OFFLINE).addText(String.valueOf(m_cmsFlexCacheConfiguration.isCacheOffline()).toString());
  flexcacheElement.addElement(N_MAXCACHEBYTES).addText(String.valueOf(m_cmsFlexCacheConfiguration.getMaxCacheBytes()).toString());
  flexcacheElement.addElement(N_AVGCACHEBYTES).addText(String.valueOf(m_cmsFlexCacheConfiguration.getAvgCacheBytes()).toString());
  flexcacheElement.addElement(N_MAXENTRYBYTES).addText(String.valueOf(m_cmsFlexCacheConfiguration.getMaxEntryBytes()).toString());
  flexcacheElement.addElement(N_MAXKEYS).addText(String.valueOf(m_cmsFlexCacheConfiguration.getMaxKeys()).toString());
  return systemElement;
}
