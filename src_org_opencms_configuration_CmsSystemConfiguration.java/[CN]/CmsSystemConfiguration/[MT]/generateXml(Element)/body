{
  Element systemElement=parent.addElement(N_SYSTEM);
  if (OpenCms.getRunLevel() >= OpenCms.RUNLEVEL_3_SHELL_ACCESS) {
    m_localeManager=OpenCms.getLocaleManager();
    m_mailSettings=OpenCms.getSystemInfo().getMailSettings();
    m_configuredJobs=OpenCms.getScheduleManager().getJobs();
    m_historyEnabled=OpenCms.getSystemInfo().isHistoryEnabled();
    m_historyVersions=OpenCms.getSystemInfo().getHistoryVersions();
    m_historyVersionsAfterDeletion=OpenCms.getSystemInfo().getHistoryVersionsAfterDeletion();
    m_siteManager=OpenCms.getSiteManager();
    m_loginManager=OpenCms.getLoginManager();
    m_loginMessage=OpenCms.getLoginManager().getLoginMessage();
  }
  Element i18nElement=systemElement.addElement(N_I18N);
  i18nElement.addElement(N_LOCALEHANDLER).addAttribute(A_CLASS,m_localeManager.getLocaleHandler().getClass().getName());
  Iterator i;
  Element localesElement;
  localesElement=i18nElement.addElement(N_LOCALESCONFIGURED);
  i=m_localeManager.getAvailableLocales().iterator();
  while (i.hasNext()) {
    Locale locale=(Locale)i.next();
    localesElement.addElement(N_LOCALE).addText(locale.toString());
  }
  localesElement=i18nElement.addElement(N_LOCALESDEFAULT);
  i=m_localeManager.getDefaultLocales().iterator();
  while (i.hasNext()) {
    Locale locale=(Locale)i.next();
    localesElement.addElement(N_LOCALE).setText(locale.toString());
  }
  Element mailElement=systemElement.addElement(N_MAIL);
  mailElement.addElement(N_MAILFROM).setText(m_mailSettings.getMailFromDefault());
  i=m_mailSettings.getMailHosts().iterator();
  while (i.hasNext()) {
    CmsMailHost host=(CmsMailHost)i.next();
    Element hostElement=mailElement.addElement(N_MAILHOST).addAttribute(A_NAME,host.getHostname()).addAttribute(A_ORDER,host.getOrder().toString()).addAttribute(A_PROTOCOL,host.getProtocol());
    if (host.isAuthenticating()) {
      hostElement.addAttribute(A_USER,host.getUsername()).addAttribute(A_PASSWORD,host.getPassword());
    }
  }
  Element schedulerElement=systemElement.addElement(N_SCHEDULER);
  i=m_configuredJobs.iterator();
  while (i.hasNext()) {
    CmsScheduledJobInfo jobInfo=(CmsScheduledJobInfo)i.next();
    Element jobElement=schedulerElement.addElement(N_JOB);
    jobElement.addElement(N_NAME).addText(jobInfo.getJobName());
    jobElement.addElement(N_CLASS).addText(jobInfo.getClassName());
    jobElement.addElement(N_REUSEINSTANCE).addText(String.valueOf(jobInfo.isReuseInstance()));
    jobElement.addElement(N_ACTIVE).addText(String.valueOf(jobInfo.isActive()));
    jobElement.addElement(N_CRONEXPRESSION).addCDATA(jobInfo.getCronExpression());
    Element contextElement=jobElement.addElement(N_CONTEXT);
    contextElement.addElement(N_USERNAME).setText(jobInfo.getContextInfo().getUserName());
    contextElement.addElement(N_PROJECT).setText(jobInfo.getContextInfo().getProjectName());
    contextElement.addElement(N_SITEROOT).setText(jobInfo.getContextInfo().getSiteRoot());
    contextElement.addElement(N_REQUESTEDURI).setText(jobInfo.getContextInfo().getRequestedUri());
    contextElement.addElement(N_LOCALE).setText(jobInfo.getContextInfo().getLocaleName());
    contextElement.addElement(N_ENCODING).setText(jobInfo.getContextInfo().getEncoding());
    contextElement.addElement(N_REMOTEADDR).setText(jobInfo.getContextInfo().getRemoteAddr());
    Map jobParameters=jobInfo.getConfiguration();
    if ((jobParameters != null) && (jobParameters.size() > 0)) {
      Element parameterElement=jobElement.addElement(N_PARAMETERS);
      Iterator it=jobParameters.entrySet().iterator();
      while (it.hasNext()) {
        Map.Entry entry=(Map.Entry)it.next();
        String name=(String)entry.getKey();
        String value=(String)entry.getValue();
        Element paramNode=parameterElement.addElement(N_PARAM);
        paramNode.addAttribute(A_NAME,name);
        paramNode.addText(value);
      }
    }
  }
  Element eventsElement=systemElement.addElement(N_EVENTS);
  Element eventManagerElement=eventsElement.addElement(N_EVENTMANAGER);
  eventManagerElement.addAttribute(A_CLASS,m_eventManager.getClass().getName());
  Element historyElement=systemElement.addElement(N_VERSIONHISTORY);
  historyElement.addAttribute(A_ENABLED,String.valueOf(m_historyEnabled));
  historyElement.addAttribute(A_COUNT,new Integer(m_historyVersions).toString());
  historyElement.addAttribute(A_DELETED,new Integer(m_historyVersionsAfterDeletion).toString());
  Element resourceinitElement=systemElement.addElement(N_RESOURCEINIT);
  i=m_resourceInitHandlers.iterator();
  while (i.hasNext()) {
    I_CmsResourceInit clazz=(I_CmsResourceInit)i.next();
    Element handlerElement=resourceinitElement.addElement(N_RESOURCEINITHANDLER);
    handlerElement.addAttribute(A_CLASS,clazz.getClass().getName());
  }
  Element requesthandlersElement=systemElement.addElement(N_REQUESTHANDLERS);
  i=m_requestHandlers.iterator();
  while (i.hasNext()) {
    I_CmsRequestHandler clazz=(I_CmsRequestHandler)i.next();
    Element handlerElement=requesthandlersElement.addElement(N_REQUESTHANDLER);
    handlerElement.addAttribute(A_CLASS,clazz.getClass().getName());
  }
  Element passwordhandlerElement=systemElement.addElement(N_PASSWORDHANDLER).addAttribute(A_CLASS,m_passwordHandler.getClass().getName());
  passwordhandlerElement.addElement(N_PASSWORDENCODING).addText(m_passwordHandler.getInputEncoding());
  passwordhandlerElement.addElement(N_DIGESTTYPE).addText(m_passwordHandler.getDigestType());
  Map handlerParameters=m_passwordHandler.getConfiguration();
  if (handlerParameters != null) {
    Iterator it=handlerParameters.entrySet().iterator();
    while (it.hasNext()) {
      Map.Entry entry=(Map.Entry)it.next();
      String name=(String)entry.getKey();
      String value=(String)entry.getValue();
      Element paramNode=passwordhandlerElement.addElement(N_PARAM);
      paramNode.addAttribute(A_NAME,name);
      paramNode.addText(value);
    }
  }
  if (m_validationHandler != null) {
    Element valHandlerElem=systemElement.addElement(N_VALIDATIONHANDLER);
    valHandlerElem.addAttribute(A_CLASS,m_validationHandler);
  }
  if (m_loginManager != null) {
    Element managerElement=systemElement.addElement(N_LOGINMANAGER);
    managerElement.addElement(N_DISABLEMINUTES).addText(String.valueOf(m_loginManager.getDisableMinutes()));
    managerElement.addElement(N_MAXBADATTEMPTS).addText(String.valueOf(m_loginManager.getMaxBadAttempts()));
  }
  if (m_loginMessage != null) {
    Element messageElement=systemElement.addElement(N_LOGINMESSAGE);
    messageElement.addElement(N_ENABLED).addText(String.valueOf(m_loginMessage.isEnabled()));
    messageElement.addElement(N_MESSAGE).addCDATA(m_loginMessage.getMessage());
    messageElement.addElement(N_LOGINFORBIDDEN).addText(String.valueOf(m_loginMessage.isLoginForbidden()));
    if (m_loginMessage.getTimeStart() != CmsLoginMessage.DEFAULT_TIME_START) {
      messageElement.addElement(N_TIMESTART).addText(String.valueOf(m_loginMessage.getTimeStart()));
    }
    if (m_loginMessage.getTimeEnd() != CmsLoginMessage.DEFAULT_TIME_END) {
      messageElement.addElement(N_TIMEEND).addText(String.valueOf(m_loginMessage.getTimeEnd()));
    }
  }
  Element sitesElement=systemElement.addElement(N_SITES);
  sitesElement.addElement(N_WORKPLACE_SERVER).addText(m_siteManager.getWorkplaceServer());
  sitesElement.addElement(N_DEFAULT_URI).addText(m_siteManager.getDefaultUri());
  Iterator siteIterator=new HashSet(m_siteManager.getSites().values()).iterator();
  while (siteIterator.hasNext()) {
    CmsSite site=(CmsSite)siteIterator.next();
    Element siteElement=sitesElement.addElement(N_SITE);
    siteElement.addAttribute(A_SERVER,site.getSiteMatcher().toString());
    siteElement.addAttribute(A_URI,site.getSiteRoot().concat("/"));
    if (site.hasSecureServer()) {
      Element secureElem=siteElement.addElement(N_SECURE);
      secureElem.addAttribute(A_SERVER,site.getSecureUrl());
      secureElem.addAttribute(A_EXCLUSIVE,"" + site.isExclusiveUrl());
      secureElem.addAttribute(A_ERROR,"" + site.isExclusiveError());
    }
    Iterator aliasIterator=site.getAliases().iterator();
    while (aliasIterator.hasNext()) {
      CmsSiteMatcher matcher=(CmsSiteMatcher)aliasIterator.next();
      Element aliasElement=siteElement.addElement(N_ALIAS);
      aliasElement.addAttribute(A_SERVER,matcher.getUrl());
      if (matcher.getTimeOffset() != 0) {
        aliasElement.addAttribute(A_OFFSET,"" + matcher.getTimeOffset());
      }
    }
  }
  Element runtimepropertiesElement=systemElement.addElement(N_RUNTIMEPROPERTIES);
  if (m_runtimeProperties != null) {
    List sortedRuntimeProperties=new ArrayList(m_runtimeProperties.keySet());
    Collections.sort(sortedRuntimeProperties);
    Iterator it=sortedRuntimeProperties.iterator();
    while (it.hasNext()) {
      String key=(String)it.next();
      runtimepropertiesElement.addElement(N_PARAM).addAttribute(A_NAME,key).addText((String)m_runtimeProperties.get(key));
    }
  }
  Element runtimeinfoElement=systemElement.addElement(N_RUNTIMECLASSES);
  Element runtimeinfofactoryElement=runtimeinfoElement.addElement(N_RUNTIMEINFO);
  runtimeinfofactoryElement.addAttribute(A_CLASS,getRuntimeInfoFactory().getClass().getName());
  Element defaultusersElement=systemElement.addElement(N_DEFAULTUSERS);
  defaultusersElement.addElement(N_USER_ADMIN).addText(m_cmsDefaultUsers.getUserAdmin());
  defaultusersElement.addElement(N_USER_GUEST).addText(m_cmsDefaultUsers.getUserGuest());
  defaultusersElement.addElement(N_USER_EXPORT).addText(m_cmsDefaultUsers.getUserExport());
  if (!m_cmsDefaultUsers.getUserDeletedResource().equals(m_cmsDefaultUsers.getUserAdmin())) {
    defaultusersElement.addElement(N_USER_DELETEDRESOURCE).addText(m_cmsDefaultUsers.getUserDeletedResource());
  }
  defaultusersElement.addElement(N_GROUP_ADMINISTRATORS).addText(m_cmsDefaultUsers.getGroupAdministrators());
  defaultusersElement.addElement(N_GROUP_PROJECTMANAGERS).addText(m_cmsDefaultUsers.getGroupProjectmanagers());
  defaultusersElement.addElement(N_GROUP_USERS).addText(m_cmsDefaultUsers.getGroupUsers());
  defaultusersElement.addElement(N_GROUP_GUESTS).addText(m_cmsDefaultUsers.getGroupGuests());
  systemElement.addElement(N_DEFAULT_CONTENT_ENCODING).addText(getDefaultContentEncoding());
  if (m_cmsMemoryMonitorConfiguration != null) {
    Element memorymonitorElement=systemElement.addElement(N_MEMORYMONITOR);
    if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(m_cmsMemoryMonitorConfiguration.getClassName())) {
      memorymonitorElement.addAttribute(A_CLASS,m_cmsMemoryMonitorConfiguration.getClassName());
    }
    if (m_cmsMemoryMonitorConfiguration.getMaxUsagePercent() > 0) {
      memorymonitorElement.addElement(N_MAXUSAGE_PERCENT).addText(String.valueOf(m_cmsMemoryMonitorConfiguration.getMaxUsagePercent()));
    }
    if (m_cmsMemoryMonitorConfiguration.getLogInterval() > 0) {
      memorymonitorElement.addElement(N_LOG_INTERVAL).addText(String.valueOf(m_cmsMemoryMonitorConfiguration.getLogInterval()));
    }
    if (m_cmsMemoryMonitorConfiguration.getEmailInterval() > 0) {
      memorymonitorElement.addElement(N_EMAIL_INTERVAL).addText(String.valueOf(m_cmsMemoryMonitorConfiguration.getEmailInterval()));
    }
    if (m_cmsMemoryMonitorConfiguration.getWarningInterval() > 0) {
      memorymonitorElement.addElement(N_WARNING_INTERVAL).addText(String.valueOf(m_cmsMemoryMonitorConfiguration.getWarningInterval()));
    }
    if (m_cmsMemoryMonitorConfiguration.getEmailSender() != null) {
      memorymonitorElement.addElement(N_EMAIL_SENDER).addText(m_cmsMemoryMonitorConfiguration.getEmailSender());
    }
    List emailReceiver=m_cmsMemoryMonitorConfiguration.getEmailReceiver();
    if (!emailReceiver.isEmpty()) {
      Element emailreceiverElement=memorymonitorElement.addElement(N_EMAIL_RECEIVER);
      Iterator iter=emailReceiver.iterator();
      while (iter.hasNext()) {
        emailreceiverElement.addElement(N_RECEIVER).addText((String)iter.next());
      }
    }
  }
  Element flexcacheElement=systemElement.addElement(N_FLEXCACHE);
  flexcacheElement.addElement(N_CACHE_ENABLED).addText(String.valueOf(m_cmsFlexCacheConfiguration.isCacheEnabled()));
  flexcacheElement.addElement(N_CACHE_OFFLINE).addText(String.valueOf(m_cmsFlexCacheConfiguration.isCacheOffline()));
  flexcacheElement.addElement(N_MAXCACHEBYTES).addText(String.valueOf(m_cmsFlexCacheConfiguration.getMaxCacheBytes()));
  flexcacheElement.addElement(N_AVGCACHEBYTES).addText(String.valueOf(m_cmsFlexCacheConfiguration.getAvgCacheBytes()));
  flexcacheElement.addElement(N_MAXENTRYBYTES).addText(String.valueOf(m_cmsFlexCacheConfiguration.getMaxEntryBytes()));
  flexcacheElement.addElement(N_MAXKEYS).addText(String.valueOf(m_cmsFlexCacheConfiguration.getMaxKeys()));
  Element httpAuthenticationElement=systemElement.addElement(N_HTTP_AUTHENTICATION);
  httpAuthenticationElement.addElement(N_BROWSER_BASED).setText(Boolean.toString(m_httpAuthenticationSettings.useBrowserBasedHttpAuthentication()));
  if (m_httpAuthenticationSettings.getFormBasedHttpAuthenticationUri() != null) {
    httpAuthenticationElement.addElement(N_FORM_BASED).setText(m_httpAuthenticationSettings.getFormBasedHttpAuthenticationUri());
  }
  Element cacheElement=systemElement.addElement(N_CACHE);
  cacheElement.addElement(N_KEYGENERATOR).setText(m_cacheSettings.getCacheKeyGenerator());
  cacheElement.addElement(N_SIZE_USERS).setText(Integer.toString(m_cacheSettings.getUserCacheSize()));
  cacheElement.addElement(N_SIZE_GROUPS).setText(Integer.toString(m_cacheSettings.getGroupCacheSize()));
  if (m_cacheSettings.getConfiguredOrgUnitCacheSize() > -1) {
    cacheElement.addElement(N_SIZE_ORGUNITS).setText(Integer.toString(m_cacheSettings.getConfiguredOrgUnitCacheSize()));
  }
  cacheElement.addElement(N_SIZE_USERGROUPS).setText(Integer.toString(m_cacheSettings.getUserGroupsCacheSize()));
  cacheElement.addElement(N_SIZE_PROJECTS).setText(Integer.toString(m_cacheSettings.getProjectCacheSize()));
  if (m_cacheSettings.getConfiguredProjectResourcesCacheSize() > -1) {
    cacheElement.addElement(N_SIZE_PROJECTRESOURCES).setText(Integer.toString(m_cacheSettings.getConfiguredProjectResourcesCacheSize()));
  }
  cacheElement.addElement(N_SIZE_RESOURCES).setText(Integer.toString(m_cacheSettings.getResourceCacheSize()));
  if (m_cacheSettings.getConfiguredRolesCacheSize() > -1) {
    cacheElement.addElement(N_SIZE_ROLES).setText(Integer.toString(m_cacheSettings.getConfiguredRolesCacheSize()));
  }
  cacheElement.addElement(N_SIZE_RESOURCELISTS).setText(Integer.toString(m_cacheSettings.getResourcelistCacheSize()));
  cacheElement.addElement(N_SIZE_PROPERTIES).setText(Integer.toString(m_cacheSettings.getPropertyCacheSize()));
  if (m_cacheSettings.getConfiguredPropertyListsCacheSize() > -1) {
    cacheElement.addElement(N_SIZE_PROPERTYLISTS).setText(Integer.toString(m_cacheSettings.getConfiguredPropertyListsCacheSize()));
  }
  cacheElement.addElement(N_SIZE_ACLS).setText(Integer.toString(m_cacheSettings.getAclCacheSize()));
  cacheElement.addElement(N_SIZE_PERMISSIONS).setText(Integer.toString(m_cacheSettings.getPermissionCacheSize()));
  if ((m_notificationTime != null) || (m_notificationProject != null)) {
    Element notificationElement=systemElement.addElement(N_CONTENT_NOTIFICATION);
    if (m_notificationTime != null) {
      notificationElement.addElement(N_NOTIFICATION_TIME).setText(m_notificationTime.toString());
    }
    if (m_notificationProject != null) {
      notificationElement.addElement(N_NOTIFICATION_PROJECT).setText(m_notificationProject);
    }
  }
  if (m_authorizationHandler != null) {
    Element authorizationHandlerElem=systemElement.addElement(N_AUTHORIZATIONHANDLER);
    authorizationHandlerElem.addAttribute(A_CLASS,m_authorizationHandler);
  }
  if (m_publishManager != null) {
    Element pubHistElement=systemElement.addElement(N_PUBLISHMANAGER);
    pubHistElement.addElement(N_HISTORYSIZE).setText(String.valueOf(m_publishManager.getPublishHistorySize()));
    pubHistElement.addElement(N_QUEUEPERSISTANCE).setText(String.valueOf(m_publishManager.isPublishQueuePersistanceEnabled()));
    pubHistElement.addElement(N_QUEUESHUTDOWNTIME).setText(String.valueOf(m_publishManager.getPublishQueueShutdowntime()));
  }
  if (m_sessionStorageProvider != null) {
    Element sessionStorageProviderElem=systemElement.addElement(N_SESSION_STORAGEPROVIDER);
    sessionStorageProviderElem.addAttribute(A_CLASS,m_sessionStorageProvider);
  }
  if (m_permissionHandler != null) {
    Element permissionHandlerElem=systemElement.addElement(N_PERMISSIONHANDLER);
    permissionHandlerElem.addAttribute(A_CLASS,m_permissionHandler);
  }
  return systemElement;
}
