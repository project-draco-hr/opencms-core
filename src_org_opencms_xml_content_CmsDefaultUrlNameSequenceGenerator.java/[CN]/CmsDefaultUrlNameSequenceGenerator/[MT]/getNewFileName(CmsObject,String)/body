{
  String checkPattern=cms.getRequestContext().removeSiteRoot(namePattern);
  String folderName=CmsResource.getFolderPath(checkPattern);
  List<CmsResource> resources=cms.readResources(folderName,CmsResourceFilter.ALL,false);
  List<String> fileNames=new ArrayList<String>(resources.size());
  for (  CmsResource res : resources) {
    fileNames.add(cms.getSitePath(res));
  }
  String checkFileName, checkTempFileName, number;
  CmsMacroResolver resolver=CmsMacroResolver.newInstance();
  int j=0;
  do {
    number=I_CmsFileNameGenerator.NUMBER_FORMAT.sprintf(++j);
    resolver.addMacro(I_CmsFileNameGenerator.MACRO_NUMBER,number);
    checkFileName=resolver.resolveMacros(checkPattern);
    checkTempFileName=CmsWorkplace.getTemporaryFileName(checkFileName);
  }
 while (fileNames.contains(checkFileName) || fileNames.contains(checkTempFileName));
  return checkFileName;
}
