{
  CmsObject cms=getCmsObject();
  CmsProject prj=cms.getRequestContext().getCurrentProject();
  String site=cms.getRequestContext().getSiteRoot();
  cms.loginUser("test1","test1");
  cms.getRequestContext().setCurrentProject(prj);
  cms.getRequestContext().setSiteRoot(site);
  CmsPublish adePub=new CmsPublish(cms);
  List<CmsPublishGroup> groups=adePub.getPublishGroups();
  assertEquals(0,groups.size());
  String resourcename="/index.html";
  cms.lockResource(resourcename);
  cms.setDateLastModified(resourcename,System.currentTimeMillis(),false);
  cms.unlockResource(resourcename);
  CmsResource resource=cms.readResource(resourcename);
  adePub=new CmsPublish(cms);
  groups=adePub.getPublishGroups();
  assertEquals(1,groups.size());
  assertEquals(1,groups.get(0).getResources().size());
  assertEquals(resource.getStructureId(),groups.get(0).getResources().get(0).getId());
  assertTrue(groups.get(0).getResources().get(0).isRemovable());
  assertEquals(CmsPublishResourceInfo.Type.PERMISSIONS,groups.get(0).getResources().get(0).getInfo().getType());
  assertEquals(0,groups.get(0).getResources().get(0).getRelated().size());
  cms=getCmsObject();
  cms.lockResource(resourcename);
  cms.chacc(resourcename,I_CmsPrincipal.PRINCIPAL_USER,"test1","+d");
  cms.unlockResource(resourcename);
  cms.loginUser("test1","test1");
  cms.getRequestContext().setCurrentProject(prj);
  cms.getRequestContext().setSiteRoot(site);
  adePub=new CmsPublish(cms);
  groups=adePub.getPublishGroups();
  assertEquals(1,groups.size());
  assertEquals(1,groups.get(0).getResources().size());
  assertEquals(resource.getStructureId(),groups.get(0).getResources().get(0).getId());
  assertTrue(groups.get(0).getResources().get(0).isRemovable());
  assertNull(groups.get(0).getResources().get(0).getInfo());
  assertEquals(0,groups.get(0).getResources().get(0).getRelated().size());
  adePub.publishResources(Collections.singletonList(resource));
  OpenCms.getPublishManager().waitWhileRunning();
  adePub=new CmsPublish(cms);
  groups=adePub.getPublishGroups();
  assertEquals(0,groups.size());
  cms=getCmsObject();
  adePub=new CmsPublish(cms);
  groups=adePub.getPublishGroups();
  assertEquals(1,groups.size());
  OpenCms.getPublishManager().removeResourceFromUsersPubList(cms,Collections.singleton(resource.getStructureId()));
  adePub=new CmsPublish(cms);
  groups=adePub.getPublishGroups();
  assertEquals(0,groups.size());
}
