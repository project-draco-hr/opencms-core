{
  CmsObject cms=getCmsObject();
  CmsPublish adePub=new CmsPublish(cms);
  List<CmsPublishGroup> groups=adePub.getPublishGroups();
  assertEquals(0,groups.size());
  String resourcename="/folder1/subfolder12/subsubfolder121/image1.gif";
  cms.lockResource(resourcename);
  cms.deleteResource(resourcename,CmsResource.DELETE_REMOVE_SIBLINGS);
  CmsResource resource=cms.readResource(resourcename,CmsResourceFilter.ALL);
  adePub=new CmsPublish(cms);
  groups=adePub.getPublishGroups();
  assertEquals(1,groups.size());
  assertEquals(1,groups.get(0).getResources().size());
  assertEquals(resource.getStructureId(),groups.get(0).getResources().get(0).getId());
  assertTrue(groups.get(0).getResources().get(0).isRemovable());
  assertNull(groups.get(0).getResources().get(0).getInfo());
  assertEquals(0,groups.get(0).getResources().get(0).getRelated().size());
  CmsResource source=cms.readResource("/folder1/subfolder12/subsubfolder121/page1.html");
  List<CmsPublishResource> broken=adePub.getBrokenResources(Collections.singletonList(resource));
  assertEquals(1,broken.size());
  assertEquals(source.getStructureId(),broken.get(0).getId());
  assertFalse(broken.get(0).isRemovable());
  assertNull(broken.get(0).getInfo());
  assertEquals(1,broken.get(0).getRelated().size());
  assertEquals(resource.getStructureId(),broken.get(0).getRelated().get(0).getId());
  assertFalse(broken.get(0).getRelated().get(0).isRemovable());
  assertEquals(CmsPublishResourceInfo.Type.BROKENLINK,broken.get(0).getRelated().get(0).getInfo().getType());
  assertEquals(0,broken.get(0).getRelated().get(0).getRelated().size());
  assertFalse(cms.existsResource(resourcename,CmsResourceFilter.DEFAULT));
  assertTrue(cms.existsResource(resourcename,CmsResourceFilter.ALL));
  adePub.publishResources(Collections.singletonList(resource));
  OpenCms.getPublishManager().waitWhileRunning();
  assertFalse(cms.existsResource(resourcename,CmsResourceFilter.ALL));
  adePub=new CmsPublish(cms);
  groups=adePub.getPublishGroups();
  assertEquals(0,groups.size());
  cms.restoreDeletedResource(resource.getStructureId());
}
