{
  if (resource.isLocked()) {
    if (!resource.isLockedBy().equals(cms.getRequestContext().currentUser().getId())) {
      cms.lockResource(resource.getAbsolutePath(),true);
    }
    cms.unlockResource(resource.getAbsolutePath());
  }
 else {
    Vector allFiles=cms.getFilesInFolder(resource.getAbsolutePath());
    Vector allFolders=cms.getSubFolders(resource.getAbsolutePath());
    for (int i=0; i < allFiles.size(); i++) {
      CmsResource curFile=(CmsResource)allFiles.elementAt(i);
      if (curFile.isLocked()) {
        if (!resource.isLockedBy().equals(cms.getRequestContext().currentUser().getId())) {
          cms.lockResource(curFile.getAbsolutePath(),true);
        }
        cms.unlockResource(curFile.getAbsolutePath());
      }
    }
    for (int j=0; j < allFolders.size(); j++) {
      CmsResource curFolder=(CmsResource)allFolders.elementAt(j);
      unlockResource(cms,curFolder);
    }
  }
}
