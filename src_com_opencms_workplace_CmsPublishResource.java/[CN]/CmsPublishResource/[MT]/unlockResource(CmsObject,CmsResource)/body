{
  if (resource.isLocked()) {
    if (!resource.isLockedBy().equals(cms.getRequestContext().currentUser().getId())) {
      cms.lockResource(cms.readAbsolutePath(resource),true);
    }
    cms.unlockResource(cms.readAbsolutePath(resource));
  }
 else {
    Vector allFiles=cms.getFilesInFolder(cms.readAbsolutePath(resource));
    Vector allFolders=cms.getSubFolders(cms.readAbsolutePath(resource));
    for (int i=0; i < allFiles.size(); i++) {
      CmsResource curFile=(CmsResource)allFiles.elementAt(i);
      if (curFile.isLocked()) {
        if (!resource.isLockedBy().equals(cms.getRequestContext().currentUser().getId())) {
          cms.lockResource(cms.readAbsolutePath(curFile),true);
        }
        cms.unlockResource(cms.readAbsolutePath(curFile));
      }
    }
    for (int j=0; j < allFolders.size(); j++) {
      CmsResource curFolder=(CmsResource)allFolders.elementAt(j);
      unlockResource(cms,curFolder);
    }
  }
}
