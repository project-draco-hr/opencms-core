{
  CmsLoginUI.Parameters params=new Parameters(m_pcType,m_oufqn,m_locale,CmsRequestUtil.getNotEmptyParameter(getRequest(),CmsWorkplaceManager.PARAM_LOGIN_REQUESTED_RESOURCE));
  getJspContext().getSession().setAttribute(CmsLoginUI.INIT_DATA_SESSION_ATTR,params);
  try {
    byte[] pageBytes=CmsFileUtil.readFully(getClass().getClassLoader().getResourceAsStream("org/opencms/ui/login/login-page.html"));
    String page=new String(pageBytes,"UTF-8");
    CmsMacroResolver resolver=new CmsMacroResolver();
    String context=OpenCms.getSystemInfo().getContextPath();
    String vaadinDir=CmsStringUtil.joinPaths(context,"VAADIN/");
    String vaadinServlet=CmsStringUtil.joinPaths(context,"opencms-login/");
    String vaadinBootstrap=CmsStringUtil.joinPaths(context,"VAADIN/vaadinBootstrap.js");
    String autocomplete=((m_pcType == null) || m_pcType.equals(CmsLogin.PCTYPE_PRIVATE)) ? "on" : "off";
    String cmsLogo=OpenCms.getSystemInfo().getContextPath() + CmsWorkplace.RFS_PATH_RESOURCES + "commons/login_logo.png";
    resolver.addMacro("vaadinDir",vaadinDir);
    resolver.addMacro("vaadinServlet",vaadinServlet);
    resolver.addMacro("vaadinBootstrap",vaadinBootstrap);
    resolver.addMacro("cmsLogo",cmsLogo);
    resolver.addMacro("autocomplete",autocomplete);
    resolver.addMacro("title",getTitle(m_locale));
    if ((m_pcType == null) || m_pcType.equals(CmsLogin.PCTYPE_PRIVATE)) {
      resolver.addMacro("hiddenPasswordField","      <input type=\"password\" id=\"hidden-password\" name=\"ocPword\" autocomplete=\"%(autocomplete)\" >");
    }
    if (m_username != null) {
      resolver.addMacro("predefUser","value=\"" + CmsEncoder.escapeXml(m_username) + "\"");
    }
    page=resolver.resolveMacros(page);
    return page;
  }
 catch (  Exception e) {
    System.out.println("Error");
    return "<!--Error-->";
  }
}
