{
  CmsObject cms=getCmsObject();
  m_username=CmsRequestUtil.getParameter(getRequest(),PARAM_USERNAME);
  m_password=CmsRequestUtil.getParameter(getRequest(),PARAM_PASSWORD);
  m_actionLogin=CmsRequestUtil.getParameter(getRequest(),PARAM_ACTION_LOGIN);
  m_actionLogout=CmsRequestUtil.getParameter(getRequest(),PARAM_ACTION_LOGOUT);
  m_requestedResource=CmsRequestUtil.getParameter(getRequest(),CmsWorkplaceManager.PARAM_LOGIN_REQUESTED_RESOURCE);
  m_message=null;
  if (Boolean.valueOf(m_actionLogin).booleanValue()) {
    if ((m_username == null) && (m_password == null)) {
      m_message="Please enter a user name and a password!";
    }
 else     if (m_username == null) {
      m_message="Please enter a user name!";
    }
 else     if (m_password == null) {
      m_message="Please enter a password!";
    }
 else     if ((m_username != null) && (m_password != null)) {
      if (m_requestedResource == null) {
        m_requestedResource=CmsWorkplaceAction.C_JSP_WORKPLACE_URI;
      }
      login(m_username,m_password);
      if (getLoginException() == null) {
        CmsUserSettings settings=new CmsUserSettings(cms.getRequestContext().currentUser());
        try {
          CmsProject project=cms.readProject(settings.getStartProject());
          if (cms.getAllAccessibleProjects().contains(project)) {
            cms.getRequestContext().setCurrentProject(project);
          }
        }
 catch (        Exception e) {
          int todo=0;
          e.printStackTrace();
        }
        return createWorkplaceOpenerScript();
      }
 else {
        m_message="Login has failed!";
      }
    }
  }
 else   if (Boolean.valueOf(m_actionLogout).booleanValue()) {
    try {
      logout();
      return null;
    }
 catch (    IOException e) {
      int todo=0;
      e.printStackTrace();
    }
  }
  return displayLoginForm();
}
