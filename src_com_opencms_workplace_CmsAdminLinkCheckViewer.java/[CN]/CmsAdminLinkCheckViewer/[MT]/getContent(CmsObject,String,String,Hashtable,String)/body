{
  CmsXmlTemplateFile templateDocument=getOwnTemplateFile(cms,templateFile,elementName,parameters,templateSelector);
  long length=0;
  if ("ok".equalsIgnoreCase((String)parameters.get("step"))) {
    templateSelector="done";
  }
 else {
    String linkcheckdate="";
    StringBuffer linkcheckcontent=new StringBuffer();
    try {
      Hashtable linkchecktable=cms.readLinkCheckTable();
      Enumeration keys=linkchecktable.keys();
      while (keys.hasMoreElements()) {
        String curKey=(String)keys.nextElement();
        String curValue=(String)linkchecktable.get(curKey);
        if (curKey.equals(C_LINKCHECKTABLE_DATE)) {
          linkcheckdate=curValue;
        }
 else {
          linkcheckcontent.append(curKey + ", failed checks: " + curValue+ "\n");
          length++;
        }
      }
    }
 catch (    Exception exc) {
      linkcheckcontent.append(CmsException.getStackTraceAsString(exc));
    }
    templateDocument.setData("logfiledate",linkcheckdate);
    templateDocument.setData("logfile",CmsEncoder.escape(linkcheckcontent.toString(),cms.getRequestContext().getEncoding()));
    templateDocument.setData("logfilesize",length + "");
  }
  return startProcessing(cms,templateDocument,elementName,parameters,templateSelector);
}
