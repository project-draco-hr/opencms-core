{
  checkMandatoryProperties(currentUser,currentProject,type,metainfos);
  validFilename(filename);
  A_CmsResource onlineResource=null;
  try {
    onlineResource=m_fileRb.readFileHeader(onlineProject(currentUser,currentProject),folder + filename);
  }
 catch (  CmsException exc) {
  }
  if (onlineResource != null) {
    throw new CmsException("[" + this.getClass().getName() + "] "+ folder+ filename,CmsException.C_FILE_EXISTS);
  }
  CmsFolder cmsFolder=m_fileRb.readFolder(currentProject,folder);
  if (accessCreate(currentUser,currentProject,(A_CmsResource)cmsFolder)) {
    CmsFile file=m_fileRb.createFile(currentUser,currentProject,onlineProject(currentUser,currentProject),folder + filename,0,contents,getResourceType(currentUser,currentProject,type));
    Hashtable startSettings=null;
    Integer accessFlags=null;
    startSettings=(Hashtable)currentUser.getAdditionalInfo(C_ADDITIONAL_INFO_STARTSETTINGS);
    if (startSettings != null) {
      accessFlags=(Integer)startSettings.get(C_START_ACCESSFLAGS);
      if (accessFlags != null) {
        file.setAccessFlags(accessFlags.intValue());
        m_fileRb.writeFileHeader(currentProject,onlineProject(currentUser,currentProject),file,false);
      }
    }
    m_metadefRb.writeMetainformations((A_CmsResource)file,metainfos);
    fileSystemChanged(currentProject.getName(),file.getAbsolutePath());
    return (file);
  }
 else {
    throw new CmsException("[" + this.getClass().getName() + "] "+ folder+ filename,CmsException.C_ACCESS_DENIED);
  }
}
