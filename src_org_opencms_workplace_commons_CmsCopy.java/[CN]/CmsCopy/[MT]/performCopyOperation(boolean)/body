{
  if (isFolder && !DIALOG_WAIT.equals(getParamAction())) {
    return false;
  }
  int copyMode=CmsResource.COPY_PRESERVE_SIBLING;
  try {
    copyMode=Integer.parseInt(getParamCopymode());
  }
 catch (  Exception e) {
    if (LOG.isInfoEnabled()) {
      LOG.info(e.getLocalizedMessage());
    }
  }
  String target=getParamTarget();
  if (target == null) {
    target="";
  }
  boolean restoreSiteRoot=false;
  try {
    String sitePrefix="";
    if (CmsSiteManager.getSiteRoot(target) != null) {
      String siteRootFolder=getCms().getRequestContext().getSiteRoot();
      if (siteRootFolder.endsWith("/")) {
        siteRootFolder=siteRootFolder.substring(0,siteRootFolder.length() - 1);
      }
      sitePrefix=siteRootFolder;
      getCms().getRequestContext().saveSiteRoot();
      getCms().getRequestContext().setSiteRoot("/");
      restoreSiteRoot=true;
    }
    target=CmsLinkManager.getAbsoluteUri(target,CmsResource.getParentFolder(getParamResource()));
    if (target.equals(getParamResource())) {
      throw new CmsVfsException(Messages.get().container(Messages.ERR_COPY_ONTO_ITSELF_1,target));
    }
    try {
      CmsResource res=getCms().readResource(target,CmsResourceFilter.ALL);
      if (res.isFolder()) {
        if (!target.endsWith("/")) {
          target+="/";
        }
        target=target + CmsResource.getName(getParamResource());
      }
    }
 catch (    CmsVfsResourceNotFoundException e) {
      if (LOG.isInfoEnabled()) {
        LOG.info(e.getLocalizedMessage());
      }
    }
    setParamTarget(target);
    if (DIALOG_CONFIRMED.equals(getParamAction())) {
      checkLock(target);
      getCms().deleteResource(target,CmsResource.DELETE_PRESERVE_SIBLINGS);
    }
    getCms().copyResource(sitePrefix + getParamResource(),target,copyMode);
  }
  finally {
    if (restoreSiteRoot) {
      getCms().getRequestContext().restoreSiteRoot();
    }
  }
  return true;
}
