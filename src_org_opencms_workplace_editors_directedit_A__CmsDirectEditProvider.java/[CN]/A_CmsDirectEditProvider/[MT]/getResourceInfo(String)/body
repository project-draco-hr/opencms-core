{
  try {
    if (m_cms.getRequestContext().currentProject().isOnlineProject()) {
      return CmsDirectEditResourceInfo.INACTIVE;
    }
    if (CmsResource.getName(resourceName).startsWith(org.opencms.workplace.CmsWorkplace.TEMP_FILE_PREFIX)) {
      return CmsDirectEditResourceInfo.INACTIVE;
    }
    if (!m_cms.isInsideCurrentProject(resourceName)) {
      return CmsDirectEditResourceInfo.INACTIVE;
    }
    CmsResource resource=m_cms.readResource(resourceName,CmsResourceFilter.ALL);
    if (!OpenCms.getResourceManager().getResourceType(resource.getTypeId()).isDirectEditable()) {
      return CmsDirectEditResourceInfo.INACTIVE;
    }
    CmsLock lock=m_cms.getLock(resource);
    boolean unlocked=lock.isNullLock();
    boolean ownedInProject=(lock.getProjectId() == m_cms.getRequestContext().currentProject().getId()) && (lock.getUserId().equals(m_cms.getRequestContext().currentUser().getId()));
    boolean locked=!(unlocked || ownedInProject);
    if (m_cms.hasPermissions(resource,CmsPermissionSet.ACCESS_WRITE,false,CmsResourceFilter.IGNORE_EXPIRATION)) {
      if (locked) {
        return new CmsDirectEditResourceInfo(CmsDirectEditPermissions.DISABLED,resource,lock);
      }
      return new CmsDirectEditResourceInfo(CmsDirectEditPermissions.ENABLED,resource,lock);
    }
  }
 catch (  Exception e) {
    if (LOG.isWarnEnabled()) {
      LOG.warn(Messages.get().getBundle().key(Messages.LOG_CALC_EDIT_MODE_FAILED_1,resourceName),e);
    }
  }
  return CmsDirectEditResourceInfo.INACTIVE;
}
