{
  String entryPoint;
  if (change instanceof CmsSitemapChangeNewSubSitemapEntry) {
    entryPoint=((CmsSitemapChangeNewSubSitemapEntry)change).getEntryPoint();
  }
 else {
    entryPoint=getEntryPoint(cms);
  }
  Element entryElement=getElement(cms,change.getSitePath(),entryPoint);
  if (entryElement != null) {
    throw createEntryAlreadyExistsException(cms,change.getSitePath());
  }
  String parentPath=CmsResource.getParentFolder(change.getSitePath());
  Element parent=getElement(cms,parentPath,entryPoint);
  if (parent == null) {
    throw createEntryNotFoundException(cms,parentPath);
  }
  entryElement=parent.addElement(XmlNode.SiteEntry.name());
  CmsUUID id=change.getId();
  if (id == null) {
    id=new CmsUUID();
  }
  entryElement.addElement(XmlNode.Id.name()).addCDATA(id.toString());
  String name=CmsResource.getName(change.getSitePath());
  if (name.endsWith("/")) {
    name=name.substring(0,name.length() - 1);
  }
  entryElement.addElement(XmlNode.Name.name()).addCDATA(name);
  entryElement.addElement(XmlNode.Title.name()).addCDATA(change.getTitle());
  Element vfsFile=entryElement.addElement(XmlNode.VfsFile.name());
  fillResource(cms,vfsFile,change.getVfsPath());
  CmsXmlContentPropertyHelper.saveProperties(cms,entryElement,change.getProperties(),getFile());
  return cms.getRequestContext().addSiteRoot(change.getSitePath());
}
