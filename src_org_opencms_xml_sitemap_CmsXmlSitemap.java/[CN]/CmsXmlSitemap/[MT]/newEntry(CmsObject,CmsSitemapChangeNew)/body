{
  Element parent=getElement(cms,CmsResource.getParentFolder(change.getSitePath()));
  if (parent == null) {
    String sitemapPath=(getFile() == null) ? null : cms.getSitePath(getFile());
    throw new CmsSitemapEntryNotFoundException(change.getSitePath(),sitemapPath);
  }
  Element entryElement=parent.addElement(XmlNode.SiteEntry.name());
  entryElement.addElement(XmlNode.Id.name()).addCDATA(new CmsUUID().toString());
  String name=CmsResource.getName(change.getSitePath());
  if (name.endsWith("/")) {
    name=name.substring(0,name.length() - 1);
  }
  entryElement.addElement(XmlNode.Name.name()).addCDATA(name);
  entryElement.addElement(XmlNode.Title.name()).addCDATA(change.getTitle());
  Element vfsFile=entryElement.addElement(XmlNode.VfsFile.name());
  fillResource(cms,vfsFile,change.getVfsPath());
  CmsXmlContentPropertyHelper.saveProperties(cms,entryElement,CmsXmlContentDefinition.getContentHandlerForResource(cms,getFile()).getProperties(),change.getProperties());
  return cms.getRequestContext().addSiteRoot(change.getSitePath());
}
