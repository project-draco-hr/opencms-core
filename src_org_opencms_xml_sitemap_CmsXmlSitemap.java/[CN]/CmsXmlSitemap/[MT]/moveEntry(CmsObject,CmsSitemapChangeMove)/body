{
  Element entryElement=getElement(cms,change.getSourcePath());
  if (entryElement == null) {
    throw createEntryNotFoundException(cms,change.getSourcePath());
  }
  String srcParentPath=CmsResource.getParentFolder(change.getSourcePath());
  String destParentPath=CmsResource.getParentFolder(change.getDestinationPath());
  Element newParent=getElement(cms,destParentPath);
  if (newParent == null) {
    throw createEntryNotFoundException(cms,destParentPath);
  }
  if (!srcParentPath.equals(destParentPath)) {
    entryElement.detach();
    List<Element> siblings=CmsCollectionsGenericWrapper.list(newParent.elements(XmlNode.SiteEntry.name()));
    if ((change.getDestinationPosition() < 0) || (change.getDestinationPosition() > siblings.size())) {
      siblings.add(entryElement);
    }
 else {
      siblings.add(change.getDestinationPosition(),entryElement);
    }
  }
 else {
    List<Element> siblings=CmsCollectionsGenericWrapper.list(newParent.elements(XmlNode.SiteEntry.name()));
    if (siblings.indexOf(entryElement) != change.getDestinationPosition()) {
      siblings.remove(entryElement);
      siblings.add(change.getDestinationPosition(),entryElement);
    }
  }
  String srcName=CmsResource.getName(change.getSourcePath());
  String destName=CmsResource.getName(change.getDestinationPath());
  if (!srcName.equals(destName)) {
    Element nameElement=entryElement.element(XmlNode.Name.name());
    nameElement.clearContent();
    if (destName.endsWith("/")) {
      destName=destName.substring(0,destName.length() - 1);
    }
    nameElement.addCDATA(destName);
  }
  return getSubTreePaths(cms.getRequestContext().addSiteRoot(destParentPath),entryElement);
}
