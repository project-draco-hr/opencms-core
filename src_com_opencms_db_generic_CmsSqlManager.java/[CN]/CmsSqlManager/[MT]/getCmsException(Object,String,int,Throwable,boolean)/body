{
  String className="";
  if (o != null) {
    className="[" + o.getClass().getName() + "] ";
  }
  if (message == null && rootCause != null) {
    StackTraceElement[] stackTraceElements=rootCause.getStackTrace();
    String stackTraceElement="";
    for (int i=0; i < stackTraceElements.length; i++) {
      String currentStackTraceElement=stackTraceElements[i].toString();
      if (currentStackTraceElement.indexOf(".opencms.") != -1) {
        stackTraceElement=currentStackTraceElement;
        break;
      }
    }
    message="where: " + stackTraceElement + ", ";
    message+="why: " + rootCause.toString();
  }
 else {
    message="";
  }
  message=className + message;
  if (!logSilent && A_OpenCms.isLogging() && I_CmsLogChannels.C_LOGGING) {
    A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_CRITICAL,message);
  }
switch (exceptionType) {
case CmsException.C_NOT_FOUND:
    return new CmsResourceNotFoundException(message);
}
return new CmsException(message,exceptionType,rootCause);
}
