{
  String entryPoint=sitemapInfo.getEntryPoint();
  entry.setEntryPoint(entryPoint);
  entry.setSitemapInfo(sitemapInfo);
  CmsPropertyInheritanceState myPropertyState=propertyState.update(entry.getNewProperties(),entry.getRootPath());
  CmsSitemapRuntimeInfo currentInfo=sitemapInfo;
  entry.setRuntimeInfo(entryPoint,entryPos,myPropertyState.getInheritedProperties());
  entry.setRootEntry(isRootEntry);
  entry.setParentComputedProperties(new HashMap<String,CmsComputedPropertyValue>(propertyState.getInheritedProperties()));
  Map<CmsUUID,CmsInternalSitemapEntry> byId=m_byId;
  Map<String,CmsInternalSitemapEntry> byPath=m_byUri;
  byId.put(entry.getId(),entry);
  byPath.put(locale.toString() + entry.getRootPath(),entry);
  m_pathSet.add(entry.getRootPath());
  CmsUUID structureId=entry.getStructureId();
  addEntryForStructureId(structureId,locale,entry);
  List<CmsInternalSitemapEntry> subEntries=getSubEntries(cms,locale,entry);
  CmsPropertyInheritanceState nextState=myPropertyState;
  if (subEntries.size() > 0) {
    CmsInternalSitemapEntry firstEntry=subEntries.get(0);
    if (firstEntry.getPropertyDefinitions() != entry.getPropertyDefinitions()) {
      nextState=nextState.update(firstEntry.getPropertyDefinitions());
    }
  }
  CmsSimplePropertyValue sitemapProp=entry.getNewProperties().get(CmsSitemapManager.Property.sitemap.name());
  String sitemapUuid=sitemapProp == null ? null : sitemapProp.getOwnValue();
  try {
    if (sitemapUuid != null) {
      CmsResource sitemapResource=internalReadResource(cms,sitemapUuid);
      currentInfo=new CmsSitemapRuntimeInfo(entry.getRootPath(),locale);
      sitemapInfo.addChildInfo(currentInfo);
      addActiveSitemap(cms,false,locale,entry.getRootPath(),sitemapResource,currentInfo);
    }
  }
 catch (  CmsException e) {
    LOG.error("Can't read sub-sitemap: ");
    LOG.error(e.getLocalizedMessage(),e);
  }
  int size=subEntries.size();
  for (int position=0; position < size; position++) {
    CmsInternalSitemapEntry subEntry=subEntries.get(position);
    visitEntry(cms,subEntry,locale,currentInfo,false,position,nextState);
  }
}
