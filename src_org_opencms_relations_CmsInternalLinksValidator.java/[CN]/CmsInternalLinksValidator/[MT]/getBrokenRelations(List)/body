{
  Map brokenRelations=new HashMap();
  CmsRelationFilter filter=CmsRelationFilter.TARGETS.filterIncludeChildren();
  Iterator itFolders=resourceNames.iterator();
  while (itFolders.hasNext()) {
    String folderName=(String)itFolders.next();
    List relations;
    try {
      relations=m_cms.getRelationsForResource(folderName,filter);
    }
 catch (    CmsException e) {
      LOG.error(Messages.get().getBundle().key(Messages.LOG_LINK_SEARCH_1,folderName),e);
      continue;
    }
    Iterator itRelations=relations.iterator();
    while (itRelations.hasNext()) {
      CmsRelation relation=(CmsRelation)itRelations.next();
      try {
        relation.getTarget(m_cms,CmsResourceFilter.IGNORE_EXPIRATION);
      }
 catch (      Exception e) {
        String resourceName=relation.getSourcePath();
        List broken=(List)brokenRelations.get(resourceName);
        if (broken == null) {
          broken=new ArrayList();
          brokenRelations.put(resourceName,broken);
        }
        broken.add(relation);
      }
    }
  }
  return brokenRelations;
}
