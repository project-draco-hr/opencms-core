{
  JSONObject configJsonObj=new JSONObject();
  if (configuration != null) {
    configuration=CmsMacroResolver.resolveMacros(configuration,cms,widgetDialog.getMessages());
    try {
      configJsonObj=new JSONObject(configuration);
    }
 catch (    JSONException e) {
      if (LOG.isErrorEnabled()) {
        LOG.error(e.getLocalizedMessage(),e);
      }
    }
  }
  JSONObject gConfigJsonObj=new JSONObject();
  JSONArray resTypes=new JSONArray();
  JSONArray tabs=new JSONArray();
switch (getGalleryType(configJsonObj)) {
case imagegallery:
    resTypes=new JSONArray();
  try {
    resTypes.put(OpenCms.getResourceManager().getResourceType(CmsResourceTypeImage.getStaticTypeName()).getTypeId());
    tabs=new JSONArray(CmsGalleryConfigValues.TABS_IMAGEGALLERY.getName());
  }
 catch (  CmsLoaderException e) {
    if (LOG.isErrorEnabled()) {
      LOG.error(e.getLocalizedMessage(),e);
    }
  }
catch (  JSONException e) {
    if (LOG.isErrorEnabled()) {
      LOG.error(e.getLocalizedMessage(),e);
    }
  }
setResourceTypes(resTypes);
setResourceTypes(resTypes);
setTabs(tabs);
setImagegallery(true);
setButtonPrefix(CmsGalleryConfigValues.IMAGE.getName());
setStartupTabId(CmsGallerySearchServer.TabId.cms_tab_galleries.toString());
prepareAndSetImageGalleryConfigParams(cms,widgetDialog,param,configJsonObj);
break;
case sitemap:
try {
resTypes.put(OpenCms.getResourceManager().getResourceType(CmsResourceTypeXmlContainerPage.getStaticTypeName()).getTypeId());
tabs=new JSONArray(CmsGalleryConfigValues.TABS_SITEMAP.getName());
}
 catch (CmsLoaderException e) {
if (LOG.isErrorEnabled()) {
LOG.error(e.getLocalizedMessage(),e);
}
}
catch (JSONException e) {
resTypes=new JSONArray();
tabs=new JSONArray();
}
setResourceTypes(resTypes);
setTabs(tabs);
setImagegallery(false);
setButtonPrefix(CmsGalleryConfigValues.SITEMAP.getName());
setStartupTabId(CmsGallerySearchServer.TabId.cms_tab_sitemap.toString());
gConfigJsonObj=configJsonObj.optJSONObject(CmsGalleryConfigKeys.sitemap.toString());
setDefaultgalleryConfigPart(cms,widgetDialog,param,gConfigJsonObj);
break;
case container:
try {
resTypes.put(OpenCms.getResourceManager().getResourceType(CmsResourceTypeXmlContainerPage.getStaticTypeName()).getTypeId());
tabs=new JSONArray(CmsGalleryConfigValues.TABS_CONTAINERPAGEGALLERY.getName());
}
 catch (CmsLoaderException e) {
if (LOG.isErrorEnabled()) {
LOG.error(e.getLocalizedMessage(),e);
}
}
catch (JSONException e) {
if (LOG.isErrorEnabled()) {
LOG.error(e.getLocalizedMessage(),e);
}
}
setResourceTypes(resTypes);
setTabs(tabs);
setImagegallery(false);
setButtonPrefix(CmsGalleryConfigValues.CONTAINER.getName());
setStartupTabId(CmsGallerySearchServer.TabId.cms_tab_results.toString());
gConfigJsonObj=configJsonObj.optJSONObject(CmsGalleryConfigKeys.container.toString());
setDefaultgalleryConfigPart(cms,widgetDialog,param,gConfigJsonObj);
break;
case downloadgallery:
try {
resTypes.put(OpenCms.getResourceManager().getResourceType(CmsResourceTypeBinary.getStaticTypeName()).getTypeId());
tabs=new JSONArray(CmsGalleryConfigValues.TABS_DOWNLOADGALLERY.getName());
}
 catch (JSONException e) {
if (LOG.isErrorEnabled()) {
LOG.error(e.getLocalizedMessage(),e);
}
}
catch (CmsLoaderException e) {
if (LOG.isErrorEnabled()) {
LOG.error(e.getLocalizedMessage(),e);
}
}
setResourceTypes(resTypes);
setTabs(tabs);
setImagegallery(false);
setButtonPrefix(CmsGalleryConfigValues.DOWNLOAD.getName());
setStartupTabId(CmsGallerySearchServer.TabId.cms_tab_galleries.toString());
gConfigJsonObj=configJsonObj.optJSONObject(CmsGalleryConfigKeys.downloadgallery.toString());
setDefaultgalleryConfigPart(cms,widgetDialog,param,gConfigJsonObj);
break;
case defaultgallery:
default :
try {
resTypes=new JSONArray(CmsGalleryConfigValues.RESOURCETYPE_DEFAULTGALLERY.getName());
tabs=new JSONArray(CmsGalleryConfigValues.TABS_DEFAULTGALLERY.getName());
}
 catch (JSONException e) {
resTypes=new JSONArray();
tabs=new JSONArray();
if (LOG.isErrorEnabled()) {
LOG.error(e.getLocalizedMessage(),e);
}
}
setResourceTypes(resTypes);
setTabs(tabs);
setImagegallery(false);
setStartupTabId(CmsGallerySearchServer.TabId.cms_tab_galleries.toString());
setButtonPrefix(CmsGalleryConfigValues.DEFAULT.getName());
}
}
