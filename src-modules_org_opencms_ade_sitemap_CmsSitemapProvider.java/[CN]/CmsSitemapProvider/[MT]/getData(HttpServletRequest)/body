{
  CmsObject cms=CmsFlexController.getCmsObject(request);
  JSONObject keys=new JSONObject();
  try {
    keys.put(KEY_EDIT,getNoEditReason(cms,request));
    keys.put(KEY_TOOLBAR,isDisplayToolbar(request));
    String sitemapUri=getSitemapURI(cms,request);
    keys.put(KEY_URI_SITEMAP,sitemapUri);
    keys.put(KEY_TYPE_CNTPAGE,OpenCms.getResourceManager().getResourceType(CmsResourceTypeXmlContainerPage.getStaticTypeName()).getTypeId());
    keys.put(KEY_URI_PARENT,cms.getSitePath(OpenCms.getSitemapManager().getParentSitemap(cms,CmsHistoryResourceHandler.getResourceWithHistory(cms,sitemapUri))));
  }
 catch (  Throwable e) {
    LOG.error(e.getLocalizedMessage(),e);
    try {
      keys.put("error",e.getLocalizedMessage());
    }
 catch (    JSONException e1) {
      LOG.error(e1.getLocalizedMessage(),e1);
    }
  }
  return keys;
}
