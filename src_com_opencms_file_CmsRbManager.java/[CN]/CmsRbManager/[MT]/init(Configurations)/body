{
  String rbName=null;
  String rbClassName=null;
  Class rbClass=null;
  I_CmsResourceBroker rbInstance=null;
  rbName=(String)configurations.getString(C_CONFIGURATION_RESOURCEBROKER);
  if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
    A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_INIT,". Resource broker used : " + rbName);
  }
  rbClassName=(String)configurations.getString(C_CONFIGURATION_RESOURCEBROKER + "." + rbName+ "."+ C_CONFIGURATION_CLASS);
  if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
    A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_INIT,". Resource broker class: " + rbClassName);
  }
  try {
    rbClass=Class.forName(rbClassName);
    if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
      A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_INIT,". Resource broker init : phase 1 ok - starting");
    }
    rbInstance=(I_CmsResourceBroker)rbClass.newInstance();
    if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
      A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_INIT,". Resource broker init : phase 2 ok - initializing database");
    }
    rbInstance.init(configurations);
    if (I_CmsLogChannels.C_PREPROCESSOR_IS_LOGGING && A_OpenCms.isLogging()) {
      A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_INIT,". Resource broker init : phase 4 ok - finished");
    }
    return (rbInstance);
  }
 catch (  Exception exc) {
    String message="Critical error while loading resourcebroker";
    if (I_CmsLogChannels.C_LOGGING && A_OpenCms.isLogging(I_CmsLogChannels.C_OPENCMS_CRITICAL)) {
      A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_CRITICAL,"[CmsRbManager] " + message);
    }
    exc.printStackTrace(System.err);
    throw new CmsException(message,CmsException.C_RB_INIT_ERROR,exc);
  }
}
