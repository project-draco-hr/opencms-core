{
  CmsObject cms=getCmsObject();
  Locale locale=cms.getRequestContext().getLocale();
  JSONArray resources=new JSONArray();
  Set<CmsResource> published=getAlreadyPublishedResources();
  for (  CmsResource resource : published) {
    JSONObject jsonRes=resourceToJson(resource);
    jsonRes.put(JsonResource.REASON.getName(),BlockingReason.PUBLISHED.getName());
    resources.put(jsonRes);
  }
  Set<CmsResource> exclude=new HashSet<CmsResource>(published);
  ResourcesAndRelated permissions=getResourcesWithoutPermissions(exclude);
  for (  CmsResource resource : permissions.getResources()) {
    JSONObject jsonRes=resourceToJson(resource);
    jsonRes.put(JsonResource.REASON.getName(),BlockingReason.PERMISSIONS.getName());
    resources.put(jsonRes);
  }
  exclude.addAll(permissions.getResources());
  exclude.addAll(permissions.getRelatedResources());
  ResourcesAndRelated locked=getBlockingLockedResources(exclude);
  for (  CmsResource resource : locked.getResources()) {
    JSONObject jsonRes=resourceToJson(resource);
    jsonRes.put(JsonResource.REASON.getName(),BlockingReason.LOCKED.getName());
    resources.put(jsonRes);
  }
  exclude.clear();
  exclude.addAll(published);
  exclude.addAll(permissions.getResources());
  exclude.addAll(locked.getResources());
  m_resourceList.getResources().removeAll(exclude);
  m_resourceList.getRelatedResources().removeAll(permissions.getRelatedResources());
  m_resourceList.getRelatedResources().removeAll(locked.getRelatedResources());
  String relatedMsg=org.opencms.workplace.commons.Messages.get().getBundle(locale).key(org.opencms.workplace.commons.Messages.GUI_PUBLISH_DETAIL_REVERSE_REFERENCE_0);
  for (  CmsResource resource : permissions.getRelatedResources()) {
    if (exclude.contains(resource)) {
      continue;
    }
    String infoForRelated=getInfoForRelated(cms,locale,resource);
    if (infoForRelated == null) {
      continue;
    }
    JSONObject jsonRes=resourceToJson(resource);
    jsonRes.put(JsonResource.REASON.getName(),BlockingReason.PERMISSIONS.getName());
    jsonRes.put(JsonResource.INFO_NAME.getName(),relatedMsg);
    jsonRes.put(JsonResource.INFO_VALUE.getName(),infoForRelated);
    resources.put(jsonRes);
  }
  for (  CmsResource resource : locked.getRelatedResources()) {
    if (exclude.contains(resource)) {
      continue;
    }
    String infoForRelated=getInfoForRelated(cms,locale,resource);
    if (infoForRelated == null) {
      continue;
    }
    JSONObject jsonRes=resourceToJson(resource);
    jsonRes.put(JsonResource.REASON.getName(),BlockingReason.LOCKED.getName());
    jsonRes.put(JsonResource.INFO_NAME.getName(),relatedMsg);
    jsonRes.put(JsonResource.INFO_VALUE.getName(),infoForRelated);
    resources.put(jsonRes);
  }
  return resources;
}
