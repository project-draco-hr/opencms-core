{
  String originalVfsName=vfsName;
  try {
    String exportname=cms.readProperty(CmsResource.getFolderPath(vfsName),I_CmsConstants.C_PROPERTY_EXPORTNAME,true);
    if (exportname != null) {
      if (!exportname.endsWith("/")) {
        exportname=exportname + "/";
      }
      if (!exportname.startsWith("/")) {
        exportname="/" + exportname;
      }
      String value;
      boolean cont;
      String resourceName=vfsName;
      do {
        try {
          value=cms.readProperty(resourceName,I_CmsConstants.C_PROPERTY_EXPORTNAME,false);
          cont=((value == null) && (!"/".equals(resourceName)));
        }
 catch (        CmsSecurityException se) {
          cont=false;
        }
        if (cont) {
          resourceName=CmsResource.getParentFolder(resourceName);
        }
      }
 while (cont);
      vfsName=exportname + vfsName.substring(resourceName.length());
    }
 else {
      vfsName=cms.getRequestContext().addSiteRoot(vfsName);
    }
    if (vfsName.toLowerCase().endsWith(".jsp")) {
      CmsResource res=cms.readFileHeader(originalVfsName);
      if (res.getType() != CmsResourceTypePlain.C_RESOURCE_TYPE_ID) {
        vfsName+=".html";
      }
    }
  }
 catch (  CmsException e) {
  }
  return OpenCms.getStaticExportManager().getRfsPrefix() + vfsName;
}
