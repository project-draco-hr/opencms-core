{
  String originalVfsName=vfsName;
  try {
    CmsProperty exportProperty=cms.readPropertyObject(CmsResource.getFolderPath(vfsName),I_CmsConstants.C_PROPERTY_EXPORTNAME,true);
    if (exportProperty != null && !exportProperty.isNullProperty()) {
      String exportname=exportProperty.getValue();
      if (!exportname.endsWith("/")) {
        exportname=exportname + "/";
      }
      if (!exportname.startsWith("/")) {
        exportname="/" + exportname;
      }
      String value;
      boolean cont;
      String resourceName=vfsName;
      do {
        try {
          value=cms.readPropertyObject(resourceName,I_CmsConstants.C_PROPERTY_EXPORTNAME,false).getValue();
          cont=((value == null) && (!"/".equals(resourceName)));
        }
 catch (        CmsVfsResourceNotFoundException e) {
          cont=(!"/".equals(resourceName));
        }
catch (        CmsSecurityException se) {
          cont=false;
        }
        if (cont) {
          resourceName=CmsResource.getParentFolder(resourceName);
        }
      }
 while (cont);
      vfsName=exportname + vfsName.substring(resourceName.length());
    }
 else {
      vfsName=cms.getRequestContext().addSiteRoot(vfsName);
    }
    if (vfsName.toLowerCase().endsWith(".jsp")) {
      CmsResource res=cms.readResource(originalVfsName);
      if (res.getTypeId() != CmsResourceTypePlain.getStaticTypeId()) {
        String suffix=cms.readPropertyObject(originalVfsName,I_CmsConstants.C_PROPERTY_EXPORTSUFFIX,true).getValue(".html");
        if (!vfsName.toLowerCase().endsWith(suffix.toLowerCase())) {
          vfsName+=suffix;
        }
      }
    }
  }
 catch (  CmsException e) {
  }
  return OpenCms.getStaticExportManager().getRfsPrefix() + vfsName;
}
