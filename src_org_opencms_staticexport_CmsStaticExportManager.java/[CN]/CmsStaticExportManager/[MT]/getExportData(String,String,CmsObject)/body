{
  CmsResource resource=null;
  String storedSiteRoot=cms.getRequestContext().getSiteRoot();
  try {
    cms.getRequestContext().setSiteRoot("/");
    rfsName=rfsName.substring(getRfsPrefixForRfsName(rfsName).length());
    String parameters=null;
    if (vfsName == null) {
      CmsStaticExportData data=getCachedExportUri(rfsName);
      if (data != null) {
        vfsName=data.getVfsName();
        parameters=data.getParameters();
      }
    }
    if (vfsName != null) {
      if (CACHEVALUE_404 != vfsName) {
        try {
          resource=cms.readResource(vfsName);
        }
 catch (        CmsException e) {
          if (LOG.isDebugEnabled()) {
            LOG.debug(Messages.get().getBundle().key(Messages.ERR_EXPORT_FILE_FAILED_1,new String[]{vfsName}),e);
          }
          return null;
        }
        return new CmsStaticExportData(vfsName,rfsName,resource,parameters);
      }
 else {
        return null;
      }
    }
 else {
      vfsName=getVfsNameInternal(cms,rfsName);
      if (vfsName != null) {
        try {
          resource=cms.readResource(vfsName);
        }
 catch (        Exception e) {
          if (LOG.isWarnEnabled()) {
            LOG.warn(Messages.get().getBundle().key(Messages.ERR_EXPORT_FILE_FAILED_1,new String[]{vfsName}),e);
          }
        }
      }
      if (resource == null) {
        try {
          parameters=cms.readStaticExportPublishedResourceParameters(rfsName);
          if (CmsStringUtil.isNotEmpty(parameters)) {
            String rfsBaseName=rfsName.substring(0,rfsName.lastIndexOf('_'));
            String vfsBaseName=getVfsNameInternal(cms,rfsBaseName);
            if (vfsBaseName != null) {
              resource=cms.readResource(vfsBaseName);
              CmsStaticExportData exportData=new CmsStaticExportData(vfsBaseName,rfsName,resource,parameters);
              cacheExportUri(rfsName,exportData.getVfsName(),parameters);
              return exportData;
            }
          }
        }
 catch (        CmsException e) {
          if (LOG.isWarnEnabled()) {
            LOG.warn(Messages.get().getBundle().key(Messages.ERR_EXPORT_FILE_FAILED_1,new String[]{vfsName}),e);
          }
        }
        cacheExportUri(rfsName,CACHEVALUE_404,null);
        return null;
      }
 else {
        cacheExportUri(rfsName,vfsName,null);
        return new CmsStaticExportData(vfsName,rfsName,resource);
      }
    }
  }
  finally {
    cms.getRequestContext().setSiteRoot(storedSiteRoot);
  }
}
