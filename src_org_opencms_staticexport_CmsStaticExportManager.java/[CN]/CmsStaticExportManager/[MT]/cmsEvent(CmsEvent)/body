{
switch (event.getType()) {
case I_CmsEventListener.EVENT_PUBLISH_PROJECT:
    CmsUUID publishHistoryId=new CmsUUID((String)event.getData().get("publishHistoryId"));
  if (OpenCms.getLog(this).isDebugEnabled()) {
    OpenCms.getLog(this).debug("Static export manager catched event EVENT_PUBLISH_PROJECT for project ID " + publishHistoryId);
  }
CmsObject cms=OpenCms.initCmsObject(OpenCms.getDefaultUsers().getUserExport());
List publishedResources;
try {
publishedResources=cms.readPublishedResources(publishHistoryId);
}
 catch (CmsException e) {
if (OpenCms.getLog(this).isErrorEnabled()) {
OpenCms.getLog(this).error("Static export manager could not read list of changes resources for project ID " + publishHistoryId);
}
return;
}
Iterator i=publishedResources.iterator();
while (i.hasNext()) {
CmsPublishedResource res=(CmsPublishedResource)i.next();
if (res.isNew() || res.isUnChanged()) {
continue;
}
String vfsName=res.getRootPath();
String rfsName=getRfsName(cms,vfsName);
if (OpenCms.getLog(this).isDebugEnabled()) {
OpenCms.getLog(this).debug("Static export checking for deletion vfsName='" + vfsName + "' rfsName='"+ rfsName+ "'");
}
if (rfsName.startsWith(getRfsPrefix())) {
String exportFileName;
if (res.isFolder()) {
if (res.isDeleted()) {
String exportFolderName=CmsLinkManager.normalizeRfsPath(getExportPath() + rfsName.substring(getRfsPrefix().length() + 1));
try {
  File exportFolder=new File(exportFolderName);
  if (exportFolder.exists() && exportFolder.canWrite()) {
    purgeDirectory(exportFolder);
    exportFolder.delete();
    if (OpenCms.getLog(this).isInfoEnabled()) {
      OpenCms.getLog(this).info("Static export deleted export folder'" + exportFolderName + "'");
    }
    continue;
  }
}
 catch (Throwable t) {
  if (OpenCms.getLog(this).isWarnEnabled()) {
    OpenCms.getLog(this).warn("Error deleting static export folder vfsName='" + vfsName + "' rfsName='"+ exportFolderName+ "'",t);
  }
}
}
rfsName+=C_EXPORT_DEFAULT_FILE;
if (OpenCms.getLog(this).isDebugEnabled()) {
OpenCms.getLog(this).debug("Static export folder index file rfsName='" + rfsName + "'");
}
}
exportFileName=CmsLinkManager.normalizeRfsPath(getExportPath() + rfsName.substring(getRfsPrefix().length() + 1));
try {
File exportFile=new File(exportFileName);
if (exportFile.exists() && exportFile.canWrite()) {
exportFile.delete();
if (OpenCms.getLog(this).isInfoEnabled()) {
  OpenCms.getLog(this).info("Static export deleted exported rfs file '" + rfsName + "'");
}
}
}
 catch (Throwable t) {
if (OpenCms.getLog(this).isWarnEnabled()) {
OpenCms.getLog(this).warn("Error deleting static export file vfsName='" + vfsName + "' rfsName='"+ exportFileName+ "'",t);
}
}
}
}
case I_CmsEventListener.EVENT_CLEAR_CACHES:
m_cacheOnlineLinks.clear();
m_cacheExportUris.clear();
setExportnames();
if (OpenCms.getLog(this).isDebugEnabled()) {
String eventType="EVENT_CLEAR_CACHES";
if (event.getType() != I_CmsEventListener.EVENT_CLEAR_CACHES) {
eventType="EVENT_PUBLISH_PROJECT";
}
OpenCms.getLog(this).debug("Static export manager flushed caches after recieving event " + eventType);
}
break;
default :
}
}
