{
  boolean templatesFound;
  CmsObject cmsExportObject=OpenCms.initCmsObject(OpenCms.getDefaultUsers().getUserExport());
  CmsProject originalProject=cmsExportObject.getRequestContext().currentProject();
  CmsProject onlineProject=cmsExportObject.readProject(I_CmsConstants.C_PROJECT_ONLINE_ID);
  try {
    cmsExportObject.getRequestContext().setCurrentProject(onlineProject);
    setTimestamp(System.currentTimeMillis());
    templatesFound=exportNonTemplateResources(cmsExportObject,resources,report);
    if ((templatesFound) || (!getQuickPlainExport())) {
      List publishedTemplateResources=cmsExportObject.readStaticExportResources(C_EXPORT_LINK_WITHOUT_PARAMETER,0);
      setTimestamp(System.currentTimeMillis());
      exportTemplateResources(cmsExportObject,publishedTemplateResources,report);
      publishedTemplateResources=cmsExportObject.readStaticExportResources(C_EXPORT_LINK_WITH_PARAMETER,0);
      while (publishedTemplateResources.size() > 0) {
        setTimestamp(System.currentTimeMillis());
        exportTemplateResources(cmsExportObject,publishedTemplateResources,report);
        publishedTemplateResources=cmsExportObject.readStaticExportResources(C_EXPORT_LINK_WITH_PARAMETER,getTimestamp());
      }
    }
  }
  finally {
    cmsExportObject.getRequestContext().setCurrentProject(originalProject);
  }
}
