{
  String absolutePath=cms.readAbsolutePath(resource);
  String templateProp=cms.readProperty(absolutePath,I_CmsConstants.C_PROPERTY_TEMPLATE);
  if (templateProp == null) {
    throw new CmsException("Property '" + I_CmsConstants.C_PROPERTY_TEMPLATE + "' undefined for page file "+ absolutePath);
  }
  CmsFile templateFile=cms.readFile(templateProp);
  if (templateFile.getLoaderId() == CmsJspLoader.C_RESOURCE_LOADER_ID) {
    return new CmsResourceLoaderFacade(getLoader(CmsJspLoader.C_RESOURCE_LOADER_ID),templateFile);
  }
 else {
    return new CmsResourceLoaderFacade(getLoader(CmsXmlTemplateLoader.C_RESOURCE_LOADER_ID),resource);
  }
}
