{
  CmsLocaleManager localeManager=OpenCms.getLocaleManager();
  String availableLocaleNames[]=localeManager.getAvailableLocaleNames(context,context.getUri());
  if (availableLocaleNames == null) {
    availableLocaleNames=localeManager.getAvailableLocaleNames();
  }
  String defaultLocaleNames[]=localeManager.getDefaultLocaleNames(context,context.getUri());
  if (defaultLocaleNames == null) {
    defaultLocaleNames=localeManager.getDefaultLocaleNames();
  }
  HashSet filter=null;
  if (requestedLocaleName != null) {
    filter=new HashSet();
    filter.add(requestedLocaleName);
  }
  Set available=localeManager.getMatchingLocales(availableLocaleNames,filter);
  String result=localeManager.getBestMatchingLocaleName(requestedLocaleName,defaultLocaleNames,available);
  if (result == null) {
    result=localeManager.getDefaultLocaleName();
  }
  return result;
}
