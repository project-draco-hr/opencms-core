{
  boolean folderReported=false;
  try {
    Vector resources=m_cms.getResourcesInFolder(path);
    CmsResource res;
    for (int i=0; i < resources.size(); i++) {
      res=(CmsResource)resources.get(i);
      if (res instanceof CmsFolder) {
        createVfsSubtreeIndex(writer,m_cms.getRequestContext().removeSiteRoot(res.getRootPath()),index,report,threadManager);
        continue;
      }
      if (report != null && !folderReported) {
        report.print(report.key("search.indexing_folder"),I_CmsReport.C_FORMAT_NOTE);
        report.println(path,I_CmsReport.C_FORMAT_DEFAULT);
        folderReported=true;
      }
      if (report != null) {
        report.print("( " + (threadManager.getCounter() + 1) + " )",I_CmsReport.C_FORMAT_NOTE);
        report.print(report.key("search.indexing_file_begin"),I_CmsReport.C_FORMAT_NOTE);
        report.print(res.getName(),I_CmsReport.C_FORMAT_DEFAULT);
        report.print(report.key("search.dots"),I_CmsReport.C_FORMAT_DEFAULT);
      }
      CmsIndexResource ires=new CmsIndexResource(res);
      threadManager.createIndexingThread(writer,ires,index);
    }
  }
 catch (  CmsIndexException exc) {
    if (report != null) {
      report.println();
      report.println(report.key("search.indexing_file_failed") + " : " + exc.getMessage(),I_CmsReport.C_FORMAT_WARNING);
    }
    if (OpenCms.getLog(this).isWarnEnabled()) {
      OpenCms.getLog(this).warn("Failed to index " + path,exc);
    }
  }
catch (  CmsException exc) {
    if (report != null) {
      report.println(report.key("search.indexing_folder") + path + report.key("search.indexing_folder_failed")+ " : "+ exc.getMessage(),I_CmsReport.C_FORMAT_WARNING);
    }
    if (OpenCms.getLog(this).isWarnEnabled()) {
      OpenCms.getLog(this).warn("Failed to index " + path,exc);
    }
  }
catch (  Exception exc) {
    if (report != null) {
      report.println(report.key("search.indexing.folder.failed"),I_CmsReport.C_FORMAT_WARNING);
    }
    if (OpenCms.getLog(this).isWarnEnabled()) {
      OpenCms.getLog(this).warn("Failed to index " + path,exc);
    }
    throw new CmsIndexException("Indexing contents of " + path + " failed.",exc);
  }
}
