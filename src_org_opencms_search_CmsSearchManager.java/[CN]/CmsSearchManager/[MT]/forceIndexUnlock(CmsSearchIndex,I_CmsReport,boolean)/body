{
  File indexPath=new File(index.getPath());
  boolean indexLocked=true;
  if (indexPath.exists()) {
    try {
      indexLocked=IndexWriter.isLocked(index.getPath());
    }
 catch (    Exception e) {
      LOG.error(Messages.get().getBundle().key(Messages.LOG_IO_INDEX_READER_OPEN_2,index.getPath(),index.getName()),e);
    }
    if (indexLocked) {
      if ((m_forceUnlockMode != null) && m_forceUnlockMode.equals(CmsSearchForceUnlockMode.ALWAYS)) {
        try {
          IndexWriter.unlock(FSDirectory.getDirectory(index.getPath()));
        }
 catch (        Exception e) {
          CmsMessageContainer msg=Messages.get().container(Messages.ERR_INDEX_LOCK_FAILED_1,index.getName());
          report.println(msg,I_CmsReport.FORMAT_ERROR);
          throw new CmsIndexException(msg,e);
        }
      }
 else       if ((m_forceUnlockMode != null) && m_forceUnlockMode.equals(CmsSearchForceUnlockMode.NEVER)) {
        indexLocked=waitIndexLock(index,report,indexLocked);
        if (indexLocked) {
          CmsMessageContainer msg=Messages.get().container(Messages.ERR_INDEX_LOCK_FAILED_1,index.getName());
          report.println(msg,I_CmsReport.FORMAT_ERROR);
          throw new CmsIndexException(msg);
        }
      }
 else {
        if (mode) {
          indexLocked=waitIndexLock(index,report,indexLocked);
        }
        if (indexLocked) {
          if (mode) {
            CmsMessageContainer msg=Messages.get().container(Messages.ERR_INDEX_LOCK_FAILED_1,index.getName());
            report.println(msg,I_CmsReport.FORMAT_ERROR);
            throw new CmsIndexException(msg);
          }
 else {
            try {
              IndexWriter.unlock(FSDirectory.getDirectory(index.getPath()));
            }
 catch (            Exception e) {
              CmsMessageContainer msg=Messages.get().container(Messages.ERR_INDEX_LOCK_FAILED_1,index.getName());
              report.println(msg,I_CmsReport.FORMAT_ERROR);
              throw new CmsIndexException(msg,e);
            }
          }
        }
      }
    }
  }
}
