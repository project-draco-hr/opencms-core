{
  List publishedResources;
  try {
    publishedResources=adminCms.readPublishedResources(publishHistoryId);
  }
 catch (  CmsException e) {
    LOG.error(Messages.get().key(Messages.LOG_READING_CHANGED_RESOURCES_FAILED_1,publishHistoryId),e);
    return;
  }
  List updateResources=new ArrayList();
  Iterator itPubRes=publishedResources.iterator();
  while (itPubRes.hasNext()) {
    CmsPublishedResource res=(CmsPublishedResource)itPubRes.next();
    if (res.isFolder() || res.isUnChanged() || !res.isVfsResource()) {
      continue;
    }
    if (res.isDeleted() || res.isNew() || res.isChanged()) {
      updateResources.add(res);
    }
  }
  Map documentCache=Collections.synchronizedMap(new LRUMap(256));
  if (!updateResources.isEmpty()) {
    Collections.sort(updateResources);
    Iterator i=m_indexes.iterator();
    while (i.hasNext()) {
      CmsSearchIndex index=(CmsSearchIndex)i.next();
      if (CmsSearchIndex.REBUILD_MODE_AUTO.equals(index.getRebuildMode())) {
        try {
          updateIndex(index,report,false,updateResources,documentCache);
        }
 catch (        CmsException e) {
          LOG.error(Messages.get().key(Messages.LOG_UPDATE_INDEX_FAILED_1,index.getName()),e);
        }
      }
    }
  }
}
