{
  String originalSiteRoot=m_cms.getRequestContext().getSiteRoot();
  CmsProject originalProject=m_cms.getRequestContext().getCurrentProject();
  try {
    m_cms.getRequestContext().setSiteRoot("");
    m_cms.getRequestContext().setCurrentProject(m_cms.createTempfileProject());
    if (!m_cms.existsResource("/shared")) {
      m_cms.createResource("/shared",OpenCms.getResourceManager().getResourceType("folder").getTypeId());
      CmsResource shared=m_cms.readResource("/shared");
      OpenCms.getPublishManager().publishProject(m_cms,new CmsHtmlReport(m_cms.getRequestContext().getLocale(),m_cms.getRequestContext().getSiteRoot()),shared,false);
      OpenCms.getPublishManager().waitWhileRunning();
    }
  }
  finally {
    m_cms.getRequestContext().setSiteRoot(originalSiteRoot);
    m_cms.getRequestContext().setCurrentProject(originalProject);
  }
}
