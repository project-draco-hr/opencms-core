{
  HashSet checkedProperties=new HashSet();
  Iterator keys=m_linkStorage.keySet().iterator();
  int linksSize=m_linkStorage.size();
  int i=0;
  while (keys.hasNext()) {
    String key=(String)keys.next();
    String link=(String)m_linkStorage.get(key);
    HashMap properties=(HashMap)m_linkPropertyStorage.get(key);
    m_report.print(" ( " + (++i) + " / "+ linksSize+ " ) ",I_CmsReport.C_FORMAT_NOTE);
    m_report.print(m_report.key("report.convert_link"),I_CmsReport.C_FORMAT_NOTE);
    m_report.print(key + " ");
    m_report.print(m_report.key("report.dots"));
    if (link.startsWith("/")) {
      try {
        CmsResource target=m_cms.readFileHeader(link);
        CmsResource resource=new CmsResource(new CmsUUID(),target.getResourceId(),CmsUUID.getNullUUID(),target.getFileId(),CmsResource.getName(key),target.getType(),0,m_cms.getRequestContext().currentProject().getId(),I_CmsConstants.C_STATE_NEW,m_cms.getResourceType(target.getType()).getLoaderId(),target.getDateCreated(),target.getUserCreated(),target.getDateLastModified(),target.getUserLastModified(),CmsResource.DATE_RELEASED_DEFAULT,CmsResource.DATE_EXPIRED_DEFAULT,1,0);
        m_cms.importResource(resource,null,properties,key);
        m_report.println(m_report.key("report.ok"),I_CmsReport.C_FORMAT_OK);
      }
 catch (      CmsException ex) {
        m_report.println();
        m_report.print(m_report.key("report.convert_link_notfound") + " " + link,I_CmsReport.C_FORMAT_WARNING);
        if (OpenCms.getLog(this).isDebugEnabled()) {
          OpenCms.getLog(this).debug("Link conversion failed: " + key + " -> "+ link,ex);
        }
      }
    }
 else {
      Iterator propKeys=properties.keySet().iterator();
      while (propKeys.hasNext()) {
        String property=(String)propKeys.next();
        if (!checkedProperties.contains(property)) {
          createPropertydefinition(property,CmsResourceTypePointer.C_RESOURCE_TYPE_ID);
          checkedProperties.add(property);
        }
      }
      m_cms.createResource(key,CmsResourceTypePointer.C_RESOURCE_TYPE_ID,properties,link.getBytes(),null);
      m_report.println(m_report.key("report.ok"),I_CmsReport.C_FORMAT_OK);
    }
  }
  m_linkStorage=null;
  m_linkPropertyStorage=null;
}
