{
  URL inputUrl=ClassLoader.getSystemResource("org/opencms/configuration/");
  CmsConfigurationManager manager=new CmsConfigurationManager(inputUrl.getFile());
  manager.loadXmlConfiguration();
  List allConfigurations=new ArrayList();
  allConfigurations.add(manager);
  allConfigurations.addAll(manager.getConfigurations());
  NodeComparator comparator=new NodeComparator();
  Iterator i=allConfigurations.iterator();
  while (i.hasNext()) {
    I_CmsXmlConfiguration config=(I_CmsXmlConfiguration)i.next();
    String xmlOrigFile=inputUrl.getFile() + config.getXmlFileName();
    System.out.println("\n\nConfiguration instance: " + config + ":\n");
    Document outputDoc=manager.generateXml(config);
    InputSource source=new InputSource(new FileInputStream(xmlOrigFile));
    Document inputDoc=CmsXmlUtils.unmarshalHelper(source,new CmsXmlEntityResolver(null));
    int result=comparator.compare(outputDoc,inputDoc);
    System.out.println(CmsXmlUtils.marshal(outputDoc,"UTF-8"));
    if (result != 0) {
      System.out.println("\n\nTest failed for configuration instance: " + config + ":\n");
      fail("Generated output for configuration '" + config.getXmlFileName() + "' differs from input!");
    }
  }
}
