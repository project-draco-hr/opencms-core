{
  Object o=m_keyCache.get(key.m_resource);
  if (key.m_timeout > 0) {
    theCacheEntry.setDateExpires(key.m_timeout);
  }
  if (o != null) {
    java.util.Map m=((CmsFlexCacheVariation)o).m_map;
    boolean wasAdded=true;
    if (!m.containsKey(key.m_variation)) {
      wasAdded=this.m_variationCache.add(theCacheEntry);
    }
 else {
      wasAdded=this.m_variationCache.touch(theCacheEntry);
    }
    if (wasAdded) {
      theCacheEntry.setVariationData(key.m_variation,m);
      m.put(key.m_variation,theCacheEntry);
    }
  }
 else {
    CmsFlexCacheVariation list=new CmsFlexCacheVariation(key);
    boolean wasAdded=this.m_variationCache.add(theCacheEntry);
    if (wasAdded) {
      theCacheEntry.setVariationData(key.m_variation,list.m_map);
      list.m_map.put(key.m_variation,theCacheEntry);
      m_keyCache.put(key.m_resource,list);
    }
  }
  if (DEBUG > 0) {
    System.err.println("FlexCache: Entry " + m_size + " added for resource "+ key.m_resource+ " with variation "+ key.m_variation);
  }
  if (DEBUG > 2) {
    System.err.println("FlexCache: Entry added was:\n" + theCacheEntry.toString());
  }
}
