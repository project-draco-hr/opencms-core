{
  m_enabled=configuration.isCacheEnabled();
  m_cacheOffline=configuration.isCacheOffline();
  int maxCacheBytes=configuration.getMaxCacheBytes();
  int avgCacheBytes=configuration.getAvgCacheBytes();
  int maxEntryBytes=configuration.getMaxEntryBytes();
  int maxKeys=configuration.getMaxKeys();
  this.m_variationCache=new CmsLruCache(maxCacheBytes,avgCacheBytes,maxEntryBytes);
  if (OpenCms.getMemoryMonitor().enabled()) {
    OpenCms.getMemoryMonitor().register(this.getClass().getName() + "." + "m_entryLruCache",m_variationCache);
  }
  if (m_enabled) {
    CmsFlexKeyMap hashMap=new CmsFlexKeyMap(maxKeys);
    this.m_keyCache=Collections.synchronizedMap(hashMap);
    if (OpenCms.getMemoryMonitor().enabled()) {
      OpenCms.getMemoryMonitor().register(this.getClass().getName() + "." + "m_resourceMap",hashMap);
    }
    OpenCms.addCmsEventListener(this,new int[]{I_CmsEventListener.EVENT_PUBLISH_PROJECT,I_CmsEventListener.EVENT_CLEAR_CACHES,I_CmsEventListener.EVENT_FLEX_PURGE_JSP_REPOSITORY,I_CmsEventListener.EVENT_FLEX_CACHE_CLEAR});
  }
  if (OpenCms.getLog(CmsFlexCache.class).isInfoEnabled()) {
    OpenCms.getLog(CmsFlexCache.class).info("FlexCache: Initializing with parameters enabled=" + m_enabled + " cacheOffline="+ m_cacheOffline);
  }
}
