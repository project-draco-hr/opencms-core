{
  CmsResource elementRes=m_cms.readResource(element.getElementId());
  CmsTemplateLoaderFacade loaderFacade=new CmsTemplateLoaderFacade(OpenCms.getResourceManager().getLoader(formatter),elementRes,formatter);
  CmsResource loaderRes=loaderFacade.getLoaderStartResource();
  String oldUri=m_cms.getRequestContext().getUri();
  try {
    m_cms.getRequestContext().setUri(m_cntPageUri);
    I_CmsDirectEditProvider eb=new CmsAdvancedDirectEditProvider();
    eb.init(m_cms,CmsDirectEditMode.TRUE,m_cms.getSitePath(elementRes));
    m_req.setAttribute(I_CmsDirectEditProvider.ATTRIBUTE_DIRECT_EDIT_PROVIDER,eb);
    element.setSitePath(m_cms.getSitePath(elementRes));
    m_req.setAttribute(CmsADEManager.ATTR_CURRENT_ELEMENT,element);
    return (new String(loaderFacade.getLoader().dump(m_cms,loaderRes,null,m_cms.getRequestContext().getLocale(),m_req,m_res),m_res.getCharacterEncoding())).trim();
  }
  finally {
    m_cms.getRequestContext().setUri(oldUri);
  }
}
