{
  CmsResource elementRes=m_cms.readResource(element.getElementId());
  CmsTemplateLoaderFacade loaderFacade=new CmsTemplateLoaderFacade(OpenCms.getResourceManager().getLoader(formatter),elementRes,formatter);
  CmsResource loaderRes=loaderFacade.getLoaderStartResource();
  String oldUri=m_cms.getRequestContext().getUri();
  try {
    m_cms.getRequestContext().setUri(m_cntPageUri);
    CmsContainerBean containerBean=null;
    if (m_standardContext.getPage().getContainers().containsKey(container.getName())) {
      containerBean=m_standardContext.getPage().getContainers().get(container.getName());
    }
 else {
      containerBean=new CmsContainerBean(container.getName(),container.getType(),container.getMaxElements(),Collections.<CmsContainerElementBean>emptyList());
    }
    if (containerBean.getWidth() == null) {
      containerBean.setWidth(String.valueOf(container.getWidth()));
    }
    m_standardContext.setContainer(containerBean);
    element.setSitePath(m_cms.getSitePath(elementRes));
    m_standardContext.setElement(element);
    I_CmsDirectEditProvider eb=new CmsAdvancedDirectEditProvider();
    eb.init(m_cms,CmsDirectEditMode.TRUE,m_cms.getSitePath(elementRes));
    m_req.setAttribute(I_CmsDirectEditProvider.ATTRIBUTE_DIRECT_EDIT_PROVIDER,eb);
    String encoding=m_res.getCharacterEncoding();
    return (new String(loaderFacade.getLoader().dump(m_cms,loaderRes,null,m_cms.getRequestContext().getLocale(),m_req,m_res),encoding)).trim();
  }
  finally {
    m_cms.getRequestContext().setUri(oldUri);
  }
}
