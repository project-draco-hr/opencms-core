{
  CmsObject clone=OpenCms.initCmsObject(getCmsObject());
  if (isTrue(m_applyChangesEverywhere)) {
    clone.getRequestContext().setSiteRoot("/");
  }
  for (  Map.Entry<I_CmsResourceType,I_CmsResourceType> mapping : resTypeMap.entrySet()) {
    CmsResourceFilter filter=CmsResourceFilter.requireType(mapping.getKey().getTypeId());
    List<CmsResource> resources=clone.readResources("/",filter);
    String sourceSchemaPath=mapping.getKey().getConfiguration().get("schema");
    String targetSchemaPath=mapping.getValue().getConfiguration().get("schema");
    for (    CmsResource res : resources) {
      if (lockResource(getCmsObject(),res)) {
        CmsFile file=getCmsObject().readFile(res);
        String encoding=CmsLocaleManager.getResourceEncoding(getCmsObject(),file);
        String content=new String(file.getContents(),encoding);
        content=content.replaceAll(sourceSchemaPath,targetSchemaPath);
        file.setContents(content.getBytes(encoding));
        try {
          getCmsObject().writeFile(file);
        }
 catch (        CmsXmlException e) {
          LOG.error(e.getMessage(),e);
        }
        res.setType(mapping.getValue().getTypeId());
        getCmsObject().writeResource(res);
      }
    }
  }
}
