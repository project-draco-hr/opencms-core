{
  String username=theUser.getName();
  List oldGroups=cms.getGroupsOfUser(username);
  List oldGroupnames=new Vector();
  cms.writeUser(theUser);
  theUser=cms.readUser(username);
  if (oldGroups != null) {
    for (int z=0; z < oldGroups.size(); z++) {
      oldGroupnames.add(((CmsGroup)oldGroups.get(z)).getName());
    }
    for (int z=0; z < oldGroupnames.size(); z++) {
      String groupname=(String)oldGroupnames.get(z);
      if (!newGroups.contains(groupname)) {
        try {
          cms.removeUserFromGroup(username,groupname);
        }
 catch (        CmsException e) {
        }
      }
    }
  }
  if (newGroups != null) {
    for (int z=0; z < newGroups.size(); z++) {
      String groupname=(String)newGroups.elementAt(z);
      if (!cms.userInGroup(username,groupname)) {
        cms.addUserToGroup(username,groupname);
      }
    }
  }
  cms.writeUser(theUser);
  theUser=cms.readUser(username);
}
