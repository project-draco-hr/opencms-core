{
  CmsObject cms=getCmsObject();
  echo("Testing publish changed files");
  String resource1="/folder2/image1_new.gif";
  String resource2="/folder2/image1_sibling1.gif";
  String resource3="/folder2/image1_sibling2.gif";
  String resource4="/folder2/image1_sibling3.gif";
  CmsProject onlineProject=cms.readProject("Online");
  CmsProject offlineProject=cms.readProject("Offline");
  long timestamp=System.currentTimeMillis();
  cms.lockResource(resource1);
  cms.lockResource(resource2);
  cms.touch(resource1,timestamp,I_CmsConstants.C_DATE_UNCHANGED,I_CmsConstants.C_DATE_UNCHANGED,true);
  cms.touch(resource2,timestamp,I_CmsConstants.C_DATE_UNCHANGED,I_CmsConstants.C_DATE_UNCHANGED,true);
  cms.unlockResource(resource1);
  cms.unlockResource(resource2);
  cms.publishResource(resource1);
  cms.getRequestContext().setCurrentProject(onlineProject);
  assertDateLastModified(cms,resource1,timestamp);
  cms.getRequestContext().setCurrentProject(offlineProject);
  assertState(cms,resource1,I_CmsConstants.C_STATE_UNCHANGED);
  cms.publishResource(resource2);
  cms.getRequestContext().setCurrentProject(onlineProject);
  assertDateLastModified(cms,resource2,timestamp);
  assertDateLastModified(cms,resource3,timestamp);
  assertDateLastModified(cms,resource4,timestamp);
  cms.getRequestContext().setCurrentProject(offlineProject);
  assertState(cms,resource2,I_CmsConstants.C_STATE_UNCHANGED);
  assertState(cms,resource3,I_CmsConstants.C_STATE_UNCHANGED);
  assertState(cms,resource4,I_CmsConstants.C_STATE_UNCHANGED);
}
