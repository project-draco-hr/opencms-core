{
  CmsObject cms=getCmsObject();
  echo("Testing publish deleted files");
  String resource1="/folder2/image1_new.gif";
  String resource2="/folder2/image1_sibling1.gif";
  String resource3="/folder2/image1_sibling2.gif";
  String resource4="/folder2/image1_sibling3.gif";
  CmsProject onlineProject=cms.readProject("Online");
  CmsProject offlineProject=cms.readProject("Offline");
  cms.lockResource(resource1);
  cms.deleteResource(resource1,I_CmsConstants.C_DELETE_OPTION_PRESERVE_SIBLINGS);
  cms.unlockResource(resource1);
  cms.publishResource(resource1);
  cms.getRequestContext().setCurrentProject(onlineProject);
  try {
    cms.readResource(resource1);
    fail("Resource " + resource1 + " was not deleted online");
  }
 catch (  CmsException e) {
    if (e.getType() != CmsException.C_NOT_FOUND) {
      fail("Resource " + resource1 + " error:"+ e);
    }
  }
  cms.getRequestContext().setCurrentProject(offlineProject);
  cms.lockResource(resource2);
  cms.deleteResource(resource2,I_CmsConstants.C_DELETE_OPTION_DELETE_SIBLINGS);
  cms.unlockResource(resource2);
  cms.publishResource(resource2,false,new CmsShellReport());
  cms.getRequestContext().setCurrentProject(onlineProject);
  try {
    cms.readResource(resource2);
    fail("Resource " + resource2 + " was not deleted online");
  }
 catch (  CmsException e) {
    if (e.getType() != CmsException.C_NOT_FOUND) {
      fail("Resource " + resource2 + " error:"+ e);
    }
  }
  try {
    cms.readResource(resource3);
  }
 catch (  CmsException e) {
    fail("Resource " + resource3 + " error:"+ e);
  }
  try {
    cms.readResource(resource4);
  }
 catch (  CmsException e) {
    fail("Resource " + resource4 + " error:"+ e);
  }
  cms.getRequestContext().setCurrentProject(offlineProject);
  assertState(cms,resource3,I_CmsConstants.C_STATE_DELETED);
  assertState(cms,resource4,I_CmsConstants.C_STATE_DELETED);
  cms.publishResource(resource3,true,new CmsShellReport());
  cms.getRequestContext().setCurrentProject(onlineProject);
  try {
    cms.readResource(resource3);
    fail("Resource " + resource3 + " was not deleted online");
  }
 catch (  CmsException e) {
    if (e.getType() != CmsException.C_NOT_FOUND) {
      fail("Resource " + resource3 + " error:"+ e);
    }
  }
  try {
    cms.readResource(resource4);
    fail("Resource " + resource4 + " was not deleted online");
  }
 catch (  CmsException e) {
    if (e.getType() != CmsException.C_NOT_FOUND) {
      fail("Resource " + resource4 + " error:"+ e);
    }
  }
  cms.getRequestContext().setCurrentProject(offlineProject);
}
