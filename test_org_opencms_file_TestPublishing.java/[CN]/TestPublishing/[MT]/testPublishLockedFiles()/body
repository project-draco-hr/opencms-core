{
  CmsObject cms=getCmsObject();
  echo("Testing publish locked files");
  String source="/folder2/subfolder21/image1.gif";
  String resource1="/folder2/image1_new.gif";
  String resource2="/folder2/image1_sibling1.gif";
  CmsProject onlineProject=cms.readProject("Online");
  CmsProperty prop0;
  CmsProperty prop1;
  CmsProperty prop2;
  cms.lockResource(source);
  cms.lockResource(resource1);
  cms.lockResource(resource2);
  cms.writePropertyObject(source,new CmsProperty("Title",source + " modified",null));
  cms.writePropertyObject(resource1,new CmsProperty("Title",resource1 + " modified",null));
  cms.writePropertyObject(resource2,new CmsProperty("Title",resource2 + " modified",null));
  storeResources(cms,source);
  storeResources(cms,resource1);
  storeResources(cms,resource2);
  cms.publishProject();
  assertState(cms,source,I_CmsConstants.C_STATE_CHANGED);
  assertState(cms,resource1,I_CmsConstants.C_STATE_CHANGED);
  assertState(cms,resource2,I_CmsConstants.C_STATE_CHANGED);
  cms.getRequestContext().setCurrentProject(onlineProject);
  prop0=cms.readPropertyObject(source,"Title",false);
  prop1=cms.readPropertyObject(resource1,"Title",false);
  prop2=cms.readPropertyObject(resource2,"Title",false);
  if (prop0.getValue().equals((source + " modified"))) {
    fail("Property published for " + source);
  }
  if (prop1.getValue().equals((resource1 + " modified"))) {
    fail("Property published for " + resource1);
  }
  if (prop2.getValue().equals((resource2 + " modified"))) {
    fail("Property published for " + resource2);
  }
}
