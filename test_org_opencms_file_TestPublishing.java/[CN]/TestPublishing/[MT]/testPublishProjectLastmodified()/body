{
  CmsObject cms=getCmsObject();
  echo("Testing publishing a distinct project");
  String path="/folder1";
  String res1=path + "/page1.html";
  String res2=path + "/page2.html";
  long timestamp=System.currentTimeMillis();
  cms.getRequestContext().setCurrentProject(cms.readProject("Online"));
  storeResources(cms,res1);
  cms.getRequestContext().setCurrentProject(cms.readProject("Offline"));
  cms.lockResource(res1);
  cms.touch(res1,timestamp,I_CmsConstants.C_DATE_UNCHANGED,I_CmsConstants.C_DATE_UNCHANGED,false);
  cms.unlockProject(cms.getRequestContext().currentProject().getId());
  CmsProject project=getTestProject(cms);
  cms.getRequestContext().setCurrentProject(project);
  cms.copyResourceToProject(path);
  cms.lockResource(res2);
  cms.touch(res2,timestamp,I_CmsConstants.C_DATE_UNCHANGED,I_CmsConstants.C_DATE_UNCHANGED,false);
  cms.unlockProject(cms.getRequestContext().currentProject().getId());
  storeResources(cms,res2);
  cms.publishProject();
  cms.getRequestContext().setCurrentProject(cms.readProject("Online"));
  this.assertFilter(cms,res1,OpenCmsTestResourceFilter.FILTER_EQUAL);
  this.assertFilter(cms,res2,OpenCmsTestResourceFilter.FILTER_PUBLISHRESOURCE);
  this.assertDateLastModified(cms,res2,timestamp);
  echo("Testing publishing in different projects");
  String res3=path + "/testPublishProjectLastmodified.txt";
  cms.getRequestContext().setCurrentProject(project);
  cms.createResource(res3,CmsResourceTypePlain.C_RESOURCE_TYPE_ID);
  String res4="/testPublishProjectLastmodified.txt";
  cms.getRequestContext().setCurrentProject(cms.readProject("Offline"));
  cms.copyResource(res3,res4,I_CmsConstants.C_COPY_AS_SIBLING);
  assertState(cms,res3,I_CmsConstants.C_STATE_NEW);
  assertState(cms,res4,I_CmsConstants.C_STATE_NEW);
  cms.getRequestContext().setCurrentProject(project);
  cms.unlockProject(project.getId());
  cms.publishProject();
  assertState(cms,res3,I_CmsConstants.C_STATE_NEW);
  assertState(cms,res4,I_CmsConstants.C_STATE_NEW);
  cms.publishResource(path,true,new CmsShellReport());
  assertState(cms,res3,I_CmsConstants.C_STATE_NEW);
  assertState(cms,res4,I_CmsConstants.C_STATE_NEW);
}
