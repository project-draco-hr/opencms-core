{
  try {
    I_CmsResponse resp=cms.getRequestContext().getResponse();
    if ((!cms.getRequestContext().isStreaming()) && result != null && !resp.isRedirected()) {
      OutputStream out=resp.getOutputStream();
      resp.setContentLength(result.length);
      resp.setHeader("Connection","keep-alive");
      out.write(result);
      out.close();
    }
  }
 catch (  IOException ioe) {
    if (I_CmsLogChannels.C_LOGGING && A_OpenCms.isLogging(I_CmsLogChannels.C_OPENCMS_DEBUG)) {
      A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_DEBUG,getClassName() + "IO error while writing to response stream for " + cms.getRequestContext().getFileUri());
      A_OpenCms.log(I_CmsLogChannels.C_OPENCMS_DEBUG,getClassName() + ioe);
    }
  }
catch (  Exception e) {
    String errorMessage="Cannot write output to HTTP response stream";
    handleException(cms,e,errorMessage);
  }
}
