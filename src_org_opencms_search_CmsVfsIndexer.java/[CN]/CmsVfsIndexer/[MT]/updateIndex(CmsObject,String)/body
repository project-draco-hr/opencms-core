{
  boolean folderReported=false;
  List resources=null;
  CmsResource res=null;
  try {
    if (CmsResource.isFolder(path)) {
      resources=cms.getResourcesInFolder(path,CmsResourceFilter.DEFAULT);
    }
 else {
      resources=Collections.EMPTY_LIST;
    }
    for (int i=0; i < resources.size(); i++) {
      res=(CmsResource)resources.get(i);
      if (res instanceof CmsFolder) {
        updateIndex(cms,cms.getRequestContext().removeSiteRoot(res.getRootPath()));
        continue;
      }
      if (m_report != null && !folderReported) {
        m_report.print(m_report.key("search.indexing_folder"),I_CmsReport.C_FORMAT_NOTE);
        m_report.println(path,I_CmsReport.C_FORMAT_DEFAULT);
        folderReported=true;
      }
      if (m_report != null) {
        m_report.print("( " + (m_threadManager.getCounter() + 1) + " ) ",I_CmsReport.C_FORMAT_NOTE);
        m_report.print(m_report.key("search.indexing_file_begin"),I_CmsReport.C_FORMAT_NOTE);
        m_report.print(res.getName(),I_CmsReport.C_FORMAT_DEFAULT);
        m_report.print(m_report.key("search.dots"),I_CmsReport.C_FORMAT_DEFAULT);
      }
      A_CmsIndexResource ires=new CmsVfsIndexResource(res);
      m_threadManager.createIndexingThread(m_writer,ires,m_index);
    }
  }
 catch (  CmsIndexException exc) {
    if (m_report != null) {
      m_report.println();
      m_report.println(m_report.key("search.indexing_file_failed") + " : " + exc.getMessage(),I_CmsReport.C_FORMAT_WARNING);
    }
    if (OpenCms.getLog(this).isWarnEnabled()) {
      OpenCms.getLog(this).warn("Failed to index " + path,exc);
    }
  }
catch (  CmsException exc) {
    if (m_report != null) {
      m_report.println(m_report.key("search.indexing_folder") + path + m_report.key("search.indexing_folder_failed")+ " : "+ exc.getMessage(),I_CmsReport.C_FORMAT_WARNING);
    }
    if (OpenCms.getLog(this).isWarnEnabled()) {
      OpenCms.getLog(this).warn("Failed to index " + path,exc);
    }
  }
catch (  Exception exc) {
    if (m_report != null) {
      m_report.println(m_report.key("search.indexing_folder_failed"),I_CmsReport.C_FORMAT_WARNING);
    }
    if (OpenCms.getLog(this).isWarnEnabled()) {
      OpenCms.getLog(this).warn("Failed to index " + path,exc);
    }
    throw new CmsIndexException("Indexing contents of " + path + " failed.",exc);
  }
}
