{
  boolean folderReported=false;
  List resources=null;
  CmsResource res=null;
  try {
    if (CmsResource.isFolder(path)) {
      resources=cms.getResourcesInFolder(path,CmsResourceFilter.DEFAULT);
    }
 else {
      resources=Collections.EMPTY_LIST;
    }
    for (int i=0; i < resources.size(); i++) {
      res=(CmsResource)resources.get(i);
      if (!res.isInternal()) {
        if (res instanceof CmsFolder) {
          updateIndex(cms,source,cms.getRequestContext().removeSiteRoot(res.getRootPath()));
          continue;
        }
        if (m_report != null && !folderReported) {
          m_report.print(Messages.get().container(Messages.RPT_SEARCH_INDEXING_FOLDER_0),I_CmsReport.FORMAT_NOTE);
          m_report.println(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_ARGUMENT_1,path));
          folderReported=true;
        }
        if (m_report != null) {
          m_report.print(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_SUCCESSION_1,String.valueOf(m_threadManager.getCounter() + 1)),I_CmsReport.FORMAT_NOTE);
          m_report.print(Messages.get().container(Messages.RPT_SEARCH_INDEXING_FILE_BEGIN_0),I_CmsReport.FORMAT_NOTE);
          m_report.print(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_ARGUMENT_1,res.getName()));
          m_report.print(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_DOTS_0),I_CmsReport.FORMAT_DEFAULT);
        }
        A_CmsIndexResource ires=new CmsVfsIndexResource(res);
        m_threadManager.createIndexingThread(cms,m_writer,ires,m_index);
      }
    }
  }
 catch (  CmsIndexException exc) {
    if (m_report != null) {
      m_report.println();
      m_report.print(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_FAILED_0),I_CmsReport.FORMAT_WARNING);
      m_report.println(exc);
    }
    if (LOG.isWarnEnabled()) {
      LOG.warn(Messages.get().key(Messages.LOG_INDEXING_PATH_FAILED_1,path),exc);
    }
  }
catch (  CmsException exc) {
    if (m_report != null) {
      m_report.println(Messages.get().container(Messages.RPT_SEARCH_INDEXING_FOLDER_FAILED_2,path,exc.getLocalizedMessage()),I_CmsReport.FORMAT_WARNING);
    }
    if (LOG.isWarnEnabled()) {
      LOG.warn(Messages.get().key(Messages.LOG_INDEXING_PATH_FAILED_1,path),exc);
    }
  }
catch (  Exception exc) {
    if (m_report != null) {
      m_report.println(Messages.get().container(Messages.RPT_SEARCH_INDEXING_FOLDER_0),I_CmsReport.FORMAT_WARNING);
    }
    if (LOG.isWarnEnabled()) {
      LOG.warn(Messages.get().key(Messages.LOG_INDEXING_PATH_FAILED_1,path),exc);
    }
    throw new CmsIndexException(Messages.get().container(Messages.LOG_INDEXING_FAILED_1));
  }
}
