{
  String base=getTestDataPath(File.separator + "WEB-INF" + File.separator+ "base");
  CmsSetupXmlHelper xmlHelper=new CmsSetupXmlHelper(base);
  String inputFile="test.xml";
  CmsFileUtil.copy(base + CmsWorkplaceConfiguration.DEFAULT_XML_FILE_NAME,base + inputFile);
  System.out.println("Modifying xml from " + base + inputFile);
  Document ori=xmlHelper.getDocument(inputFile);
  String baseXp="/" + CmsConfigurationManager.N_ROOT + "/"+ CmsWorkplaceConfiguration.N_WORKPLACE+ "/";
  String xPath=baseXp + CmsWorkplaceConfiguration.N_AUTOLOCK;
  String value=xmlHelper.getValue(inputFile,xPath);
  assertEquals("true",value);
  String expected="false";
  xmlHelper.setValue(inputFile,xPath,expected);
  value=xmlHelper.getValue(inputFile,xPath);
  assertEquals(expected,value);
  xPath=baseXp + CmsWorkplaceConfiguration.N_LOCALIZEDFOLDERS + "/"+ I_CmsXmlConfiguration.N_RESOURCE+ "[2]/@"+ I_CmsXmlConfiguration.A_URI;
  value=xmlHelper.getValue(inputFile,xPath);
  assertEquals("/system/login/",value);
  expected="/";
  xmlHelper.setValue(inputFile,xPath,expected);
  value=xmlHelper.getValue(inputFile,xPath);
  assertEquals(expected,value);
  xPath=baseXp + "test1/test2/test3";
  expected="test4";
  assertEquals(1,xmlHelper.setValue(inputFile,xPath,expected));
  value=xmlHelper.getValue(inputFile,xPath);
  assertEquals(expected,value);
  xPath=baseXp + CmsWorkplaceConfiguration.N_LOCALIZEDFOLDERS + "/"+ I_CmsXmlConfiguration.N_RESOURCE+ "[2]/@test-attr";
  expected="test-value";
  assertEquals(1,xmlHelper.setValue(inputFile,xPath,expected));
  value=xmlHelper.getValue(inputFile,xPath);
  assertEquals(expected,value);
  xPath=baseXp + "test1/test2[2]/test5";
  expected="test6";
  assertEquals(1,xmlHelper.setValue(inputFile,xPath,expected));
  value=xmlHelper.getValue(inputFile,xPath);
  assertEquals(expected,value);
  xmlHelper.write(inputFile);
  xPath=baseXp + CmsWorkplaceConfiguration.N_LOCALIZEDFOLDERS + "/"+ I_CmsXmlConfiguration.N_RESOURCE+ "[2]/@"+ I_CmsXmlConfiguration.A_URI;
  value=xmlHelper.getValue(inputFile,xPath);
  assertEquals("/",value);
  expected="/system/login/";
  xmlHelper.setValue(inputFile,xPath,expected);
  value=xmlHelper.getValue(inputFile,xPath);
  assertEquals(expected,value);
  xPath=baseXp + CmsWorkplaceConfiguration.N_AUTOLOCK;
  value=xmlHelper.getValue(inputFile,xPath);
  assertEquals("false",value);
  expected="true";
  xmlHelper.setValue(inputFile,xPath,expected);
  value=xmlHelper.getValue(inputFile,xPath);
  assertEquals(expected,value);
  xPath=baseXp + "test1";
  assertEquals(1,xmlHelper.setValue(inputFile,xPath,null));
  assertNull(xmlHelper.getValue(inputFile,xPath));
  xPath=baseXp + CmsWorkplaceConfiguration.N_LOCALIZEDFOLDERS + "/"+ I_CmsXmlConfiguration.N_RESOURCE+ "[2]/@test-attr";
  assertEquals(1,xmlHelper.setValue(inputFile,xPath,null));
  assertNull(xmlHelper.getValue(inputFile,xPath));
  assertNotNull(xmlHelper.getValue(inputFile,xPath.substring(0,xPath.lastIndexOf('/')) + "/@uri"));
  xPath=baseXp + "test1";
  assertEquals(0,xmlHelper.setValue(inputFile,xPath,null));
  xPath=baseXp + CmsWorkplaceConfiguration.N_LOCALIZEDFOLDERS + "/"+ I_CmsXmlConfiguration.N_RESOURCE+ "[2]/@test-xxx";
  assertEquals(0,xmlHelper.setValue(inputFile,xPath,null));
  xmlHelper.write(inputFile);
  xmlHelper.flushAll();
  Document cur=xmlHelper.getDocument(inputFile);
  assertEquals(ori,cur);
  new File(base + inputFile).delete();
}
