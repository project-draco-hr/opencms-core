{
  String mail_encoding="ISO-8859-1";
  Properties mailProps=new java.util.Properties();
  mailProps.put("mail.smtp.host",host.getHostname());
  mailProps.put("mail.transport.protocol",host.getProtocol());
  CmsMailPasswordAuth auth=null;
  if (host.isAuthenticating()) {
    mailProps.put("mail.smtp.auth","true");
    mailProps.put("mail.smtp.user",host.getUsername());
    auth=new CmsMailPasswordAuth(host.getUsername(),host.getPassword());
  }
  Session mailSession=Session.getInstance(mailProps,auth);
  MimeMessage msg=new MimeMessage(mailSession);
  InternetAddress[] to=new InternetAddress[m_to.length];
  for (int i=0; i < m_to.length; i++) {
    to[i]=new InternetAddress(m_to[i]);
  }
  msg.setFrom(new InternetAddress(m_from));
  msg.setRecipients(Message.RecipientType.TO,to);
  InternetAddress[] cc=null;
  if (m_cc != null) {
    cc=new InternetAddress[m_cc.length];
    for (int i=0; i < m_cc.length; i++) {
      cc[i]=new InternetAddress(m_cc[i]);
    }
    msg.setRecipients(Message.RecipientType.CC,cc);
  }
  InternetAddress[] bcc=null;
  if (m_bcc != null) {
    bcc=new InternetAddress[m_bcc.length];
    for (int i=0; i < m_bcc.length; i++) {
      bcc[i]=new InternetAddress(m_bcc[i]);
    }
    msg.setRecipients(Message.RecipientType.BCC,bcc);
  }
  msg.setSubject(m_subject,mail_encoding);
  if (m_type.equals("text/html")) {
    msg.setDataHandler(new DataHandler(new CmsMailByteArrayDataSource(m_content,m_type,mail_encoding)));
  }
 else {
    msg.setContent(m_content,m_type);
  }
  msg.setSentDate(new Date());
  return msg;
}
