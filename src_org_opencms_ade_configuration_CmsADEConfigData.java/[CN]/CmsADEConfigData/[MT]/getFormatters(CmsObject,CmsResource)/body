{
  int resTypeId=res.getTypeId();
  try {
    I_CmsResourceType resType=OpenCms.getResourceManager().getResourceType(resTypeId);
    String typeName=resType.getTypeName();
    CmsResourceTypeConfig typeConfig=getResourceType(typeName);
    if ((typeConfig != null) && (typeConfig.getFormatterConfiguration() != null) && !typeConfig.getFormatterConfiguration().getAllFormatters().isEmpty()) {
      return typeConfig.getFormatterConfiguration();
    }
    CmsFormatterConfigurationCacheState formatterCacheState=OpenCms.getADEManager().getCachedFormatters(cms.getRequestContext().getCurrentProject().isOnlineProject());
    CmsFormatterConfiguration schemaFormatters=getFormattersFromSchema(cms,res);
    List<I_CmsFormatterBean> formatters=new ArrayList<I_CmsFormatterBean>();
    for (    I_CmsFormatterBean formatter : schemaFormatters.getAllFormatters()) {
      formatters.add(formatter);
    }
    for (    I_CmsFormatterBean formatter : formatterCacheState.getFormattersForType(typeName,true)) {
      formatters.add(formatter);
    }
    return CmsFormatterConfiguration.create(cms,formatters);
  }
 catch (  CmsLoaderException e) {
    LOG.warn(e.getLocalizedMessage(),e);
    return null;
  }
}
