{
  List<String> subSitePaths=OpenCms.getADEManager().getSubSitePaths(getCmsObject(),getCmsObject().getRequestContext().addSiteRoot(entryPointUri));
  CmsObject cms=getCmsObject();
  List<CmsGalleryType> galleryTypes=collectGalleryTypes();
  Map<CmsGalleryType,List<CmsGalleryFolderEntry>> result=new HashMap<CmsGalleryType,List<CmsGalleryFolderEntry>>();
  for (  CmsGalleryType type : galleryTypes) {
    List<CmsGalleryFolderEntry> galleries=new ArrayList<CmsGalleryFolderEntry>();
    try {
      List<CmsResource> galleryFolders=cms.readResources(entryPointUri,CmsResourceFilter.ONLY_VISIBLE_NO_DELETED.addRequireType(type.getTypeId()));
      for (      CmsResource folder : galleryFolders) {
        try {
          if (!isInSubsite(subSitePaths,folder.getRootPath())) {
            galleries.add(readGalleryFolderEntry(folder,type.getTypeName()));
          }
        }
 catch (        CmsException ex) {
          log(ex.getLocalizedMessage(),ex);
        }
      }
    }
 catch (    CmsException e) {
      log(e.getLocalizedMessage(),e);
    }
    result.put(type,galleries);
  }
  return result;
}
