{
  List<CmsClientSitemapEntry> children=new ArrayList<CmsClientSitemapEntry>();
  int i=0;
  for (  CmsJspNavElement navElement : getNavBuilder().getNavigationForFolder(root,Visibility.all,CmsResourceFilter.ONLY_VISIBLE)) {
    CmsClientSitemapEntry child=toClientEntry(navElement,false);
    if (child != null) {
      child.setPosition(i);
      children.add(child);
      int nextLevels=levels;
      if ((nextLevels == 1) && (targetPath != null) && targetPath.startsWith(child.getSitePath())) {
        nextLevels=2;
      }
      if (child.isFolderType() && ((nextLevels > 1) || (nextLevels == -1)) && !isSubSitemap(navElement)) {
        child.setSubEntries(getChildren(child.getSitePath(),nextLevels - 1,targetPath));
        child.setChildrenLoadedInitially(true);
      }
      i++;
    }
  }
  return children;
}
