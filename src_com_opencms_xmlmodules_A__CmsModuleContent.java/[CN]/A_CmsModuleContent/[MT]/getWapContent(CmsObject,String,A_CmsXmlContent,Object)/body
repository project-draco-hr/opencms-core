{
  Hashtable parameters=(Hashtable)userObj;
  String elementName=(String)parameters.get("_ELEMENT_");
  String result="";
  CmsXmlTemplateFile templateFile=(CmsXmlTemplateFile)doc;
  String folder=getFolder(elementName,parameters);
  Vector v=getAllArticles(cms,folder);
  String maxArticles=getMaxLinks(elementName,parameters);
  int max=new Integer(maxArticles).intValue();
  String navDeck=getNavDeck(elementName,parameters);
  int nav=new Integer(navDeck).intValue();
  String selectedArticle=getSelectedArticle(elementName,parameters);
  if (selectedArticle == null || "".equals(selectedArticle)) {
    for (int i=(nav) * max; i < ((nav + 1) * max); i++) {
      if (i < v.size()) {
        result=result + getWapData(templateFile,v,i,true);
      }
    }
    nav+=1;
    if (nav * max < v.size()) {
      String linktext;
      templateFile.setData("selection","?body.nav=" + nav);
      try {
        linktext=templateFile.getDataValue(C_TAG_WMLLINKLABEL);
      }
 catch (      CmsException e) {
        linktext=C_DEF_WMLLINKLABEL;
      }
      templateFile.setData("headline",linktext);
      result=result + templateFile.getProcessedDataValue(C_TAG_WMLNAV);
    }
  }
 else {
    int article=new Integer(selectedArticle).intValue();
    if (article < v.size()) {
      result=result + getWapData(templateFile,v,article,false);
    }
  }
  return result;
}
