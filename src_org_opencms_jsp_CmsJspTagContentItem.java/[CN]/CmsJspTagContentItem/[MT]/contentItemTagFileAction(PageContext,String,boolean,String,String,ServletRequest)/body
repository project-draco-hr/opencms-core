{
  int todo=0;
  CmsFlexController controller=(CmsFlexController)req.getAttribute(CmsFlexController.ATTRIBUTE_NAME);
  CmsObject cms=controller.getCmsObject();
  CmsFile contentFile;
  CmsXmlContent content;
  if ("uri".equals(filename)) {
    filename=cms.getRequestContext().getUri();
  }
  try {
    contentFile=cms.readFile(filename);
    content=CmsXmlContentFactory.unmarshal(cms,contentFile);
  }
 catch (  CmsException e) {
    controller.setThrowable(e,filename);
    throw new JspException(e);
  }
  req.setAttribute(ATTRIBUTE_FILENAME,filename);
  req.setAttribute(ATTRIBUTE_XMLCONTENT,content);
  String directEditPermissions=null;
  String directEditIncludeFile=null;
  if (editable) {
    directEditIncludeFile=(String)context.getRequest().getAttribute(I_CmsEditorActionHandler.C_DIRECT_EDIT_INCLUDE_FILE_URI);
    if (directEditIncludeFile != null) {
      directEditPermissions=OpenCms.getWorkplaceManager().getEditorActionHandler().getEditMode(controller.getCmsObject(),filename,null,req);
    }
    if (directEditPermissions == null) {
      editable=false;
    }
  }
  if (editable) {
    includeDirectEditElement(context,directEditIncludeFile,I_CmsEditorActionHandler.C_DIRECT_EDIT_AREA_START + "_" + directEditPermissions,filename,editOptions,createLink,req,context.getResponse());
  }
  return editable;
}
