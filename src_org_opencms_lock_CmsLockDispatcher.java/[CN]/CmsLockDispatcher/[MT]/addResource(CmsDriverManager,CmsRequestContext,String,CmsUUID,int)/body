{
  if (!getLock(driverManager,context,resourcename).isNullLock()) {
    throw new CmsLockException("Resource is already locked",CmsLockException.C_RESOURCE_LOCKED);
  }
  CmsLock newLock=new CmsLock(resourcename,userId,projectId,CmsLock.C_TYPE_EXCLUSIVE);
  m_exclusiveLocks.put(resourcename,newLock);
  if (resourcename.endsWith(I_CmsConstants.C_FOLDER_SEPARATOR)) {
    Iterator i=m_exclusiveLocks.keySet().iterator();
    String lockedPath=null;
    while (i.hasNext()) {
      lockedPath=(String)i.next();
      if (lockedPath.startsWith(resourcename) && !lockedPath.equals(resourcename)) {
        i.remove();
      }
    }
  }
}
