{
  List<CmsProject> allProjects;
  try {
    String ouFqn="";
    CmsUserSettings settings=new CmsUserSettings(m_context.getCms());
    if (!settings.getListAllProjects()) {
      ouFqn=m_context.getCms().getRequestContext().getCurrentUser().getOuFqn();
    }
    allProjects=new ArrayList<CmsProject>(OpenCms.getOrgUnitManager().getAllAccessibleProjects(m_context.getCms(),ouFqn,settings.getListAllProjects()));
    Iterator<CmsProject> itProjects=allProjects.iterator();
    while (itProjects.hasNext()) {
      CmsProject prj=itProjects.next();
      if (prj.isHiddenFromSelector()) {
        itProjects.remove();
      }
    }
  }
 catch (  CmsException e) {
    if (LOG.isErrorEnabled()) {
      LOG.error(e.getLocalizedMessage(),e);
    }
    allProjects=Collections.emptyList();
  }
  return allProjects;
}
