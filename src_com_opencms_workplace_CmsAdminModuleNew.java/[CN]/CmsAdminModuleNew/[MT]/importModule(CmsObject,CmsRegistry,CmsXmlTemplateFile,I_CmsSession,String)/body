{
  String nav=(String)session.getValue(C_MODULE_NAV);
  Vector conflictFiles=null;
  String moduleName=null;
  boolean importNewModule=true;
  String moduleType=CmsRegistry.C_MODULE_TYPE_TRADITIONAL;
  if (nav == null) {
    Map moduleInfo=reg.importGetModuleInfo(zipName);
    moduleName=(String)moduleInfo.get("name");
    moduleType=(String)moduleInfo.get("type");
    if (reg.moduleExists(moduleName)) {
      if (!CmsRegistry.C_MODULE_TYPE_SIMPLE.equals(moduleType)) {
        xmlDocument.setData("name",moduleName);
        xmlDocument.setData("version","" + reg.getModuleVersion(moduleName));
        session.removeValue(C_MODULE_NAV);
        return C_ERRORREPLACE;
      }
 else {
        session.putValue(C_MODULE_NAME,moduleName);
        importNewModule=false;
      }
    }
    Vector needs=reg.importCheckDependencies(zipName,true);
    if (!needs.isEmpty()) {
      xmlDocument.setData("name",moduleName);
      xmlDocument.setData("version","" + reg.getModuleVersion(moduleName));
      String preconditions="";
      for (int i=0; i < needs.size(); i++) {
        preconditions+="<br><br>" + needs.elementAt(i);
      }
      xmlDocument.setData("precondition",preconditions);
      session.removeValue(C_MODULE_NAV);
      return C_ERRORDEP;
    }
    if (!CmsRegistry.C_MODULE_TYPE_SIMPLE.equals(moduleType)) {
      conflictFiles=reg.importGetConflictingFileNames(zipName);
      if (!conflictFiles.isEmpty()) {
        session.putValue(C_SESSION_MODULE_VECTOR,conflictFiles);
        session.putValue(C_MODULE_NAV,C_FILES);
        session.putValue(C_MODULE_FILENAME,zipName);
        return C_FILES;
      }
    }
 else {
      conflictFiles=new Vector();
    }
  }
 else {
    if (C_FILES.equals(nav)) {
      zipName=(String)session.getValue(C_MODULE_FILENAME);
      moduleName=(String)session.getValue(C_MODULE_NAME);
      if (moduleName != null)       importNewModule=false;
      conflictFiles=(Vector)session.getValue(C_SESSION_MODULE_VECTOR);
      session.removeValue(C_MODULE_NAV);
    }
  }
  if (importNewModule) {
    A_CmsReportThread doTheImport=new CmsAdminModuleImportThread(cms,reg,moduleName,zipName,conflictFiles);
    doTheImport.start();
    session.putValue(C_MODULE_THREAD,doTheImport);
  }
 else {
    A_CmsReportThread doTheReplace=new CmsAdminModuleReplaceThread(cms,reg,moduleName,zipName,conflictFiles);
    doTheReplace.start();
    session.putValue(C_MODULE_THREAD,doTheReplace);
  }
  xmlDocument.setData("time","5");
  return "showresult";
}
