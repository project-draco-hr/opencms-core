{
  if (isFolder && !DIALOG_WAIT.equals(getParamAction())) {
    return false;
  }
  String target=getParamTarget();
  if (target == null) {
    target="";
  }
  boolean restoreSiteRoot=false;
  try {
    String sitePrefix="";
    if (CmsSiteManager.getSiteRoot(target) != null) {
      String siteRootFolder=getCms().getRequestContext().getSiteRoot();
      if (siteRootFolder.endsWith("/")) {
        siteRootFolder=siteRootFolder.substring(0,siteRootFolder.length() - 1);
      }
      sitePrefix=siteRootFolder;
      getCms().getRequestContext().saveSiteRoot();
      getCms().getRequestContext().setSiteRoot("/");
      restoreSiteRoot=true;
    }
    String source=getParamResource();
    target=CmsLinkManager.getAbsoluteUri(target,CmsResource.getParentFolder(getParamResource()));
    if (target.equals(source)) {
      throw new CmsVfsException(Messages.get().container(Messages.ERR_MOVE_ONTO_ITSELF_1,target));
    }
    try {
      CmsResource res=getCms().readResource(target,CmsResourceFilter.ALL);
      if (res.isFolder()) {
        if (!target.endsWith("/")) {
          target+="/";
        }
        target=target + CmsResource.getName(getParamResource());
        if (target.endsWith("/")) {
          target=target.substring(0,target.length() - 1);
        }
      }
    }
 catch (    CmsVfsResourceNotFoundException e) {
      if (LOG.isInfoEnabled()) {
        LOG.info(e.getLocalizedMessage());
      }
    }
    setParamTarget(target);
    CmsResource targetRes=null;
    try {
      targetRes=getCms().readResource(target,CmsResourceFilter.ALL);
    }
 catch (    CmsException e) {
      if (LOG.isInfoEnabled()) {
        LOG.info(e.getLocalizedMessage());
      }
    }
    if (targetRes != null) {
      if (DIALOG_CONFIRMED.equals(getParamAction())) {
        checkLock(target);
        getCms().deleteResource(target,I_CmsConstants.C_DELETE_OPTION_PRESERVE_SIBLINGS);
      }
 else {
        throw new CmsVfsResourceAlreadyExistsException(Messages.get().container(Messages.ERR_MOVE_FAILED_TARGET_EXISTS_2,getParamResource(),getJsp().getRequestContext().removeSiteRoot(target)));
      }
    }
    checkLock(sitePrefix + getParamResource());
    getCms().moveResource(sitePrefix + getParamResource(),target);
  }
  finally {
    if (restoreSiteRoot) {
      getCms().getRequestContext().restoreSiteRoot();
    }
  }
  return true;
}
