{
  if (context.currentProject().isOnlineProject()) {
    CmsMessageContainer errMsg=org.opencms.security.Messages.get().container(org.opencms.security.Messages.ERR_MODIFY_ONLINE_1,context.currentProject().getName());
    throw new CmsSecurityException(errMsg);
  }
  if (context.currentProject().getFlags() != I_CmsConstants.C_PROJECT_STATE_UNLOCKED) {
    CmsMessageContainer errMsg=org.opencms.security.Messages.get().container(org.opencms.security.Messages.ERR_RESOURCE_LOCKED_1,context.currentProject().getName());
    throw new CmsLockException(errMsg);
  }
  if (directPublishResource != null) {
    String parentFolder=CmsResource.getParentFolder(directPublishResource.getRootPath());
    if (parentFolder != null) {
      CmsResource parent=readResource(context,parentFolder,CmsResourceFilter.ALL);
      if (parent.getState() == I_CmsConstants.C_STATE_DELETED) {
        CmsMessageContainer errMsg=Messages.get().container(Messages.ERR_DIRECT_PUBLISH_PARENT_DELETED_2,directPublishResource.getName(),parentFolder);
        throw new CmsSecurityException(errMsg);
      }
      if (parent.getState() == I_CmsConstants.C_STATE_NEW) {
        CmsMessageContainer errMsg=Messages.get().container(Messages.ERR_DIRECT_PUBLISH_PARENT_NEW_2,directPublishResource.getName(),parentFolder);
        throw new CmsSecurityException(errMsg);
      }
    }
    if (PERM_ALLOWED == hasPermissions(context,directPublishResource,CmsPermissionSet.ACCESS_DIRECT_PUBLISH,true,CmsResourceFilter.ALL)) {
      return;
    }
  }
  CmsDbContext dbc=m_dbContextFactory.getDbContext(context);
  try {
    checkManagerOfProjectRole(dbc,context.currentProject());
  }
  finally {
    dbc.clear();
  }
}
