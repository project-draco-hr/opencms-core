{
  List resources=new ArrayList();
  if (recursive) {
    resources=readResourcesWithProperty(context,resource.getRootPath(),propertyDefinition);
  }
 else {
    resources.add(resource);
  }
  Pattern oldPattern;
  try {
    oldPattern=Pattern.compile(oldValue);
  }
 catch (  PatternSyntaxException e) {
    throw new CmsException(e.getMessage());
  }
  List changedResources=new ArrayList(resources.size());
  for (int i=0; i < resources.size(); i++) {
    CmsResource res=(CmsResource)resources.get(i);
    CmsProperty property=readPropertyObject(context,res.getRootPath(),propertyDefinition,false);
    String structureValue=property.getStructureValue();
    String resourceValue=property.getResourceValue();
    boolean changed=false;
    if (structureValue != null && oldPattern.matcher(structureValue).matches()) {
      property.setStructureValue(newValue);
      changed=true;
    }
    if (resourceValue != null && oldPattern.matcher(resourceValue).matches()) {
      property.setResourceValue(newValue);
      changed=true;
    }
    if (changed) {
      writePropertyObject(context,res,property);
      changedResources.add(res);
    }
  }
  return changedResources;
}
