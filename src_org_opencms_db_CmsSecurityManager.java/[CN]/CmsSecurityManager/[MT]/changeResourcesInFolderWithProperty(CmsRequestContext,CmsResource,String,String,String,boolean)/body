{
  List resources=new ArrayList();
  if (recursive) {
    resources=readResourcesWithProperty(context,resource.getRootPath(),propertyDefinition);
  }
 else {
    resources.add(resource);
  }
  Pattern oldPattern;
  try {
    oldPattern=Pattern.compile(oldValue);
  }
 catch (  PatternSyntaxException e) {
    throw new CmsVfsException(Messages.get().container(Messages.ERR_CHANGE_RESOURCES_IN_FOLDER_WITH_PROP_4,new Object[]{propertyDefinition,oldValue,newValue,resource.getName()}),e);
  }
  List changedResources=new ArrayList(resources.size());
  CmsPermissionSet perm=CmsPermissionSet.ACCESS_WRITE;
  CmsResourceFilter filter=CmsResourceFilter.IGNORE_EXPIRATION;
  for (int i=0; i < resources.size(); i++) {
    CmsResource res=(CmsResource)resources.get(i);
    try {
      checkPermissions(context,res,perm,true,filter);
    }
 catch (    Exception e) {
      continue;
    }
    CmsProperty property=readPropertyObject(context,res,propertyDefinition,false);
    String structureValue=property.getStructureValue();
    String resourceValue=property.getResourceValue();
    boolean changed=false;
    if (structureValue != null && oldPattern.matcher(structureValue).matches()) {
      property.setStructureValue(newValue);
      changed=true;
    }
    if (resourceValue != null && oldPattern.matcher(resourceValue).matches()) {
      property.setResourceValue(newValue);
      changed=true;
    }
    if (changed) {
      writePropertyObject(context,res,property);
      changedResources.add(res);
    }
  }
  return changedResources;
}
