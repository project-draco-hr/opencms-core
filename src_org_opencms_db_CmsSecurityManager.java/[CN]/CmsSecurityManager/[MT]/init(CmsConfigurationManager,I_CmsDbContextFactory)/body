{
  Map configuration=configurationManager.getConfiguration();
  ExtendedProperties config;
  if (configuration instanceof ExtendedProperties) {
    config=(ExtendedProperties)configuration;
  }
 else {
    config=new ExtendedProperties();
    config.putAll(configuration);
  }
  try {
    m_keyGenerator=(I_CmsCacheKey)Class.forName(config.getString(I_CmsConstants.C_CONFIGURATION_CACHE + ".keygenerator")).newInstance();
  }
 catch (  Exception e) {
    throw new CmsException("Unable to create security manager classes",CmsException.C_SM_INIT_ERROR,e);
  }
  LRUMap hashMap=new LRUMap(config.getInteger(I_CmsConstants.C_CONFIGURATION_CACHE + ".permissions",1000));
  m_permissionCache=Collections.synchronizedMap(hashMap);
  if (OpenCms.getMemoryMonitor().enabled()) {
    OpenCms.getMemoryMonitor().register(this.getClass().getName() + "." + "m_permissionCache",hashMap);
  }
  m_driverManager=CmsDriverManager.newInstance(configurationManager,this,runtimeInfoFactory);
  if (runtimeInfoFactory == null) {
    String message="Critical error while loading security manager: runtime info factory is null";
    if (OpenCms.getLog(CmsLog.CHANNEL_INIT).isFatalEnabled()) {
      OpenCms.getLog(CmsLog.CHANNEL_INIT).fatal(message);
    }
    throw new CmsException(message,CmsException.C_SM_INIT_ERROR);
  }
 else {
    m_dbContextFactory=runtimeInfoFactory;
  }
  if (OpenCms.getLog(CmsLog.CHANNEL_INIT).isInfoEnabled()) {
    OpenCms.getLog(CmsLog.CHANNEL_INIT).info(". Security manager init: ok - finished");
  }
}
