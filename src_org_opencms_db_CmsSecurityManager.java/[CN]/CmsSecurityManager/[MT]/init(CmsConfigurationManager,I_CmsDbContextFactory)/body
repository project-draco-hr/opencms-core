{
  if (dbContextFactory == null) {
    throw new CmsInitException(org.opencms.main.Messages.get().container(org.opencms.main.Messages.ERR_CRITICAL_NO_DB_CONTEXT_0));
  }
  m_dbContextFactory=dbContextFactory;
  CmsSystemConfiguration systemConfiguation=(CmsSystemConfiguration)configurationManager.getConfiguration(CmsSystemConfiguration.class);
  CmsCacheSettings settings=systemConfiguation.getCacheSettings();
  String className=settings.getCacheKeyGenerator();
  try {
    m_keyGenerator=(I_CmsCacheKey)Class.forName(className).newInstance();
  }
 catch (  Exception e) {
    throw new CmsInitException(org.opencms.main.Messages.get().container(org.opencms.main.Messages.ERR_CRITICAL_CLASS_CREATION_1,className));
  }
  LRUMap hashMap=new LRUMap(settings.getPermissionCacheSize());
  m_permissionCache=Collections.synchronizedMap(hashMap);
  if (OpenCms.getMemoryMonitor().enabled()) {
    OpenCms.getMemoryMonitor().register(this.getClass().getName() + "." + "m_permissionCache",hashMap);
  }
  try {
    m_driverManager=CmsDriverManager.newInstance(configurationManager,this,dbContextFactory);
  }
 catch (  CmsException e) {
    throw new CmsInitException(org.opencms.main.Messages.get().container(org.opencms.main.Messages.ERR_CRITICAL_INIT_DATABASE_0));
  }
  if (OpenCms.getLog(CmsLog.CHANNEL_INIT).isInfoEnabled()) {
    OpenCms.getLog(CmsLog.CHANNEL_INIT).info(". Security manager init: ok - finished");
  }
}
