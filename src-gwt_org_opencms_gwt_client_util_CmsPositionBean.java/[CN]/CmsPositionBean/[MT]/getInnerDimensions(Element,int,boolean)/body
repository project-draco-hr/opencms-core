{
  boolean first=true;
  int top=0;
  int left=0;
  int bottom=0;
  int right=0;
  String parentBackground=CmsDomUtil.getCurrentStyle(panel.getParentElement(),Style.backgroundColor);
  String selfBackground=CmsDomUtil.getCurrentStyle(panel,Style.backgroundColor);
  if (!Overflow.HIDDEN.getCssName().equals(CmsDomUtil.getCurrentStyle(panel,Style.overflow)) && ((parentBackground.equals(selfBackground) || "transparent".equals(selfBackground)))) {
    if (!includeSelf) {
      NodeList<Node> children=panel.getChildNodes();
      for (int i=0; i < children.getLength(); i++) {
        if ((children.getItem(i).getNodeType() == Node.TEXT_NODE) && CmsStringUtil.isNotEmptyOrWhitespaceOnly(children.getItem(i).getNodeValue())) {
          includeSelf=true;
          break;
        }
      }
    }
    if (includeSelf) {
      top=panel.getAbsoluteTop();
      left=panel.getAbsoluteLeft();
      bottom=top + panel.getOffsetHeight();
      right=left + panel.getOffsetWidth();
      first=false;
    }
    Element child=panel.getFirstChildElement();
    while (child != null) {
      String tagName=child.getTagName();
      if (tagName.equalsIgnoreCase("br") || tagName.equalsIgnoreCase("tr") || tagName.equalsIgnoreCase("thead")|| tagName.equalsIgnoreCase("tfoot")|| tagName.equalsIgnoreCase("script")|| tagName.equalsIgnoreCase("style")) {
        child=child.getNextSiblingElement();
        continue;
      }
      String positioning=CmsDomUtil.getCurrentStyle(child,Style.position);
      if (!Display.NONE.getCssName().equals(CmsDomUtil.getCurrentStyle(child,Style.display)) && !(positioning.equalsIgnoreCase(Position.ABSOLUTE.getCssName()) || positioning.equalsIgnoreCase(Position.FIXED.getCssName()))) {
        CmsPositionBean childDimensions=levels > 0 ? getInnerDimensions(child,levels - 1,true) : generatePositionInfo(panel);
        if (first) {
          first=false;
          top=childDimensions.getTop();
          left=childDimensions.getLeft();
          bottom=top + childDimensions.getHeight();
          right=left + childDimensions.getWidth();
        }
 else {
          int wTop=childDimensions.getTop();
          top=top < wTop ? top : wTop;
          int wLeft=childDimensions.getLeft();
          left=left < wLeft ? left : wLeft;
          int wBottom=wTop + childDimensions.getHeight();
          bottom=bottom > wBottom ? bottom : wBottom;
          int wRight=wLeft + childDimensions.getWidth();
          right=right > wRight ? right : wRight;
        }
      }
      child=child.getNextSiblingElement();
    }
  }
  if (!first) {
    CmsPositionBean result=new CmsPositionBean();
    result.setHeight(bottom - top);
    result.setWidth(right - left);
    result.setTop(top);
    result.setLeft(left);
    return result;
  }
 else {
    return generatePositionInfo(panel);
  }
}
