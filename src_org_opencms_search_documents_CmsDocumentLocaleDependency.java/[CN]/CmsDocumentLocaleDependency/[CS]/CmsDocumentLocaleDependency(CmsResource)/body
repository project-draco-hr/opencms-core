{
  m_resource=res;
  m_rootPath=res.getRootPath();
  m_languageVersionLocales=new HashSet<Locale>();
  m_dependencies=new ArrayList<CmsDocumentLocaleDependency>();
  String docName=CmsResource.getName(m_rootPath);
  m_type=DependencyType.simpleAttachment;
  Matcher matcher=DOC_PATTERN_NUMBER.matcher(docName);
  if (matcher.find()) {
    Integer partNumber=new Integer(Integer.parseInt(matcher.group(2)));
    setAttachmentNumber(partNumber);
    int startIndex=matcher.start(1);
    int endIndex=matcher.end(2);
    docName=docName.substring(0,startIndex) + docName.substring(endIndex);
  }
  Locale locale=null;
  matcher=DOC_PATTERN_LOCALE.matcher(docName);
  if (matcher.find()) {
    String suffix=matcher.group(2);
    String langString=suffix.substring(0,2);
    locale=suffix.length() == 5 ? new Locale(langString,suffix.substring(3,5)) : new Locale(langString);
    m_type=isAttachment() ? DependencyType.localizedAttachment : DependencyType.languageVariant;
    int startIndex=matcher.start(1);
    int endIndex=matcher.end(2);
    docName=docName.substring(0,startIndex) + docName.substring(endIndex);
  }
  if ((locale == null) || !OpenCms.getLocaleManager().getDefaultLocales().contains(locale)) {
    locale=CmsLocaleManager.getDefaultLocale();
  }
  setLocale(locale);
  int index=docName.lastIndexOf('.');
  if (index != -1) {
    setDocumentSuffix(docName.substring(index));
    docName=docName.substring(0,index);
  }
  setDocumentName(CmsResource.getFolderPath(m_rootPath) + docName);
}
