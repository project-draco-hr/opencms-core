{
  Map<Integer,CmsDocumentLocaleDependency> attachments=new HashMap<Integer,CmsDocumentLocaleDependency>();
  if (isAttachment()) {
    attachments.put(new Integer(this.getAttachmentNumber()),this);
  }
  Iterator<CmsResource> i=folderContent.iterator();
  while (i.hasNext()) {
    CmsResource r=i.next();
    if (r.isFile() && !getRootPath().equals(r.getRootPath())) {
      CmsDocumentLocaleDependency dep=new CmsDocumentLocaleDependency(r);
      if (getDocumentName().equals(dep.getDocumentName())) {
        if (isAttachment()) {
          if (dep.isAttachment()) {
            if (getAttachmentNumber() == dep.getAttachmentNumber()) {
              addLocaleVersion(dep);
            }
 else {
              Integer attNum=new Integer(dep.getAttachmentNumber());
              CmsDocumentLocaleDependency att=attachments.get(attNum);
              if (att != null) {
                att.addLocaleVersion(dep);
              }
 else {
                attachments.put(attNum,dep);
              }
            }
          }
 else {
            setMainDocument(dep);
          }
        }
 else {
          if (dep.isAttachment()) {
            addAttachment(dep);
          }
 else           if (CmsStringUtil.isEqual(getDocumentSuffix(),dep.getDocumentSuffix())) {
            addLocaleVersion(dep);
          }
        }
      }
    }
  }
  if (m_mainDocument != null) {
    for (    CmsDocumentLocaleDependency att : attachments.values()) {
      m_mainDocument.addAttachment(att);
    }
    addDependency(m_mainDocument);
  }
}
