{
  CmsObject linkCms=cms;
  String subSiteRoot=OpenCms.getADEManager().getSubSiteRoot(cms,resource.getRootPath());
  if (!cms.getRequestContext().getUri().startsWith(subSiteRoot)) {
    try {
      linkCms=OpenCms.initCmsObject(cms);
      CmsSite site=OpenCms.getSiteManager().getSiteForRootPath(subSiteRoot);
      if (site != null) {
        if (site.getSiteRoot() != linkCms.getRequestContext().getSiteRoot()) {
          linkCms.getRequestContext().setSiteRoot(site.getSiteRoot());
        }
      }
      linkCms.getRequestContext().setUri(linkCms.getRequestContext().removeSiteRoot(subSiteRoot));
    }
 catch (    CmsException e) {
    }
  }
  document.addField("link",OpenCms.getLinkManager().substituteLink(linkCms,resource));
  return ClientUtils.toSolrDocument(document);
}
