{
  byte[] bytes=new byte[size];
  int offset=0;
  int numRead=0;
  while (offset < bytes.length && (numRead=in.read(bytes,offset,bytes.length - offset)) >= 0) {
    offset+=numRead;
  }
  in.close();
  if (offset < bytes.length) {
    throw new IOException("Could not read requested " + size + " bytes from input stream");
  }
  return bytes;
}
