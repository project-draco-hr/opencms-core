{
  try {
    URL myURL=new URL(parameter);
    parameter=myURL.getFile();
    String reference=myURL.getRef();
    if (reference != null) {
      parameter+="#" + reference;
    }
  }
 catch (  MalformedURLException e) {
    if (!parameter.startsWith("/")) {
      try {
        URL newUrl=new URL(orgUrl,parameter);
        parameter=newUrl.getFile();
        String reference=newUrl.getRef();
        if (reference != null) {
          parameter+="#" + reference;
        }
      }
 catch (      MalformedURLException exc) {
      }
    }
  }
  if (prefix != null && !"".equals(prefix)) {
    if (parameter.startsWith(prefix)) {
      parameter=parameter.substring(prefix.length());
    }
  }
  if ((relativeRoot != null) && parameter.startsWith(relativeRoot)) {
    String source=orgUrl.getFile();
    if (source.startsWith(prefix))     source=source.substring(prefix.length());
    parameter=OpenCms.getLinkManager().getRelativeUri(source,parameter);
  }
  return parameter;
}
