{
  I_CmsDocumentFactory factory=OpenCms.getSearchManager().getDocumentFactory(res);
  if ((factory == null) || !index.getDocumenttypes(res.getRootPath()).contains(factory.getName())) {
    m_fileCounter++;
    m_returnedCounter++;
    if (m_report != null) {
      m_report.println(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_SKIPPED_0),I_CmsReport.FORMAT_NOTE);
    }
    if (LOG.isDebugEnabled()) {
      LOG.debug(Messages.get().getBundle().key(Messages.LOG_SKIPPED_1,res.getRootPath()));
    }
    return;
  }
  Document cachedDoc;
  if ((m_documentCache != null) && ((cachedDoc=(Document)m_documentCache.get(res.getId().toString().concat(index.getLocale()))) != null)) {
    m_fileCounter++;
    m_returnedCounter++;
    try {
      writer.addDocument(cachedDoc);
      if (m_report != null) {
        m_report.println(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_OK_0),I_CmsReport.FORMAT_OK);
      }
    }
 catch (    IOException e) {
      if (m_report != null) {
        m_report.println();
        m_report.print(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_FAILED_0),I_CmsReport.FORMAT_WARNING);
        m_report.println(e);
      }
      if (LOG.isWarnEnabled()) {
        LOG.warn(Messages.get().getBundle().key(Messages.ERR_INDEX_RESOURCE_FAILED_2,res.getRootPath(),index.getName()),e);
      }
    }
  }
 else {
    CmsIndexingThread thread=new CmsIndexingThread(cms,writer,res,factory,index,m_report,this);
    try {
      m_fileCounter++;
      thread.start();
      thread.join(m_timeout);
      if (thread.isAlive()) {
        if (LOG.isWarnEnabled()) {
          LOG.warn(Messages.get().getBundle().key(Messages.LOG_INDEXING_TIMEOUT_1,res.getRootPath()));
        }
        m_report.println();
        m_report.print(org.opencms.report.Messages.get().container(org.opencms.report.Messages.RPT_FAILED_0),I_CmsReport.FORMAT_WARNING);
        m_report.println(Messages.get().container(Messages.RPT_SEARCH_INDEXING_TIMEOUT_1,res.getRootPath()),I_CmsReport.FORMAT_WARNING);
        m_abandonedCounter++;
        thread.interrupt();
      }
    }
 catch (    InterruptedException exc) {
    }
  }
}
