{
  CmsObject adminCms=OpenCms.initCmsObject(m_adminCms);
  adminCms.getRequestContext().setCurrentProject(cms.getRequestContext().currentProject());
  boolean online=adminCms.getRequestContext().currentProject().isOnlineProject();
  Map<String,String> active=online ? m_activeOnline : m_activeOffline;
  if (active != null) {
    return active;
  }
  long t=System.currentTimeMillis();
  if (online) {
    m_activeOnline=Collections.synchronizedMap(new HashMap<String,String>());
    OpenCms.getMemoryMonitor().register(CmsSitemapCache.class.getName() + ".sitemapActiveOnline",m_activeOnline);
  }
 else {
    m_activeOffline=Collections.synchronizedMap(new HashMap<String,String>());
    OpenCms.getMemoryMonitor().register(CmsSitemapCache.class.getName() + ".sitemapActiveOffline",m_activeOffline);
  }
  active=online ? m_activeOnline : m_activeOffline;
  if (online) {
    m_byIdOnline.clear();
    m_byUriOnline.clear();
  }
 else {
    m_byIdOffline.clear();
    m_byUriOffline.clear();
  }
  List<CmsResource> entryPoints=adminCms.readResourcesWithProperty("/",CmsPropertyDefinition.PROPERTY_ADE_SITEMAP,null,CmsResourceFilter.IGNORE_EXPIRATION.addRequireFolder());
  for (  CmsResource entryPoint : entryPoints) {
    String sitemapPath=adminCms.readPropertyObject(entryPoint,CmsPropertyDefinition.PROPERTY_ADE_SITEMAP,false).getValue();
    CmsFile sitemapFile;
    try {
      sitemapFile=cms.readFile(sitemapPath);
    }
 catch (    CmsVfsResourceNotFoundException e) {
      sitemapPath=OpenCms.getSiteManager().getSiteForRootPath(entryPoint.getRootPath()).getSiteRoot() + sitemapPath;
      sitemapFile=cms.readFile(sitemapPath);
    }
    CmsXmlSitemap xmlSitemap=CmsXmlSitemapFactory.unmarshal(adminCms,sitemapFile);
    for (    Locale locale : xmlSitemap.getLocales()) {
      active.put(locale.toString() + entryPoint.getRootPath(),sitemapFile.getRootPath());
      CmsSitemapBean locSitemap=xmlSitemap.getSitemap(adminCms,locale);
      CmsInternalSitemapEntry startEntry=locSitemap.getSiteEntries().get(0);
      if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(startEntry.getName())) {
        startEntry.removeName();
      }
      Map<String,String> properties=new HashMap<String,String>();
      visitEntry(adminCms,active,startEntry,locale,entryPoint.getRootPath(),true,0,properties,online);
    }
  }
  LOG.debug(Messages.get().getBundle().key(Messages.LOG_DEBUG_CACHE_SITEMAP_2,new Boolean(online),new Long(System.currentTimeMillis() - t)));
  return active;
}
