{
  Vector filesInFolder=null;
  Vector foldersInFolder=null;
  CmsResource startResource=null;
  CmsFile syncFile=null;
  CmsFolder syncFolder=null;
  File startFolder=null;
  File sfsFile=null;
  int onlineProject=I_CmsConstants.C_PROJECT_ONLINE_ID;
  startResource=m_cms.readFileHeader(resourceName);
  if (startResource == null || startResource.getProjectId() == onlineProject) {
    throw new CmsException("[" + this.getClass().getName() + "] "+ resourceName,CmsException.C_NOT_FOUND);
  }
  if (m_cms.readAbsolutePath(startResource).endsWith("/")) {
    startFolder=new File((m_synchronizePath + m_cms.readAbsolutePath(startResource)).replace('/',File.separatorChar));
    startFolder.mkdirs();
    m_vfsFolders.put(m_synchronizePath + m_cms.readAbsolutePath(startResource),startResource);
    filesInFolder=m_cms.getFilesInFolder(resourceName);
    for (int i=0; i < filesInFolder.size(); i++) {
      syncFile=((CmsFile)filesInFolder.elementAt(i));
      if ((syncFile.getProjectId() != onlineProject) && (!syncFile.getName().startsWith("~"))) {
        if (syncFile.getState() == C_STATE_DELETED) {
          sfsFile=new File(m_synchronizePath + m_cms.readAbsolutePath(syncFile));
          if (sfsFile.exists()) {
            sfsFile.delete();
          }
          m_synchronizeList.remove(m_cms.readAbsolutePath(syncFile));
        }
 else {
          syncFile=m_cms.readFile(m_cms.readAbsolutePath(syncFile));
          synchronizeFile(syncFile);
          m_vfsFiles.put(m_synchronizePath + m_cms.readAbsolutePath(syncFile),syncFile);
        }
      }
    }
    foldersInFolder=m_cms.getSubFolders(resourceName);
    for (int i=0; i < foldersInFolder.size(); i++) {
      syncFolder=((CmsFolder)foldersInFolder.elementAt(i));
      if (syncFolder.getProjectId() != onlineProject) {
        if (syncFolder.getState() == C_STATE_DELETED) {
          sfsFile=new File(m_synchronizePath + m_cms.readAbsolutePath(syncFolder));
          if (sfsFile.exists()) {
            if (!deleteDirectory(sfsFile)) {
              throw new CmsException("[" + this.getClass().getName() + "] "+ "Could not delete "+ sfsFile.getPath());
            }
          }
        }
 else {
          sfsFile=new File((m_synchronizePath + m_cms.readAbsolutePath(syncFolder)).replace('/',File.separatorChar));
          sfsFile.mkdir();
          m_vfsFolders.put(m_synchronizePath + m_cms.readAbsolutePath(syncFolder),syncFolder);
          synchronizeServer(m_cms.readAbsolutePath(syncFolder));
        }
      }
    }
  }
 else {
    if ((startResource.getProjectId() != onlineProject) && (!startResource.getName().startsWith("~"))) {
      if (startResource.getState() == C_STATE_DELETED) {
        sfsFile=new File(m_synchronizePath + m_cms.readAbsolutePath(startResource));
        if (sfsFile.exists()) {
          sfsFile.delete();
        }
        m_synchronizeList.remove(m_cms.readAbsolutePath(startResource));
      }
 else {
        syncFile=m_cms.readFile(resourceName);
        synchronizeFile(syncFile);
      }
    }
  }
}
