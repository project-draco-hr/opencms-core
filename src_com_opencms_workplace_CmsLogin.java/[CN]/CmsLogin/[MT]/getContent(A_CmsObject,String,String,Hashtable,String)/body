{
  String result=null;
  String username=null;
  A_CmsUser user;
  String template="template";
  Hashtable preferences=new Hashtable();
  String name=(String)parameters.get("NAME");
  String password=(String)parameters.get("PASSWORD");
  if ((name != null) && (password != null)) {
    try {
      username=cms.loginUser(name,password);
    }
 catch (    CmsException e) {
      if (e.getType() == CmsException.C_NO_ACCESS) {
        username=null;
        template="error";
      }
 else {
        throw e;
      }
    }
    if (username != null) {
      HttpSession session=((HttpServletRequest)cms.getRequestContext().getRequest().getOriginalRequest()).getSession(true);
      if (A_OpenCms.isLogging()) {
        A_OpenCms.log(C_OPENCMS_INFO,"[CmsLogin] Login user " + username);
      }
      user=cms.readUser(username);
      preferences=(Hashtable)user.getAdditionalInfo(C_ADDITIONAL_INFO_PREFERENCES);
      if (preferences == null) {
        preferences=getDefaultPreferences();
      }
      session.putValue(C_ADDITIONAL_INFO_PREFERENCES,preferences);
    }
  }
  CmsXmlWpTemplateFile xmlTemplateDocument=new CmsXmlWpTemplateFile(cms,templateFile);
  if (username == null) {
    xmlTemplateDocument.clearStartup();
  }
  return startProcessing(cms,xmlTemplateDocument,"",parameters,template);
}
