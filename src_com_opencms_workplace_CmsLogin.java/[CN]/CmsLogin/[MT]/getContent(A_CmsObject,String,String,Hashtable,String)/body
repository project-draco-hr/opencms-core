{
  String result=null;
  String user=null;
  String name=(String)parameters.get("NAME");
  String password=(String)parameters.get("PASSWORD");
  if ((name != null) && (password != null)) {
    try {
      user=cms.loginUser(name,password);
    }
 catch (    CmsException e) {
      if (e.getType() == CmsException.C_NO_ACCESS) {
        user=null;
      }
 else {
        throw e;
      }
    }
    if (user != null) {
      HttpSession session=((HttpServletRequest)cms.getRequestContext().getRequest().getOriginalRequest()).getSession(true);
      if (A_OpenCms.isLogging()) {
        A_OpenCms.log(C_OPENCMS_INFO,"[CmsLogin] Login user " + user);
      }
    }
  }
  CmsXmlWpTemplateFile xmlTemplateDocument=new CmsXmlWpTemplateFile();
  String fullFileName=CmsXmlWpTemplateFile.lookupAbsoluteFilename(cms,templateFile,xmlTemplateDocument);
  CmsFile file=cms.readFile(fullFileName);
  xmlTemplateDocument.init(cms,file);
  try {
    result=xmlTemplateDocument.getProcessedTemplateContent(this,parameters);
  }
 catch (  Throwable e) {
    xmlTemplateDocument.clearFileCache(xmlTemplateDocument);
    if (isCacheable(cms,templateFile,parameters)) {
      m_cache.clearCache(getKey(cms,templateFile,parameters));
    }
    if (e instanceof CmsException) {
      throw (CmsException)e;
    }
 else {
      String errorMessage="Exception while getting content for (sub)template " + elementName + ". "+ e;
      if (A_OpenCms.isLogging()) {
        A_OpenCms.log(C_OPENCMS_CRITICAL,"[CmsXmlTemplate] " + errorMessage);
      }
      throw new CmsException(errorMessage);
    }
  }
  return result.getBytes();
}
