{
  CmsResource importedResource=null;
  CmsResource existingResource=null;
  try {
    importedResource=driverManager.importResource(cms.getRequestContext(),cms.getRequestContext().addSiteRoot(resourcename),resource,content,properties);
    cms.lockResource(resourcename);
  }
 catch (  CmsException e) {
    if (e.getType() == CmsException.C_FILE_EXISTS) {
      existingResource=cms.readFileHeader(resourcename);
      if (OpenCms.getImportExportManager().overwriteCollidingResources() || existingResource.getResourceId().equals(resource.getResourceId())) {
        cms.lockResource(resourcename);
        driverManager.importResourceUpdate(cms.getRequestContext(),cms.getRequestContext().addSiteRoot(resourcename),content,properties);
        importedResource=cms.readFileHeader(resourcename);
        cms.touch(resourcename,resource.getDateLastModified(),I_CmsConstants.C_DATE_UNCHANGED,I_CmsConstants.C_DATE_UNCHANGED,resource.getUserLastModified(),false);
      }
 else {
        String newResourcename=moveToLostAndFound(cms,driverManager,resourcename,false);
        CmsResource newResource=new CmsResource(resource.getStructureId(),resource.getResourceId(),resource.getParentStructureId(),resource.getFileId(),CmsResource.getName(newResourcename),resource.getTypeId(),resource.getFlags(),resource.getProjectLastModified(),resource.getState(),resource.getLoaderId(),resource.getDateLastModified(),resource.getUserLastModified(),resource.getDateCreated(),resource.getUserCreated(),resource.getDateReleased(),resource.getDateExpired(),1,resource.getLength());
        importedResource=driverManager.importResource(cms.getRequestContext(),cms.getRequestContext().addSiteRoot(newResourcename),newResource,content,properties);
      }
    }
  }
  return importedResource;
}
