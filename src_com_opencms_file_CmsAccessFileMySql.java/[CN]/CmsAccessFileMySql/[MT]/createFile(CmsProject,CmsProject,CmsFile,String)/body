{
  Connection con=null;
  int state=0;
  if (project.equals(onlineProject)) {
    state=file.getState();
  }
 else {
    state=C_STATE_NEW;
  }
  try {
    readFileHeader(project,filename);
  }
 catch (  CmsException e) {
    if (e.getType() == CmsException.C_RESOURCE_DELETED) {
      removeFile(project,filename);
      state=C_STATE_CHANGED;
    }
  }
  try {
    con=getConnection();
    PreparedStatement statementResourceWrite=con.prepareStatement(C_RESOURCE_WRITE);
    statementResourceWrite.setString(1,absoluteName(filename));
    statementResourceWrite.setInt(2,file.getType());
    statementResourceWrite.setInt(3,file.getFlags());
    statementResourceWrite.setInt(4,file.getOwnerId());
    statementResourceWrite.setInt(5,file.getGroupId());
    statementResourceWrite.setInt(6,project.getId());
    statementResourceWrite.setInt(7,file.getAccessFlags());
    statementResourceWrite.setInt(8,state);
    statementResourceWrite.setInt(9,file.isLockedBy());
    statementResourceWrite.setInt(10,file.getLauncherType());
    statementResourceWrite.setString(11,file.getLauncherClassname());
    statementResourceWrite.setTimestamp(12,new Timestamp(file.getDateCreated()));
    statementResourceWrite.setTimestamp(13,new Timestamp(System.currentTimeMillis()));
    statementResourceWrite.setInt(14,file.getContents().length);
    statementResourceWrite.executeUpdate();
    putConnection(con);
    con=getConnection();
    PreparedStatement statementFileWrite=con.prepareStatement(C_FILE_WRITE);
    statementFileWrite.setString(1,absoluteName(filename));
    statementFileWrite.setInt(2,project.getId());
    statementFileWrite.setBytes(3,file.getContents());
    statementFileWrite.executeUpdate();
    putConnection(con);
  }
 catch (  SQLException e) {
    putConnection(con);
    throw new CmsException("[" + this.getClass().getName() + "] "+ e.getMessage(),CmsException.C_SQL_ERROR,e);
  }
  return readFile(project,onlineProject,filename);
}
