{
  ResultSet res;
  byte[] content;
  try {
    if (file.getState() != C_STATE_CHANGED) {
synchronized (m_statementFileRead) {
        m_statementFileRead.setString(1,absoluteName(file.getAbsolutePath()));
        m_statementFileRead.setInt(2,onlineProject.getId());
        res=m_statementFileRead.executeQuery();
        if (res.next()) {
          content=res.getBytes(C_FILE_CONTENT);
        }
 else {
          throw new CmsException(CmsException.C_NOT_FOUND);
        }
      }
synchronized (m_statementFileWrite) {
        m_statementFileWrite.setString(1,absoluteName(file.getAbsolutePath()));
        m_statementFileWrite.setInt(2,project.getId());
        m_statementFileWrite.setBytes(3,content);
        m_statementFileWrite.executeUpdate();
      }
    }
synchronized (m_statementResourceUpdate) {
      m_statementResourceUpdate.setInt(1,file.getType());
      m_statementResourceUpdate.setInt(2,file.getFlags());
      m_statementResourceUpdate.setInt(3,file.getOwnerId());
      m_statementResourceUpdate.setInt(4,file.getGroupId());
      m_statementResourceUpdate.setInt(5,file.getAccessFlags());
      m_statementResourceUpdate.setInt(6,C_STATE_CHANGED);
      m_statementResourceUpdate.setInt(7,file.isLockedBy());
      m_statementResourceUpdate.setInt(8,file.getLauncherType());
      m_statementResourceUpdate.setString(9,file.getLauncherClassname());
      m_statementResourceUpdate.setLong(10,System.currentTimeMillis());
      m_statementResourceUpdate.setInt(11,file.getContents().length);
      m_statementResourceUpdate.setString(12,absoluteName(file.getAbsolutePath()));
      m_statementResourceUpdate.setInt(13,file.getProjectId());
      m_statementResourceUpdate.executeUpdate();
    }
  }
 catch (  SQLException e) {
    throw new CmsException(e.getMessage(),CmsException.C_SQL_ERROR,e);
  }
}
