{
  CmsXmlWpTemplateFile xmlTemplateDocument=new CmsXmlWpTemplateFile(cms,templateFile);
  if (parameters.get("message") != null) {
    cms.sendBroadcastMessage((String)parameters.get("message"));
  }
  Vector users=cms.getLoggedInUsers();
  Hashtable user;
  StringBuffer ret=new StringBuffer();
  for (int i=0; i < users.size(); i++) {
    try {
      user=(Hashtable)users.get(i);
      CmsUser cmsUser=cms.readUser((String)user.get(I_CmsConstants.C_SESSION_USERNAME));
      CmsProject cmsProject=cms.readProject(((Integer)user.get(I_CmsConstants.C_SESSION_PROJECT)).intValue());
      xmlTemplateDocument.setData("username",cmsUser.getName());
      xmlTemplateDocument.setData("firstname",cmsUser.getFirstname() + "");
      xmlTemplateDocument.setData("lastname",cmsUser.getLastname() + "");
      xmlTemplateDocument.setData("email",cmsUser.getEmail() + "");
      xmlTemplateDocument.setData("currentgroup",(String)user.get(I_CmsConstants.C_SESSION_CURRENTGROUP));
      xmlTemplateDocument.setData("messagepending",((Boolean)user.get(I_CmsConstants.C_SESSION_MESSAGEPENDING)).toString());
      xmlTemplateDocument.setData("currentproject",cmsProject.getName());
      ret.append(xmlTemplateDocument.getProcessedDataValue("line"));
    }
 catch (    Exception exc) {
    }
  }
  xmlTemplateDocument.setData("all_lines",ret.toString());
  return startProcessing(cms,xmlTemplateDocument,elementName,parameters,templateSelector);
}
