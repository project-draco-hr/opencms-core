{
  CmsXmlWpTemplateFile xmlTemplateDocument=new CmsXmlWpTemplateFile(cms,templateFile);
  if (parameters.get("message") != null) {
    OpenCms.getSessionInfoManager().sendBroadcastMessage(cms,(String)parameters.get("message"));
  }
  List users=OpenCms.getSessionInfoManager().getLoggedInUsers(cms);
  Map userData;
  StringBuffer ret=new StringBuffer();
  for (int i=0; i < users.size(); i++) {
    try {
      userData=(Map)users.get(i);
      CmsUser cmsUser=cms.readUser((String)userData.get(I_CmsConstants.C_SESSION_USERNAME));
      CmsProject cmsProject=cms.readProject(((Integer)userData.get(I_CmsConstants.C_SESSION_PROJECT)).intValue());
      xmlTemplateDocument.setData("username",cmsUser.getName());
      xmlTemplateDocument.setData("firstname",cmsUser.getFirstname() + "");
      xmlTemplateDocument.setData("lastname",cmsUser.getLastname() + "");
      xmlTemplateDocument.setData("email",cmsUser.getEmail() + "");
      xmlTemplateDocument.setData("currentgroup",(String)userData.get(I_CmsConstants.C_SESSION_CURRENTGROUP));
      xmlTemplateDocument.setData("messagepending",((Boolean)userData.get(I_CmsConstants.C_SESSION_MESSAGEPENDING)).toString());
      xmlTemplateDocument.setData("currentproject",cmsProject.getName());
      ret.append(xmlTemplateDocument.getProcessedDataValue("line"));
    }
 catch (    Exception exc) {
    }
  }
  xmlTemplateDocument.setData("all_lines",ret.toString());
  return startProcessing(cms,xmlTemplateDocument,elementName,parameters,templateSelector);
}
