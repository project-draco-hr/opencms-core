{
  if (C_DEBUG && A_OpenCms.isLogging()) {
    A_OpenCms.log(C_OPENCMS_DEBUG,"[CmsClassLoader] Class " + name + " requested.");
  }
  Class c=null;
  CmsFile classFile=null;
  try {
    c=Class.forName(name);
  }
 catch (  ClassNotFoundException e) {
    c=null;
  }
  if (c != null) {
    return c;
  }
  c=(Class)cache.get(name);
  if (c != null) {
    if (A_OpenCms.isLogging()) {
      A_OpenCms.log(C_OPENCMS_DEBUG,"BINGO! Class " + name + "was found in cache.");
    }
    if (resolve) {
      resolveClass(c);
    }
    return c;
  }
  if (A_OpenCms.isLogging()) {
    A_OpenCms.log(C_OPENCMS_DEBUG,"Class " + name + "was NOT found in cache.");
  }
  Enumeration allRepositories=repository.elements();
  String filename=null;
  byte[] myClassData=null;
  while ((allRepositories.hasMoreElements()) && (classFile == null)) {
    filename=(String)allRepositories.nextElement();
    if (isZipOrJarArchive(filename)) {
      try {
        if (A_OpenCms.isLogging()) {
          A_OpenCms.log(C_OPENCMS_DEBUG,"Try to load archive file " + filename + ".");
        }
        myClassData=loadClassFromZipFile(m_cms.readFile(filename),name);
      }
 catch (      Exception e) {
        myClassData=null;
      }
    }
 else {
      if (filename.endsWith("/")) {
        String classname=name.replace('.','/');
        filename=filename + classname + ".class";
      }
      try {
        classFile=m_cms.readFile(filename);
        myClassData=classFile.getContents();
      }
 catch (      Exception e) {
        classFile=null;
        myClassData=null;
      }
    }
  }
  if (classFile == null) {
    throw new ClassNotFoundException(name);
  }
  if (myClassData != null) {
    try {
      c=defineClass(null,myClassData,0,myClassData.length);
    }
 catch (    ClassFormatError e) {
      throw new ClassNotFoundException(filename + " seems to be no class file. Sorry.");
    }
catch (    Exception e) {
      throw new ClassNotFoundException(e.toString());
    }
catch (    Error e) {
      throw new ClassNotFoundException("Something really bad happened while loading class " + filename);
    }
    cache.put(name,c);
    if (resolve) {
      resolveClass(c);
    }
    if (A_OpenCms.isLogging()) {
      A_OpenCms.log(C_OPENCMS_DEBUG,"Classloader returned class " + name + " successfully!");
    }
    return c;
  }
  throw new ClassNotFoundException(name);
}
