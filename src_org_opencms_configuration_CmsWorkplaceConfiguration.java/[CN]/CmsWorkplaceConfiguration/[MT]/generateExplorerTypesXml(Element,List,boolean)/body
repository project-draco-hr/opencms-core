{
  CmsExplorerTypeAccess defaultAccess=null;
  if (OpenCms.getWorkplaceManager() != null) {
    defaultAccess=OpenCms.getWorkplaceManager().getDefaultAccess();
  }
  CmsMenuRuleTranslator menuRuleTranslator=new CmsMenuRuleTranslator();
  Iterator i=explorerTypes.iterator();
  while (i.hasNext()) {
    CmsExplorerTypeSettings settings=(CmsExplorerTypeSettings)i.next();
    if (settings.isAddititionalModuleExplorerType() == module) {
      Element explorerTypeElement=startNode.addElement(N_EXPLORERTYPE);
      explorerTypeElement.addAttribute(A_NAME,CmsEncoder.escapeXml(settings.getName()));
      explorerTypeElement.addAttribute(A_KEY,CmsEncoder.escapeXml(settings.getKey()));
      explorerTypeElement.addAttribute(A_ICON,CmsEncoder.escapeXml(settings.getIcon()));
      if (settings.getReference() != null) {
        explorerTypeElement.addAttribute(A_REFERENCE,CmsEncoder.escapeXml(settings.getReference()));
      }
      Element newResElement=explorerTypeElement.addElement(N_NEWRESOURCE);
      if (CmsStringUtil.isNotEmpty(settings.getNewResourcePage())) {
        newResElement.addAttribute(A_PAGE,CmsEncoder.escapeXml(settings.getNewResourcePage()));
      }
      newResElement.addAttribute(A_HANDLER,CmsEncoder.escapeXml(settings.getNewResourceHandlerClassName()));
      newResElement.addAttribute(A_URI,CmsEncoder.escapeXml(settings.getNewResourceUri()));
      newResElement.addAttribute(A_ORDER,settings.getNewResourceOrder());
      newResElement.addAttribute(A_AUTOSETNAVIGATION,String.valueOf(settings.isAutoSetNavigation()));
      newResElement.addAttribute(A_AUTOSETTITLE,String.valueOf(settings.isAutoSetTitle()));
      newResElement.addAttribute(A_INFO,CmsEncoder.escapeXml(settings.getInfo()));
      newResElement.addAttribute(A_ICON,CmsEncoder.escapeXml(settings.getDescriptionImage()));
      newResElement.addAttribute(A_KEY,CmsEncoder.escapeXml(settings.getTitleKey()));
      CmsExplorerTypeAccess access=settings.getAccess();
      if (access != defaultAccess) {
        List accessEntries=new ArrayList(access.getAccessEntries().keySet());
        Collections.sort(accessEntries);
        if (accessEntries.size() > 0) {
          Element accessControlElement=explorerTypeElement.addElement(N_ACCESSCONTROL);
          Iterator k=accessEntries.iterator();
          while (k.hasNext()) {
            String key=(String)k.next();
            String value=(String)settings.getAccess().getAccessEntries().get(key);
            Element accessEntryElement=accessControlElement.addElement(N_ACCESSENTRY);
            accessEntryElement.addAttribute(A_PRINCIPAL,CmsEncoder.escapeXml(key));
            accessEntryElement.addAttribute(A_PERMISSIONS,CmsEncoder.escapeXml(value));
          }
        }
      }
      if (settings.hasEditOptions()) {
        Element editOptionsElement=explorerTypeElement.addElement(N_EDITOPTIONS);
        Element defaultPropertiesElement=editOptionsElement.addElement(N_DEFAULTPROPERTIES);
        defaultPropertiesElement.addAttribute(A_ENABLED,String.valueOf(settings.isPropertiesEnabled()));
        defaultPropertiesElement.addAttribute(A_SHOWNAVIGATION,String.valueOf(settings.isShowNavigation()));
        Iterator m=settings.getProperties().iterator();
        while (m.hasNext()) {
          defaultPropertiesElement.addElement(N_DEFAULTPROPERTY).addAttribute(A_NAME,CmsEncoder.escapeXml((String)m.next()));
        }
        Element contextMenuElement=editOptionsElement.addElement(N_CONTEXTMENU);
        m=settings.getContextMenuEntries().iterator();
        while (m.hasNext()) {
          CmsExplorerContextMenuItem item=(CmsExplorerContextMenuItem)m.next();
          generateContextMenuItemXml(contextMenuElement,menuRuleTranslator,item);
        }
      }
    }
  }
}
