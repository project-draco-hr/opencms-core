{
  Element workplaceElement=parent.addElement(N_WORKPLACE);
  Iterator i;
  workplaceElement.addElement(N_DEFAULTLOCALE).setText(m_workplaceManager.getDefaultLocale().toString());
  Element localizedElement=workplaceElement.addElement(N_LOCALIZEDFOLDERS);
  Iterator localizedIterator=m_workplaceManager.getLocalizedFolders().iterator();
  while (localizedIterator.hasNext()) {
    localizedElement.addElement(N_RESOURCE).addAttribute(A_URI,(String)localizedIterator.next());
  }
  Element dialogElement=workplaceElement.addElement(N_DIALOGHANDLERS);
  Map dialogs=m_workplaceManager.getDialogHandler();
  String[] keys=(String[])dialogs.keySet().toArray(new String[0]);
  Arrays.sort(keys);
  for (int j=0; j < keys.length; j++) {
    String name=keys[j];
    dialogElement.addElement(N_DIALOGHANDLER).addAttribute(A_CLASS,dialogs.get(name).getClass().getName());
  }
  workplaceElement.addElement(N_EDITORHANDLER).addAttribute(A_CLASS,m_workplaceManager.getEditorHandler().getClass().getName());
  workplaceElement.addElement(N_EDITORACTION).addAttribute(A_CLASS,m_workplaceManager.getEditorActionHandler().getClass().getName());
  if (m_workplaceManager.getEditorCssHandlers().size() > 0) {
    Element editorCssHandlers=workplaceElement.addElement(N_EDITORCSSHANDLERS);
    Iterator it=m_workplaceManager.getEditorCssHandlers().iterator();
    while (it.hasNext()) {
      I_CmsEditorCssHandler current=(I_CmsEditorCssHandler)it.next();
      Element handler=editorCssHandlers.addElement(N_EDITORCSSHANDLER);
      handler.addAttribute(A_CLASS,current.getClass().getName());
    }
  }
  if (m_workplaceManager.getPreEditorConditionDefinitions().size() > 0) {
    Element editorPreActions=workplaceElement.addElement(N_EDITORPRECONDITIONS);
    Iterator it=m_workplaceManager.getPreEditorConditionDefinitions().iterator();
    while (it.hasNext()) {
      I_CmsPreEditorActionDefinition current=(I_CmsPreEditorActionDefinition)it.next();
      Element action=editorPreActions.addElement(N_EDITORPRECONDITION);
      action.addAttribute(A_NAME,current.getResourceTypeName());
      action.addAttribute(A_CLASS,current.getClass().getName());
    }
  }
  I_CmsConfigurationParameterHandler deProvider=m_workplaceManager.getDirectEditProvider();
  Element deProviderNode=workplaceElement.addElement(N_DIRECTEDITPROVIDER).addAttribute(A_CLASS,deProvider.getClass().getName());
  Map deProviderConfig=deProvider.getConfiguration();
  if (deProviderConfig != null) {
    Iterator it=deProviderConfig.entrySet().iterator();
    while (it.hasNext()) {
      Map.Entry entry=(Map.Entry)it.next();
      String name=(String)entry.getKey();
      String value=(String)entry.getValue();
      Element paramNode=deProviderNode.addElement(N_PARAM);
      paramNode.addAttribute(A_NAME,name);
      paramNode.addText(value);
    }
  }
  Element resourceloadersElement=workplaceElement.addElement(N_EXPORTPOINTS);
  Set points=m_workplaceManager.getExportPoints();
  i=points.iterator();
  while (i.hasNext()) {
    CmsExportPoint point=(CmsExportPoint)i.next();
    resourceloadersElement.addElement(N_EXPORTPOINT).addAttribute(A_URI,point.getUri()).addAttribute(A_DESTINATION,point.getConfiguredDestination());
  }
  workplaceElement.addElement(N_AUTOLOCK).setText(String.valueOf(m_workplaceManager.autoLockResources()));
  workplaceElement.addElement(N_XMLCONTENTAUTOCORRECTION).setText(String.valueOf(m_workplaceManager.isXmlContentAutoCorrect()));
  workplaceElement.addElement(N_ENABLEUSERMGMT).setText(String.valueOf(m_workplaceManager.showUserGroupIcon()));
  workplaceElement.addElement(N_DEFAULTPROPERTIESONSTRUCTURE).setText(String.valueOf(m_workplaceManager.isDefaultPropertiesOnStructure()));
  workplaceElement.addElement(N_ENABLEADVANCEDPROPERTYTABS).setText(String.valueOf(m_workplaceManager.isEnableAdvancedPropertyTabs()));
  workplaceElement.addElement(N_MAXUPLOADSIZE).setText(String.valueOf(m_workplaceManager.getFileMaxUploadSize()));
  Element labeledElement=workplaceElement.addElement(N_LABELEDFOLDERS);
  i=m_workplaceManager.getLabelSiteFolders().iterator();
  while (i.hasNext()) {
    labeledElement.addElement(N_RESOURCE).addAttribute(A_URI,(String)i.next());
  }
  CmsRfsFileViewer viewSettings=m_workplaceManager.getFileViewSettings();
  Element fileViewElement=workplaceElement.addElement(N_RFSFILEVIEWESETTINGS);
  String rootPath=viewSettings.getRootPath();
  if (rootPath != null) {
    fileViewElement.addElement(N_ROOTPATH).setText(rootPath);
  }
  String filePath=viewSettings.getFilePath();
  if (filePath != null) {
    fileViewElement.addElement(N_FILEPATH).setText(filePath);
  }
  fileViewElement.addElement(N_ENABLED).setText(String.valueOf(viewSettings.isEnabled()));
  fileViewElement.addElement(N_FILEENCODING).setText(viewSettings.getFileEncoding());
  fileViewElement.addElement(N_ISLOGFILE).setText(String.valueOf(viewSettings.getIsLogfile()));
  fileViewElement.addElement(N_WINDOWSIZE).setText(String.valueOf(viewSettings.getWindowSize()));
  Element explorerTypesElement=workplaceElement.addElement(N_EXPLORERTYPES);
  List explorerTypes=m_workplaceManager.getExplorerTypeSettings();
  generateExplorerTypesXml(explorerTypesElement,explorerTypes,false);
  Element defaultAccessControlElement=explorerTypesElement.addElement(N_DEFAULTACCESSCONTROL);
  List accessEntries=new ArrayList();
  CmsExplorerTypeAccess access=m_workplaceManager.getDefaultAccess();
  Iterator iter=access.getAccessEntries().keySet().iterator();
  while (iter.hasNext()) {
    accessEntries.add(iter.next());
  }
  Collections.sort(accessEntries);
  if (accessEntries.size() > 0) {
    Element accessControlElement=defaultAccessControlElement.addElement(N_ACCESSCONTROL);
    Iterator k=accessEntries.iterator();
    while (k.hasNext()) {
      String key=(String)k.next();
      String value=(String)m_workplaceManager.getDefaultAccess().getAccessEntries().get(key);
      Element accessEntryElement=accessControlElement.addElement(N_ACCESSENTRY);
      accessEntryElement.addAttribute(A_PRINCIPAL,key);
      accessEntryElement.addAttribute(A_PERMISSIONS,value);
    }
  }
  i=m_workplaceManager.getMultiContextMenu().getAllEntries().iterator();
  if (i.hasNext()) {
    Element contextMenuElement=explorerTypesElement.addElement(N_MULTICONTEXTMENU);
    CmsMenuRuleTranslator menuRuleTranslator=new CmsMenuRuleTranslator();
    while (i.hasNext()) {
      CmsExplorerContextMenuItem item=(CmsExplorerContextMenuItem)i.next();
      generateContextMenuItemXml(contextMenuElement,menuRuleTranslator,item);
    }
  }
  if (m_workplaceManager.getMenuRules().size() > 0) {
    Element rulesElement=explorerTypesElement.addElement(N_MENURULES);
    i=m_workplaceManager.getMenuRules().iterator();
    while (i.hasNext()) {
      CmsMenuRule rule=(CmsMenuRule)i.next();
      Element ruleElement=rulesElement.addElement(N_MENURULE);
      ruleElement.addAttribute(A_NAME,rule.getName());
      Iterator it=rule.getMenuItemRules().iterator();
      while (it.hasNext()) {
        I_CmsMenuItemRule itemRule=(I_CmsMenuItemRule)it.next();
        Element itemRuleElement=ruleElement.addElement(N_MENUITEMRULE);
        itemRuleElement.addAttribute(A_CLASS,itemRule.getClass().getName());
      }
    }
  }
  if (m_workplaceManager.getUserInfoManager() != null) {
    Element userInfosElement=workplaceElement.addElement(N_USERINFOS);
    i=m_workplaceManager.getUserInfoManager().getBlocks().iterator();
    while (i.hasNext()) {
      CmsWorkplaceUserInfoBlock block=(CmsWorkplaceUserInfoBlock)i.next();
      Element infoBlockElement=userInfosElement.addElement(N_INFOBLOCK);
      infoBlockElement.addAttribute(A_NAME,block.getTitle());
      Iterator itEntries=block.getEntries().iterator();
      while (itEntries.hasNext()) {
        CmsWorkplaceUserInfoEntry entry=(CmsWorkplaceUserInfoEntry)itEntries.next();
        Element userInfoElement=infoBlockElement.addElement(N_USERINFO);
        userInfoElement.addAttribute(A_KEY,entry.getKey());
        if (entry.getType() != null) {
          userInfoElement.addAttribute(A_TYPE,entry.getType());
        }
        if (entry.getWidget() != null) {
          userInfoElement.addAttribute(A_WIDGET,entry.getWidget());
        }
        if (entry.getParams() != null) {
          userInfoElement.addAttribute(A_PARAMS,entry.getParams());
        }
        if (entry.getOptional() != null) {
          userInfoElement.addAttribute(A_OPTIONAL,entry.getOptional());
        }
      }
    }
  }
  Element defaultPreferences=workplaceElement.addElement(N_DEFAULTPREFERENCES);
  Element workplacePreferences=defaultPreferences.addElement(N_WORKPLACEPREFERENCES);
  Element workplaceGeneraloptions=workplacePreferences.addElement(N_WORKPLACEGENERALOPTIONS);
  workplaceGeneraloptions.addElement(N_BUTTONSTYLE).setText(m_workplaceManager.getDefaultUserSettings().getWorkplaceButtonStyleString());
  workplaceGeneraloptions.addElement(N_REPORTTYPE).setText(m_workplaceManager.getDefaultUserSettings().getWorkplaceReportType());
  workplaceGeneraloptions.addElement(N_UPLOADAPPLET).setText(m_workplaceManager.getDefaultUserSettings().getUploadAppletString());
  if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(m_workplaceManager.getDefaultUserSettings().getPublishButtonAppearance())) {
    workplaceGeneraloptions.addElement(N_PUBLISHBUTTONAPPEARANCE).setText(m_workplaceManager.getDefaultUserSettings().getPublishButtonAppearance());
  }
  workplaceGeneraloptions.addElement(N_PUBLISHNOTIFICATION).setText(m_workplaceManager.getDefaultUserSettings().getShowPublishNotificationString());
  workplaceGeneraloptions.addElement(N_SHOWFILEUPLOADBUTTON).setText(m_workplaceManager.getDefaultUserSettings().getShowFileUploadButtonString());
  workplaceGeneraloptions.addElement(N_ALLOWBROKENRELATIONS).setText(String.valueOf(m_workplaceManager.getDefaultUserSettings().isAllowBrokenRelations()));
  if (m_workplaceManager.getDefaultUserSettings().getPublishRelatedResources() != null) {
    workplaceGeneraloptions.addElement(N_PUBLISHRELATEDRESOURCES).setText(m_workplaceManager.getDefaultUserSettings().getPublishRelatedResources().toString());
  }
  workplaceGeneraloptions.addElement(N_NEWFOLDEREDITPROPERTIES).setText(m_workplaceManager.getDefaultUserSettings().getNewFolderEditProperties().toString());
  workplaceGeneraloptions.addElement(N_NEWFOLDERCREATEINDEXPAGE).setText(m_workplaceManager.getDefaultUserSettings().getNewFolderCreateIndexPage().toString());
  workplaceGeneraloptions.addElement(N_SHOWUPLOADTYPEDIALOG).setText(m_workplaceManager.getDefaultUserSettings().getShowUploadTypeDialog().toString());
  Element workplaceStartupsettings=workplacePreferences.addElement(N_WORKPLACESTARTUPSETTINGS);
  workplaceStartupsettings.addElement(N_LOCALE).setText(m_workplaceManager.getDefaultUserSettings().getLocale().toString());
  workplaceStartupsettings.addElement(N_PROJECT).setText(m_workplaceManager.getDefaultUserSettings().getStartProject());
  workplaceStartupsettings.addElement(N_WORKPLACEVIEW).setText(m_workplaceManager.getDefaultUserSettings().getStartView());
  workplaceStartupsettings.addElement(N_FOLDER).setText(m_workplaceManager.getDefaultUserSettings().getStartFolder());
  workplaceStartupsettings.addElement(N_SITE).setText(m_workplaceManager.getDefaultUserSettings().getStartSite());
  workplaceStartupsettings.addElement(N_RESTRICTEXPLORERVIEW).setText(m_workplaceManager.getDefaultUserSettings().getRestrictExplorerViewString());
  Element workplaceSearch=workplacePreferences.addElement(N_WORKPLACESEARCH);
  workplaceSearch.addElement(N_SEARCHINDEXNAME).setText(m_workplaceManager.getDefaultUserSettings().getWorkplaceSearchIndexName());
  workplaceSearch.addElement(N_SEARCHVIEWSTYLE).setText(m_workplaceManager.getDefaultUserSettings().getWorkplaceSearchViewStyle().toString());
  Element explorerPreferences=defaultPreferences.addElement(N_EXPLORERPREFERENCES);
  Element explorerGeneraloptions=explorerPreferences.addElement(N_EXPLORERGENERALOPTIONS);
  explorerGeneraloptions.addElement(N_BUTTONSTYLE).setText(m_workplaceManager.getDefaultUserSettings().getExplorerButtonStyleString());
  explorerGeneraloptions.addElement(N_ENTRIES).setText("" + m_workplaceManager.getDefaultUserSettings().getExplorerFileEntries());
  if (!CmsStringUtil.isEmptyOrWhitespaceOnly(m_workplaceManager.getDefaultUserSettings().getExporerFileEntryOptions())) {
    explorerGeneraloptions.addElement(N_ENTRYOPTIONS).setText(m_workplaceManager.getDefaultUserSettings().getExporerFileEntryOptions());
  }
  Element explorerDisplayoptions=explorerPreferences.addElement(N_EXPLORERDISPLAYOPTIONS);
  explorerDisplayoptions.addElement(N_TITLE).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFileTitle());
  explorerDisplayoptions.addElement(N_NAVTEXT).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFileNavText());
  explorerDisplayoptions.addElement(N_TYPE).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFileType());
  explorerDisplayoptions.addElement(N_DATELASTMODIFIED).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFileDateLastModified());
  explorerDisplayoptions.addElement(N_DATECREATED).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFileDateCreated());
  explorerDisplayoptions.addElement(N_LOCKEDBY).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFileLockedBy());
  explorerDisplayoptions.addElement(N_PERMISSIONS).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFilePermissions());
  explorerDisplayoptions.addElement(N_SIZE).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFileSize());
  explorerDisplayoptions.addElement(N_STATE).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFileState());
  explorerDisplayoptions.addElement(N_USERLASTMODIFIED).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFileUserLastModified());
  explorerDisplayoptions.addElement(N_USERCREATED).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFileUserCreated());
  explorerDisplayoptions.addElement(N_DATERELEASED).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFileDateReleased());
  explorerDisplayoptions.addElement(N_DATEEXPIRED).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFileDateExpired());
  Element dialogPreferences=defaultPreferences.addElement(N_DIALOGSPREFERENCES);
  Element dialogDefaultSettings=dialogPreferences.addElement(N_DIALOGSDEFAULTSETTINGS);
  dialogDefaultSettings.addElement(N_FILECOPY).setText(m_workplaceManager.getDefaultUserSettings().getDialogCopyFileModeString());
  dialogDefaultSettings.addElement(N_FOLDERCOPY).setText(m_workplaceManager.getDefaultUserSettings().getDialogCopyFolderModeString());
  dialogDefaultSettings.addElement(N_FILEDELETION).setText(m_workplaceManager.getDefaultUserSettings().getDialogDeleteFileModeString());
  dialogDefaultSettings.addElement(N_DIRECTPUBLISH).setText(m_workplaceManager.getDefaultUserSettings().getDialogPublishSiblingsString());
  dialogDefaultSettings.addElement(N_SHOWLOCK).setText(m_workplaceManager.getDefaultUserSettings().getDialogShowLockString());
  dialogDefaultSettings.addElement(N_SHOWEXPORTSETTINGS).setText(m_workplaceManager.getDefaultUserSettings().getDialogShowExportSettingsString());
  dialogDefaultSettings.addElement(N_EXPANDPERMISSIONSUSER).setText(m_workplaceManager.getDefaultUserSettings().getDialogExpandUserPermissionsString());
  dialogDefaultSettings.addElement(N_EXPANDPERMISSIONSINHERITED).setText(m_workplaceManager.getDefaultUserSettings().getDialogExpandInheritedPermissionsString());
  dialogDefaultSettings.addElement(N_PERMISSIONSINHERITONFOLDER).setText(m_workplaceManager.getDefaultUserSettings().getDialogPermissionsInheritOnFolderString());
  Element editorsPreferences=defaultPreferences.addElement(N_EDITORPREFERENCES);
  Element editorGeneraloptions=editorsPreferences.addElement(N_EDITORGENERALOPTIONS);
  editorGeneraloptions.addElement(N_BUTTONSTYLE).setText(m_workplaceManager.getDefaultUserSettings().getEditorButtonStyleString());
  editorGeneraloptions.addElement(N_DIRECTEDITSTYLE).setText(m_workplaceManager.getDefaultUserSettings().getDirectEditButtonStyleString());
  Element editorPreferrededitors=editorsPreferences.addElement(N_EDITORPREFERREDEDITORS);
  Iterator editors=m_workplaceManager.getDefaultUserSettings().getEditorSettings().entrySet().iterator();
  while (editors.hasNext()) {
    Map.Entry e=(Map.Entry)editors.next();
    String type=(String)e.getKey();
    String value=(String)e.getValue();
    Element editor=editorPreferrededitors.addElement(N_EDITOR);
    editor.addAttribute(A_TYPE,type);
    editor.addAttribute(A_VALUE,value);
  }
  if (m_workplaceManager.getCustomFoot() != null) {
    Element workplaceFootCustom=workplaceElement.addElement(N_WORKPLACECUSTOMFOOT);
    workplaceFootCustom.addElement(N_COLOR).setText(m_workplaceManager.getCustomFoot().getColor());
    workplaceFootCustom.addElement(N_BACKGROUNDCOLOR).setText(m_workplaceManager.getCustomFoot().getBackgroundColor());
    Element textElement=workplaceFootCustom.addElement(N_TEXT);
    textElement.addAttribute(A_REPLACE,Boolean.toString(m_workplaceManager.getCustomFoot().isReplaceDefault()));
    textElement.setText(m_workplaceManager.getCustomFoot().getText());
  }
  Element toolManagerElement=workplaceElement.addElement(N_TOOLMANAGER);
  Element rootsElement=toolManagerElement.addElement(N_ROOTS);
  Iterator it=m_workplaceManager.getToolManager().getToolRoots().iterator();
  while (it.hasNext()) {
    CmsToolRootHandler root=(CmsToolRootHandler)it.next();
    Element rootElement=rootsElement.addElement(N_ROOT);
    rootElement.addElement(N_KEY).addText(root.getKey());
    rootElement.addElement(N_URI).addText(root.getUri());
    rootElement.addElement(N_NAME).addText(root.getName());
    rootElement.addElement(N_HELPTEXT).addText(root.getHelpText());
  }
  return workplaceElement;
}
