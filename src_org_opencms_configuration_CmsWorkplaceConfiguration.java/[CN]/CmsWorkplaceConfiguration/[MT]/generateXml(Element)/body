{
  Element workplaceElement=parent.addElement(N_WORKPLACE);
  Iterator i;
  workplaceElement.addElement(N_DEFAULTLOCALE).setText(m_workplaceManager.getDefaultLocale().toString());
  Element dialogElement=workplaceElement.addElement(N_DIALOGHANDLERS);
  Map dialogs=m_workplaceManager.getDialogHandler();
  i=dialogs.keySet().iterator();
  while (i.hasNext()) {
    String name=(String)i.next();
    dialogElement.addElement(N_DIALOGHANDLER).addAttribute(A_CLASS,dialogs.get(name).getClass().getName());
  }
  workplaceElement.addElement(N_EDITORHANDLER).addAttribute(A_CLASS,m_workplaceManager.getEditorHandler().getClass().getName());
  workplaceElement.addElement(N_EDITORACTION).addAttribute(A_CLASS,m_workplaceManager.getEditorActionHandler().getClass().getName());
  Element resourceloadersElement=workplaceElement.addElement(N_EXPORTPOINTS);
  Set points=m_workplaceManager.getExportPoints();
  i=points.iterator();
  while (i.hasNext()) {
    CmsExportPoint point=(CmsExportPoint)i.next();
    resourceloadersElement.addElement(N_EXPORTPOINT).addAttribute(A_URI,point.getUri()).addAttribute(A_DESTINATION,point.getConfiguredDestination());
  }
  workplaceElement.addElement(N_AUTOLOCK).setText(new Boolean(m_workplaceManager.autoLockResources()).toString());
  workplaceElement.addElement(N_ENABLEUSERMGMT).setText(new Boolean(m_workplaceManager.showUserGroupIcon()).toString());
  workplaceElement.addElement(N_MAXUPLOADSIZE).setText(new Integer(m_workplaceManager.getFileMaxUploadSize()).toString());
  Element labeledElement=workplaceElement.addElement(N_LABELEDFOLDERS);
  i=m_workplaceManager.getLabelSiteFolders().iterator();
  while (i.hasNext()) {
    labeledElement.addElement(N_RESOURCE).addAttribute(A_URI,(String)i.next());
  }
  Element explorerTypesElement=workplaceElement.addElement(N_EXPLORERTYPES);
  i=m_workplaceManager.getExplorerTypeSettings().iterator();
  while (i.hasNext()) {
    CmsExplorerTypeSettings settings=(CmsExplorerTypeSettings)i.next();
    Element explorerTypeElement=explorerTypesElement.addElement(N_EXPLORERTYPE);
    explorerTypeElement.addAttribute(A_NAME,settings.getName());
    explorerTypeElement.addAttribute(A_KEY,settings.getKey());
    explorerTypeElement.addAttribute(A_ICON,settings.getIcon());
    Element newResElement=explorerTypeElement.addElement(N_NEWRESOURCE);
    newResElement.addAttribute(A_URI,settings.getNewResourceUri());
    newResElement.addAttribute(A_ORDER,settings.getNewResourceOrder());
    Element accessControlElement=explorerTypeElement.addElement(N_ACCESSCONTROL);
    Iterator k=settings.getAccessEntries().keySet().iterator();
    while (k.hasNext()) {
      String key=(String)k.next();
      String value=(String)settings.getAccessEntries().get(key);
      Element accessEntryElement=accessControlElement.addElement(N_ACCESSENTRY);
      accessEntryElement.addAttribute(A_PRINCIPAL,key);
      accessEntryElement.addAttribute(A_PERMISSIONS,value);
    }
    if (settings.isResourceType()) {
      Element editOptionsElement=explorerTypeElement.addElement(N_EDITOPTIONS);
      Element defaultPropertiesElement=editOptionsElement.addElement(N_DEFAULTPROPERTIES);
      defaultPropertiesElement.addAttribute(A_ENABLED,"" + settings.isPropertiesEnabled());
      defaultPropertiesElement.addAttribute(A_SHOWNAVIGATION,"" + settings.isShowNavigation());
      Iterator m=settings.getProperties().iterator();
      while (m.hasNext()) {
        defaultPropertiesElement.addElement(N_PROPERTY).addAttribute(A_NAME,(String)m.next());
      }
      Element contextMenuElement=editOptionsElement.addElement(N_CONTEXTMENU);
      m=settings.getContextMenuEntries().iterator();
      while (m.hasNext()) {
        CmsExplorerContextMenuItem item=(CmsExplorerContextMenuItem)m.next();
        Element itemElement;
        if (CmsExplorerContextMenuItem.C_TYPE_ENTRY.equals(item.getType())) {
          itemElement=contextMenuElement.addElement(N_ENTRY);
          itemElement.addAttribute(A_KEY,item.getKey());
          itemElement.addAttribute(A_URI,item.getUri());
          if (item.isXml()) {
            itemElement.addAttribute(A_ISXML,"" + item.isXml());
          }
          if (item.getTarget() != null) {
            itemElement.addAttribute(A_TARGET,item.getTarget());
          }
          itemElement.addAttribute(A_RULES,item.getRules());
        }
 else {
          itemElement=contextMenuElement.addElement(N_SEPARATOR);
        }
        itemElement.addAttribute(A_ORDER,"" + item.getOrder());
      }
    }
  }
  Element defaultPreferences=workplaceElement.addElement(N_USER);
  Element workplacePreferences=defaultPreferences.addElement(N_WORKPLACEPREFERENCES);
  Element workplaceGeneraloptions=workplacePreferences.addElement(N_WORKPLACEGENERALOPTIONS);
  workplaceGeneraloptions.addElement(N_BUTTONSTYLE).setText(m_workplaceManager.getDefaultUserSettings().getWorkplaceButtonStyleString());
  workplaceGeneraloptions.addElement(N_REPORTTYPE).setText(m_workplaceManager.getDefaultUserSettings().getWorkplaceReportType());
  workplaceGeneraloptions.addElement(N_UPLOADAPPLET).setText(m_workplaceManager.getDefaultUserSettings().getUploadAppletString());
  Element workplaceStartupsettings=workplacePreferences.addElement(N_WORKPLACESTARTUPSETTINGS);
  workplaceStartupsettings.addElement(N_LOCALE).setText(m_workplaceManager.getDefaultUserSettings().getLocale().toString());
  workplaceStartupsettings.addElement(N_PROJECT).setText(m_workplaceManager.getDefaultUserSettings().getStartProject());
  workplaceStartupsettings.addElement(N_WORKPLACEVIEW).setText(m_workplaceManager.getDefaultUserSettings().getStartView());
  workplaceStartupsettings.addElement(N_FOLDER).setText(m_workplaceManager.getDefaultUserSettings().getStartFolder());
  workplaceStartupsettings.addElement(N_SITE).setText(m_workplaceManager.getDefaultUserSettings().getStartSite());
  workplaceStartupsettings.addElement(N_RESTRICTEXPLORERVIEW).setText(m_workplaceManager.getDefaultUserSettings().getRestrictExplorerViewString());
  Element explorerPreferences=defaultPreferences.addElement(N_EXPLORERPREFERENCES);
  Element explorerGeneraloptions=explorerPreferences.addElement(N_EXPLORERPREFERENCES);
  explorerGeneraloptions.addElement(N_BUTTONSTYLE).setText(m_workplaceManager.getDefaultUserSettings().getExplorerButtonStyleString());
  explorerGeneraloptions.addElement(N_ENTRIES).setText("" + m_workplaceManager.getDefaultUserSettings().getExplorerFileEntries());
  Element explorerDisplayoptions=explorerPreferences.addElement(N_EXPLORERDISPLAYOPTIONS);
  explorerDisplayoptions.addElement(N_TITLE).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFileTitle());
  explorerDisplayoptions.addElement(N_TYPE).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFileType());
  explorerDisplayoptions.addElement(N_DATELASTMODIFIED).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFileDateLastModified());
  explorerDisplayoptions.addElement(N_DATECREATED).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFileDateCreated());
  explorerDisplayoptions.addElement(N_LOCKEDBY).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFileLockedBy());
  explorerDisplayoptions.addElement(N_PERMISSIONS).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFilePermissions());
  explorerDisplayoptions.addElement(N_SIZE).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFileSize());
  explorerDisplayoptions.addElement(N_STATE).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFileState());
  explorerDisplayoptions.addElement(N_USERLASTMODIFIED).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFileUserLastModified());
  explorerDisplayoptions.addElement(N_USERCREATED).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFileUserCreated());
  explorerDisplayoptions.addElement(N_DATERELEASED).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFileDateReleased());
  explorerDisplayoptions.addElement(N_DATEEXPIRED).setText(m_workplaceManager.getDefaultUserSettings().getShowExplorerFileDateExpired());
  Element dialogPreferences=defaultPreferences.addElement(N_DIALOGSPREFERENCES);
  Element dialogDefaultSettings=dialogPreferences.addElement(N_DIALOGSDEFAULTSETTINGS);
  dialogDefaultSettings.addElement(N_FILECOPY).setText(m_workplaceManager.getDefaultUserSettings().getDialogCopyFileModeString());
  dialogDefaultSettings.addElement(N_FOLDERCOPY).setText(m_workplaceManager.getDefaultUserSettings().getDialogCopyFolderModeString());
  dialogDefaultSettings.addElement(N_FILEDELETION).setText(m_workplaceManager.getDefaultUserSettings().getDialogDeleteFileModeString());
  dialogDefaultSettings.addElement(N_DIRECTPUBLISH).setText(m_workplaceManager.getDefaultUserSettings().getDialogPublishSiblingsString());
  dialogDefaultSettings.addElement(N_SHOWLOCK).setText(m_workplaceManager.getDefaultUserSettings().getDialogShowLockString());
  Element editorsPreferences=defaultPreferences.addElement(N_EDITORPREFERENCES);
  Element editorGeneraloptions=editorsPreferences.addElement(N_EDITORGENERALOPTIONS);
  editorGeneraloptions.addElement(N_BUTTONSTYLE).setText(m_workplaceManager.getDefaultUserSettings().getEditorButtonStyleString());
  editorGeneraloptions.addElement(N_DIRECTEDITSTYLE).setText(m_workplaceManager.getDefaultUserSettings().getDirectEditButtonStyleString());
  Element editorPreferrededitors=editorsPreferences.addElement(N_EDITORPREFERREDEDITORS);
  Iterator editors=m_workplaceManager.getDefaultUserSettings().getEditorSettings().keySet().iterator();
  while (editors.hasNext()) {
    String type=(String)editors.next();
    String value=m_workplaceManager.getDefaultUserSettings().getPreferredEditor(type);
    Element editor=editorPreferrededitors.addElement(N_EDITOR);
    editor.addAttribute(A_TYPE,type);
    editor.addAttribute(A_VALUE,value);
  }
  Element workflowPreferences=defaultPreferences.addElement(N_WORKFLOWPREFERENCES);
  Element workflowGeneraloptions=workflowPreferences.addElement(N_WORKFLOWGENERALOPTIONS);
  workflowGeneraloptions.addElement(N_STARTUPFILTER).setText(m_workplaceManager.getDefaultUserSettings().getTaskStartupFilterDefault());
  workflowGeneraloptions.addElement(N_SHOWPROJECTS).setText(m_workplaceManager.getDefaultUserSettings().getTaskShowAllProjectsString());
  Element workflowDefaultsettings=workflowPreferences.addElement(N_WORKFLOWDEFAULTSETTINGS);
  workflowDefaultsettings.addElement(N_MESSAGEACCEPTED).setText(m_workplaceManager.getDefaultUserSettings().getTaskMessageAcceptedString());
  workflowDefaultsettings.addElement(N_MESSAGECOMPLETED).setText(m_workplaceManager.getDefaultUserSettings().getTaskMessageCompletedString());
  workflowDefaultsettings.addElement(N_MESSAGEFORWARDED).setText(m_workplaceManager.getDefaultUserSettings().getTaskMessageForwardedString());
  workflowDefaultsettings.addElement(N_INFORMROLEMEMBERS).setText(m_workplaceManager.getDefaultUserSettings().getTaskMessageMembersString());
  return workplaceElement;
}
