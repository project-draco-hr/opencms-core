{
  Element itemElement;
  if (CmsExplorerContextMenuItem.TYPE_ENTRY.equals(item.getType())) {
    itemElement=parentElement.addElement(N_ENTRY);
    itemElement.addAttribute(A_KEY,CmsEncoder.escapeXml(item.getKey()));
    itemElement.addAttribute(A_URI,CmsEncoder.escapeXml(item.getUri()));
    if (item.getTarget() != null) {
      itemElement.addAttribute(A_TARGET,CmsEncoder.escapeXml(item.getTarget()));
    }
    String rule=item.getRule();
    if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(rule)) {
      itemElement.addAttribute(A_RULE,CmsEncoder.escapeXml(rule));
    }
 else {
      String legacyRules=item.getRules();
      if (CmsStringUtil.isNotEmpty(legacyRules) && menuRuleTranslator.hasMenuRule(legacyRules)) {
        itemElement.addAttribute(A_RULE,CmsEncoder.escapeXml(menuRuleTranslator.getMenuRuleName(legacyRules)));
      }
 else {
        itemElement.addAttribute(A_RULES,CmsEncoder.escapeXml(legacyRules));
      }
    }
    if (item.isParentItem()) {
      Iterator i=item.getSubItems().iterator();
      while (i.hasNext()) {
        CmsExplorerContextMenuItem subItem=(CmsExplorerContextMenuItem)i.next();
        generateContextMenuItemXml(itemElement,menuRuleTranslator,subItem);
      }
    }
  }
 else {
    parentElement.addElement(N_SEPARATOR);
  }
}
