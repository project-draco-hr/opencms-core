{
  CmsObject cms=getCmsObject();
  echo("Testing automatic index update after modification of a resource");
  cms.createResource("/test/",CmsResourceTypeFolder.RESOURCE_TYPE_ID,null,null);
  cms.unlockResource("/test/");
  String fileName="/test/test.txt";
  String text1="Alkacon OpenCms is great!";
  cms.createResource(fileName,CmsResourceTypePlain.getStaticTypeId(),text1.getBytes(),null);
  Thread.sleep(1500);
  CmsSearch cmsSearchBean=new CmsSearch();
  cmsSearchBean.init(cms);
  cmsSearchBean.setIndex(INDEX_SPECIAL);
  cmsSearchBean.setSearchRoot("/");
  List results;
  cmsSearchBean.setQuery("+Alkacon +OpenCms");
  results=cmsSearchBean.getSearchResult();
  TestCmsSearch.printResults(results,cms);
  assertEquals(8,results.size());
  assertEquals("/sites/default/test/test.txt",((CmsSearchResult)results.get(7)).getPath());
  cms.writePropertyObject(fileName,new CmsProperty(CmsPropertyDefinition.PROPERTY_TITLE,"Alkacon OpenCms IN THE NEW FILE",""));
  Thread.sleep(1500);
  cmsSearchBean.setQuery("+Alkacon +OpenCms");
  results=cmsSearchBean.getSearchResult();
  TestCmsSearch.printResults(results,cms);
  assertEquals(8,results.size());
  assertEquals("/sites/default/test/test.txt",((CmsSearchResult)results.get(1)).getPath());
  String deleteFileName="/types/text.txt";
  cms.lockResource(deleteFileName);
  cms.deleteResource(deleteFileName,CmsResource.DELETE_PRESERVE_SIBLINGS);
  Thread.sleep(1500);
  cmsSearchBean.setQuery("+Alkacon +OpenCms");
  results=cmsSearchBean.getSearchResult();
  TestCmsSearch.printResults(results,cms);
  assertEquals(7,results.size());
  assertEquals("/sites/default/test/test.txt",((CmsSearchResult)results.get(0)).getPath());
  String moveFileName="/test/test_moved.txt";
  cms.moveResource(fileName,moveFileName);
  Thread.sleep(1500);
  cmsSearchBean.setQuery("+Alkacon +OpenCms");
  results=cmsSearchBean.getSearchResult();
  TestCmsSearch.printResults(results,cms);
  assertEquals(7,results.size());
  assertEquals("/sites/default/test/test_moved.txt",((CmsSearchResult)results.get(0)).getPath());
}
