{
  CmsObject cms=getCmsObject();
  echo("Testing automatic index update after modification of a resource");
  cms.createResource("/test/",CmsResourceTypeFolder.RESOURCE_TYPE_ID,null,null);
  cms.unlockResource("/test/");
  String fileName="/test/test.txt";
  String text1="Alkacon OpenCms is great!";
  cms.createResource(fileName,CmsResourceTypePlain.getStaticTypeId(),text1.getBytes(),null);
  waitForUpdate();
  CmsSearch cmsSearchBean=new CmsSearch();
  cmsSearchBean.setIndex(INDEX_SPECIAL);
  cmsSearchBean.setSearchRoot("/");
  cmsSearchBean.setQuery("+Alkacon +OpenCms");
  List<CmsSearchResult> results;
  cmsSearchBean.init(cms);
  results=cmsSearchBean.getSearchResult();
  TestCmsSearch.printResults(results,cms);
  assertEquals(8,results.size());
  assertEquals("/sites/default/test/test.txt",results.get(7).getPath());
  cms.writePropertyObject(fileName,new CmsProperty(CmsPropertyDefinition.PROPERTY_TITLE,"Alkacon OpenCms IN THE NEW FILE",""));
  waitForUpdate();
  cmsSearchBean.setQuery("+Alkacon +OpenCms");
  results=cmsSearchBean.getSearchResult();
  TestCmsSearch.printResults(results,cms);
  assertEquals(8,results.size());
  assertEquals("/sites/default/test/test.txt",(results.get(1)).getPath());
  echo("Delete Test - start");
  String deleteFileName="/types/text.txt";
  cms.lockResource(deleteFileName);
  cms.deleteResource(deleteFileName,CmsResource.DELETE_PRESERVE_SIBLINGS);
  waitForUpdate();
  cmsSearchBean.setQuery("+Alkacon +OpenCms");
  results=cmsSearchBean.getSearchResult();
  TestCmsSearch.printResults(results,cms);
  assertEquals(7,results.size());
  assertEquals("/sites/default/test/test.txt",(results.get(0)).getPath());
  echo("Delete Test - end");
  String moveFileName="/test/test_moved.txt";
  cms.moveResource(fileName,moveFileName);
  waitForUpdate();
  cmsSearchBean.setQuery("+Alkacon +OpenCms");
  results=cmsSearchBean.getSearchResult();
  TestCmsSearch.printResults(results,cms);
  assertEquals(7,results.size());
  assertEquals("/sites/default/test/test_moved.txt",(results.get(0)).getPath());
}
