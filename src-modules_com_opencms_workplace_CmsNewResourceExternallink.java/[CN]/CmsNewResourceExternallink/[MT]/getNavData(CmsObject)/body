{
  CmsXmlLanguageFile lang=new CmsXmlLanguageFile(cms);
  String[] filenames;
  String[] nicenames;
  String[] positions;
  Hashtable storage=new Hashtable();
  CmsFolder folder=null;
  CmsFile file=null;
  String nicename=null;
  String currentFilelist=null;
  int count=1;
  float max=0;
  currentFilelist=CmsWorkplaceAction.getCurrentFolder(CmsXmlTemplateLoader.getRequest(cms.getRequestContext()).getOriginalRequest());
  if (currentFilelist == null) {
    currentFilelist=cms.getSitePath(cms.readFolder("/"));
  }
  List files=cms.getFilesInFolder(currentFilelist);
  List folders=cms.getSubFolders(currentFilelist);
  Vector filefolders=new Vector();
  Iterator en=folders.iterator();
  while (en.hasNext()) {
    folder=(CmsFolder)en.next();
    filefolders.addElement(folder);
  }
  en=files.iterator();
  while (en.hasNext()) {
    file=(CmsFile)en.next();
    filefolders.addElement(file);
  }
  if (filefolders.size() > 0) {
    filenames=new String[filefolders.size() + 2];
    nicenames=new String[filefolders.size() + 2];
    positions=new String[filefolders.size() + 2];
    en=filefolders.iterator();
    while (en.hasNext()) {
      CmsResource res=(CmsResource)en.next();
      if (res.getState() != CmsResource.STATE_DELETED) {
        String navpos=cms.readProperty(cms.getSitePath(res),CmsPropertyDefinition.PROPERTY_NAVPOS);
        if (navpos != null) {
          nicename=cms.readProperty(cms.getSitePath(res),CmsPropertyDefinition.PROPERTY_NAVTEXT);
          if (nicename == null) {
            nicename=res.getName();
          }
          filenames[count]=cms.getSitePath(res);
          nicenames[count]=nicename;
          positions[count]=navpos;
          if (new Float(navpos).floatValue() > max) {
            max=new Float(navpos).floatValue();
          }
          count++;
        }
      }
    }
  }
 else {
    filenames=new String[2];
    nicenames=new String[2];
    positions=new String[2];
  }
  filenames[0]="FIRSTENTRY";
  nicenames[0]=lang.getLanguageValue("input.firstelement");
  positions[0]="0";
  filenames[count]="LASTENTRY";
  nicenames[count]=lang.getLanguageValue("input.lastelement");
  positions[count]=new Float(max + 1).toString();
  sort(cms,filenames,nicenames,positions,count);
  storage.put("FILENAMES",filenames);
  storage.put("NICENAMES",nicenames);
  storage.put("POSITIONS",positions);
  storage.put("COUNT",new Integer(count));
  return storage;
}
