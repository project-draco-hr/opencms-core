{
  try {
    List elementList=computeElements();
    if (elementList == null) {
      throw new CmsException("Elements not specified on template file!");
    }
    CmsFile file=getCms().readFile(this.getParamTempfile());
    CmsXmlPage page=CmsXmlPage.read(getCms(),file);
    boolean foundMandatory=false;
    String changeBody="";
    Iterator i=elementList.iterator();
    while (i.hasNext()) {
      String[] currentElement=(String[])i.next();
      String elementName=currentElement[0];
      boolean isMandatory="1".equals(currentElement[2]);
      if (isMandatory || "true".equals(getJsp().getRequest().getParameter(PREFIX_PARAM_BODY + elementName))) {
        page.setEnabled(elementName,getParamBodylanguage(),true);
        if (isMandatory && !foundMandatory) {
          changeBody=elementName;
          foundMandatory=true;
        }
      }
 else {
        page.setEnabled(elementName,getParamBodylanguage(),false);
      }
    }
    getCms().writeFile(page.write(file));
    if (page.isEnabled(getParamBodyname(),getParamBodylanguage())) {
      changeBody=getParamBodyname();
    }
 else     if (!foundMandatory) {
      changeBody=((String[])elementList.get(0))[0];
    }
    setParamOkFunctions("window.opener.changeBody(\"" + changeBody + "\", \""+ getParamBodylanguage()+ "\");window.close();");
    getJsp().getRequest().setAttribute(C_SESSION_WORKPLACE_CLASS,this);
    closeDialog();
  }
 catch (  CmsException e) {
  }
}
