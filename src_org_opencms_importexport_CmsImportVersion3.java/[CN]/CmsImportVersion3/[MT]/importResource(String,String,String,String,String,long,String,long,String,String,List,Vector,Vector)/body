{
  boolean success=true;
  byte[] content=null;
  String fullname=null;
  CmsResource res=null;
  try {
    if (m_importingChannelData) {
      String channelId=null;
      try {
        if ((type.equalsIgnoreCase(CmsResourceTypeFolder.C_RESOURCE_TYPE_NAME)) && (!destination.endsWith(I_CmsConstants.C_FOLDER_SEPARATOR))) {
          destination+=I_CmsConstants.C_FOLDER_SEPARATOR;
        }
        CmsResource channel=m_cms.readResource(I_CmsConstants.C_ROOT + destination);
        channelId=m_cms.readPropertyObject(m_cms.getSitePath(channel),I_CmsConstants.C_PROPERTY_CHANNELID,false).getValue();
      }
 catch (      Exception e) {
      }
      if (channelId != null) {
        properties.add(new CmsProperty(I_CmsConstants.C_PROPERTY_CHANNELID,channelId,null));
      }
    }
    if (source != null) {
      content=getFileBytes(source);
    }
    int resType=OpenCms.getResourceManager().getResourceType(type).getTypeId();
    int size=0;
    if (content != null) {
      size=content.length;
    }
    CmsUUID curUser=m_cms.getRequestContext().currentUser().getId();
    CmsUUID newUserlastmodified=new CmsUUID(userlastmodified);
    CmsUUID newUsercreated=new CmsUUID(usercreated);
    if (m_cms.readUser(newUserlastmodified).getId().equals(CmsUUID.getNullUUID())) {
      newUserlastmodified=curUser;
    }
    if (m_cms.readUser(newUsercreated).getId().equals(CmsUUID.getNullUUID())) {
      newUsercreated=curUser;
    }
    CmsUUID newUuidstructure=new CmsUUID();
    CmsUUID newUuidresource=new CmsUUID();
    if (uuidstructure != null) {
      newUuidstructure=new CmsUUID(uuidstructure);
    }
    if (uuidresource != null) {
      newUuidresource=new CmsUUID(uuidresource);
    }
    if (m_convertToXmlPage && (resType == A_CmsImport.C_RESOURCE_TYPE_PAGE_ID || resType == C_RESOURCE_TYPE_NEWPAGE_ID)) {
      if (content != null) {
        String encoding=null;
        encoding=CmsProperty.get(I_CmsConstants.C_PROPERTY_CONTENT_ENCODING,properties).getValue();
        if (encoding == null) {
          encoding=OpenCms.getSystemInfo().getDefaultEncoding();
        }
        CmsXmlPage xmlPage=CmsXmlPageConverter.convertToXmlPage(m_cms,new String(content,encoding),"body",getLocale(destination,properties),encoding);
        content=xmlPage.marshal();
      }
      resType=CmsResourceTypeXmlPage.C_RESOURCE_TYPE_ID;
    }
    CmsResource resource=new CmsResource(newUuidstructure,newUuidresource,destination,resType,CmsFolder.isFolderType(resType),new Integer(flags).intValue(),m_cms.getRequestContext().currentProject().getId(),I_CmsConstants.C_STATE_NEW,datelastmodified,newUserlastmodified,datecreated,newUsercreated,CmsResource.DATE_RELEASED_DEFAULT,CmsResource.DATE_EXPIRED_DEFAULT,1,size);
    res=m_cms.importResource(m_importPath + destination,resource,content,properties);
    if (res != null) {
      if (A_CmsImport.C_RESOURCE_TYPE_PAGE_NAME.equals(type)) {
        m_importedPages.add(I_CmsConstants.C_FOLDER_SEPARATOR + destination);
      }
    }
    m_report.println(m_report.key("report.ok"),I_CmsReport.C_FORMAT_OK);
  }
 catch (  Exception exc) {
    success=false;
    m_report.println(exc);
    try {
      Thread.sleep(1000);
    }
 catch (    Exception e) {
    }
  }
  byte[] digestContent={0};
  if (content != null) {
    digestContent=m_digest.digest(content);
  }
  if (success && (fullname != null)) {
    if (writtenFilenames != null) {
      writtenFilenames.addElement(fullname);
    }
    if (fileCodes != null) {
      fileCodes.addElement(new String(digestContent));
    }
  }
  return res;
}
