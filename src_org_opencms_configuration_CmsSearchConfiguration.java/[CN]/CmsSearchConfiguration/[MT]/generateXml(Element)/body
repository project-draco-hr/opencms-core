{
  Element searchElement=parent.addElement(N_SEARCH);
  if (OpenCms.getRunLevel() >= OpenCms.RUNLEVEL_3_SHELL_ACCESS) {
    m_searchManager=OpenCms.getSearchManager();
  }
  if (!m_searchManager.getClass().equals(CmsSearchManager.class)) {
    searchElement.addAttribute(A_CLASS,m_searchManager.getClass().getName());
  }
  searchElement.addElement(N_DIRECTORY).addText(m_searchManager.getDirectory());
  searchElement.addElement(N_TIMEOUT).addText(String.valueOf(m_searchManager.getTimeout()));
  searchElement.addElement(N_OFFLINE_UPDATE_FREQUENCY).addText(String.valueOf(m_searchManager.getOfflineUpdateFrequency()));
  if (m_searchManager.getForceunlock() != null) {
    searchElement.addElement(N_FORCEUNLOCK).addText(m_searchManager.getForceunlock().toString());
  }
  searchElement.addElement(N_EXCERPT).addText(String.valueOf(m_searchManager.getMaxExcerptLength()));
  searchElement.addElement(N_EXTRACTION_CACHE_MAX_AGE).addText(String.valueOf(m_searchManager.getExtractionCacheMaxAge()));
  searchElement.addElement(N_MAX_MODIFICATIONS_BEFORE_COMMIT).addText(String.valueOf(m_searchManager.getMaxModificationsBeforeCommit()));
  searchElement.addElement(N_HIGHLIGHTER).addText(m_searchManager.getHighlighter().getClass().getName());
  Element documenttypesElement=searchElement.addElement(N_DOCUMENTTYPES);
  List docTypeKeyList=m_searchManager.getDocumentTypeConfigs();
  Iterator docTypeIterator=docTypeKeyList.iterator();
  while (docTypeIterator.hasNext()) {
    CmsSearchDocumentType currSearchDocType=(CmsSearchDocumentType)docTypeIterator.next();
    Element documenttypeElement=documenttypesElement.addElement(N_DOCUMENTTYPE);
    documenttypeElement.addElement(N_NAME).addText(currSearchDocType.getName());
    documenttypeElement.addElement(N_CLASS).addText(currSearchDocType.getClassName());
    Element mimetypesElement=documenttypeElement.addElement(N_MIMETYPES);
    Iterator mimeTypesIterator=currSearchDocType.getMimeTypes().iterator();
    while (mimeTypesIterator.hasNext()) {
      mimetypesElement.addElement(N_MIMETYPE).addText((String)mimeTypesIterator.next());
    }
    Element restypesElement=documenttypeElement.addElement(N_RESOURCETYPES);
    Iterator resTypesIterator=currSearchDocType.getResourceTypes().iterator();
    while (resTypesIterator.hasNext()) {
      restypesElement.addElement(N_RESOURCETYPE).addText((String)resTypesIterator.next());
    }
  }
  Element analyzersElement=searchElement.addElement(N_ANALYZERS);
  List analyzerLocaleList=new ArrayList(m_searchManager.getAnalyzers().keySet());
  Collections.sort(analyzerLocaleList,CmsLocaleComparator.getComparator());
  Iterator analyzersLocaleInterator=analyzerLocaleList.iterator();
  while (analyzersLocaleInterator.hasNext()) {
    CmsSearchAnalyzer searchAnalyzer=m_searchManager.getCmsSearchAnalyzer((Locale)analyzersLocaleInterator.next());
    Element analyzerElement=analyzersElement.addElement(N_ANALYZER);
    analyzerElement.addElement(N_CLASS).addText(searchAnalyzer.getClassName());
    if (searchAnalyzer.getStemmerAlgorithm() != null) {
      analyzerElement.addElement(N_STEMMER).addText(searchAnalyzer.getStemmerAlgorithm());
    }
    analyzerElement.addElement(N_LOCALE).addText(searchAnalyzer.getLocale().toString());
  }
  Element indexesElement=searchElement.addElement(N_INDEXES);
  Iterator indexIterator=m_searchManager.getSearchIndexes().iterator();
  while (indexIterator.hasNext()) {
    CmsSearchIndex searchIndex=(CmsSearchIndex)indexIterator.next();
    Element indexElement=indexesElement.addElement(N_INDEX);
    if (!searchIndex.getClass().equals(CmsSearchIndex.class)) {
      indexElement.addAttribute(A_CLASS,searchIndex.getClass().getName());
    }
    indexElement.addElement(N_NAME).addText(searchIndex.getName());
    indexElement.addElement(N_REBUILD).addText(searchIndex.getRebuildMode());
    indexElement.addElement(N_PROJECT).addText(searchIndex.getProject());
    indexElement.addElement(N_LOCALE).addText(searchIndex.getLocale().toString());
    String fieldConfigurationName=searchIndex.getFieldConfigurationName();
    if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(fieldConfigurationName)) {
      indexElement.addElement(N_CONFIGURATION).addText(fieldConfigurationName);
    }
    Element sourcesElement=indexElement.addElement(N_SOURCES);
    Iterator sourcesIterator=searchIndex.getSourceNames().iterator();
    while (sourcesIterator.hasNext()) {
      sourcesElement.addElement(N_SOURCE).addText((String)sourcesIterator.next());
    }
    CmsParameterConfiguration indexConfiguration=searchIndex.getConfiguration();
    if (indexConfiguration != null) {
      indexConfiguration.appendToXml(indexElement);
    }
  }
  Element indexsourcesElement=searchElement.addElement(N_INDEXSOURCES);
  List indexSources=new ArrayList(m_searchManager.getSearchIndexSources().values());
  Iterator indexsourceIterator=indexSources.iterator();
  while (indexsourceIterator.hasNext()) {
    CmsSearchIndexSource searchIndexSource=(CmsSearchIndexSource)indexsourceIterator.next();
    Element indexsourceElement=indexsourcesElement.addElement(N_INDEXSOURCE);
    indexsourceElement.addElement(N_NAME).addText(searchIndexSource.getName());
    Element indexerElement=indexsourceElement.addElement(N_INDEXER).addAttribute(N_CLASS,searchIndexSource.getIndexerClassName());
    Map params=searchIndexSource.getParams();
    Iterator paramIterator=params.entrySet().iterator();
    while (paramIterator.hasNext()) {
      Map.Entry entry=(Map.Entry)paramIterator.next();
      String name=(String)entry.getKey();
      String value=(String)entry.getValue();
      indexerElement.addElement(I_CmsXmlConfiguration.N_PARAM).addAttribute(I_CmsXmlConfiguration.A_NAME,name).addText(value);
    }
    Element resourcesElement=indexsourceElement.addElement(N_RESOURCES);
    Iterator resourceIterator=searchIndexSource.getResourcesNames().iterator();
    while (resourceIterator.hasNext()) {
      resourcesElement.addElement(N_RESOURCE).addText((String)resourceIterator.next());
    }
    Element doctypes_indexedElement=indexsourceElement.addElement(N_DOCUMENTTYPES_INDEXED);
    Iterator doctypesIterator=searchIndexSource.getDocumentTypes().iterator();
    while (doctypesIterator.hasNext()) {
      doctypes_indexedElement.addElement(N_NAME).addText((String)doctypesIterator.next());
    }
  }
  Element fieldConfigurationsElement=searchElement.addElement(N_FIELDCONFIGURATIONS);
  Iterator configs=m_searchManager.getFieldConfigurations().iterator();
  while (configs.hasNext()) {
    CmsSearchFieldConfiguration fieldConfiguration=(CmsSearchFieldConfiguration)configs.next();
    Element fieldConfigurationElement=fieldConfigurationsElement.addElement(N_FIELDCONFIGURATION);
    if (!fieldConfiguration.getClass().equals(CmsSearchFieldConfiguration.class)) {
      fieldConfigurationElement.addAttribute(A_CLASS,fieldConfiguration.getClass().getName());
    }
    fieldConfigurationElement.addElement(N_NAME).setText(fieldConfiguration.getName());
    if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(fieldConfiguration.getDescription())) {
      fieldConfigurationElement.addElement(N_DESCRIPTION).setText(fieldConfiguration.getDescription());
    }
    Element fieldsElement=fieldConfigurationElement.addElement(N_FIELDS);
    Iterator fields=fieldConfiguration.getFields().iterator();
    while (fields.hasNext()) {
      CmsSearchField field=(CmsSearchField)fields.next();
      Element fieldElement=fieldsElement.addElement(N_FIELD);
      fieldElement.addAttribute(A_NAME,field.getName());
      if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(field.getDisplayNameForConfiguration())) {
        fieldElement.addAttribute(A_DISPLAY,field.getDisplayNameForConfiguration());
      }
      if (field.isCompressed()) {
        fieldElement.addAttribute(A_STORE,CmsSearchField.STR_COMPRESS);
      }
 else {
        fieldElement.addAttribute(A_STORE,String.valueOf(field.isStored()));
      }
      String index;
      if (field.isIndexed()) {
        if (field.isTokenizedAndIndexed()) {
          index=CmsStringUtil.TRUE;
        }
 else {
          index=CmsSearchField.STR_UN_TOKENIZED;
        }
      }
 else {
        index=CmsStringUtil.FALSE;
      }
      fieldElement.addAttribute(A_INDEX,index);
      if (field.getBoost() != CmsSearchField.BOOST_DEFAULT) {
        fieldElement.addAttribute(A_BOOST,String.valueOf(field.getBoost()));
      }
      if (field.isInExcerptAndStored()) {
        fieldElement.addAttribute(A_EXCERPT,String.valueOf(true));
      }
      if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(field.getDefaultValue())) {
        fieldElement.addAttribute(A_DEFAULT,field.getDefaultValue());
      }
      if (field.getAnalyzer() != null) {
        String className=field.getAnalyzer().getClass().getName();
        if (className.startsWith(CmsSearchManager.LUCENE_ANALYZER)) {
          className=className.substring(CmsSearchManager.LUCENE_ANALYZER.length());
        }
        fieldElement.addAttribute(A_ANALYZER,className);
      }
      Iterator mappings=field.getMappings().iterator();
      while (mappings.hasNext()) {
        CmsSearchFieldMapping mapping=(CmsSearchFieldMapping)mappings.next();
        Element mappingElement=fieldElement.addElement(N_MAPPING);
        mappingElement.addAttribute(A_TYPE,mapping.getType().toString());
        if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(mapping.getDefaultValue())) {
          mappingElement.addAttribute(A_DEFAULT,mapping.getDefaultValue());
        }
        if (!mapping.getClass().equals(CmsSearchFieldMapping.class) || (mapping.getType() == CmsSearchFieldMappingType.DYNAMIC)) {
          mappingElement.addAttribute(A_CLASS,mapping.getClass().getName());
        }
        if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(mapping.getParam())) {
          mappingElement.setText(mapping.getParam());
        }
      }
    }
  }
  return searchElement;
}
