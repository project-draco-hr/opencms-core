{
  try {
    CmsFile file=readFile(cms,resource);
    String absolutePath=cms.getSitePath(file);
    A_CmsXmlDocument xmlContent=CmsXmlContentFactory.unmarshal(cms,file);
    List locales=xmlContent.getLocales();
    if (locales.size() == 0) {
      locales=OpenCms.getLocaleManager().getDefaultLocales(cms,absolutePath);
    }
    Locale locale=OpenCms.getLocaleManager().getBestMatchingLocale(index.getLocale(),OpenCms.getLocaleManager().getDefaultLocales(cms,absolutePath),locales);
    List elements=xmlContent.getNames(locale);
    StringBuffer content=new StringBuffer();
    HashMap items=new HashMap();
    for (Iterator i=elements.iterator(); i.hasNext(); ) {
      String xpath=(String)i.next();
      I_CmsXmlContentValue value=xmlContent.getValue(xpath,locale);
      if (value.getContentDefinition().getContentHandler().isSearchable(value)) {
        String extracted=value.getPlainText(cms);
        if (CmsStringUtil.isNotEmptyOrWhitespaceOnly(extracted)) {
          items.put(xpath,extracted);
          content.append(extracted);
          content.append('\n');
        }
      }
    }
    return new CmsExtractionResult(content.toString(),items);
  }
 catch (  Exception e) {
    throw new CmsIndexException(Messages.get().container(Messages.ERR_TEXT_EXTRACTION_1,resource.getRootPath()),e);
  }
}
