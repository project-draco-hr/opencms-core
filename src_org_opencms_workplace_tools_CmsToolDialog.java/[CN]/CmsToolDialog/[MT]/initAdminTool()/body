{
  Map params=new HashMap(getParameterMap());
  getToolManager().initParams(this,getParamPath(),getParamRoot());
  if (!useNewStyle()) {
    params.put(PARAM_STYLE,new String[]{CmsToolDialog.STYLE_NEW});
    setParamStyle(CmsToolDialog.STYLE_NEW);
  }
  try {
    CmsDialog wp=(CmsDialog)this;
    if (CmsStringUtil.isEmptyOrWhitespaceOnly(wp.getParamCloseLink())) {
      if (!getToolManager().getRootToolPath(this).equals(getToolManager().getCurrentToolPath(this))) {
        Map args=getToolManager().resolveAdminTool(getParentPath()).getHandler().getParameters(wp);
        wp.setParamCloseLink(CmsToolManager.linkForToolPath(getJsp(),getParentPath(),args));
        params.put(CmsDialog.PARAM_CLOSELINK,new String[]{wp.getParamCloseLink()});
      }
    }
  }
 catch (  Exception e) {
  }
  return params;
}
