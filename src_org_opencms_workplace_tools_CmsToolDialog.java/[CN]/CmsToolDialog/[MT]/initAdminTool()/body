{
  Map params=new HashMap(getJsp().getRequest().getParameterMap());
  getToolManager().initParams(this,getParamPath(),getParamRoot());
  if (!useNewStyle()) {
    params.put(PARAM_STYLE,"new");
    setParamStyle("new");
  }
  try {
    if (!getAdminTool().getHandler().isEnabled(getCms())) {
      params.put(PARAM_PATH,getParentPath());
      setParamPath(getParentPath());
    }
  }
 catch (  Exception e) {
  }
  try {
    CmsDialog wp=(CmsDialog)this;
    if (wp.getParamCloseLink() == null) {
      if (!getToolManager().getRootToolPath(this).equals(getToolManager().getCurrentToolPath(this))) {
        wp.setParamCloseLink(getToolManager().linkForPath(getJsp(),getParentPath(),null));
        params.put(CmsDialog.PARAM_CLOSELINK,wp.getParamCloseLink());
      }
    }
  }
 catch (  Exception e) {
  }
  return params;
}
